{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/material/source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/material/source/img/avatar.png","path":"img/avatar.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/browserstack_logo.png","path":"img/browserstack_logo.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/bg.png","path":"img/bg.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/logo.png","path":"img/logo.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/upyun_logo.svg","path":"img/upyun_logo.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/sidebar_header.png","path":"img/sidebar_header.png","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.woff","path":"fonts/MaterialIcons-Regular.woff","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.woff2","path":"fonts/MaterialIcons-Regular.woff2","modified":0,"renderable":1},{"_id":"themes/material/source/css/duoshuo.css","path":"css/duoshuo.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/disqus-proxy.css","path":"css/disqus-proxy.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/disqus-proxy.min.css","path":"css/disqus-proxy.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/duoshuo.min.css","path":"css/duoshuo.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/ie-blocker.css","path":"css/ie-blocker.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/fontawesome.min.css","path":"css/fontawesome.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/gallery.min.css","path":"css/gallery.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/material-icons.css","path":"css/material-icons.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify.css","path":"css/prettify.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/uc.css","path":"css/uc.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify.min.css","path":"css/prettify.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/js/hanabi-browser-bundle.js","path":"js/hanabi-browser-bundle.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/ie-blocker.en.js","path":"js/ie-blocker.en.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/Valine.min.js","path":"js/Valine.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/MathJax.js","path":"js/MathJax.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/ie-blocker.zhCN.js","path":"js/ie-blocker.zhCN.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/lsloader.js","path":"js/lsloader.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/lsloader.min.js","path":"js/lsloader.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/nprogress.js","path":"js/nprogress.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/queue.js","path":"js/queue.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/prettify.min.js","path":"js/prettify.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/queue.min.js","path":"js/queue.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/smoothscroll.js","path":"js/smoothscroll.js","modified":0,"renderable":1},{"_id":"themes/material/source/img/daily_pic.png","path":"img/daily_pic.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/portrait.jpeg","path":"img/portrait.jpeg","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.ttf","path":"fonts/MaterialIcons-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/fontawesome-webfont.woff","path":"fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/fontawesome-webfont.woff2","path":"fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/material/source/css/material.css","path":"css/material.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/material.min.css","path":"css/material.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/style.min.css","path":"css/style.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/js.min.js","path":"js/js.min.js","modified":0,"renderable":1},{"_id":"themes/material/source/js/js.js","path":"js/js.js","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-bilibili.svg","path":"img/footer/footer_ico-bilibili.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-gplus.svg","path":"img/footer/footer_ico-gplus.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-github.svg","path":"img/footer/footer_ico-github.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-facebook.svg","path":"img/footer/footer_ico-facebook.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-linkedin.svg","path":"img/footer/footer_ico-linkedin.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-instagram.svg","path":"img/footer/footer_ico-instagram.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-telegram.svg","path":"img/footer/footer_ico-telegram.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-tumblr.svg","path":"img/footer/footer_ico-tumblr.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-twitter.svg","path":"img/footer/footer_ico-twitter.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-v2ex.svg","path":"img/footer/footer_ico-v2ex.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-zhihu.svg","path":"img/footer/footer_ico-zhihu.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/footer/footer_ico-weibo.svg","path":"img/footer/footer_ico-weibo.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/gallery/close.svg","path":"img/gallery/close.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/gallery/arrow.svg","path":"img/gallery/arrow.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/gallery/spinner.svg","path":"img/gallery/spinner.svg","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-10.png","path":"img/random/material-10.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-12.png","path":"img/random/material-12.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-17.png","path":"img/random/material-17.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-3.png","path":"img/random/material-3.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-4.png","path":"img/random/material-4.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-6.png","path":"img/random/material-6.png","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/FontAwesome.otf","path":"fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.eot","path":"fonts/MaterialIcons-Regular.eot","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-9.png","path":"img/random/material-9.png","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/fontawesome-webfont.eot","path":"fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/fontawesome-webfont.ttf","path":"fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-cave-light.min.css","path":"css/prettify/atelier-cave-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-dune-dark.min.css","path":"css/prettify/atelier-dune-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-dune-light.min.css","path":"css/prettify/atelier-dune-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-forest-dark.min.css","path":"css/prettify/atelier-forest-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-estuary-dark.min.css","path":"css/prettify/atelier-estuary-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-estuary-light.min.css","path":"css/prettify/atelier-estuary-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-heath-light.min.css","path":"css/prettify/atelier-heath-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-forest-light.min.css","path":"css/prettify/atelier-forest-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-heath-dark.min.css","path":"css/prettify/atelier-heath-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-lakeside-dark.min.css","path":"css/prettify/atelier-lakeside-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-lakeside-light.min.css","path":"css/prettify/atelier-lakeside-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-plateau-dark.min.css","path":"css/prettify/atelier-plateau-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-plateau-light.min.css","path":"css/prettify/atelier-plateau-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-savanna-dark.min.css","path":"css/prettify/atelier-savanna-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-savanna-light.min.css","path":"css/prettify/atelier-savanna-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-seaside-dark.min.css","path":"css/prettify/atelier-seaside-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-sulphurpool-light.min.css","path":"css/prettify/atelier-sulphurpool-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-sulphurpool-dark.min.css","path":"css/prettify/atelier-sulphurpool-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/github-v2.min.css","path":"css/prettify/github-v2.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-seaside-light.min.css","path":"css/prettify/atelier-seaside-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/hemisu-dark.min.css","path":"css/prettify/hemisu-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/github.min.css","path":"css/prettify/github.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tomorrow-night-blue.min.css","path":"css/prettify/tomorrow-night-blue.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/hemisu-light.min.css","path":"css/prettify/hemisu-light.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tomorrow-night-eighties.min.css","path":"css/prettify/tomorrow-night-eighties.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tomorrow-night.min.css","path":"css/prettify/tomorrow-night.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tomorrow.min.css","path":"css/prettify/tomorrow.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tranquil-heart.min.css","path":"css/prettify/tranquil-heart.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/vibrant-ink.min.css","path":"css/prettify/vibrant-ink.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/tomorrow-night-bright.min.css","path":"css/prettify/tomorrow-night-bright.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/js/gallery/gallery.js","path":"js/gallery/gallery.js","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-1.png","path":"img/random/material-1.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-11.png","path":"img/random/material-11.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-13.png","path":"img/random/material-13.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-15.png","path":"img/random/material-15.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-14.png","path":"img/random/material-14.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-16.png","path":"img/random/material-16.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-18.png","path":"img/random/material-18.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-2.png","path":"img/random/material-2.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-5.png","path":"img/random/material-5.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-8.png","path":"img/random/material-8.png","modified":0,"renderable":1},{"_id":"themes/material/source/css/prettify/atelier-cave-dark.min.css","path":"css/prettify/atelier-cave-dark.min.css","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-19.png","path":"img/random/material-19.png","modified":0,"renderable":1},{"_id":"themes/material/source/img/random/material-7.png","path":"img/random/material-7.png","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/fontawesome-webfont.svg","path":"fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Light.ttf","path":"fonts/Roboto-Light.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Medium.ttf","path":"fonts/Roboto-Medium.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Regular.ttf","path":"fonts/Roboto-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Thin.ttf","path":"fonts/Roboto-Thin.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Bold.ttf","path":"fonts/Roboto-Bold.ttf","modified":0,"renderable":1},{"_id":"themes/material/source/fonts/Roboto-Black.ttf","path":"fonts/Roboto-Black.ttf","modified":0,"renderable":1}],"Cache":[{"_id":"themes/material/.gitignore","hash":"cf4e2dcaa760ff6f7520fd032ce44574e2970e54","modified":1534241511791},{"_id":"themes/material/package.json","hash":"544f21a0b2c7034998b36ae94dba6e3e0f39f228","modified":1534241511812},{"_id":"source/CNAME","hash":"fb5a88c062706435767090b234bdbb58a8041c61","modified":1534241511791},{"_id":"source/.DS_Store","hash":"b16cb8f8182b25fb627a41bcba9c834ec5def867","modified":1572339994839},{"_id":"themes/material/_config.yml","hash":"e71e78cabe9be1a1b85f3fdb46b8d66f64f7d7f9","modified":1554897425173},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1567156418279},{"_id":"source/_posts/Android Paint- .measureText() VS .getTextBounds().md","hash":"9e27ea811b6fed5bc5904978b26b552ac84be2e3","modified":1543228986981},{"_id":"source/_posts/Android-collapse-status-bar.md","hash":"b3455dcfb2352c36af04d671e08aa5dad4608f25","modified":1557750862745},{"_id":"source/_posts/Android-MeasureSpec.md","hash":"0082fe0774432bc2a63687c77aab716afcdb6879","modified":1554897291189},{"_id":"source/_posts/Canvas.drawPath().md","hash":"a98307f136d97fd04f6c4631b5d97b60f184743b","modified":1553165748335},{"_id":"source/_posts/Efficient-Android-Threading-chapter-2.md","hash":"9bbf7912a03355fa843f88c406de3b9e1db5afc3","modified":1553165500270},{"_id":"source/_posts/Efficient-Android-Threading-chapter-4-1.md","hash":"2522d69b2ff57e2540cc87a83924e5e76e9632a8","modified":1553165246820},{"_id":"source/_posts/Efficient-Android-Threading-chapter-3.md","hash":"f6795eb94e64bf76004ee54e6ecb217cb0feb684","modified":1553165619443},{"_id":"source/_posts/ConstraintLayout-learning.md","hash":"cacaf35c622970510cafb9f84a6bd99b740c8177","modified":1553251891927},{"_id":"source/_posts/Efficient-Android-Threading-chapter-4-2.md","hash":"dd6ac70e1d7098aaab984bcc15f5416bc4bf946b","modified":1553165257178},{"_id":"source/_posts/TrackColorTextView.md","hash":"982f00029a9d31077177087ab9585e2577340efe","modified":1543228837000},{"_id":"source/_posts/android-view-post.md","hash":"16fb6c6be18537c341c760d4afd827f9f0d3bf21","modified":1553163331549},{"_id":"source/_posts/TextView.md","hash":"e68356d7c4185eb21f2478b5fe763ae610ec3901","modified":1543228957807},{"_id":"source/_posts/bug-of-mysql.md","hash":"da5c59fa94664c595e4fab56ad6edada4cd357b2","modified":1534241511791},{"_id":"source/_posts/can-not-get-height-in-onCreate.md","hash":"d8556462cecb254c4b3a31a47a613bb58d9798c5","modified":1553165448542},{"_id":"source/_posts/ViewDragHelper-source-code.md","hash":"11a21e4c623d917ba8ae6c8f7f5a5bd793322532","modified":1557751411980},{"_id":"source/_posts/color-track-textview.md","hash":"f4ab2d3b2830c02979a564ae4410247c5f3808a5","modified":1553164423994},{"_id":"source/_posts/View-inflate-analysis.md","hash":"c36ab482999c52df4a565e48caa694f2cdf4a04e","modified":1553849279124},{"_id":"source/_posts/custom-view-parallax.md","hash":"0599c77c2b782f4cc376b140765dde4130d02372","modified":1555320253834},{"_id":"source/_posts/design-pattern-factory.md","hash":"43975c6cd50d9095774becd09c504e13b967cc8f","modified":1572339885657},{"_id":"source/_posts/design-pattern-decoration.md","hash":"6715b657a8a11fce60ede7ec7f353d8482521639","modified":1572578560280},{"_id":"source/_posts/design-pattern-builder.md","hash":"ef698c30da40042158e2918937ac21b236d6ee52","modified":1572080508879},{"_id":"source/_posts/design-pattern-template.md","hash":"80436a41b646363bd809362164b0a19b319eda2a","modified":1573116726238},{"_id":"source/_posts/design-pattern-singleton.md","hash":"145ccee5fd5d9f40749296ee03d6a04c113a7a3e","modified":1572077462086},{"_id":"source/_posts/design-pattern-strategy.md","hash":"4c863ce2a63a3838eb36eb38e93794b643f05ea5","modified":1573207188722},{"_id":"source/_posts/differ-of-abstract-interface.md","hash":"bcdbfa670c5ef2a7146bdb9a0bf39277b6157823","modified":1534241511791},{"_id":"source/_posts/java-proxy-pattern.md","hash":"d4adb8c0f1096dc4d1a32cb70e858a9cdd534ccc","modified":1565774119456},{"_id":"source/_posts/message-enqueue-process.md","hash":"c3ce80eb3cee0ade5a16924dee7419bf96efbac1","modified":1572075735935},{"_id":"source/_posts/polymorphism-of-java.md","hash":"760424d75a98da04e3634839194d3438a9094877","modified":1534241511791},{"_id":"source/_posts/what's the fuck is Context.md","hash":"307ad9ccbac6fe2977bfad38c428f28dc1f666ba","modified":1573728272836},{"_id":"source/_posts/start-activity-procedure.md","hash":"b033dfd86334a0c9ed00e3b8cac7098526b47cd2","modified":1567154894858},{"_id":"source/timeline/index.md","hash":"2f904a9468375cb479bdd574c2ce4911ded736d7","modified":1534403512224},{"_id":"source/tags/index.md","hash":"668119f5b5ab4d0ca02d0506eee4dbcb1c7117ba","modified":1534403366881},{"_id":"themes/material/languages/ar.yml","hash":"472d71f052e08f3c03b15dd67d11ad41f2eee7bf","modified":1534241511792},{"_id":"themes/material/languages/de.yml","hash":"bce37d066ffa82f3e249d41d0ee883c913cc2c5f","modified":1534241511792},{"_id":"themes/material/languages/en.yml","hash":"b59136a1b4d0a77e550b0e7e2e430cac44230dd3","modified":1534241511792},{"_id":"themes/material/languages/fr.yml","hash":"f456cf31a72d97f2f18e3bb6cf735285d2b9d2c5","modified":1534241511793},{"_id":"themes/material/languages/es.yml","hash":"d35f5411bc87277cc2d3a58d9499ddb9cfd46f1b","modified":1534241511792},{"_id":"themes/material/languages/nl_NL.yml","hash":"b71e59807716185627d6b9b84e44a79401df639f","modified":1534241511793},{"_id":"themes/material/languages/ja.yml","hash":"768b8330c9c73287efd475e68741ce4ebad29fd1","modified":1534241511793},{"_id":"themes/material/languages/ms.yml","hash":"237a39bbfcce33e7b918f6c5dc0f01bc79900262","modified":1534241511793},{"_id":"themes/material/languages/pt-BR.yml","hash":"a070c2c4d0d3d54f8ca70513cff73c3f7c306db1","modified":1534241511793},{"_id":"themes/material/languages/zh-CN.yml","hash":"c188cad1a16ab0651e2d2d03cb3fa79962cf65ff","modified":1534241511794},{"_id":"themes/material/languages/ru.yml","hash":"fbff2cf48dbde45adcad781e2fd6c30b523a4ac1","modified":1534241511793},{"_id":"themes/material/languages/zh-TW.yml","hash":"ec55953f0330f81bf1ffb37ff34de258dfda642a","modified":1534241511794},{"_id":"themes/material/layout/index.ejs","hash":"aca1abb741f891776913c8ea2e6ff626a0ea5736","modified":1534241511811},{"_id":"themes/material/layout/post.ejs","hash":"4dd572a9e84f3a6baa5e3f16d270e58e3cd31a23","modified":1534241511812},{"_id":"themes/material/layout/layout.ejs","hash":"94f66850b815a262c0f8ff112a32a0a6f43066e3","modified":1534241511811},{"_id":"themes/material/scripts/helper.js","hash":"e7111a8b1f0ab5bf3466378c48c260a4f6e527d6","modified":1534241511812},{"_id":"themes/material/layout/_partial/Isolation-post-info.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534241511794},{"_id":"themes/material/scripts/lib/font_lsload.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534241511812},{"_id":"themes/material/layout/_partial/Paradox-post-info.ejs","hash":"125cfa5cd9e6e1ca5e958026fdd42f3c3141e34f","modified":1534241511794},{"_id":"themes/material/layout/_partial/Paradox-post-thumbnail.ejs","hash":"6f1e9a85c089ce98a36a2954839fb9ce3e53739e","modified":1534241511794},{"_id":"themes/material/layout/_partial/Paradox-post_entry-thumbnail.ejs","hash":"4d740eba338517d4e10d011a157cdefad45a8e1f","modified":1534241511795},{"_id":"themes/material/layout/_partial/Isolation-post_entry.ejs","hash":"134dc82320b7aed7d4d78960be63e16c5c4a30fb","modified":1534241511794},{"_id":"themes/material/layout/_partial/Paradox-search.ejs","hash":"18a6971b04feccd124a096b8c7cecf1fd4bb914e","modified":1534241511795},{"_id":"themes/material/layout/_partial/Paradox-post_entry.ejs","hash":"5f4d67e5bd70f635203706cf344b036d891073e6","modified":1534241511795},{"_id":"themes/material/layout/_partial/blog_info.ejs","hash":"5e95796e6f9a81163554ca4198573860f7328d4e","modified":1534241511795},{"_id":"themes/material/layout/_partial/comment.ejs","hash":"c9fb1f98a18ca484cb52d60e2ad2bad25b56dfb2","modified":1534241511795},{"_id":"themes/material/layout/_partial/config_css.ejs","hash":"2b1e27faa0446a5e756e61ddf3e969e50948f1ce","modified":1534241511795},{"_id":"themes/material/layout/_partial/config_font.ejs","hash":"730abeb681758ce288d5541930c46bc4b041a0b1","modified":1534241511796},{"_id":"themes/material/layout/_partial/footer-left.ejs","hash":"372cdf718e01fea2736b8e427e57bfcfaa8a557f","modified":1534241511796},{"_id":"themes/material/layout/_partial/daily_pic.ejs","hash":"e780fbdb79b5e27091c408545cfd5b64892c9b01","modified":1534241511796},{"_id":"themes/material/layout/_partial/footer-option.ejs","hash":"be20394eaeaf2d20db28946b948962c839da6ea9","modified":1534241511796},{"_id":"themes/material/layout/_partial/footer.ejs","hash":"530626c347882579d09d71df68993e25076ca8e2","modified":1534241511796},{"_id":"themes/material/layout/_partial/footer_top.ejs","hash":"9eaace4feb951c96c0033e7271497f3f300d2476","modified":1534241511796},{"_id":"themes/material/layout/_partial/isolate-sns_list.ejs","hash":"fc5f03ebb847f85975676a9dfee8870e7c908008","modified":1534241511797},{"_id":"themes/material/layout/_partial/import_js.ejs","hash":"961b8a0059875e4044fe80bbe91ca6a225f113e5","modified":1534241511797},{"_id":"themes/material/layout/_partial/head.ejs","hash":"8167f995c7cc21a6a8ddbfbdd03f2f74a7bd904d","modified":1534241511797},{"_id":"themes/material/layout/_partial/isolate_info.ejs","hash":"b8ec76716bfa2e6513b4df6814fe8676536a94c1","modified":1534241511797},{"_id":"themes/material/layout/_partial/post-content.ejs","hash":"ad626e3b60bc4a17bacff02cf9b0a8beaba2ad1e","modified":1534241511797},{"_id":"themes/material/layout/_partial/post-header.ejs","hash":"b0b8973c48db6376a24d4b4b1d2eb15d18d6508c","modified":1534241511798},{"_id":"themes/material/layout/_partial/post-info-share.ejs","hash":"9f28d62bf728c2bd89411688426a65d7ee55400c","modified":1534241511798},{"_id":"themes/material/layout/_partial/post-nav.ejs","hash":"3b6d4568cc46f60c697ad9ec85a4aa5971f3eecc","modified":1534241511798},{"_id":"themes/material/layout/_partial/sidebar-footer.ejs","hash":"6c3486b846473e0d58666f7a8720f5bf4a14e030","modified":1534241511798},{"_id":"themes/material/layout/_partial/sidebar-header.ejs","hash":"06295e01092f55504d30a343c3fdc5091280e495","modified":1534241511799},{"_id":"themes/material/layout/_partial/sidebar-footer_image.ejs","hash":"b9157d2072028a1db3c3419f76bde6637e85cf0e","modified":1534241511799},{"_id":"themes/material/layout/_partial/sidebar.ejs","hash":"c5ce6136e82895cb80dab8a918a7cdf2fe820fea","modified":1534241511799},{"_id":"themes/material/layout/_partial/sidebar-navigation.ejs","hash":"ff44901fdfdd952174b0d22e86df7163d7fba9ba","modified":1534241511799},{"_id":"themes/material/layout/_partial/structured-data.ejs","hash":"d6681d472d6840d2335397790acd0cfa6a8e74d9","modified":1534241511799},{"_id":"themes/material/layout/_partial/toc_button.ejs","hash":"688c3fc12e2548ff27fe60688f79dcce2881fd50","modified":1534241511799},{"_id":"themes/material/layout/_widget/leancloud-views_num.ejs","hash":"e27baba6a2de406463735d276606b15fb40f5eba","modified":1534241511809},{"_id":"themes/material/layout/_widget/leancloud-like.ejs","hash":"e4780fe3bbb049db38d694fc18dee13d799bd51d","modified":1534241511809},{"_id":"themes/material/layout/_widget/leancloud-views.ejs","hash":"211dc183b8e84f71b2c25b3ac6659d162d81662b","modified":1534241511809},{"_id":"themes/material/layout/_widget/dnsprefetch.ejs","hash":"5e4c5359d69a64042183db13f6dd771b1f7f6b31","modified":1534241511809},{"_id":"themes/material/layout/_widget/page-links.ejs","hash":"0ebe18e4326f921d6010df8479a08c2d403ba717","modified":1534241511810},{"_id":"themes/material/layout/_widget/mathjax.ejs","hash":"b68befe1fea84739c8429c344e570a8bc0357401","modified":1534241511810},{"_id":"themes/material/layout/_widget/nprogress.ejs","hash":"901a64600854b312209287c702278183600e06b9","modified":1534241511810},{"_id":"themes/material/layout/_widget/page-gallery.ejs","hash":"81b9410deef7a83ef5bc7cd18ad042df70d70b94","modified":1534241511810},{"_id":"themes/material/layout/_widget/page-tagcloud.ejs","hash":"e71de74e4067cc4e6aef1e09ac429c92bcd178b3","modified":1534241511810},{"_id":"themes/material/layout/_widget/qrcode.ejs","hash":"575e63ad12e856d58dc749cb9de9f256a8f13593","modified":1534241511811},{"_id":"themes/material/layout/_widget/page-timeline.ejs","hash":"9fa0195e08d9fd40aa0333e9279c98bc65acf604","modified":1534241511811},{"_id":"themes/material/layout/_widget/search-swiftype-js.ejs","hash":"7ad1e843e620ccd9b3c041dccfdcee97921247a1","modified":1534241511811},{"_id":"themes/material/layout/_widget/search-local-js.ejs","hash":"f42cc040adf47fc7d74f64b0be3c3230e8a3339e","modified":1534241511811},{"_id":"themes/material/layout/_widget/tagcloud.ejs","hash":"88b2e2cc54e280651af2f4107e5c82dbd4288ddf","modified":1534241511811},{"_id":"themes/material/scripts/lib/css_lsload.js","hash":"179f5f5e3297a7fb7d90545ddd94eb468a11046e","modified":1534241511812},{"_id":"themes/material/scripts/lib/get_file_hex.js","hash":"eb3b9a45f8ca45ef40d5421baef7d4484023982c","modified":1534241511812},{"_id":"themes/material/scripts/lib/js_hex.js","hash":"2704583aa036d538544ce31c2e924c0c125309dd","modified":1534241511813},{"_id":"themes/material/scripts/lib/js_lsload.js","hash":"72f885b13fe0028a0e2acb7168dcc66e39ea1592","modified":1534241511813},{"_id":"themes/material/scripts/lib/path_for.js","hash":"f944e3b53a468962121aa3357cc0bc18ac27a34c","modified":1534241511813},{"_id":"themes/material/source/img/avatar.jpg","hash":"859cc1776449dde1c08526076af2d82e0e8da931","modified":1534241511860},{"_id":"themes/material/source/img/avatar.png","hash":"bf483b0d495dbbcfb308348a945818e1c1cc9696","modified":1534241511860},{"_id":"themes/material/source/img/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1534241511861},{"_id":"themes/material/source/img/bg.png","hash":"a32f9717e19e821a4030ade551dc2917c889fcd8","modified":1534241511861},{"_id":"themes/material/source/img/favicon.png","hash":"b1bcc84cedb2a618e8db93559ce7d58f9274085d","modified":1534241511861},{"_id":"themes/material/source/img/logo.png","hash":"b1bcc84cedb2a618e8db93559ce7d58f9274085d","modified":1534241511868},{"_id":"themes/material/source/img/upyun_logo.svg","hash":"1f118b2b9c54f431d5e731ccf316ceefe605ba67","modified":1534241511880},{"_id":"themes/material/source/img/sidebar_header.png","hash":"c47f4d39f421c0a950279d050ae82f9ae6dd19ff","modified":1534241511879},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.woff","hash":"c6c953c2ccb2ca9abb21db8dbf473b5a435f0082","modified":1534241511831},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.woff2","hash":"09963592e8c953cc7e14e3fb0a5b05d5042e8435","modified":1534241511831},{"_id":"themes/material/source/css/duoshuo.css","hash":"32a02eaa01ff7b66fd9df307b0d33d52810096be","modified":1534241511813},{"_id":"themes/material/source/css/disqus-proxy.css","hash":"d5086cda8aaae20b8d3f9dd50f0be5ccb717e42a","modified":1534241511813},{"_id":"themes/material/source/css/disqus-proxy.min.css","hash":"3f8f99f71d361302288b0ba11fd36072564b08c2","modified":1534241511813},{"_id":"themes/material/source/css/duoshuo.min.css","hash":"89a30544b8b01d061da51c40f2af702a7969de5e","modified":1534241511814},{"_id":"themes/material/source/css/ie-blocker.css","hash":"dddce7e6250a449291888ae7865697282a213b14","modified":1534241511814},{"_id":"themes/material/source/css/fontawesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1534241511814},{"_id":"themes/material/source/css/gallery.min.css","hash":"c5333ca835aae49239d809130a7b281af745729e","modified":1534241511814},{"_id":"themes/material/source/css/material-icons.css","hash":"f6f95fe5190f3c65931847246621fb83754eb00c","modified":1534241511815},{"_id":"themes/material/source/css/prettify.css","hash":"c395f20ee64e80c2b6b15c7dade02f9aaaeab2c8","modified":1534241511816},{"_id":"themes/material/source/css/uc.css","hash":"1e0977a2c9bdf721cc05654dfc025dd250655852","modified":1534241511826},{"_id":"themes/material/source/css/prettify.min.css","hash":"62edd8f08656463b0e077dcf893faa3cc8eb5fe4","modified":1534241511816},{"_id":"themes/material/source/js/hanabi-browser-bundle.js","hash":"d646647bda386140c8315d60e3ff4ddbdb15c1ea","modified":1534241511882},{"_id":"themes/material/source/js/ie-blocker.en.js","hash":"96ca8e677a12048d099319ebdf01983ddc6ca80c","modified":1534241511882},{"_id":"themes/material/source/js/Valine.min.js","hash":"6a287a99a772a0ea8f98b133523429c9250cc67f","modified":1534241511881},{"_id":"themes/material/source/js/MathJax.js","hash":"a21703b5848325a902c9b39bbf3ca6490d3e1b1b","modified":1534241511880},{"_id":"themes/material/source/js/ie-blocker.zhCN.js","hash":"0ed49b0ec1d1924b128fbd97fca2cf7af7856fdf","modified":1534241511882},{"_id":"themes/material/source/js/lazyload.min.js","hash":"5348fd7aa4dbefac9d21091c9fd5e263563b5540","modified":1534241511884},{"_id":"themes/material/source/js/lsloader.js","hash":"2b14e57784fb6b5f58d71584189c61af45f393e8","modified":1534241511885},{"_id":"themes/material/source/js/lsloader.min.js","hash":"1a68a8d267948ea8475245b7d365a1a1bd8f732e","modified":1534241511885},{"_id":"themes/material/source/js/nprogress.js","hash":"a3058d4b6afb5d7a14e5afcbb88f778de35864f0","modified":1534241511885},{"_id":"themes/material/source/js/queue.js","hash":"dd252616b568b71c222d9cfc859bfe52738e576a","modified":1534241511886},{"_id":"themes/material/source/js/prettify.min.js","hash":"69908fe0a09cee107c25cb5d769b861723e7b7bb","modified":1534241511885},{"_id":"themes/material/source/js/queue.min.js","hash":"21aab782ca33efbb1386cc960b6be0a02106760d","modified":1534241511886},{"_id":"themes/material/source/js/smoothscroll.js","hash":"df56a1c84191a62750ae820943377b6775fca0e2","modified":1534241511886},{"_id":"themes/material/source/img/daily_pic.png","hash":"5e9a5f6a134889d0242e69061837f2032416d7ce","modified":1534241511861},{"_id":"themes/material/source/img/portrait.jpeg","hash":"1521ba5b86020bb5c417572f250d84109d62c7c2","modified":1534394897343},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.ttf","hash":"fc05de31234e0090f7ddc28ce1b23af4026cb1da","modified":1534241511831},{"_id":"themes/material/source/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1534241511859},{"_id":"themes/material/source/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1534241511860},{"_id":"themes/material/source/css/material.css","hash":"068e2b00f686157b6e8b78b9b808112adbedf4de","modified":1534241511815},{"_id":"themes/material/source/css/material.min.css","hash":"1a19febb9214ab689b02f5bb8ccb23579e6c1181","modified":1534241511816},{"_id":"themes/material/source/css/style.css","hash":"a2f27c40f412dc24e1ed5f62a4117523a226eed0","modified":1534241511826},{"_id":"themes/material/source/css/style.min.css","hash":"a9e9b33e1fcf818f08a04b909c86f2460a05f060","modified":1534241511826},{"_id":"themes/material/source/js/jquery.min.js","hash":"00073d6597d2760b81387274a9ec56b9d5cb1552","modified":1534241511883},{"_id":"themes/material/source/js/js.min.js","hash":"709d347d3be033b841de0493b7cf532b594bb1f6","modified":1534241511884},{"_id":"themes/material/source/js/js.js","hash":"64b3f20e7138674ecf21e6e3982565ea63feae26","modified":1534241511883},{"_id":"themes/material/layout/_widget/analytics/baidu-analytics.ejs","hash":"3866a7fead3c1f94a517f1f9d629f092670b1520","modified":1534241511800},{"_id":"themes/material/layout/_widget/analytics/google-analytics.ejs","hash":"3b10ebf524baf0c24b22dcd110b39d15c5acb9b5","modified":1534241511800},{"_id":"themes/material/layout/_widget/analytics/cnzz-analytics.ejs","hash":"1765e3dcd92961292f40d1812e593186c77b17ef","modified":1534241511800},{"_id":"themes/material/source/img/footer/footer_ico-bilibili.svg","hash":"1a007ae30d69aa597f589edb4ee0638a9814c988","modified":1534241511862},{"_id":"themes/material/source/img/footer/footer_ico-gplus.svg","hash":"b50274133ab263bcacdf729871d0446b615ac984","modified":1534241511863},{"_id":"themes/material/source/img/footer/footer_ico-github.svg","hash":"5f1f9f53e6a87ad674108c6bd16e424a1e888c61","modified":1534241511863},{"_id":"themes/material/source/img/footer/footer_ico-facebook.svg","hash":"74b3b3c6bd1d76b7eaaf75d36ac929b11a5a3e82","modified":1534241511863},{"_id":"themes/material/source/img/footer/footer_ico-linkedin.svg","hash":"9831c86352ec5ff283a3277d033120f86388c277","modified":1534241511864},{"_id":"themes/material/source/img/footer/footer_ico-instagram.svg","hash":"294c511e62063ea49f61e23958ab27d643ba0228","modified":1534241511863},{"_id":"themes/material/source/img/footer/footer_ico-telegram.svg","hash":"413d66e40ca476deeb49364935d49d2f7839cdfd","modified":1534241511864},{"_id":"themes/material/source/img/footer/footer_ico-tumblr.svg","hash":"11daf4fa4220787306fc21a879429e98b7db8d03","modified":1534241511864},{"_id":"themes/material/source/img/footer/footer_ico-twitter.svg","hash":"58df7777d6fcee8fa3c42453c091714bb3f97c95","modified":1534241511865},{"_id":"themes/material/source/img/footer/footer_ico-v2ex.svg","hash":"c5ffaf67a97e534c266d1585a9a3b56f1bfe3052","modified":1534241511865},{"_id":"themes/material/source/img/footer/footer_ico-zhihu.svg","hash":"d3f8da320fffefc5144822665dfe17d25af4061c","modified":1534241511866},{"_id":"themes/material/source/img/footer/footer_ico-weibo.svg","hash":"26d0cdb77f0c4afd60111176167eacfa222bc4c1","modified":1534241511866},{"_id":"themes/material/source/img/gallery/close.svg","hash":"0739fa52652dd59cebecc861144b702e455adb0c","modified":1534241511867},{"_id":"themes/material/source/img/gallery/arrow.svg","hash":"68799fe01ecc7f5fb721287693b9b0b93f4c067a","modified":1534241511866},{"_id":"themes/material/source/img/gallery/spinner.svg","hash":"ef69a35119feb82d8e9cf4a59656aa25051afebd","modified":1534241511867},{"_id":"themes/material/source/img/random/material-10.png","hash":"363466a376e4df9e61acc904cd25f3c7ae1a7280","modified":1534241511869},{"_id":"themes/material/source/img/random/material-12.png","hash":"d020b3d42542715c7ae95b3d8603fe3180bfe8f3","modified":1534241511870},{"_id":"themes/material/source/img/random/material-17.png","hash":"ece82810e31f711576db598c845c3d97bd49fe67","modified":1534241511873},{"_id":"themes/material/source/img/random/material-3.png","hash":"848eaa70b9b0cd7a2204c78e8aa324d8f96bb097","modified":1534241511875},{"_id":"themes/material/source/img/random/material-4.png","hash":"b475dfbf67a076a4e17a5527fd1973b1d4adac07","modified":1534241511876},{"_id":"themes/material/source/img/random/material-6.png","hash":"2f841e0c064fecb607ad1e149662a0c96d9e725d","modified":1534241511877},{"_id":"themes/material/source/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1534241511828},{"_id":"themes/material/source/fonts/MaterialIcons-Regular.eot","hash":"26fb8cecb5512223277b4d290a24492a0f09ede1","modified":1534241511830},{"_id":"themes/material/source/img/random/material-9.png","hash":"840319c4d1f38fb8df79eb4669ed2e14d89fd680","modified":1534241511879},{"_id":"themes/material/source/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1534241511855},{"_id":"themes/material/source/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1534241511859},{"_id":"themes/material/source/css/prettify/atelier-cave-light.min.css","hash":"4b62dc45aa351b071d6a434dc54fe8c2e15c85cc","modified":1534241511816},{"_id":"themes/material/source/css/prettify/atelier-dune-dark.min.css","hash":"c5094d99ca0e619d97860c88211bf908fdf830b1","modified":1534241511816},{"_id":"themes/material/source/css/prettify/atelier-dune-light.min.css","hash":"b3ad98483e4d5bde72d52a15423d98e0d086db09","modified":1534241511817},{"_id":"themes/material/source/css/prettify/atelier-forest-dark.min.css","hash":"9296b851a5b66785a60afa5da5fe9080bda96bf5","modified":1534241511818},{"_id":"themes/material/source/css/prettify/atelier-estuary-dark.min.css","hash":"7e3a065cafeb3acc1d7178f64ef4265f5d5ad2b9","modified":1534241511817},{"_id":"themes/material/source/css/prettify/atelier-estuary-light.min.css","hash":"1d12d8f7fa9c122a186ee76fdf681c191a68f104","modified":1534241511817},{"_id":"themes/material/source/css/prettify/atelier-heath-light.min.css","hash":"a67199fa580b3aa2df031e5d2028929d29ca3b45","modified":1534241511819},{"_id":"themes/material/source/css/prettify/atelier-forest-light.min.css","hash":"3532f6e86bf4afbba05f7a074b791b73174f9622","modified":1534241511818},{"_id":"themes/material/source/css/prettify/atelier-heath-dark.min.css","hash":"954309acd7918422382a3ff2f9c2988aec0ff956","modified":1534241511819},{"_id":"themes/material/source/css/prettify/atelier-lakeside-dark.min.css","hash":"18575fc6dff855e395a39d0383d2f18807091f0d","modified":1534241511819},{"_id":"themes/material/source/css/prettify/atelier-lakeside-light.min.css","hash":"e20e8ac64432fa1aa6f74792b58196af7cf79c12","modified":1534241511820},{"_id":"themes/material/source/css/prettify/atelier-plateau-dark.min.css","hash":"137e3c499a720da3c1d57b4dc53264b1d623e1c5","modified":1534241511820},{"_id":"themes/material/source/css/prettify/atelier-plateau-light.min.css","hash":"153801640fdcbb74c0de3f15345110f2210eb991","modified":1534241511820},{"_id":"themes/material/source/css/prettify/atelier-savanna-dark.min.css","hash":"fba92c652fd6704422b8f2bbc11706805a6faed0","modified":1534241511820},{"_id":"themes/material/source/css/prettify/atelier-savanna-light.min.css","hash":"d9425ffb7c60d646190c22b9a5f72091ee5f9ace","modified":1534241511820},{"_id":"themes/material/source/css/prettify/atelier-seaside-dark.min.css","hash":"e0e6bbacc75a349b1e49c236d374b0e42f1fd485","modified":1534241511821},{"_id":"themes/material/source/css/prettify/atelier-sulphurpool-light.min.css","hash":"ab1a6200eab648cab443c3df77fde9b237ef27b6","modified":1534241511821},{"_id":"themes/material/source/css/prettify/atelier-sulphurpool-dark.min.css","hash":"015a35dddaee153fa8bb71d7f3818a6ba4d120d8","modified":1534241511821},{"_id":"themes/material/source/css/prettify/github-v2.min.css","hash":"57630621d20842a529bdea7b17fc90f520e562ef","modified":1534241511821},{"_id":"themes/material/source/css/prettify/atelier-seaside-light.min.css","hash":"732750b75389c1c49204f37705e6abeee40ce64f","modified":1534241511821},{"_id":"themes/material/source/css/prettify/hemisu-dark.min.css","hash":"a671248cfd573292026d2174817e82e593691052","modified":1534241511822},{"_id":"themes/material/source/css/prettify/github.min.css","hash":"19cf828225288fa5c006f1d8f66c39d11f4ef7f2","modified":1534241511821},{"_id":"themes/material/source/css/prettify/tomorrow-night-blue.min.css","hash":"c442728d96485bcf816151fe6bd96993aae09852","modified":1534241511823},{"_id":"themes/material/source/css/prettify/hemisu-light.min.css","hash":"b2556ff41e513fd13d032ec84a37ee260a905815","modified":1534241511823},{"_id":"themes/material/source/css/prettify/tomorrow-night-eighties.min.css","hash":"6ce259d674bb4edda23eea32b2379be17d0e0e6e","modified":1534241511824},{"_id":"themes/material/source/css/prettify/tomorrow-night.min.css","hash":"d989206d124035494acb4b0cdc7fbc89f3b7d108","modified":1534241511824},{"_id":"themes/material/source/css/prettify/tomorrow.min.css","hash":"b2c6d610b77f0273fefab5aa4ad26a7f58956f87","modified":1534241511824},{"_id":"themes/material/source/css/prettify/tranquil-heart.min.css","hash":"0f6eefbdda8e410832e9c516a5dd19899217ef06","modified":1534241511824},{"_id":"themes/material/source/css/prettify/vibrant-ink.min.css","hash":"c265bac6c31cf622b536b29c8a6bc46955d6fe63","modified":1534241511825},{"_id":"themes/material/source/css/prettify/tomorrow-night-bright.min.css","hash":"cf251fd3edfd736695272a0f1b41d509b7bb1fb9","modified":1534241511823},{"_id":"themes/material/source/js/gallery/gallery.js","hash":"8ee48312a183b42a9886211a0ec825ea0d041301","modified":1534241511881},{"_id":"themes/material/layout/_widget/comment/livere/common.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534241511807},{"_id":"themes/material/layout/_widget/comment/valine/common.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1534241511808},{"_id":"themes/material/source/img/random/material-1.png","hash":"4839299eaa4db7272befa7b824e54b647fbbfc44","modified":1534241511868},{"_id":"themes/material/source/img/random/material-11.png","hash":"ce20b0ad08a248c036115374f2edb7301ff60b72","modified":1534241511869},{"_id":"themes/material/source/img/random/material-13.png","hash":"1a8378db3121b583485e2b939cb1aa0e0b14b0c8","modified":1534241511871},{"_id":"themes/material/source/img/random/material-15.png","hash":"36b9937cf3810e4970902b78797ad29b0831f065","modified":1534241511872},{"_id":"themes/material/source/img/random/material-14.png","hash":"b4f65b601960138c69f57171b0ddd55895483f45","modified":1534241511871},{"_id":"themes/material/source/img/random/material-16.png","hash":"ade7f75200d3fb38326e3cf1e9f1a812fb12a43b","modified":1534241511873},{"_id":"themes/material/source/img/random/material-18.png","hash":"4b98204abe36ecd3f30678d2c22059130e0db328","modified":1534241511874},{"_id":"themes/material/source/img/random/material-2.png","hash":"faba2ce69c19d6c1dac392dd10b054e0061f6fb7","modified":1534241511875},{"_id":"themes/material/source/img/random/material-5.png","hash":"5041ebd073a139c67f8ed271e74c967c7eb9c5be","modified":1534241511876},{"_id":"themes/material/source/img/random/material-8.png","hash":"57db542d526ef6866cb34e261096e93a0e6f3a82","modified":1534241511878},{"_id":"themes/material/source/css/prettify/atelier-cave-dark.min.css","hash":"cb0156cdc36500a26b232ae1c81fdc880eba85e7","modified":1534241511816},{"_id":"themes/material/layout/_widget/comment/changyan/enter.ejs","hash":"e3cfb4f37ea35457f112f3e822e130c930086497","modified":1534241511801},{"_id":"themes/material/layout/_widget/comment/changyan/common.ejs","hash":"40e1fc76d6b7f64e226693fb2fe1a6bb17bae245","modified":1534241511801},{"_id":"themes/material/layout/_widget/comment/changyan/main.ejs","hash":"77539ff32cc9d1204b848e01b5277fff5cbd61e0","modified":1534241511801},{"_id":"themes/material/layout/_widget/comment/disqus/common.ejs","hash":"c11cfceb0906a96399dede5da01ff7fe4787f8a5","modified":1534241511801},{"_id":"themes/material/layout/_widget/comment/disqus/enter.ejs","hash":"39192034766349e47967da63184f9104fdded2ab","modified":1534241511802},{"_id":"themes/material/layout/_widget/comment/disqus/main.ejs","hash":"21e0eeff664191b818d7a0071ae7edcdfc270442","modified":1534241511802},{"_id":"themes/material/layout/_widget/comment/disqus_click/main.ejs","hash":"f53de208ca46c669a868a1922488e39509c6fe3b","modified":1534241511803},{"_id":"themes/material/layout/_widget/comment/disqus_click/common.ejs","hash":"d243f576b366a62191066459efcc6fd0ab79d00a","modified":1534241511802},{"_id":"themes/material/layout/_widget/comment/disqus_click/enter.ejs","hash":"d82f0296f8bae25223ec44e6e05b817d3a234884","modified":1534241511802},{"_id":"themes/material/layout/_widget/comment/gitalk/common.ejs","hash":"f739897518011e1b3de7807c8c5d734984711282","modified":1534241511804},{"_id":"themes/material/layout/_widget/comment/gitment/common.ejs","hash":"9c6c8d1b448c32afb01c2d0351e87f4d4a17ec3c","modified":1534241511806},{"_id":"themes/material/layout/_widget/comment/gitalk/enter.ejs","hash":"4d70d76465469a57def29a221962a5520fb34ebe","modified":1534241511804},{"_id":"themes/material/layout/_widget/comment/gitalk/main.ejs","hash":"1ee7a7b2b9b5ae8c4fa8c4b09c7973b9e085bdf2","modified":1534241511805},{"_id":"themes/material/layout/_widget/comment/gitment/enter.ejs","hash":"46d904fde9233694b95c6a3d91b9a2b7a6805850","modified":1534241511806},{"_id":"themes/material/layout/_widget/comment/livere/enter.ejs","hash":"194b7bb581a3b8608a7ab135b6953d7908f51cc8","modified":1534241511807},{"_id":"themes/material/layout/_widget/comment/gitment/main.ejs","hash":"e622660eda38cda05847aadc2a3e31a228fc519b","modified":1534241511806},{"_id":"themes/material/layout/_widget/comment/livere/main.ejs","hash":"1c4be9ba104a8cbcc11d45f11bf8cfe7704b93a5","modified":1534241511807},{"_id":"themes/material/layout/_widget/comment/valine/enter.ejs","hash":"56e74a1147bd2fa5a14c86375bef517a351a20d2","modified":1534241511808},{"_id":"themes/material/layout/_widget/comment/valine/main.ejs","hash":"0d044c3b8141809ead06a870b5ce65bf95647c14","modified":1534241511809},{"_id":"themes/material/source/img/random/material-19.png","hash":"768ed1a4966e2e418cb00f6b36d2fc9058328eb3","modified":1534241511874},{"_id":"themes/material/source/img/random/material-7.png","hash":"5c49ff3c064aaeb21227c2bd98b5ae422ddca84c","modified":1534241511878},{"_id":"themes/material/source/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1534241511857},{"_id":"themes/material/source/fonts/Roboto-Light.ttf","hash":"b9ea2eaf26ff8fdcb5aee3e0c2c7a6084ebb6aac","modified":1534241511842},{"_id":"themes/material/source/fonts/Roboto-Medium.ttf","hash":"3965419aab480c184f66bc5e39c1719a373a4ef6","modified":1534241511846},{"_id":"themes/material/source/fonts/Roboto-Regular.ttf","hash":"06691e103d4d3ce1f1108d9b7d21254b714a41f8","modified":1534241511850},{"_id":"themes/material/source/fonts/Roboto-Thin.ttf","hash":"ed5101c3a800f35e925603a406e0c2dc5278b96c","modified":1534241511854},{"_id":"themes/material/source/fonts/Roboto-Bold.ttf","hash":"d1864343b543978bd491d40c80010cea50c1b7bf","modified":1534241511838},{"_id":"themes/material/source/fonts/Roboto-Black.ttf","hash":"0244e6497a51fb8a38ca7e6fe297b066e2e09af5","modified":1534241511835},{"_id":"public/atom.xml","hash":"dde317eb3ffb5bac4cd0fb5e597f32bed5ef8c25","modified":1573728350797},{"_id":"public/timeline/index.html","hash":"4a4f7cb94275fe7d87528a241c8c85dcc48706e3","modified":1573728351282},{"_id":"public/tags/index.html","hash":"55d9dc0134154fc83e9a6513e2a689bdf13a5ccd","modified":1573728351282},{"_id":"public/2019/11/08/design-pattern-strategy/index.html","hash":"98db0180a5b7f8175e2e7f976c86e5b5b390f8e9","modified":1573728351283},{"_id":"public/2019/11/14/what's the fuck is Context/index.html","hash":"84ab39a099770c22404d1150b79f95aee042b932","modified":1573728351283},{"_id":"public/2019/11/06/design-pattern-template/index.html","hash":"90e478f8fc961b2237adba51e13aa4bb5e434f6b","modified":1573728351283},{"_id":"public/2019/11/01/design-pattern-decoration/index.html","hash":"b94dc78a0de1db2c1c19593a2d57098927f63b54","modified":1573728351283},{"_id":"public/2019/10/29/design-pattern-factory/index.html","hash":"78a42c0eaac40d96a753c3036454db85f025243f","modified":1573728351283},{"_id":"public/2019/10/26/design-pattern-singleton/index.html","hash":"7ac30b9ed084d9a92a12f6399bcedf07de40f5bc","modified":1573728351283},{"_id":"public/2019/10/26/design-pattern-builder/index.html","hash":"390a359502bd516da104f41bb8113a07a90b895f","modified":1573728351283},{"_id":"public/2019/10/26/message-enqueue-process/index.html","hash":"fbe798a60c0b137251c89e058c2ca1d94472d7e9","modified":1573728351283},{"_id":"public/2019/08/30/start-activity-procedure/index.html","hash":"34d6301e5b66c5811575cdb16142cc977904c2a9","modified":1573728351283},{"_id":"public/2019/08/14/java-proxy-pattern/index.html","hash":"0a79df9bff010f7ae9e736d7816fcbc936f6d7b6","modified":1573728351283},{"_id":"public/2019/05/13/Android-collapse-status-bar/index.html","hash":"bfafd827497766e80a6654056f7bd7c223d3aebd","modified":1573728351283},{"_id":"public/2019/05/13/ViewDragHelper-source-code/index.html","hash":"88bb6cfb77e24e319b548d3fdacee7ce8a9d15a0","modified":1573728351283},{"_id":"public/2019/04/15/custom-view-parallax/index.html","hash":"2d33c6caaf68399cd0e7a6001d466c9208896892","modified":1573728351283},{"_id":"public/2019/04/10/Android-MeasureSpec/index.html","hash":"28692b6dbd8cdd58413689bf6d28bd2a09d7d6cd","modified":1573728351283},{"_id":"public/2019/03/29/View-inflate-analysis/index.html","hash":"e2d6b49befb6c977008aa53e0de3ff6853b12778","modified":1573728351283},{"_id":"public/2019/03/22/ConstraintLayout-learning/index.html","hash":"fd299189b0567d23618846cf829c5d13d8507814","modified":1573728351283},{"_id":"public/2018/09/09/Efficient-Android-Threading-chapter-4-1/index.html","hash":"0e1dcb6f99a25a3c848644fcf0589eea87acb8f1","modified":1573728351283},{"_id":"public/2018/09/09/Efficient-Android-Threading-chapter-4-2/index.html","hash":"e20cf22c28e6697765d2d654859c2c90596dcbd9","modified":1573728351284},{"_id":"public/2018/08/29/Efficient-Android-Threading-chapter-3/index.html","hash":"21de4865a68188c57971bab7665e87376275bcc8","modified":1573728351284},{"_id":"public/2018/08/25/Efficient-Android-Threading-chapter-2/index.html","hash":"905a0390b851b254fe2f0117300c4ef78cbc1ae6","modified":1573728351285},{"_id":"public/2018/08/14/android-view-post/index.html","hash":"b91ca34b276a681b63d74c2f814387cd3345324f","modified":1573728351285},{"_id":"public/2018/08/13/can-not-get-height-in-onCreate/index.html","hash":"d19ed4320ae05afce1ef08553f27e0332703aa2c","modified":1573728351285},{"_id":"public/2018/08/12/color-track-textview/index.html","hash":"5b39e7fb199795869dc7c88de64e24792a723bdd","modified":1573728351285},{"_id":"public/2018/05/28/Canvas.drawPath()/index.html","hash":"cbf0e40490bc937c6c20550ab762e18faf69b378","modified":1573728351285},{"_id":"public/2018/05/28/bug-of-mysql/index.html","hash":"f43cc1af7c8dd1ad9e5559223aa1fb488b01b58b","modified":1573728351285},{"_id":"public/2018/03/29/Android Paint- .measureText() VS .getTextBounds()/index.html","hash":"3d9daa6781dc62489e3111907b3f39211337a906","modified":1573728351285},{"_id":"public/2018/03/19/TrackColorTextView/index.html","hash":"babd3465ef37aedbf543c006f23b0fb382140865","modified":1573728351285},{"_id":"public/2018/03/09/differ-of-abstract-interface/index.html","hash":"5d26314819eb6bea47c580f21f68d0abc58f8b32","modified":1573728351285},{"_id":"public/2018/03/09/polymorphism-of-java/index.html","hash":"f39b412003226363e70c277bfea62571ea4d4a05","modified":1573728351285},{"_id":"public/2018/03/07/TextView/index.html","hash":"841c642d234f990c7115ceea08d3693cc72eb151","modified":1573728351285},{"_id":"public/archives/index.html","hash":"4ab1c5103e2a6b4d42cf4ce37f64c6bb7f217946","modified":1573728351285},{"_id":"public/index.html","hash":"3b685b47de5347b1cbfccbe13c44ec4bd8246cac","modified":1573728351285},{"_id":"public/page/2/index.html","hash":"00f9cd9358339ce88d9fae7c2a2363588b93f7c6","modified":1573728351285},{"_id":"public/page/3/index.html","hash":"4eda5a03b92d28e3c1b93ac1fb41785ab6686841","modified":1573728351285},{"_id":"public/tags/Android/index.html","hash":"9664ca42bbfc9f8c7ea0c3931634a7fc08435313","modified":1573728351285},{"_id":"public/tags/design-pattern/index.html","hash":"205d06cd2a1ffd6d34938abc1e0135a7e9b20b33","modified":1573728351285},{"_id":"public/tags/Android/page/2/index.html","hash":"bc26648756e33c64054899332bfbafe18295a3b7","modified":1573728351286},{"_id":"public/tags/android/index.html","hash":"2aff34dde9b5975b16ca2bbc6cc9cb1a1d0d4725","modified":1573728351286},{"_id":"public/tags/java/index.html","hash":"6d493c4ec7c45f577809ec377e98251eb3d1835b","modified":1573728351286},{"_id":"public/tags//index.html","hash":"5216f36e5e566457f35e06276c19b8fb36af20e2","modified":1573728351286},{"_id":"public/tags/Efficient-Android-Threading/index.html","hash":"432186a9ac9f0865a7350c82959b7278c0fb7041","modified":1573728351286},{"_id":"public/tags//index.html","hash":"8e2ad526efd539fb308572ddd16f75232afb3a58","modified":1573728351286},{"_id":"public/img/avatar.jpg","hash":"859cc1776449dde1c08526076af2d82e0e8da931","modified":1573728351300},{"_id":"public/CNAME","hash":"fb5a88c062706435767090b234bdbb58a8041c61","modified":1573728351300},{"_id":"public/img/avatar.png","hash":"bf483b0d495dbbcfb308348a945818e1c1cc9696","modified":1573728351300},{"_id":"public/img/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1573728351300},{"_id":"public/img/favicon.png","hash":"b1bcc84cedb2a618e8db93559ce7d58f9274085d","modified":1573728351300},{"_id":"public/img/logo.png","hash":"b1bcc84cedb2a618e8db93559ce7d58f9274085d","modified":1573728351300},{"_id":"public/img/bg.png","hash":"a32f9717e19e821a4030ade551dc2917c889fcd8","modified":1573728351300},{"_id":"public/img/upyun_logo.svg","hash":"1f118b2b9c54f431d5e731ccf316ceefe605ba67","modified":1573728351300},{"_id":"public/img/sidebar_header.png","hash":"c47f4d39f421c0a950279d050ae82f9ae6dd19ff","modified":1573728351300},{"_id":"public/fonts/MaterialIcons-Regular.woff2","hash":"09963592e8c953cc7e14e3fb0a5b05d5042e8435","modified":1573728351300},{"_id":"public/fonts/MaterialIcons-Regular.woff","hash":"c6c953c2ccb2ca9abb21db8dbf473b5a435f0082","modified":1573728351301},{"_id":"public/img/footer/footer_ico-gplus.svg","hash":"b50274133ab263bcacdf729871d0446b615ac984","modified":1573728351301},{"_id":"public/img/footer/footer_ico-bilibili.svg","hash":"1a007ae30d69aa597f589edb4ee0638a9814c988","modified":1573728351301},{"_id":"public/img/footer/footer_ico-github.svg","hash":"5f1f9f53e6a87ad674108c6bd16e424a1e888c61","modified":1573728351301},{"_id":"public/img/footer/footer_ico-linkedin.svg","hash":"9831c86352ec5ff283a3277d033120f86388c277","modified":1573728351301},{"_id":"public/img/footer/footer_ico-instagram.svg","hash":"294c511e62063ea49f61e23958ab27d643ba0228","modified":1573728351301},{"_id":"public/img/footer/footer_ico-facebook.svg","hash":"74b3b3c6bd1d76b7eaaf75d36ac929b11a5a3e82","modified":1573728351301},{"_id":"public/img/footer/footer_ico-telegram.svg","hash":"413d66e40ca476deeb49364935d49d2f7839cdfd","modified":1573728351301},{"_id":"public/img/footer/footer_ico-tumblr.svg","hash":"11daf4fa4220787306fc21a879429e98b7db8d03","modified":1573728351301},{"_id":"public/img/footer/footer_ico-v2ex.svg","hash":"c5ffaf67a97e534c266d1585a9a3b56f1bfe3052","modified":1573728351301},{"_id":"public/img/footer/footer_ico-zhihu.svg","hash":"d3f8da320fffefc5144822665dfe17d25af4061c","modified":1573728351301},{"_id":"public/img/footer/footer_ico-twitter.svg","hash":"58df7777d6fcee8fa3c42453c091714bb3f97c95","modified":1573728351301},{"_id":"public/img/footer/footer_ico-weibo.svg","hash":"26d0cdb77f0c4afd60111176167eacfa222bc4c1","modified":1573728351301},{"_id":"public/img/gallery/close.svg","hash":"0739fa52652dd59cebecc861144b702e455adb0c","modified":1573728351301},{"_id":"public/img/gallery/arrow.svg","hash":"68799fe01ecc7f5fb721287693b9b0b93f4c067a","modified":1573728351301},{"_id":"public/img/gallery/spinner.svg","hash":"ef69a35119feb82d8e9cf4a59656aa25051afebd","modified":1573728351301},{"_id":"public/img/random/material-10.png","hash":"363466a376e4df9e61acc904cd25f3c7ae1a7280","modified":1573728351301},{"_id":"public/img/random/material-3.png","hash":"848eaa70b9b0cd7a2204c78e8aa324d8f96bb097","modified":1573728351301},{"_id":"public/img/random/material-17.png","hash":"ece82810e31f711576db598c845c3d97bd49fe67","modified":1573728351301},{"_id":"public/img/random/material-12.png","hash":"d020b3d42542715c7ae95b3d8603fe3180bfe8f3","modified":1573728351301},{"_id":"public/img/random/material-4.png","hash":"b475dfbf67a076a4e17a5527fd1973b1d4adac07","modified":1573728351302},{"_id":"public/img/random/material-6.png","hash":"2f841e0c064fecb607ad1e149662a0c96d9e725d","modified":1573728351302},{"_id":"public/img/random/material-8.png","hash":"57db542d526ef6866cb34e261096e93a0e6f3a82","modified":1573728351302},{"_id":"public/img/random/material-19.png","hash":"768ed1a4966e2e418cb00f6b36d2fc9058328eb3","modified":1573728351302},{"_id":"public/img/daily_pic.png","hash":"5e9a5f6a134889d0242e69061837f2032416d7ce","modified":1573728351311},{"_id":"public/img/portrait.jpeg","hash":"1521ba5b86020bb5c417572f250d84109d62c7c2","modified":1573728351312},{"_id":"public/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1573728351313},{"_id":"public/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1573728351313},{"_id":"public/img/random/material-9.png","hash":"840319c4d1f38fb8df79eb4669ed2e14d89fd680","modified":1573728351313},{"_id":"public/img/random/material-1.png","hash":"4839299eaa4db7272befa7b824e54b647fbbfc44","modified":1573728351313},{"_id":"public/img/random/material-11.png","hash":"ce20b0ad08a248c036115374f2edb7301ff60b72","modified":1573728351313},{"_id":"public/img/random/material-13.png","hash":"1a8378db3121b583485e2b939cb1aa0e0b14b0c8","modified":1573728351313},{"_id":"public/img/random/material-15.png","hash":"36b9937cf3810e4970902b78797ad29b0831f065","modified":1573728351313},{"_id":"public/img/random/material-14.png","hash":"b4f65b601960138c69f57171b0ddd55895483f45","modified":1573728351314},{"_id":"public/img/random/material-16.png","hash":"ade7f75200d3fb38326e3cf1e9f1a812fb12a43b","modified":1573728351314},{"_id":"public/img/random/material-2.png","hash":"faba2ce69c19d6c1dac392dd10b054e0061f6fb7","modified":1573728351314},{"_id":"public/img/random/material-18.png","hash":"4b98204abe36ecd3f30678d2c22059130e0db328","modified":1573728351314},{"_id":"public/img/random/material-5.png","hash":"5041ebd073a139c67f8ed271e74c967c7eb9c5be","modified":1573728351314},{"_id":"public/img/random/material-7.png","hash":"5c49ff3c064aaeb21227c2bd98b5ae422ddca84c","modified":1573728351314},{"_id":"public/css/ie-blocker.css","hash":"dddce7e6250a449291888ae7865697282a213b14","modified":1573728351326},{"_id":"public/css/prettify.css","hash":"c395f20ee64e80c2b6b15c7dade02f9aaaeab2c8","modified":1573728351326},{"_id":"public/css/uc.css","hash":"1e0977a2c9bdf721cc05654dfc025dd250655852","modified":1573728351326},{"_id":"public/css/prettify.min.css","hash":"62edd8f08656463b0e077dcf893faa3cc8eb5fe4","modified":1573728351327},{"_id":"public/js/ie-blocker.en.js","hash":"96ca8e677a12048d099319ebdf01983ddc6ca80c","modified":1573728351327},{"_id":"public/js/hanabi-browser-bundle.js","hash":"d646647bda386140c8315d60e3ff4ddbdb15c1ea","modified":1573728351327},{"_id":"public/js/ie-blocker.zhCN.js","hash":"0ed49b0ec1d1924b128fbd97fca2cf7af7856fdf","modified":1573728351327},{"_id":"public/js/lazyload.min.js","hash":"5348fd7aa4dbefac9d21091c9fd5e263563b5540","modified":1573728351327},{"_id":"public/js/lsloader.min.js","hash":"1a68a8d267948ea8475245b7d365a1a1bd8f732e","modified":1573728351327},{"_id":"public/js/nprogress.js","hash":"a3058d4b6afb5d7a14e5afcbb88f778de35864f0","modified":1573728351327},{"_id":"public/js/queue.js","hash":"dd252616b568b71c222d9cfc859bfe52738e576a","modified":1573728351327},{"_id":"public/js/smoothscroll.js","hash":"df56a1c84191a62750ae820943377b6775fca0e2","modified":1573728351327},{"_id":"public/js/queue.min.js","hash":"21aab782ca33efbb1386cc960b6be0a02106760d","modified":1573728351327},{"_id":"public/css/prettify/atelier-cave-light.min.css","hash":"4b62dc45aa351b071d6a434dc54fe8c2e15c85cc","modified":1573728351327},{"_id":"public/css/prettify/atelier-dune-dark.min.css","hash":"c5094d99ca0e619d97860c88211bf908fdf830b1","modified":1573728351327},{"_id":"public/css/prettify/atelier-dune-light.min.css","hash":"b3ad98483e4d5bde72d52a15423d98e0d086db09","modified":1573728351327},{"_id":"public/css/prettify/atelier-forest-dark.min.css","hash":"9296b851a5b66785a60afa5da5fe9080bda96bf5","modified":1573728351327},{"_id":"public/css/prettify/atelier-estuary-dark.min.css","hash":"7e3a065cafeb3acc1d7178f64ef4265f5d5ad2b9","modified":1573728351327},{"_id":"public/css/prettify/atelier-estuary-light.min.css","hash":"1d12d8f7fa9c122a186ee76fdf681c191a68f104","modified":1573728351327},{"_id":"public/css/prettify/atelier-heath-light.min.css","hash":"a67199fa580b3aa2df031e5d2028929d29ca3b45","modified":1573728351327},{"_id":"public/css/prettify/atelier-forest-light.min.css","hash":"3532f6e86bf4afbba05f7a074b791b73174f9622","modified":1573728351327},{"_id":"public/css/prettify/atelier-heath-dark.min.css","hash":"954309acd7918422382a3ff2f9c2988aec0ff956","modified":1573728351327},{"_id":"public/css/prettify/atelier-lakeside-dark.min.css","hash":"18575fc6dff855e395a39d0383d2f18807091f0d","modified":1573728351327},{"_id":"public/css/prettify/atelier-lakeside-light.min.css","hash":"e20e8ac64432fa1aa6f74792b58196af7cf79c12","modified":1573728351327},{"_id":"public/css/prettify/atelier-plateau-dark.min.css","hash":"137e3c499a720da3c1d57b4dc53264b1d623e1c5","modified":1573728351327},{"_id":"public/css/prettify/atelier-plateau-light.min.css","hash":"153801640fdcbb74c0de3f15345110f2210eb991","modified":1573728351327},{"_id":"public/css/prettify/atelier-savanna-light.min.css","hash":"d9425ffb7c60d646190c22b9a5f72091ee5f9ace","modified":1573728351327},{"_id":"public/css/prettify/atelier-savanna-dark.min.css","hash":"fba92c652fd6704422b8f2bbc11706805a6faed0","modified":1573728351327},{"_id":"public/css/prettify/atelier-sulphurpool-dark.min.css","hash":"015a35dddaee153fa8bb71d7f3818a6ba4d120d8","modified":1573728351327},{"_id":"public/css/prettify/atelier-sulphurpool-light.min.css","hash":"ab1a6200eab648cab443c3df77fde9b237ef27b6","modified":1573728351327},{"_id":"public/css/prettify/atelier-seaside-dark.min.css","hash":"e0e6bbacc75a349b1e49c236d374b0e42f1fd485","modified":1573728351328},{"_id":"public/css/prettify/github-v2.min.css","hash":"57630621d20842a529bdea7b17fc90f520e562ef","modified":1573728351328},{"_id":"public/css/prettify/atelier-seaside-light.min.css","hash":"732750b75389c1c49204f37705e6abeee40ce64f","modified":1573728351328},{"_id":"public/css/prettify/hemisu-dark.min.css","hash":"a671248cfd573292026d2174817e82e593691052","modified":1573728351328},{"_id":"public/css/prettify/tomorrow-night-blue.min.css","hash":"c442728d96485bcf816151fe6bd96993aae09852","modified":1573728351328},{"_id":"public/css/prettify/hemisu-light.min.css","hash":"b2556ff41e513fd13d032ec84a37ee260a905815","modified":1573728351328},{"_id":"public/css/prettify/github.min.css","hash":"19cf828225288fa5c006f1d8f66c39d11f4ef7f2","modified":1573728351328},{"_id":"public/css/prettify/tomorrow-night-eighties.min.css","hash":"6ce259d674bb4edda23eea32b2379be17d0e0e6e","modified":1573728351328},{"_id":"public/css/prettify/tomorrow-night.min.css","hash":"d989206d124035494acb4b0cdc7fbc89f3b7d108","modified":1573728351328},{"_id":"public/css/prettify/tomorrow.min.css","hash":"b2c6d610b77f0273fefab5aa4ad26a7f58956f87","modified":1573728351328},{"_id":"public/css/prettify/tranquil-heart.min.css","hash":"0f6eefbdda8e410832e9c516a5dd19899217ef06","modified":1573728351328},{"_id":"public/css/prettify/vibrant-ink.min.css","hash":"c265bac6c31cf622b536b29c8a6bc46955d6fe63","modified":1573728351328},{"_id":"public/css/prettify/tomorrow-night-bright.min.css","hash":"cf251fd3edfd736695272a0f1b41d509b7bb1fb9","modified":1573728351328},{"_id":"public/css/prettify/atelier-cave-dark.min.css","hash":"cb0156cdc36500a26b232ae1c81fdc880eba85e7","modified":1573728351328},{"_id":"public/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1573728351328},{"_id":"public/css/duoshuo.css","hash":"32a02eaa01ff7b66fd9df307b0d33d52810096be","modified":1573728351333},{"_id":"public/css/disqus-proxy.min.css","hash":"3f8f99f71d361302288b0ba11fd36072564b08c2","modified":1573728351333},{"_id":"public/css/duoshuo.min.css","hash":"89a30544b8b01d061da51c40f2af702a7969de5e","modified":1573728351333},{"_id":"public/js/lsloader.js","hash":"2b14e57784fb6b5f58d71584189c61af45f393e8","modified":1573728351333},{"_id":"public/js/prettify.min.js","hash":"69908fe0a09cee107c25cb5d769b861723e7b7bb","modified":1573728351333},{"_id":"public/fonts/MaterialIcons-Regular.ttf","hash":"fc05de31234e0090f7ddc28ce1b23af4026cb1da","modified":1573728351333},{"_id":"public/fonts/MaterialIcons-Regular.eot","hash":"26fb8cecb5512223277b4d290a24492a0f09ede1","modified":1573728351334},{"_id":"public/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1573728351334},{"_id":"public/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1573728351334},{"_id":"public/css/disqus-proxy.css","hash":"d5086cda8aaae20b8d3f9dd50f0be5ccb717e42a","modified":1573728351334},{"_id":"public/js/Valine.min.js","hash":"6a287a99a772a0ea8f98b133523429c9250cc67f","modified":1573728351334},{"_id":"public/css/gallery.min.css","hash":"c5333ca835aae49239d809130a7b281af745729e","modified":1573728351362},{"_id":"public/css/fontawesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1573728351362},{"_id":"public/js/gallery/gallery.js","hash":"8ee48312a183b42a9886211a0ec825ea0d041301","modified":1573728351362},{"_id":"public/fonts/Roboto-Black.ttf","hash":"0244e6497a51fb8a38ca7e6fe297b066e2e09af5","modified":1573728351381},{"_id":"public/css/material-icons.css","hash":"f6f95fe5190f3c65931847246621fb83754eb00c","modified":1573728351388},{"_id":"public/js/MathJax.js","hash":"a21703b5848325a902c9b39bbf3ca6490d3e1b1b","modified":1573728351388},{"_id":"public/fonts/Roboto-Bold.ttf","hash":"d1864343b543978bd491d40c80010cea50c1b7bf","modified":1573728351390},{"_id":"public/fonts/Roboto-Medium.ttf","hash":"3965419aab480c184f66bc5e39c1719a373a4ef6","modified":1573728351390},{"_id":"public/css/style.min.css","hash":"a9e9b33e1fcf818f08a04b909c86f2460a05f060","modified":1573728351397},{"_id":"public/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1573728351397},{"_id":"public/fonts/Roboto-Thin.ttf","hash":"ed5101c3a800f35e925603a406e0c2dc5278b96c","modified":1573728351397},{"_id":"public/css/material.min.css","hash":"1a19febb9214ab689b02f5bb8ccb23579e6c1181","modified":1573728351407},{"_id":"public/fonts/Roboto-Light.ttf","hash":"b9ea2eaf26ff8fdcb5aee3e0c2c7a6084ebb6aac","modified":1573728351407},{"_id":"public/js/jquery.min.js","hash":"00073d6597d2760b81387274a9ec56b9d5cb1552","modified":1573728351413},{"_id":"public/css/style.css","hash":"a2f27c40f412dc24e1ed5f62a4117523a226eed0","modified":1573728351413},{"_id":"public/css/material.css","hash":"068e2b00f686157b6e8b78b9b808112adbedf4de","modified":1573728351416},{"_id":"public/js/js.min.js","hash":"709d347d3be033b841de0493b7cf532b594bb1f6","modified":1573728351416},{"_id":"public/fonts/Roboto-Regular.ttf","hash":"06691e103d4d3ce1f1108d9b7d21254b714a41f8","modified":1573728351416},{"_id":"public/js/js.js","hash":"64b3f20e7138674ecf21e6e3982565ea63feae26","modified":1573728351420}],"Category":[],"Data":[],"Page":[{"title":"timeline","date":"2019-08-30T09:13:41.197Z","layout":"timeline","_content":"","source":"timeline/index.md","raw":"---\ntitle: timeline\ndate:\nlayout: timeline\n---\n","updated":"2018-08-16T07:11:52.224Z","path":"timeline/index.html","comments":1,"_id":"ck2yl86bw0005lh1p8picpuc2","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2019-08-30T09:13:41.191Z","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate:\nlayout: tags\n---\n","updated":"2018-08-16T07:09:26.881Z","path":"tags/index.html","comments":1,"_id":"ck2yl86by0007lh1p2d0e5yeo","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Android Paint .measureText() VS .getTextBounds()","Tags":"android","date":"2018-03-28T16:00:00.000Z","_content":"\n\n\n **.getTextBounds()**  Rect  **.measureText()** \n\n<!--more-->\n\n\n\n```java\nfinal String someText = \"Hello. I'm some text!\";\n\nPaint mPaint = new Paint();\n\n// .measureText()\nfloat measuredWidth = mPaint.measureText(someText);\n\n// .getTextBounds()\nRect mBounds = new Rect();\nmPaint.getTextBounds(someText, 0, someText.length, mBounds);\nint measuredWidth = mBounds.width();\nint measuredHeight = mBounds.height();\n\n```\n\n\n\n```java\n// \nLog.d(\"Test\", String.format(\n        \"Text is '%s', measureText %f, getTextBounds %d\",\n        someText,\n        measuredWidth,\n        mBounds.width())\n    );\n\n// \n// Text is 'Hello. I'm some text!', measureText 115.000000, getTextBounds 105\n```\n\n\n\n\n\n>  measureText()  getTextBounds() \n>\n> measureText()  Glyph's AdvanceX \n>\n> getTextBounds() \n\n\n\n native measureText()  getTextBounds() \n\n","source":"_posts/Android Paint- .measureText() VS .getTextBounds().md","raw":"---\ntitle: Android Paint .measureText() VS .getTextBounds()\n\nTags: android\n\ndate: 2018-03-29\n---\n\n\n\n **.getTextBounds()**  Rect  **.measureText()** \n\n<!--more-->\n\n\n\n```java\nfinal String someText = \"Hello. I'm some text!\";\n\nPaint mPaint = new Paint();\n\n// .measureText()\nfloat measuredWidth = mPaint.measureText(someText);\n\n// .getTextBounds()\nRect mBounds = new Rect();\nmPaint.getTextBounds(someText, 0, someText.length, mBounds);\nint measuredWidth = mBounds.width();\nint measuredHeight = mBounds.height();\n\n```\n\n\n\n```java\n// \nLog.d(\"Test\", String.format(\n        \"Text is '%s', measureText %f, getTextBounds %d\",\n        someText,\n        measuredWidth,\n        mBounds.width())\n    );\n\n// \n// Text is 'Hello. I'm some text!', measureText 115.000000, getTextBounds 105\n```\n\n\n\n\n\n>  measureText()  getTextBounds() \n>\n> measureText()  Glyph's AdvanceX \n>\n> getTextBounds() \n\n\n\n native measureText()  getTextBounds() \n\n","slug":"Android Paint- .measureText() VS .getTextBounds()","published":1,"updated":"2018-11-26T10:43:06.981Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86at0000lh1pwwax2k5c","content":"<p> <strong>.getTextBounds()</strong>  Rect  <strong>.measureText()</strong> </p>\n<a id=\"more\"></a>\n<p></p>\n<pre><code class=\"java\">final String someText = &quot;Hello. I&#39;m some text!&quot;;\n\nPaint mPaint = new Paint();\n\n// .measureText()\nfloat measuredWidth = mPaint.measureText(someText);\n\n// .getTextBounds()\nRect mBounds = new Rect();\nmPaint.getTextBounds(someText, 0, someText.length, mBounds);\nint measuredWidth = mBounds.width();\nint measuredHeight = mBounds.height();\n\n</code></pre>\n<p></p>\n<pre><code class=\"java\">// \nLog.d(&quot;Test&quot;, String.format(\n        &quot;Text is &#39;%s&#39;, measureText %f, getTextBounds %d&quot;,\n        someText,\n        measuredWidth,\n        mBounds.width())\n    );\n\n// \n// Text is &#39;Hello. I&#39;m some text!&#39;, measureText 115.000000, getTextBounds 105\n</code></pre>\n<p></p>\n<blockquote>\n<p> measureText()  getTextBounds() </p>\n<p>measureText()  Glyphs AdvanceX </p>\n<p>getTextBounds() </p>\n</blockquote>\n<p> native measureText()  getTextBounds() </p>\n","site":{"data":{}},"excerpt":"<p> <strong>.getTextBounds()</strong>  Rect  <strong>.measureText()</strong> </p>","more":"<p></p>\n<pre><code class=\"java\">final String someText = &quot;Hello. I&#39;m some text!&quot;;\n\nPaint mPaint = new Paint();\n\n// .measureText()\nfloat measuredWidth = mPaint.measureText(someText);\n\n// .getTextBounds()\nRect mBounds = new Rect();\nmPaint.getTextBounds(someText, 0, someText.length, mBounds);\nint measuredWidth = mBounds.width();\nint measuredHeight = mBounds.height();\n\n</code></pre>\n<p></p>\n<pre><code class=\"java\">// \nLog.d(&quot;Test&quot;, String.format(\n        &quot;Text is &#39;%s&#39;, measureText %f, getTextBounds %d&quot;,\n        someText,\n        measuredWidth,\n        mBounds.width())\n    );\n\n// \n// Text is &#39;Hello. I&#39;m some text!&#39;, measureText 115.000000, getTextBounds 105\n</code></pre>\n<p></p>\n<blockquote>\n<p> measureText()  getTextBounds() </p>\n<p>measureText()  Glyphs AdvanceX </p>\n<p>getTextBounds() </p>\n</blockquote>\n<p> native measureText()  getTextBounds() </p>"},{"title":"Android ","thumbnails":null,"data":"2019-05-12T16:00:00.000Z","_content":"\n\n\n\n\nRemoteViewAPI\n\nandroid.app.StatusBarManager\n\nAPI LEVEL>16\n\n AndroidManifest.xml\n\n```xml\n<uses-permission android:name=\"android.permission.EXPAND_STATUS_BAR\" />\n```\n\n```java\nprivate void collapseStatusBar() {\n        int currentApiVersion = android.os.Build.VERSION.SDK_INT;\n        try {\n            Object service = getSystemService(\"statusbar\");\n            Class<?> statusbarManager = Class\n                    .forName(\"android.app.StatusBarManager\");\n            Method collapse = null;\n            if (service != null) {\n                if (currentApiVersion <= 16) {\n                    collapse = statusbarManager.getMethod(\"collapse\");\n                } else {\n                    collapse = statusbarManager.getMethod(\"collapsePanels\");\n                }\n                collapse.setAccessible(true);\n                collapse.invoke(service);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n```\n\n\n\n","source":"_posts/Android-collapse-status-bar.md","raw":"---\ntitle: Android \nthumbnails: \ndata: 2019-05-13\ntags: [Android]\n---\n\n\n\n\n\nRemoteViewAPI\n\nandroid.app.StatusBarManager\n\nAPI LEVEL>16\n\n AndroidManifest.xml\n\n```xml\n<uses-permission android:name=\"android.permission.EXPAND_STATUS_BAR\" />\n```\n\n```java\nprivate void collapseStatusBar() {\n        int currentApiVersion = android.os.Build.VERSION.SDK_INT;\n        try {\n            Object service = getSystemService(\"statusbar\");\n            Class<?> statusbarManager = Class\n                    .forName(\"android.app.StatusBarManager\");\n            Method collapse = null;\n            if (service != null) {\n                if (currentApiVersion <= 16) {\n                    collapse = statusbarManager.getMethod(\"collapse\");\n                } else {\n                    collapse = statusbarManager.getMethod(\"collapsePanels\");\n                }\n                collapse.setAccessible(true);\n                collapse.invoke(service);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n```\n\n\n\n","slug":"Android-collapse-status-bar","published":1,"date":"2019-05-13T12:34:22.745Z","updated":"2019-05-13T12:34:22.745Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ay0001lh1pmzb7qwil","content":"<p>RemoteViewAPI</p>\n<p>android.app.StatusBarManager</p>\n<p>API LEVEL&gt;16</p>\n<p> AndroidManifest.xml</p>\n<pre><code class=\"xml\">&lt;uses-permission android:name=&quot;android.permission.EXPAND_STATUS_BAR&quot; /&gt;\n</code></pre>\n<pre><code class=\"java\">private void collapseStatusBar() {\n        int currentApiVersion = android.os.Build.VERSION.SDK_INT;\n        try {\n            Object service = getSystemService(&quot;statusbar&quot;);\n            Class&lt;?&gt; statusbarManager = Class\n                    .forName(&quot;android.app.StatusBarManager&quot;);\n            Method collapse = null;\n            if (service != null) {\n                if (currentApiVersion &lt;= 16) {\n                    collapse = statusbarManager.getMethod(&quot;collapse&quot;);\n                } else {\n                    collapse = statusbarManager.getMethod(&quot;collapsePanels&quot;);\n                }\n                collapse.setAccessible(true);\n                collapse.invoke(service);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<p>RemoteViewAPI</p>\n<p>android.app.StatusBarManager</p>\n<p>API LEVEL&gt;16</p>\n<p> AndroidManifest.xml</p>\n<pre><code class=\"xml\">&lt;uses-permission android:name=&quot;android.permission.EXPAND_STATUS_BAR&quot; /&gt;\n</code></pre>\n<pre><code class=\"java\">private void collapseStatusBar() {\n        int currentApiVersion = android.os.Build.VERSION.SDK_INT;\n        try {\n            Object service = getSystemService(&quot;statusbar&quot;);\n            Class&lt;?&gt; statusbarManager = Class\n                    .forName(&quot;android.app.StatusBarManager&quot;);\n            Method collapse = null;\n            if (service != null) {\n                if (currentApiVersion &lt;= 16) {\n                    collapse = statusbarManager.getMethod(&quot;collapse&quot;);\n                } else {\n                    collapse = statusbarManager.getMethod(&quot;collapsePanels&quot;);\n                }\n                collapse.setAccessible(true);\n                collapse.invoke(service);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n"},{"title":"Canvas.drawPath() ","date":"2018-05-27T16:00:00.000Z","_content":"\n\n\n<!-- more -->\n\n\n\n\n> Path\n>\n>  drawPath() \n\n\n\n```java\n// \nprivate void drawTriangle(Canvas canvas, Paint paint) {\n    Path mPath = new Path();\n    \n    // moveTo \n    mPath.moveTo(getWidth() / 2, 0);\n    //  y \n    // :: = 1:2:3\n    mPath.lineTo(0, getWidth() / 2 * Math.sqrt(3)));\n    mPath.lineTo(getWidth(), getWidth() / 2 * Math.sqrt(3)));\n    // \n    mPath.close();\n\n    canvas.drawPath(mPath, mPaint);\n}\n```\n\n","source":"_posts/Canvas.drawPath().md","raw":"---\ntitle: Canvas.drawPath() \n\ntags: [Android]\n\ndate: 2018-05-28\n---\n\n\n\n<!-- more -->\n\n\n\n\n> Path\n>\n>  drawPath() \n\n\n\n```java\n// \nprivate void drawTriangle(Canvas canvas, Paint paint) {\n    Path mPath = new Path();\n    \n    // moveTo \n    mPath.moveTo(getWidth() / 2, 0);\n    //  y \n    // :: = 1:2:3\n    mPath.lineTo(0, getWidth() / 2 * Math.sqrt(3)));\n    mPath.lineTo(getWidth(), getWidth() / 2 * Math.sqrt(3)));\n    // \n    mPath.close();\n\n    canvas.drawPath(mPath, mPaint);\n}\n```\n\n","slug":"Canvas.drawPath()","published":1,"updated":"2019-03-21T10:55:48.335Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86bv0004lh1pcdyds597","content":"<a id=\"more\"></a>\n<blockquote>\n<p>Path</p>\n<p> drawPath() </p>\n</blockquote>\n<p></p>\n<pre><code class=\"java\">// \nprivate void drawTriangle(Canvas canvas, Paint paint) {\n    Path mPath = new Path();\n\n    // moveTo \n    mPath.moveTo(getWidth() / 2, 0);\n    //  y \n    // :: = 1:2:3\n    mPath.lineTo(0, getWidth() / 2 * Math.sqrt(3)));\n    mPath.lineTo(getWidth(), getWidth() / 2 * Math.sqrt(3)));\n    // \n    mPath.close();\n\n    canvas.drawPath(mPath, mPaint);\n}\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Path</p>\n<p> drawPath() </p>\n</blockquote>\n<p></p>\n<pre><code class=\"java\">// \nprivate void drawTriangle(Canvas canvas, Paint paint) {\n    Path mPath = new Path();\n\n    // moveTo \n    mPath.moveTo(getWidth() / 2, 0);\n    //  y \n    // :: = 1:2:3\n    mPath.lineTo(0, getWidth() / 2 * Math.sqrt(3)));\n    mPath.lineTo(getWidth(), getWidth() / 2 * Math.sqrt(3)));\n    // \n    mPath.close();\n\n    canvas.drawPath(mPath, mPaint);\n}\n</code></pre>"},{"title":"","Tags":"android","date":"2018-03-18T16:00:00.000Z","_content":"\n\n\n> Canvas.clipRect()\n\n\n\n Rect  Rect \n\n\n\n\n\n\n\n```java\n@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n```","source":"_posts/TrackColorTextView.md","raw":"---\ntitle: \n\nTags: android\n\ndate: 2018-03-19\n---\n\n\n\n> Canvas.clipRect()\n\n\n\n Rect  Rect \n\n\n\n\n\n\n\n```java\n@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n```","slug":"TrackColorTextView","published":1,"updated":"2018-11-26T10:40:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86bx0006lh1p8m8wlbqy","content":"<blockquote>\n<p>Canvas.clipRect()</p>\n</blockquote>\n<p></p>\n<p> Rect  Rect </p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Canvas.clipRect()</p>\n</blockquote>\n<p></p>\n<p> Rect  Rect </p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n</code></pre>\n"},{"title":" MySQL 8.0 + ","date":"2018-05-27T16:00:00.000Z","_content":"\n\n\nMySQL 8.0  password  authentication_string \n\n<!-- more -->\n\nmysql_native_password8.0 caching_sha2_password\n\n\n\n\n\n>  \n\n```mysql\nmysql -u root -p\n```\n> MySQL  8  MySQL \n\n\n\n>  >mysql \n\n```mysql\n#  mysql \nuse mysql;\n\n# \nalter user 'root'@'localhost' identified by 'your pwd' password expire never;\n\n# mysql_native_password root \nalter user 'root'@'localhost' identified with mysql_native_password by 'your pwd';\n\n# \nflush privileges;\n```\n","source":"_posts/bug-of-mysql.md","raw":"---\ntitle:  MySQL 8.0 + \n\ndate: 2018-05-28\n---\n\n\n\nMySQL 8.0  password  authentication_string \n\n<!-- more -->\n\nmysql_native_password8.0 caching_sha2_password\n\n\n\n\n\n>  \n\n```mysql\nmysql -u root -p\n```\n> MySQL  8  MySQL \n\n\n\n>  >mysql \n\n```mysql\n#  mysql \nuse mysql;\n\n# \nalter user 'root'@'localhost' identified by 'your pwd' password expire never;\n\n# mysql_native_password root \nalter user 'root'@'localhost' identified with mysql_native_password by 'your pwd';\n\n# \nflush privileges;\n```\n","slug":"bug-of-mysql","published":1,"updated":"2018-08-14T10:11:51.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86c10009lh1p32pi2f0z","content":"<p>MySQL 8.0  password  authentication_string </p>\n<a id=\"more\"></a>\n<p>mysql_native_password8.0 caching_sha2_password </p>\n<p></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<pre><code class=\"mysql\">mysql -u root -p\n</code></pre>\n<blockquote>\n<p>MySQL  8  MySQL </p>\n</blockquote>\n<blockquote>\n<p> &gt;mysql </p>\n</blockquote>\n<pre><code class=\"mysql\">#  mysql \nuse mysql;\n\n# \nalter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;your pwd&#39; password expire never;\n\n# mysql_native_password root \nalter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password by &#39;your pwd&#39;;\n\n# \nflush privileges;\n</code></pre>\n","site":{"data":{}},"excerpt":"<p>MySQL 8.0  password  authentication_string </p>","more":"<p>mysql_native_password8.0 caching_sha2_password </p>\n<p></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<pre><code class=\"mysql\">mysql -u root -p\n</code></pre>\n<blockquote>\n<p>MySQL  8  MySQL </p>\n</blockquote>\n<blockquote>\n<p> &gt;mysql </p>\n</blockquote>\n<pre><code class=\"mysql\">#  mysql \nuse mysql;\n\n# \nalter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;your pwd&#39; password expire never;\n\n# mysql_native_password root \nalter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password by &#39;your pwd&#39;;\n\n# \nflush privileges;\n</code></pre>"},{"title":" TextView","date":"2018-03-06T16:00:00.000Z","_content":"\n\n\n### \n\n- \n\n  \n\n- \n\n   **attrs** \n\n- \n\n   style  style \n\n### \n\nMeasureSpec  32  int  2  SpecMode 30  SpecSize\n\nMeasureSpec  SpecMode  SpecSize  int \n\n```\n @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  MeasureSpec \n        // MeasureSpec  View  View \n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n    }\n\n```\n\n- MeasureSpec \n\n  - AT_MOST\n\n     SpecSize View \n\n     wrap_content\n\n  - EXACTLY\n\n     View  View \n\n     match_parent \n\n  - UNSECIFIED\n\n     View \n\n- ScrollView  ListView \n\n  ```\n  public class ListViewForScrollView extends ListView {\n      public ListViewForScrollView(Context context) {\n          super(context);\n      }\n      public ListViewForScrollView(Context context, AttributeSet attrs) {\n          super(context, attrs);\n      }\n      public ListViewForScrollView(Context context, AttributeSet attrs,\n          int defStyle) {\n          super(context, attrs, defStyle);\n      }\n          \n      @Override\n      /**\n       * ListViewScrollView\n       */\n      protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n          //  heightMeasureSpec\n          int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE >> 2,\n          MeasureSpec.AT_MOST);\n          super.onMeasure(widthMeasureSpec, expandSpec);\n      }\n  }\n\n  ```\n\n  Android  View  measureChild()  ViewGroup .\n\n   ScrollView \n\n  ```\n  @Override\n      protected void measureChild(View child, int parentWidthMeasureSpec,\n              int parentHeightMeasureSpec) {\n          ViewGroup.LayoutParams lp = child.getLayoutParams();\n\n          int childWidthMeasureSpec;\n          int childHeightMeasureSpec;\n\n          childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec, mPaddingLeft\n                  + mPaddingRight, lp.width);\n          final int verticalPadding = mPaddingTop + mPaddingBottom;\n          \n          // ScrollView  View  MeasureSpec.UNSPECIFIED\n          childHeightMeasureSpec = MeasureSpec.makeSafeMeasureSpec(\n                  Math.max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - verticalPadding),\n                  MeasureSpec.UNSPECIFIED);\n\n          child.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n      }\n\n  ```\n\n   ListView  onMeasure() \n\n  ```\n  @Override\n      protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n          super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\n          final int heightMode = MeasureSpec.getMode(heightMeasureSpec);\n          int heightSize = MeasureSpec.getSize(heightMeasureSpec);\n\n          int childHeight = 0;\n         \n          ... ...\n          \n          //  ListView \n          childHeight = child.getMeasuredHeight();\n\n       \t... ...\n\n          // \n          //  MeasureSpec.UNSPECIFIED + padding\n          if (heightMode == MeasureSpec.UNSPECIFIED) {\n              heightSize = mListPadding.top + mListPadding.bottom + childHeight +\n                      getVerticalFadingEdgeLength() * 2;\n          }\n\n          //  AT_MOST  measureHeightOfChildren()  View \n          if (heightMode == MeasureSpec.AT_MOST) {\n              heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);\n          }\n\n          setMeasuredDimension(widthSize, heightSize);\n      }\n\n  ```\n\n   Integer.MAX_VALUE >> 2 SpecSize  30  Integer.MAX_VALUE  AT_MOST,  resultSize  Integer.MAX_VALUE >> 2\n\n  ```java\n  public static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n          int specMode = MeasureSpec.getMode(spec);\n          int specSize = MeasureSpec.getSize(spec);\n\n          int size = Math.max(0, specSize - padding);\n\n          int resultSize = 0;\n          int resultMode = 0;\n\n          switch (specMode) { \n                  // Parent has imposed a maximum size on us\n              case MeasureSpec.AT_MOST:\n                  if (childDimension >= 0) {\n                      // Child wants a specific size... so be it\n                      resultSize = childDimension;\n                      resultMode = MeasureSpec.EXACTLY;\n                  } else if (childDimension == LayoutParams.MATCH_PARENT) {\n                      // Child wants to be our size, but our size is not fixed.\n                      // Constrain child to not be bigger than us.\n                      resultSize = size;\n                      resultMode = MeasureSpec.AT_MOST;\n                  } else if (childDimension == LayoutParams.WRAP_CONTENT) {\n                      // Child wants to determine its own size. It can't be\n                      // bigger than us.\n                      resultSize = size;\n                      resultMode = MeasureSpec.AT_MOST;\n                  }\n                  break;\n          }\n              \n          //noinspection ResourceType\n          return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n  }\n  ```\n\n  \n\n","source":"_posts/TextView.md","raw":"---\ntitle:  TextView\n\ntags: android \n\ndate: 2018-03-07\n---\n\n\n\n### \n\n- \n\n  \n\n- \n\n   **attrs** \n\n- \n\n   style  style \n\n### \n\nMeasureSpec  32  int  2  SpecMode 30  SpecSize\n\nMeasureSpec  SpecMode  SpecSize  int \n\n```\n @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  MeasureSpec \n        // MeasureSpec  View  View \n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n    }\n\n```\n\n- MeasureSpec \n\n  - AT_MOST\n\n     SpecSize View \n\n     wrap_content\n\n  - EXACTLY\n\n     View  View \n\n     match_parent \n\n  - UNSECIFIED\n\n     View \n\n- ScrollView  ListView \n\n  ```\n  public class ListViewForScrollView extends ListView {\n      public ListViewForScrollView(Context context) {\n          super(context);\n      }\n      public ListViewForScrollView(Context context, AttributeSet attrs) {\n          super(context, attrs);\n      }\n      public ListViewForScrollView(Context context, AttributeSet attrs,\n          int defStyle) {\n          super(context, attrs, defStyle);\n      }\n          \n      @Override\n      /**\n       * ListViewScrollView\n       */\n      protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n          //  heightMeasureSpec\n          int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE >> 2,\n          MeasureSpec.AT_MOST);\n          super.onMeasure(widthMeasureSpec, expandSpec);\n      }\n  }\n\n  ```\n\n  Android  View  measureChild()  ViewGroup .\n\n   ScrollView \n\n  ```\n  @Override\n      protected void measureChild(View child, int parentWidthMeasureSpec,\n              int parentHeightMeasureSpec) {\n          ViewGroup.LayoutParams lp = child.getLayoutParams();\n\n          int childWidthMeasureSpec;\n          int childHeightMeasureSpec;\n\n          childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec, mPaddingLeft\n                  + mPaddingRight, lp.width);\n          final int verticalPadding = mPaddingTop + mPaddingBottom;\n          \n          // ScrollView  View  MeasureSpec.UNSPECIFIED\n          childHeightMeasureSpec = MeasureSpec.makeSafeMeasureSpec(\n                  Math.max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - verticalPadding),\n                  MeasureSpec.UNSPECIFIED);\n\n          child.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n      }\n\n  ```\n\n   ListView  onMeasure() \n\n  ```\n  @Override\n      protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n          super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\n          final int heightMode = MeasureSpec.getMode(heightMeasureSpec);\n          int heightSize = MeasureSpec.getSize(heightMeasureSpec);\n\n          int childHeight = 0;\n         \n          ... ...\n          \n          //  ListView \n          childHeight = child.getMeasuredHeight();\n\n       \t... ...\n\n          // \n          //  MeasureSpec.UNSPECIFIED + padding\n          if (heightMode == MeasureSpec.UNSPECIFIED) {\n              heightSize = mListPadding.top + mListPadding.bottom + childHeight +\n                      getVerticalFadingEdgeLength() * 2;\n          }\n\n          //  AT_MOST  measureHeightOfChildren()  View \n          if (heightMode == MeasureSpec.AT_MOST) {\n              heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);\n          }\n\n          setMeasuredDimension(widthSize, heightSize);\n      }\n\n  ```\n\n   Integer.MAX_VALUE >> 2 SpecSize  30  Integer.MAX_VALUE  AT_MOST,  resultSize  Integer.MAX_VALUE >> 2\n\n  ```java\n  public static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n          int specMode = MeasureSpec.getMode(spec);\n          int specSize = MeasureSpec.getSize(spec);\n\n          int size = Math.max(0, specSize - padding);\n\n          int resultSize = 0;\n          int resultMode = 0;\n\n          switch (specMode) { \n                  // Parent has imposed a maximum size on us\n              case MeasureSpec.AT_MOST:\n                  if (childDimension >= 0) {\n                      // Child wants a specific size... so be it\n                      resultSize = childDimension;\n                      resultMode = MeasureSpec.EXACTLY;\n                  } else if (childDimension == LayoutParams.MATCH_PARENT) {\n                      // Child wants to be our size, but our size is not fixed.\n                      // Constrain child to not be bigger than us.\n                      resultSize = size;\n                      resultMode = MeasureSpec.AT_MOST;\n                  } else if (childDimension == LayoutParams.WRAP_CONTENT) {\n                      // Child wants to determine its own size. It can't be\n                      // bigger than us.\n                      resultSize = size;\n                      resultMode = MeasureSpec.AT_MOST;\n                  }\n                  break;\n          }\n              \n          //noinspection ResourceType\n          return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n  }\n  ```\n\n  \n\n","slug":"TextView","published":1,"updated":"2018-11-26T10:42:37.807Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86c3000alh1pygir4rq5","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p> <strong>attrs</strong> </p>\n</li>\n<li><p></p>\n<p> style  style </p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MeasureSpec  32  int  2  SpecMode 30  SpecSize</p>\n<p>MeasureSpec  SpecMode  SpecSize  int </p>\n<pre><code> @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  MeasureSpec \n        // MeasureSpec  View  View \n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n    }\n\n</code></pre><ul>\n<li><p>MeasureSpec </p>\n<ul>\n<li><p>AT_MOST</p>\n<p> SpecSize View </p>\n<p> wrap_content</p>\n</li>\n<li><p>EXACTLY</p>\n<p> View  View </p>\n<p> match_parent </p>\n</li>\n<li><p>UNSECIFIED</p>\n<p> View </p>\n</li>\n</ul>\n</li>\n<li><p>ScrollView  ListView </p>\n<pre><code>public class ListViewForScrollView extends ListView {\n    public ListViewForScrollView(Context context) {\n        super(context);\n    }\n    public ListViewForScrollView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n    public ListViewForScrollView(Context context, AttributeSet attrs,\n        int defStyle) {\n        super(context, attrs, defStyle);\n    }\n\n    @Override\n    /**\n     * ListViewScrollView\n     */\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  heightMeasureSpec\n        int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE &gt;&gt; 2,\n        MeasureSpec.AT_MOST);\n        super.onMeasure(widthMeasureSpec, expandSpec);\n    }\n}\n\n</code></pre><p>Android  View  measureChild()  ViewGroup .</p>\n<p> ScrollView </p>\n<pre><code>@Override\n    protected void measureChild(View child, int parentWidthMeasureSpec,\n            int parentHeightMeasureSpec) {\n        ViewGroup.LayoutParams lp = child.getLayoutParams();\n\n        int childWidthMeasureSpec;\n        int childHeightMeasureSpec;\n\n        childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec, mPaddingLeft\n                + mPaddingRight, lp.width);\n        final int verticalPadding = mPaddingTop + mPaddingBottom;\n\n        // ScrollView  View  MeasureSpec.UNSPECIFIED\n        childHeightMeasureSpec = MeasureSpec.makeSafeMeasureSpec(\n                Math.max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - verticalPadding),\n                MeasureSpec.UNSPECIFIED);\n\n        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n    }\n\n</code></pre><p> ListView  onMeasure() </p>\n<pre><code>@Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\n        final int heightMode = MeasureSpec.getMode(heightMeasureSpec);\n        int heightSize = MeasureSpec.getSize(heightMeasureSpec);\n\n        int childHeight = 0;\n\n        ... ...\n\n        //  ListView \n        childHeight = child.getMeasuredHeight();\n\n         ... ...\n\n        // \n        //  MeasureSpec.UNSPECIFIED + padding\n        if (heightMode == MeasureSpec.UNSPECIFIED) {\n            heightSize = mListPadding.top + mListPadding.bottom + childHeight +\n                    getVerticalFadingEdgeLength() * 2;\n        }\n\n        //  AT_MOST  measureHeightOfChildren()  View \n        if (heightMode == MeasureSpec.AT_MOST) {\n            heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);\n        }\n\n        setMeasuredDimension(widthSize, heightSize);\n    }\n\n</code></pre><p> Integer.MAX_VALUE &gt;&gt; 2 SpecSize  30  Integer.MAX_VALUE  AT_MOST,  resultSize  Integer.MAX_VALUE &gt;&gt; 2</p>\n<pre><code class=\"java\">public static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n        int specMode = MeasureSpec.getMode(spec);\n        int specSize = MeasureSpec.getSize(spec);\n\n        int size = Math.max(0, specSize - padding);\n\n        int resultSize = 0;\n        int resultMode = 0;\n\n        switch (specMode) { \n                // Parent has imposed a maximum size on us\n            case MeasureSpec.AT_MOST:\n                if (childDimension &gt;= 0) {\n                    // Child wants a specific size... so be it\n                    resultSize = childDimension;\n                    resultMode = MeasureSpec.EXACTLY;\n                } else if (childDimension == LayoutParams.MATCH_PARENT) {\n                    // Child wants to be our size, but our size is not fixed.\n                    // Constrain child to not be bigger than us.\n                    resultSize = size;\n                    resultMode = MeasureSpec.AT_MOST;\n                } else if (childDimension == LayoutParams.WRAP_CONTENT) {\n                    // Child wants to determine its own size. It can&#39;t be\n                    // bigger than us.\n                    resultSize = size;\n                    resultMode = MeasureSpec.AT_MOST;\n                }\n                break;\n        }\n\n        //noinspection ResourceType\n        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n</code></pre>\n<p></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p> <strong>attrs</strong> </p>\n</li>\n<li><p></p>\n<p> style  style </p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>MeasureSpec  32  int  2  SpecMode 30  SpecSize</p>\n<p>MeasureSpec  SpecMode  SpecSize  int </p>\n<pre><code> @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  MeasureSpec \n        // MeasureSpec  View  View \n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n    }\n\n</code></pre><ul>\n<li><p>MeasureSpec </p>\n<ul>\n<li><p>AT_MOST</p>\n<p> SpecSize View </p>\n<p> wrap_content</p>\n</li>\n<li><p>EXACTLY</p>\n<p> View  View </p>\n<p> match_parent </p>\n</li>\n<li><p>UNSECIFIED</p>\n<p> View </p>\n</li>\n</ul>\n</li>\n<li><p>ScrollView  ListView </p>\n<pre><code>public class ListViewForScrollView extends ListView {\n    public ListViewForScrollView(Context context) {\n        super(context);\n    }\n    public ListViewForScrollView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n    public ListViewForScrollView(Context context, AttributeSet attrs,\n        int defStyle) {\n        super(context, attrs, defStyle);\n    }\n\n    @Override\n    /**\n     * ListViewScrollView\n     */\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        //  heightMeasureSpec\n        int expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE &gt;&gt; 2,\n        MeasureSpec.AT_MOST);\n        super.onMeasure(widthMeasureSpec, expandSpec);\n    }\n}\n\n</code></pre><p>Android  View  measureChild()  ViewGroup .</p>\n<p> ScrollView </p>\n<pre><code>@Override\n    protected void measureChild(View child, int parentWidthMeasureSpec,\n            int parentHeightMeasureSpec) {\n        ViewGroup.LayoutParams lp = child.getLayoutParams();\n\n        int childWidthMeasureSpec;\n        int childHeightMeasureSpec;\n\n        childWidthMeasureSpec = getChildMeasureSpec(parentWidthMeasureSpec, mPaddingLeft\n                + mPaddingRight, lp.width);\n        final int verticalPadding = mPaddingTop + mPaddingBottom;\n\n        // ScrollView  View  MeasureSpec.UNSPECIFIED\n        childHeightMeasureSpec = MeasureSpec.makeSafeMeasureSpec(\n                Math.max(0, MeasureSpec.getSize(parentHeightMeasureSpec) - verticalPadding),\n                MeasureSpec.UNSPECIFIED);\n\n        child.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n    }\n\n</code></pre><p> ListView  onMeasure() </p>\n<pre><code>@Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\n        final int heightMode = MeasureSpec.getMode(heightMeasureSpec);\n        int heightSize = MeasureSpec.getSize(heightMeasureSpec);\n\n        int childHeight = 0;\n\n        ... ...\n\n        //  ListView \n        childHeight = child.getMeasuredHeight();\n\n         ... ...\n\n        // \n        //  MeasureSpec.UNSPECIFIED + padding\n        if (heightMode == MeasureSpec.UNSPECIFIED) {\n            heightSize = mListPadding.top + mListPadding.bottom + childHeight +\n                    getVerticalFadingEdgeLength() * 2;\n        }\n\n        //  AT_MOST  measureHeightOfChildren()  View \n        if (heightMode == MeasureSpec.AT_MOST) {\n            heightSize = measureHeightOfChildren(widthMeasureSpec, 0, NO_POSITION, heightSize, -1);\n        }\n\n        setMeasuredDimension(widthSize, heightSize);\n    }\n\n</code></pre><p> Integer.MAX_VALUE &gt;&gt; 2 SpecSize  30  Integer.MAX_VALUE  AT_MOST,  resultSize  Integer.MAX_VALUE &gt;&gt; 2</p>\n<pre><code class=\"java\">public static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n        int specMode = MeasureSpec.getMode(spec);\n        int specSize = MeasureSpec.getSize(spec);\n\n        int size = Math.max(0, specSize - padding);\n\n        int resultSize = 0;\n        int resultMode = 0;\n\n        switch (specMode) { \n                // Parent has imposed a maximum size on us\n            case MeasureSpec.AT_MOST:\n                if (childDimension &gt;= 0) {\n                    // Child wants a specific size... so be it\n                    resultSize = childDimension;\n                    resultMode = MeasureSpec.EXACTLY;\n                } else if (childDimension == LayoutParams.MATCH_PARENT) {\n                    // Child wants to be our size, but our size is not fixed.\n                    // Constrain child to not be bigger than us.\n                    resultSize = size;\n                    resultMode = MeasureSpec.AT_MOST;\n                } else if (childDimension == LayoutParams.WRAP_CONTENT) {\n                    // Child wants to determine its own size. It can&#39;t be\n                    // bigger than us.\n                    resultSize = size;\n                    resultMode = MeasureSpec.AT_MOST;\n                }\n                break;\n        }\n\n        //noinspection ResourceType\n        return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n</code></pre>\n<p></p>\n</li>\n</ul>\n"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg","title":"Android ","date":"2018-08-11T16:00:00.000Z","_content":"\n<!--more-->\n\n> Canvas.clipRect()\n\n\n\n Rect  Rect \n\n\n\n\n\n\n\n```java\n@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n```","source":"_posts/color-track-textview.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg\ntitle: Android \ntags: [Android]\ndate: 2018-08-12\n---\n\n<!--more-->\n\n> Canvas.clipRect()\n\n\n\n Rect  Rect \n\n\n\n\n\n\n\n```java\n@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n```","slug":"color-track-textview","published":1,"updated":"2019-03-21T10:33:43.994Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86c5000blh1px246pmbu","content":"<a id=\"more\"></a>\n<blockquote>\n<p>Canvas.clipRect()</p>\n</blockquote>\n<p></p>\n<p> Rect  Rect </p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Canvas.clipRect()</p>\n</blockquote>\n<p></p>\n<p> Rect  Rect </p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">@Override\nprotected void onDraw(Canvas canvas) {\n\n    // \n    drawText(canvas, mChangePaint, 0, getWidth()/2);\n\n    // \n    drawText(canvas, mOriginPaint, getWidth() / 2, getWidth());\n\n}\n\nprivate void drawText(Canvas canvas, Paint paint, int start, int end) {\n\n    paint.setTextSize(getTextSize());\n\n    // \n    canvas.save();\n\n    //  .clipRect() \n    Rect rect = new Rect(start, 0, end, getHeight());\n    canvas.clipRect(rect);\n\n    // \n    String text = getText().toString();\n    Rect textBounds = new Rect();\n    paint.getTextBounds(text, 0, text.length(), textBounds);\n    Paint.FontMetricsInt metrics = paint.getFontMetricsInt();\n\n    // \n    int x = getWidth() / 2 - textBounds.width() / 2;\n    int y = getHeight() / 2 + (metrics.bottom - metrics.top) / 2 - metrics.bottom;\n    canvas.drawText(text, x, y, paint);\n\n    // \n    canvas.restore();\n\n}\n</code></pre>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"","date":"2019-10-28T16:00:00.000Z","_content":"\n\n\n\n\n\n\n<!-- more -->\n\n\n#### \n\n\n\n Factory \n\n SharedPreferences  LruCache \n\n\n\n#### \n\n\n\n```java\nenum IOHandlerFactory {\n    INSTANCE;\n    enum IOType{\n        MEMORY, SP\n    }\n\n    public IOHandler createIOHandler(IOType type) {\n        switch (type) {\n            case MEMORY:\n                return new MemoryIOHandler();\n            case SP:\n                return new SPIOHandler();\n        }\n        return null;\n    }\n}\n\nIOHandlerFactory.INSTANCE.createIOHandler(IOType.SP);\n```\n\n IOType  IOHandler  IOType\n\n\n\n#### \n\n type \n\n```java\npublic interface IOFactory {\n    IOHandler createIOHandler();\n}\n\npublic class MemoryIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new MemoryIOHandler();\n    }\n}\n\npublic class SPIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new SpIOHandler(null);\n    }\n}\n\nnew MemoryIOFactoty().createIOHandler();\n```\n\n\n\n\n\n#### \n\n BitmapFactory \n\n```java\nenum IOHandlerFactory {\n\n    INSTANCE;\n\n    public IOHandler createIOHandler(Class<? extends IOHandler> ioHandlerClass) {\n        try {\n            return ioHandlerClass.newInstance();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    public IOHandler getMemoryIOHandler() {\n        return createIOHandler(MemoryIOHandler.class);\n    }\n\n    public IOHandler getSPIOHandler() {\n        return createIOHandler(SpIOHandler.class);\n    }\n\n    public IOHandler getDefaultIOHandler() {\n        return getSPIOHandler();\n    }\n\n}\n\nIOHandlerFactory.INSTANCE.getDefaultIOHandler();\n```\n\n\n\n\n\n","source":"_posts/design-pattern-factory.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: \ntags: [design-pattern]\ndate: 2019-10-29\n---\n\n\n\n\n\n\n\n<!-- more -->\n\n\n#### \n\n\n\n Factory \n\n SharedPreferences  LruCache \n\n\n\n#### \n\n\n\n```java\nenum IOHandlerFactory {\n    INSTANCE;\n    enum IOType{\n        MEMORY, SP\n    }\n\n    public IOHandler createIOHandler(IOType type) {\n        switch (type) {\n            case MEMORY:\n                return new MemoryIOHandler();\n            case SP:\n                return new SPIOHandler();\n        }\n        return null;\n    }\n}\n\nIOHandlerFactory.INSTANCE.createIOHandler(IOType.SP);\n```\n\n IOType  IOHandler  IOType\n\n\n\n#### \n\n type \n\n```java\npublic interface IOFactory {\n    IOHandler createIOHandler();\n}\n\npublic class MemoryIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new MemoryIOHandler();\n    }\n}\n\npublic class SPIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new SpIOHandler(null);\n    }\n}\n\nnew MemoryIOFactoty().createIOHandler();\n```\n\n\n\n\n\n#### \n\n BitmapFactory \n\n```java\nenum IOHandlerFactory {\n\n    INSTANCE;\n\n    public IOHandler createIOHandler(Class<? extends IOHandler> ioHandlerClass) {\n        try {\n            return ioHandlerClass.newInstance();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    public IOHandler getMemoryIOHandler() {\n        return createIOHandler(MemoryIOHandler.class);\n    }\n\n    public IOHandler getSPIOHandler() {\n        return createIOHandler(SpIOHandler.class);\n    }\n\n    public IOHandler getDefaultIOHandler() {\n        return getSPIOHandler();\n    }\n\n}\n\nIOHandlerFactory.INSTANCE.getDefaultIOHandler();\n```\n\n\n\n\n\n","slug":"design-pattern-factory","published":1,"updated":"2019-10-29T09:04:45.657Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86c7000dlh1pma10bvvf","content":"<p></p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p> Factory </p>\n<p> SharedPreferences  LruCache </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">enum IOHandlerFactory {\n    INSTANCE;\n    enum IOType{\n        MEMORY, SP\n    }\n\n    public IOHandler createIOHandler(IOType type) {\n        switch (type) {\n            case MEMORY:\n                return new MemoryIOHandler();\n            case SP:\n                return new SPIOHandler();\n        }\n        return null;\n    }\n}\n\nIOHandlerFactory.INSTANCE.createIOHandler(IOType.SP);\n</code></pre>\n<p> IOType  IOHandler  IOType</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> type </p>\n<pre><code class=\"java\">public interface IOFactory {\n    IOHandler createIOHandler();\n}\n\npublic class MemoryIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new MemoryIOHandler();\n    }\n}\n\npublic class SPIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new SpIOHandler(null);\n    }\n}\n\nnew MemoryIOFactoty().createIOHandler();\n</code></pre>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> BitmapFactory </p>\n<pre><code class=\"java\">enum IOHandlerFactory {\n\n    INSTANCE;\n\n    public IOHandler createIOHandler(Class&lt;? extends IOHandler&gt; ioHandlerClass) {\n        try {\n            return ioHandlerClass.newInstance();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    public IOHandler getMemoryIOHandler() {\n        return createIOHandler(MemoryIOHandler.class);\n    }\n\n    public IOHandler getSPIOHandler() {\n        return createIOHandler(SpIOHandler.class);\n    }\n\n    public IOHandler getDefaultIOHandler() {\n        return getSPIOHandler();\n    }\n\n}\n\nIOHandlerFactory.INSTANCE.getDefaultIOHandler();\n</code></pre>\n<p></p>\n","site":{"data":{}},"excerpt":"<p></p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p> Factory </p>\n<p> SharedPreferences  LruCache </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">enum IOHandlerFactory {\n    INSTANCE;\n    enum IOType{\n        MEMORY, SP\n    }\n\n    public IOHandler createIOHandler(IOType type) {\n        switch (type) {\n            case MEMORY:\n                return new MemoryIOHandler();\n            case SP:\n                return new SPIOHandler();\n        }\n        return null;\n    }\n}\n\nIOHandlerFactory.INSTANCE.createIOHandler(IOType.SP);\n</code></pre>\n<p> IOType  IOHandler  IOType</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> type </p>\n<pre><code class=\"java\">public interface IOFactory {\n    IOHandler createIOHandler();\n}\n\npublic class MemoryIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new MemoryIOHandler();\n    }\n}\n\npublic class SPIOFactoty implements IOFactory {\n    @Override\n    public IOHandler createIOHandler() {\n        return new SpIOHandler(null);\n    }\n}\n\nnew MemoryIOFactoty().createIOHandler();\n</code></pre>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> BitmapFactory </p>\n<pre><code class=\"java\">enum IOHandlerFactory {\n\n    INSTANCE;\n\n    public IOHandler createIOHandler(Class&lt;? extends IOHandler&gt; ioHandlerClass) {\n        try {\n            return ioHandlerClass.newInstance();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    public IOHandler getMemoryIOHandler() {\n        return createIOHandler(MemoryIOHandler.class);\n    }\n\n    public IOHandler getSPIOHandler() {\n        return createIOHandler(SpIOHandler.class);\n    }\n\n    public IOHandler getDefaultIOHandler() {\n        return getSPIOHandler();\n    }\n\n}\n\nIOHandlerFactory.INSTANCE.getDefaultIOHandler();\n</code></pre>\n<p></p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"","date":"2019-10-31T16:00:00.000Z","_content":"\n\n\n\n\n\n\n<!-- more -->\n\n\n#### \n\n\n\n\n\n ListView  RecyclerView addHeaderView() \n\n\n\n#### ListView#addHeaderView\n\n RecyclerView  ListView ListView ListView  RecyclerView \n\n ListView#addHeaderView  ListView  ListView  ListView \n\n ListView#addHeaderView \n\n```java\npublic void addHeaderView(View v, Object data, boolean isSelectable) {\n  // Wrap the adapter if it wasn't already wrapped.\n  if (mAdapter != null) {\n    if (!(mAdapter instanceof HeaderViewListAdapter)) {\n      wrapHeaderListAdapterInternal();\n    }\n\n    // In the case of re-adding a header view, or adding one later on,\n    // we need to notify the observer.\n    if (mDataSetObserver != null) {\n      mDataSetObserver.onChanged();\n    }\n  }\n}\n```\n\n adapter  HeaderViewListAdapter  `wrapHeaderListAdapterInternal()`  onChanged  HeaderViewListAdapter ListView \n\n```java\npublic class HeaderViewListAdapter implements WrapperListAdapter, Filterable {\n\n    private final ListAdapter mAdapter;\n\n    ArrayList<ListView.FixedViewInfo> mHeaderViewInfos;\n    ArrayList<ListView.FixedViewInfo> mFooterViewInfos;\n\n    public HeaderViewListAdapter(ArrayList<ListView.FixedViewInfo> headerViewInfos,\n                                 ArrayList<ListView.FixedViewInfo> footerViewInfos,\n                                 ListAdapter adapter) {\n        mAdapter = adapter;\n\t\t\t\t\n    }\n\n    public int getHeadersCount() {\n        return mHeaderViewInfos.size();\n    }\n\n    public int getFootersCount() {\n        return mFooterViewInfos.size();\n    }\n\n    public int getCount() {\n        if (mAdapter != null) {\n            return getFootersCount() + getHeadersCount() + mAdapter.getCount();\n        } else {\n            return getFootersCount() + getHeadersCount();\n        }\n    }\n  \n    public View getView(int position, View convertView, ViewGroup parent) {\n        // Header (negative positions will throw an IndexOutOfBoundsException)\n        int numHeaders = getHeadersCount();\n        if (position < numHeaders) {\n            return mHeaderViewInfos.get(position).view;\n        }\n\n        // Adapter\n        final int adjPosition = position - numHeaders;\n        int adapterCount = 0;\n        if (mAdapter != null) {\n            adapterCount = mAdapter.getCount();\n            if (adjPosition < adapterCount) {\n                return mAdapter.getView(adjPosition, convertView, parent);\n            }\n        }\n\n        // Footer (off-limits positions will throw an IndexOutOfBoundsException)\n        return mFooterViewInfos.get(adjPosition - adapterCount).view;\n    }\n\n}\n```\n\n HeaderViewListAdapter  ListAdapter \n\n1.  getCount  adapter getCount  +  + \n\n2.  getView \n\n  - \n\n    > return mHeaderViewInfos.get(position).view;\n\n  -  adapter  -  =   + \n\n     adapter  adapter \n\n    > return mAdapter.getView(adjPosition, convertView, parent);\n\n  - \n\n    > return mFooterViewInfos.get(adjPosition - adapterCount).view;\n\n\n\n#### \n\n RecyclerView \n\n\n\n listView.addHeaderView(), addHeaderView  adapter wrapper  adapter  listView \n\n\n\n","source":"_posts/design-pattern-decoration.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: \ntags: [design-pattern]\ndate: 2019-11-01\n---\n\n\n\n\n\n\n\n<!-- more -->\n\n\n#### \n\n\n\n\n\n ListView  RecyclerView addHeaderView() \n\n\n\n#### ListView#addHeaderView\n\n RecyclerView  ListView ListView ListView  RecyclerView \n\n ListView#addHeaderView  ListView  ListView  ListView \n\n ListView#addHeaderView \n\n```java\npublic void addHeaderView(View v, Object data, boolean isSelectable) {\n  // Wrap the adapter if it wasn't already wrapped.\n  if (mAdapter != null) {\n    if (!(mAdapter instanceof HeaderViewListAdapter)) {\n      wrapHeaderListAdapterInternal();\n    }\n\n    // In the case of re-adding a header view, or adding one later on,\n    // we need to notify the observer.\n    if (mDataSetObserver != null) {\n      mDataSetObserver.onChanged();\n    }\n  }\n}\n```\n\n adapter  HeaderViewListAdapter  `wrapHeaderListAdapterInternal()`  onChanged  HeaderViewListAdapter ListView \n\n```java\npublic class HeaderViewListAdapter implements WrapperListAdapter, Filterable {\n\n    private final ListAdapter mAdapter;\n\n    ArrayList<ListView.FixedViewInfo> mHeaderViewInfos;\n    ArrayList<ListView.FixedViewInfo> mFooterViewInfos;\n\n    public HeaderViewListAdapter(ArrayList<ListView.FixedViewInfo> headerViewInfos,\n                                 ArrayList<ListView.FixedViewInfo> footerViewInfos,\n                                 ListAdapter adapter) {\n        mAdapter = adapter;\n\t\t\t\t\n    }\n\n    public int getHeadersCount() {\n        return mHeaderViewInfos.size();\n    }\n\n    public int getFootersCount() {\n        return mFooterViewInfos.size();\n    }\n\n    public int getCount() {\n        if (mAdapter != null) {\n            return getFootersCount() + getHeadersCount() + mAdapter.getCount();\n        } else {\n            return getFootersCount() + getHeadersCount();\n        }\n    }\n  \n    public View getView(int position, View convertView, ViewGroup parent) {\n        // Header (negative positions will throw an IndexOutOfBoundsException)\n        int numHeaders = getHeadersCount();\n        if (position < numHeaders) {\n            return mHeaderViewInfos.get(position).view;\n        }\n\n        // Adapter\n        final int adjPosition = position - numHeaders;\n        int adapterCount = 0;\n        if (mAdapter != null) {\n            adapterCount = mAdapter.getCount();\n            if (adjPosition < adapterCount) {\n                return mAdapter.getView(adjPosition, convertView, parent);\n            }\n        }\n\n        // Footer (off-limits positions will throw an IndexOutOfBoundsException)\n        return mFooterViewInfos.get(adjPosition - adapterCount).view;\n    }\n\n}\n```\n\n HeaderViewListAdapter  ListAdapter \n\n1.  getCount  adapter getCount  +  + \n\n2.  getView \n\n  - \n\n    > return mHeaderViewInfos.get(position).view;\n\n  -  adapter  -  =   + \n\n     adapter  adapter \n\n    > return mAdapter.getView(adjPosition, convertView, parent);\n\n  - \n\n    > return mFooterViewInfos.get(adjPosition - adapterCount).view;\n\n\n\n#### \n\n RecyclerView \n\n\n\n listView.addHeaderView(), addHeaderView  adapter wrapper  adapter  listView \n\n\n\n","slug":"design-pattern-decoration","published":1,"updated":"2019-11-01T03:22:40.280Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ca000flh1pdt4qtfci","content":"<p></p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<p> ListView  RecyclerView addHeaderView() </p>\n<h4 id=\"ListView-addHeaderView\"><a href=\"#ListView-addHeaderView\" class=\"headerlink\" title=\"ListView#addHeaderView\"></a>ListView#addHeaderView</h4><p> RecyclerView  ListView ListView ListView  RecyclerView </p>\n<p> ListView#addHeaderView  ListView  ListView  ListView </p>\n<p> ListView#addHeaderView </p>\n<pre><code class=\"java\">public void addHeaderView(View v, Object data, boolean isSelectable) {\n  // Wrap the adapter if it wasn&#39;t already wrapped.\n  if (mAdapter != null) {\n    if (!(mAdapter instanceof HeaderViewListAdapter)) {\n      wrapHeaderListAdapterInternal();\n    }\n\n    // In the case of re-adding a header view, or adding one later on,\n    // we need to notify the observer.\n    if (mDataSetObserver != null) {\n      mDataSetObserver.onChanged();\n    }\n  }\n}\n</code></pre>\n<p> adapter  HeaderViewListAdapter  <code>wrapHeaderListAdapterInternal()</code>  onChanged  HeaderViewListAdapter ListView </p>\n<pre><code class=\"java\">public class HeaderViewListAdapter implements WrapperListAdapter, Filterable {\n\n    private final ListAdapter mAdapter;\n\n    ArrayList&lt;ListView.FixedViewInfo&gt; mHeaderViewInfos;\n    ArrayList&lt;ListView.FixedViewInfo&gt; mFooterViewInfos;\n\n    public HeaderViewListAdapter(ArrayList&lt;ListView.FixedViewInfo&gt; headerViewInfos,\n                                 ArrayList&lt;ListView.FixedViewInfo&gt; footerViewInfos,\n                                 ListAdapter adapter) {\n        mAdapter = adapter;\n\n    }\n\n    public int getHeadersCount() {\n        return mHeaderViewInfos.size();\n    }\n\n    public int getFootersCount() {\n        return mFooterViewInfos.size();\n    }\n\n    public int getCount() {\n        if (mAdapter != null) {\n            return getFootersCount() + getHeadersCount() + mAdapter.getCount();\n        } else {\n            return getFootersCount() + getHeadersCount();\n        }\n    }\n\n    public View getView(int position, View convertView, ViewGroup parent) {\n        // Header (negative positions will throw an IndexOutOfBoundsException)\n        int numHeaders = getHeadersCount();\n        if (position &lt; numHeaders) {\n            return mHeaderViewInfos.get(position).view;\n        }\n\n        // Adapter\n        final int adjPosition = position - numHeaders;\n        int adapterCount = 0;\n        if (mAdapter != null) {\n            adapterCount = mAdapter.getCount();\n            if (adjPosition &lt; adapterCount) {\n                return mAdapter.getView(adjPosition, convertView, parent);\n            }\n        }\n\n        // Footer (off-limits positions will throw an IndexOutOfBoundsException)\n        return mFooterViewInfos.get(adjPosition - adapterCount).view;\n    }\n\n}\n</code></pre>\n<p> HeaderViewListAdapter  ListAdapter </p>\n<ol>\n<li><p> getCount  adapter getCount  +  + </p>\n</li>\n<li><p> getView </p>\n<ul>\n<li><p></p>\n<blockquote>\n<p>return mHeaderViewInfos.get(position).view;</p>\n</blockquote>\n</li>\n<li><p> adapter  -  =   + </p>\n<p> adapter  adapter </p>\n<blockquote>\n<p>return mAdapter.getView(adjPosition, convertView, parent);</p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p>return mFooterViewInfos.get(adjPosition - adapterCount).view;</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RecyclerView </p>\n<p></p>\n<p> listView.addHeaderView(), addHeaderView  adapter wrapper  adapter  listView </p>\n<p></p>\n","site":{"data":{}},"excerpt":"<p></p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<p> ListView  RecyclerView addHeaderView() </p>\n<h4 id=\"ListView-addHeaderView\"><a href=\"#ListView-addHeaderView\" class=\"headerlink\" title=\"ListView#addHeaderView\"></a>ListView#addHeaderView</h4><p> RecyclerView  ListView ListView ListView  RecyclerView </p>\n<p> ListView#addHeaderView  ListView  ListView  ListView </p>\n<p> ListView#addHeaderView </p>\n<pre><code class=\"java\">public void addHeaderView(View v, Object data, boolean isSelectable) {\n  // Wrap the adapter if it wasn&#39;t already wrapped.\n  if (mAdapter != null) {\n    if (!(mAdapter instanceof HeaderViewListAdapter)) {\n      wrapHeaderListAdapterInternal();\n    }\n\n    // In the case of re-adding a header view, or adding one later on,\n    // we need to notify the observer.\n    if (mDataSetObserver != null) {\n      mDataSetObserver.onChanged();\n    }\n  }\n}\n</code></pre>\n<p> adapter  HeaderViewListAdapter  <code>wrapHeaderListAdapterInternal()</code>  onChanged  HeaderViewListAdapter ListView </p>\n<pre><code class=\"java\">public class HeaderViewListAdapter implements WrapperListAdapter, Filterable {\n\n    private final ListAdapter mAdapter;\n\n    ArrayList&lt;ListView.FixedViewInfo&gt; mHeaderViewInfos;\n    ArrayList&lt;ListView.FixedViewInfo&gt; mFooterViewInfos;\n\n    public HeaderViewListAdapter(ArrayList&lt;ListView.FixedViewInfo&gt; headerViewInfos,\n                                 ArrayList&lt;ListView.FixedViewInfo&gt; footerViewInfos,\n                                 ListAdapter adapter) {\n        mAdapter = adapter;\n\n    }\n\n    public int getHeadersCount() {\n        return mHeaderViewInfos.size();\n    }\n\n    public int getFootersCount() {\n        return mFooterViewInfos.size();\n    }\n\n    public int getCount() {\n        if (mAdapter != null) {\n            return getFootersCount() + getHeadersCount() + mAdapter.getCount();\n        } else {\n            return getFootersCount() + getHeadersCount();\n        }\n    }\n\n    public View getView(int position, View convertView, ViewGroup parent) {\n        // Header (negative positions will throw an IndexOutOfBoundsException)\n        int numHeaders = getHeadersCount();\n        if (position &lt; numHeaders) {\n            return mHeaderViewInfos.get(position).view;\n        }\n\n        // Adapter\n        final int adjPosition = position - numHeaders;\n        int adapterCount = 0;\n        if (mAdapter != null) {\n            adapterCount = mAdapter.getCount();\n            if (adjPosition &lt; adapterCount) {\n                return mAdapter.getView(adjPosition, convertView, parent);\n            }\n        }\n\n        // Footer (off-limits positions will throw an IndexOutOfBoundsException)\n        return mFooterViewInfos.get(adjPosition - adapterCount).view;\n    }\n\n}\n</code></pre>\n<p> HeaderViewListAdapter  ListAdapter </p>\n<ol>\n<li><p> getCount  adapter getCount  +  + </p>\n</li>\n<li><p> getView </p>\n<ul>\n<li><p></p>\n<blockquote>\n<p>return mHeaderViewInfos.get(position).view;</p>\n</blockquote>\n</li>\n<li><p> adapter  -  =   + </p>\n<p> adapter  adapter </p>\n<blockquote>\n<p>return mAdapter.getView(adjPosition, convertView, parent);</p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p>return mFooterViewInfos.get(adjPosition - adapterCount).view;</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RecyclerView </p>\n<p></p>\n<p> listView.addHeaderView(), addHeaderView  adapter wrapper  adapter  listView </p>\n<p></p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"Builder ","date":"2019-10-25T16:00:00.000Z","_content":"\nBuilder \n\n<!-- more -->\n\n Builder \n\nBuilder \n\n OkHttp AlertDialog  Builder Builder  new  Builder  build \n\n\n\n```java\nPosAlertDialog backAlertDialog = new PosAlertDialog.Builder(mContext)\n                    .setRemindText(\"\")\n                    .setPrimaryText(\"\")\n                    .setSecondaryText(\"\")\n                    .setUseLoadingButton(false)\n                    .setOnCancelClickListener(new PosAlertDialog.OnCancelClickListener() {\n                        @Override\n                        public void onCancelClick(View view, Dialog dialog) {\n                            \n                        }\n                    })\n                    .build();\nbackAlertDialog.show();\n```\n\n Builder  build  PosAlertDialog \n\n\n\n### Builder  VS \n\nBuilder Builder \n\n```java\npublic class AppVersionEntity {\n  private String version;\n  private String smVersion;\n  private String updateInfo;\n\n  public void setUpdateInfo(String updateInfo) {\n    this.updateInfo = updateInfo;\n    return this;\n  }\n\n  public void setVersion(String version) {\n    this.version = version;\n    return this;\n  }\n\n  public void setSmVersion(String smVersion) {\n    this.smVersion = smVersion;\n    return this;\n  }\n}\n\nAppVersionEntity entity = new AppVersionEntity()\n   \t\t.setUpdateInfo(\"1\")\n   \t\t.setVersion(\"1\")\n   \t\t.setSmVersion(\"1\");\n```\n\n Java bean Builder \n\n","source":"_posts/design-pattern-builder.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: Builder \ntags: [design-pattern]\ndate: 2019-10-26\n---\n\nBuilder \n\n<!-- more -->\n\n Builder \n\nBuilder \n\n OkHttp AlertDialog  Builder Builder  new  Builder  build \n\n\n\n```java\nPosAlertDialog backAlertDialog = new PosAlertDialog.Builder(mContext)\n                    .setRemindText(\"\")\n                    .setPrimaryText(\"\")\n                    .setSecondaryText(\"\")\n                    .setUseLoadingButton(false)\n                    .setOnCancelClickListener(new PosAlertDialog.OnCancelClickListener() {\n                        @Override\n                        public void onCancelClick(View view, Dialog dialog) {\n                            \n                        }\n                    })\n                    .build();\nbackAlertDialog.show();\n```\n\n Builder  build  PosAlertDialog \n\n\n\n### Builder  VS \n\nBuilder Builder \n\n```java\npublic class AppVersionEntity {\n  private String version;\n  private String smVersion;\n  private String updateInfo;\n\n  public void setUpdateInfo(String updateInfo) {\n    this.updateInfo = updateInfo;\n    return this;\n  }\n\n  public void setVersion(String version) {\n    this.version = version;\n    return this;\n  }\n\n  public void setSmVersion(String smVersion) {\n    this.smVersion = smVersion;\n    return this;\n  }\n}\n\nAppVersionEntity entity = new AppVersionEntity()\n   \t\t.setUpdateInfo(\"1\")\n   \t\t.setVersion(\"1\")\n   \t\t.setSmVersion(\"1\");\n```\n\n Java bean Builder \n\n","slug":"design-pattern-builder","published":1,"updated":"2019-10-26T09:01:48.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86cc000glh1p0w5h4dho","content":"<p>Builder </p>\n<a id=\"more\"></a>\n<p> Builder </p>\n<p>Builder </p>\n<p> OkHttp AlertDialog  Builder Builder  new  Builder  build </p>\n<p></p>\n<pre><code class=\"java\">PosAlertDialog backAlertDialog = new PosAlertDialog.Builder(mContext)\n                    .setRemindText(&quot;&quot;)\n                    .setPrimaryText(&quot;&quot;)\n                    .setSecondaryText(&quot;&quot;)\n                    .setUseLoadingButton(false)\n                    .setOnCancelClickListener(new PosAlertDialog.OnCancelClickListener() {\n                        @Override\n                        public void onCancelClick(View view, Dialog dialog) {\n\n                        }\n                    })\n                    .build();\nbackAlertDialog.show();\n</code></pre>\n<p> Builder  build  PosAlertDialog </p>\n<h3 id=\"Builder--VS-\"><a href=\"#Builder--VS-\" class=\"headerlink\" title=\"Builder  VS \"></a>Builder  VS </h3><p>Builder Builder </p>\n<pre><code class=\"java\">public class AppVersionEntity {\n  private String version;\n  private String smVersion;\n  private String updateInfo;\n\n  public void setUpdateInfo(String updateInfo) {\n    this.updateInfo = updateInfo;\n    return this;\n  }\n\n  public void setVersion(String version) {\n    this.version = version;\n    return this;\n  }\n\n  public void setSmVersion(String smVersion) {\n    this.smVersion = smVersion;\n    return this;\n  }\n}\n\nAppVersionEntity entity = new AppVersionEntity()\n           .setUpdateInfo(&quot;1&quot;)\n           .setVersion(&quot;1&quot;)\n           .setSmVersion(&quot;1&quot;);\n</code></pre>\n<p> Java bean Builder </p>\n","site":{"data":{}},"excerpt":"<p>Builder </p>","more":"<p> Builder </p>\n<p>Builder </p>\n<p> OkHttp AlertDialog  Builder Builder  new  Builder  build </p>\n<p></p>\n<pre><code class=\"java\">PosAlertDialog backAlertDialog = new PosAlertDialog.Builder(mContext)\n                    .setRemindText(&quot;&quot;)\n                    .setPrimaryText(&quot;&quot;)\n                    .setSecondaryText(&quot;&quot;)\n                    .setUseLoadingButton(false)\n                    .setOnCancelClickListener(new PosAlertDialog.OnCancelClickListener() {\n                        @Override\n                        public void onCancelClick(View view, Dialog dialog) {\n\n                        }\n                    })\n                    .build();\nbackAlertDialog.show();\n</code></pre>\n<p> Builder  build  PosAlertDialog </p>\n<h3 id=\"Builder--VS-\"><a href=\"#Builder--VS-\" class=\"headerlink\" title=\"Builder  VS \"></a>Builder  VS </h3><p>Builder Builder </p>\n<pre><code class=\"java\">public class AppVersionEntity {\n  private String version;\n  private String smVersion;\n  private String updateInfo;\n\n  public void setUpdateInfo(String updateInfo) {\n    this.updateInfo = updateInfo;\n    return this;\n  }\n\n  public void setVersion(String version) {\n    this.version = version;\n    return this;\n  }\n\n  public void setSmVersion(String smVersion) {\n    this.smVersion = smVersion;\n    return this;\n  }\n}\n\nAppVersionEntity entity = new AppVersionEntity()\n           .setUpdateInfo(&quot;1&quot;)\n           .setVersion(&quot;1&quot;)\n           .setSmVersion(&quot;1&quot;);\n</code></pre>\n<p> Java bean Builder </p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"","date":"2019-11-05T16:00:00.000Z","_content":"\n base \n\n\n\n<!-- more -->\n\n#### \n\n****\n\n\n\n```java\npublic abstract class BaseActivity extends AppCompatActivity {\n  \t\n  \t@Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(getLayoutId());\n      \tinitView();\n    }\n  \n  \tpublic abstract int getLayoutId();\n  \tpublic abstract void initView();\n}\n```\n\n****************\n\n\n\n\n\n\n\n#### \n\n Android View \n\n- View#onDraw()\n\n  View [](https://www.jianshu.com/p/d7ab114ac1f7)\n\n   View  onDraw()  View.java  onDraw() \n\n- Activity \n\n   Activity \n\n   Activity  Activity  Activity  Activity \n\n- AsyncTask\n\n  Android  AsyncTask \n\n  ```java\n  new AsyncTask<Void, Integer, String>(){\n      @Override\n      protected void onProgressUpdate(Integer... values) {\n        \n      }\n  \n      @Override\n      protected String doInBackground(Void... voids) {\n        return null;\n      }\n  \n      @Override\n      protected void onPostExecute(String s) {\n        \n      }\n  };\n  ```\n\n  \n\n\n\n\n\n","source":"_posts/design-pattern-template.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: \ntags: [design-pattern]\ndate: 2019-11-06\n---\n\n base \n\n\n\n<!-- more -->\n\n#### \n\n****\n\n\n\n```java\npublic abstract class BaseActivity extends AppCompatActivity {\n  \t\n  \t@Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(getLayoutId());\n      \tinitView();\n    }\n  \n  \tpublic abstract int getLayoutId();\n  \tpublic abstract void initView();\n}\n```\n\n****************\n\n\n\n\n\n\n\n#### \n\n Android View \n\n- View#onDraw()\n\n  View [](https://www.jianshu.com/p/d7ab114ac1f7)\n\n   View  onDraw()  View.java  onDraw() \n\n- Activity \n\n   Activity \n\n   Activity  Activity  Activity  Activity \n\n- AsyncTask\n\n  Android  AsyncTask \n\n  ```java\n  new AsyncTask<Void, Integer, String>(){\n      @Override\n      protected void onProgressUpdate(Integer... values) {\n        \n      }\n  \n      @Override\n      protected String doInBackground(Void... voids) {\n        return null;\n      }\n  \n      @Override\n      protected void onPostExecute(String s) {\n        \n      }\n  };\n  ```\n\n  \n\n\n\n\n\n","slug":"design-pattern-template","published":1,"updated":"2019-11-07T08:52:06.238Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86cd000jlh1px5hwn8uk","content":"<p> base </p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong></strong></p>\n<p></p>\n<pre><code class=\"java\">public abstract class BaseActivity extends AppCompatActivity {\n\n      @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(getLayoutId());\n          initView();\n    }\n\n      public abstract int getLayoutId();\n      public abstract void initView();\n}\n</code></pre>\n<p><strong></strong><strong></strong><strong></strong><strong></strong></p>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Android View </p>\n<ul>\n<li><p>View#onDraw()</p>\n<p>View <a href=\"https://www.jianshu.com/p/d7ab114ac1f7\" target=\"_blank\" rel=\"noopener\"></a></p>\n<p> View  onDraw()  View.java  onDraw() </p>\n</li>\n<li><p>Activity </p>\n<p> Activity </p>\n<p> Activity  Activity  Activity  Activity </p>\n</li>\n<li><p>AsyncTask</p>\n<p>Android  AsyncTask </p>\n<pre><code class=\"java\">new AsyncTask&lt;Void, Integer, String&gt;(){\n    @Override\n    protected void onProgressUpdate(Integer... values) {\n\n    }\n\n    @Override\n    protected String doInBackground(Void... voids) {\n      return null;\n    }\n\n    @Override\n    protected void onPostExecute(String s) {\n\n    }\n};\n</code></pre>\n<p></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> base </p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong></strong></p>\n<p></p>\n<pre><code class=\"java\">public abstract class BaseActivity extends AppCompatActivity {\n\n      @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(getLayoutId());\n          initView();\n    }\n\n      public abstract int getLayoutId();\n      public abstract void initView();\n}\n</code></pre>\n<p><strong></strong><strong></strong><strong></strong><strong></strong></p>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Android View </p>\n<ul>\n<li><p>View#onDraw()</p>\n<p>View <a href=\"https://www.jianshu.com/p/d7ab114ac1f7\" target=\"_blank\" rel=\"noopener\"></a></p>\n<p> View  onDraw()  View.java  onDraw() </p>\n</li>\n<li><p>Activity </p>\n<p> Activity </p>\n<p> Activity  Activity  Activity  Activity </p>\n</li>\n<li><p>AsyncTask</p>\n<p>Android  AsyncTask </p>\n<pre><code class=\"java\">new AsyncTask&lt;Void, Integer, String&gt;(){\n    @Override\n    protected void onProgressUpdate(Integer... values) {\n\n    }\n\n    @Override\n    protected String doInBackground(Void... voids) {\n      return null;\n    }\n\n    @Override\n    protected void onPostExecute(String s) {\n\n    }\n};\n</code></pre>\n<p></p>\n</li>\n</ul>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"","date":"2019-10-25T16:00:00.000Z","_content":"\n\n\n\n\n\n\n<!-- more -->\n\n\n\n#### \n\n\n\n```java\nclass Singleton {\n\n    public static Singleton sInstance = new Singleton();\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        return sInstance;\n    }\n\n}\n```\n\n\n\n#### \n\n\n\n```java\nclass Singleton {\n\n    public static Singleton sInstance;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n      \tif(sInstance == null){\n           sInstance = new Singleton();\n        }\n        return sInstance;\n    }\n\n}\n```\n\n\n\n#### \n\n\n\n1.  `volatile` \n\n2.  if  if \n\n   >  if synchronized \n   \n3. synchronized  new Object(), \n\n```java\nclass Singleton {\n    public static volatile Singleton sInstance;\n    private Singleton() {}\n    public static Singleton getInstance() {\n      if(sInstance == null){\n        synchronized (Singleton.class) {\n          if(sInstance == null){\n            sInstance = new Singleton();\n          }\n        }\n      }\n      return sInstance;\n    }\n}\n```\n\n\n\n#### \n\n Java Java \n\n```java\nclass Singleton {\n    private Singleton() {}\n    public Singleton getInstance() {\n        return Holder.mInstance;\n    }\n    private static class Holder {\n        private static Singleton sInstance = new Singleton();\n    }\n}\n```\n\n\n\n#### \n\n Singleton \n\n```java\nenum Singleton{\n  INSTANCE\n}\n```\n\n","source":"_posts/design-pattern-singleton.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: \ntags: [design-pattern]\ndate: 2019-10-26\n---\n\n\n\n\n\n\n\n<!-- more -->\n\n\n\n#### \n\n\n\n```java\nclass Singleton {\n\n    public static Singleton sInstance = new Singleton();\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        return sInstance;\n    }\n\n}\n```\n\n\n\n#### \n\n\n\n```java\nclass Singleton {\n\n    public static Singleton sInstance;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n      \tif(sInstance == null){\n           sInstance = new Singleton();\n        }\n        return sInstance;\n    }\n\n}\n```\n\n\n\n#### \n\n\n\n1.  `volatile` \n\n2.  if  if \n\n   >  if synchronized \n   \n3. synchronized  new Object(), \n\n```java\nclass Singleton {\n    public static volatile Singleton sInstance;\n    private Singleton() {}\n    public static Singleton getInstance() {\n      if(sInstance == null){\n        synchronized (Singleton.class) {\n          if(sInstance == null){\n            sInstance = new Singleton();\n          }\n        }\n      }\n      return sInstance;\n    }\n}\n```\n\n\n\n#### \n\n Java Java \n\n```java\nclass Singleton {\n    private Singleton() {}\n    public Singleton getInstance() {\n        return Holder.mInstance;\n    }\n    private static class Holder {\n        private static Singleton sInstance = new Singleton();\n    }\n}\n```\n\n\n\n#### \n\n Singleton \n\n```java\nenum Singleton{\n  INSTANCE\n}\n```\n\n","slug":"design-pattern-singleton","published":1,"updated":"2019-10-26T08:11:02.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86cf000klh1plklptp9a","content":"<p></p>\n<a id=\"more\"></a>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">class Singleton {\n\n    public static Singleton sInstance = new Singleton();\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        return sInstance;\n    }\n\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">class Singleton {\n\n    public static Singleton sInstance;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n          if(sInstance == null){\n           sInstance = new Singleton();\n        }\n        return sInstance;\n    }\n\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ol>\n<li><p> <code>volatile</code> </p>\n</li>\n<li><p> if  if </p>\n<blockquote>\n<p> if synchronized </p>\n</blockquote>\n</li>\n<li><p>synchronized  new Object(), </p>\n</li>\n</ol>\n<pre><code class=\"java\">class Singleton {\n    public static volatile Singleton sInstance;\n    private Singleton() {}\n    public static Singleton getInstance() {\n      if(sInstance == null){\n        synchronized (Singleton.class) {\n          if(sInstance == null){\n            sInstance = new Singleton();\n          }\n        }\n      }\n      return sInstance;\n    }\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Java Java </p>\n<pre><code class=\"java\">class Singleton {\n    private Singleton() {}\n    public Singleton getInstance() {\n        return Holder.mInstance;\n    }\n    private static class Holder {\n        private static Singleton sInstance = new Singleton();\n    }\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Singleton </p>\n<pre><code class=\"java\">enum Singleton{\n  INSTANCE\n}\n</code></pre>\n","site":{"data":{}},"excerpt":"<p></p>","more":"<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">class Singleton {\n\n    public static Singleton sInstance = new Singleton();\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        return sInstance;\n    }\n\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">class Singleton {\n\n    public static Singleton sInstance;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n          if(sInstance == null){\n           sInstance = new Singleton();\n        }\n        return sInstance;\n    }\n\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ol>\n<li><p> <code>volatile</code> </p>\n</li>\n<li><p> if  if </p>\n<blockquote>\n<p> if synchronized </p>\n</blockquote>\n</li>\n<li><p>synchronized  new Object(), </p>\n</li>\n</ol>\n<pre><code class=\"java\">class Singleton {\n    public static volatile Singleton sInstance;\n    private Singleton() {}\n    public static Singleton getInstance() {\n      if(sInstance == null){\n        synchronized (Singleton.class) {\n          if(sInstance == null){\n            sInstance = new Singleton();\n          }\n        }\n      }\n      return sInstance;\n    }\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Java Java </p>\n<pre><code class=\"java\">class Singleton {\n    private Singleton() {}\n    public Singleton getInstance() {\n        return Holder.mInstance;\n    }\n    private static class Holder {\n        private static Singleton sInstance = new Singleton();\n    }\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Singleton </p>\n<pre><code class=\"java\">enum Singleton{\n  INSTANCE\n}\n</code></pre>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"","date":"2019-11-07T16:00:00.000Z","_content":"\n\n\n\n\n\n\n<!-- more -->\n\n#### \n\n if-else \n\n\n\n```java\nObjectAnimator.ofFloat().setInterpolator(TimeInterpolator value);\n```\n\n TimeInterpolator \n\n```java\npublic interface TimeInterpolator {\n    float getInterpolation(float input);\n}\n```\n\n\n\n- AccelerateInterpolator\n- DecelerateInterpolator\n- AnticipateInterpolator\n- CycleInterpolator\n- LinearInterpolator\n- ... ...\n\n `getInterpolation()` ****\n\n\n\n#### \n\n\n\n\n\n\n\n```java\npublic interface IFinanceInterest{\n  double getInterest(int month, int money);\n}\n```\n\n\n\n```java\npublic class AlipayFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n  \tswitch(month){\n      case 3:\n        return money * (1 + 0.026 / 12 * 3);\n      case 6:\n        return money * (1 + 0.035 / 12 * 3);\n      case 12:\n        return money * (1 + 0.043 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n```\n\n\n\n```java\npublic class ZhaoShangFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n  \tswitch(month){\n      case 3:\n        return money * (1 + 0.028 / 12 * 3);\n      case 6:\n        return money * (1 + 0.037 / 12 * 3);\n      case 12:\n        return money * (1 + 0.052 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n```\n\n\n\n```java\npublic class FinanceContext{\n  \n  private IFinanceInterest mFinance;\n  public FinanceContext(IFinanceInterest interest){\n     mFinance = interest;\n  }\n\n  public void setFinanceInterest(IFinanceInterest interest){\n    mFinance = interest;\n  }\n\t\n  public double getMyInterest(int month, int money){\n    mFinance.getInterest(month, money);\n  }\n  \n}\n```\n\n\n\n```java\npublic static void main(String[] args) {\n      FinanceContext context = new FinanceContext(new AlipayFinance());    \n      context.getMyInterest(3, 12000);\n \n      context.setFinanceInterest(new ZhaoShangFinance())\n      context.getMyInterest(12, 12000);\n}\n```\n\n\n\n#### \n\n- \n  - ","source":"_posts/design-pattern-strategy.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: \ntags: [design-pattern]\ndate: 2019-11-08\n---\n\n\n\n\n\n\n\n<!-- more -->\n\n#### \n\n if-else \n\n\n\n```java\nObjectAnimator.ofFloat().setInterpolator(TimeInterpolator value);\n```\n\n TimeInterpolator \n\n```java\npublic interface TimeInterpolator {\n    float getInterpolation(float input);\n}\n```\n\n\n\n- AccelerateInterpolator\n- DecelerateInterpolator\n- AnticipateInterpolator\n- CycleInterpolator\n- LinearInterpolator\n- ... ...\n\n `getInterpolation()` ****\n\n\n\n#### \n\n\n\n\n\n\n\n```java\npublic interface IFinanceInterest{\n  double getInterest(int month, int money);\n}\n```\n\n\n\n```java\npublic class AlipayFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n  \tswitch(month){\n      case 3:\n        return money * (1 + 0.026 / 12 * 3);\n      case 6:\n        return money * (1 + 0.035 / 12 * 3);\n      case 12:\n        return money * (1 + 0.043 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n```\n\n\n\n```java\npublic class ZhaoShangFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n  \tswitch(month){\n      case 3:\n        return money * (1 + 0.028 / 12 * 3);\n      case 6:\n        return money * (1 + 0.037 / 12 * 3);\n      case 12:\n        return money * (1 + 0.052 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n```\n\n\n\n```java\npublic class FinanceContext{\n  \n  private IFinanceInterest mFinance;\n  public FinanceContext(IFinanceInterest interest){\n     mFinance = interest;\n  }\n\n  public void setFinanceInterest(IFinanceInterest interest){\n    mFinance = interest;\n  }\n\t\n  public double getMyInterest(int month, int money){\n    mFinance.getInterest(month, money);\n  }\n  \n}\n```\n\n\n\n```java\npublic static void main(String[] args) {\n      FinanceContext context = new FinanceContext(new AlipayFinance());    \n      context.getMyInterest(3, 12000);\n \n      context.setFinanceInterest(new ZhaoShangFinance())\n      context.getMyInterest(12, 12000);\n}\n```\n\n\n\n#### \n\n- \n  - ","slug":"design-pattern-strategy","published":1,"updated":"2019-11-08T09:59:48.722Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ci000nlh1ps1e2mcj7","content":"<p></p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> if-else </p>\n<p></p>\n<pre><code class=\"java\">ObjectAnimator.ofFloat().setInterpolator(TimeInterpolator value);\n</code></pre>\n<p> TimeInterpolator </p>\n<pre><code class=\"java\">public interface TimeInterpolator {\n    float getInterpolation(float input);\n}\n</code></pre>\n<p></p>\n<ul>\n<li>AccelerateInterpolator</li>\n<li>DecelerateInterpolator</li>\n<li>AnticipateInterpolator</li>\n<li>CycleInterpolator</li>\n<li>LinearInterpolator</li>\n<li> </li>\n</ul>\n<p> <code>getInterpolation()</code> <strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">public interface IFinanceInterest{\n  double getInterest(int month, int money);\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class AlipayFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n      switch(month){\n      case 3:\n        return money * (1 + 0.026 / 12 * 3);\n      case 6:\n        return money * (1 + 0.035 / 12 * 3);\n      case 12:\n        return money * (1 + 0.043 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class ZhaoShangFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n      switch(month){\n      case 3:\n        return money * (1 + 0.028 / 12 * 3);\n      case 6:\n        return money * (1 + 0.037 / 12 * 3);\n      case 12:\n        return money * (1 + 0.052 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class FinanceContext{\n\n  private IFinanceInterest mFinance;\n  public FinanceContext(IFinanceInterest interest){\n     mFinance = interest;\n  }\n\n  public void setFinanceInterest(IFinanceInterest interest){\n    mFinance = interest;\n  }\n\n  public double getMyInterest(int month, int money){\n    mFinance.getInterest(month, money);\n  }\n\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public static void main(String[] args) {\n      FinanceContext context = new FinanceContext(new AlipayFinance());    \n      context.getMyInterest(3, 12000);\n\n      context.setFinanceInterest(new ZhaoShangFinance())\n      context.getMyInterest(12, 12000);\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><br>- </li>\n</ul>\n","site":{"data":{}},"excerpt":"<p></p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> if-else </p>\n<p></p>\n<pre><code class=\"java\">ObjectAnimator.ofFloat().setInterpolator(TimeInterpolator value);\n</code></pre>\n<p> TimeInterpolator </p>\n<pre><code class=\"java\">public interface TimeInterpolator {\n    float getInterpolation(float input);\n}\n</code></pre>\n<p></p>\n<ul>\n<li>AccelerateInterpolator</li>\n<li>DecelerateInterpolator</li>\n<li>AnticipateInterpolator</li>\n<li>CycleInterpolator</li>\n<li>LinearInterpolator</li>\n<li> </li>\n</ul>\n<p> <code>getInterpolation()</code> <strong></strong></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<p></p>\n<pre><code class=\"java\">public interface IFinanceInterest{\n  double getInterest(int month, int money);\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class AlipayFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n      switch(month){\n      case 3:\n        return money * (1 + 0.026 / 12 * 3);\n      case 6:\n        return money * (1 + 0.035 / 12 * 3);\n      case 12:\n        return money * (1 + 0.043 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class ZhaoShangFinance implements IFinanceInterest{\n  @Overide\n  double getInterest(int month, int money){\n      switch(month){\n      case 3:\n        return money * (1 + 0.028 / 12 * 3);\n      case 6:\n        return money * (1 + 0.037 / 12 * 3);\n      case 12:\n        return money * (1 + 0.052 / 12 * 3);\n      default:\n        return money * (1 + 0.02 / 12 * 3);\n    }\n  }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public class FinanceContext{\n\n  private IFinanceInterest mFinance;\n  public FinanceContext(IFinanceInterest interest){\n     mFinance = interest;\n  }\n\n  public void setFinanceInterest(IFinanceInterest interest){\n    mFinance = interest;\n  }\n\n  public double getMyInterest(int month, int money){\n    mFinance.getInterest(month, money);\n  }\n\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public static void main(String[] args) {\n      FinanceContext context = new FinanceContext(new AlipayFinance());    \n      context.getMyInterest(3, 12000);\n\n      context.setFinanceInterest(new ZhaoShangFinance())\n      context.getMyInterest(12, 12000);\n}\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><br>- </li>\n</ul>"},{"title":"","date":"2018-03-08T16:00:00.000Z","_content":"\n\n\njava\n\n\n\n##  - \n\n* abstract, extends, \n* final\n* private\n* \n* \n* \n* \n* \n\n##  - \n* interface, implements, \n* final\n* \n    1.  public final static\n    2.  public abstract\n    3.  static class\n* public\n* \n* \n* \n* \n\n## \n* \n* \n* privatepublic abstract\n* \n* \n\n","source":"_posts/differ-of-abstract-interface.md","raw":"---\ntitle: \ntags: java\ndate: 2018-03-9\n---\n\n\n\njava\n\n\n\n##  - \n\n* abstract, extends, \n* final\n* private\n* \n* \n* \n* \n* \n\n##  - \n* interface, implements, \n* final\n* \n    1.  public final static\n    2.  public abstract\n    3.  static class\n* public\n* \n* \n* \n* \n\n## \n* \n* \n* privatepublic abstract\n* \n* \n\n","slug":"differ-of-abstract-interface","published":1,"updated":"2018-08-14T10:11:51.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ck000plh1pwfojm0kt","content":"<p>java</p>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" - \"></a> - </h2><ul>\n<li>abstract, extends, </li>\n<li>final</li>\n<li>private</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" - \"></a> - </h2><ul>\n<li>interface, implements, </li>\n<li>final</li>\n<li><ol>\n<li> public final static</li>\n<li> public abstract</li>\n<li> static class</li>\n</ol>\n</li>\n<li>public</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>privatepublic abstract</li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n","site":{"data":{}},"excerpt":"","more":"<p>java</p>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" - \"></a> - </h2><ul>\n<li>abstract, extends, </li>\n<li>final</li>\n<li>private</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" - \"></a> - </h2><ul>\n<li>interface, implements, </li>\n<li>final</li>\n<li><ol>\n<li> public final static</li>\n<li> public abstract</li>\n<li> static class</li>\n</ol>\n</li>\n<li>public</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>privatepublic abstract</li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"Message ","date":"2019-10-25T16:00:00.000Z","_content":"\n\n\n Handler  MessageQueue\n\n\n\n<!-- more -->\n\n\n\nHandler  sendMessageAtTime  MessageQueue  Message  when  Message \n\n\n\n###  show time\n\n MessageQueue#enqueueMessage \n\n```java\nMessage mMessages;\nboolean enqueueMessage(Message msg, long when) {\n    msg.when = when; \n    Message p = mMessages;\n    if (p == null || when == 0 || when < p.when) {\n        msg.next = p;\n        mMessages = msg;\n    } else {\n        Message prev;\n        for (; ;) {\n            prev = p;\n            p = p.next;\n            if (p == null || when < p.when) {\n                break;\n            }\n        }\n        msg.next = p;\n        prev.next = msg;\n    }\n    return true;\n}\n```\n\n\n\n1.  when  sendMessageDelayed  + ****\n2.  when  msg.when = when\n3.  p  null\n\n\n\n### \n\n\n\n```java\nmHandler.sendEmptyMessage(100)\nmHandler.sendEmptyMessageDelayed(200, 1000)\nmHandler.sendEmptyMessageDelayed(300, 500)\n```\n\n\n\n1.  enqueueMessage when = 0\n\n   ```java\n   if (p == null || when == 0 || when < p.when){}\n   ```\n\n   p == null  mMessages  null p  next  next  mMessages \n\n2.  enqueueMessage when = 1000\n\n   ```java\n   Message p = mMessages;\n   ```\n\n    mMessages mMessages.next = nullmMessages.when = 0\n\n    if \n\n   - p == null p  mMessages \n   - when == 0 when  1000\n   - when < p.when 1000 < 0\n\n    else \n\n   ```java\n   Message prev;\n   for (; ;) {\n       prev = p;\n       p = p.next;\n       if (p == null || when < p.when) {\n         break;\n       }\n   }\n   msg.next = p;\n   prev.next = msg;\n   ```\n\n   -  Message  prev previous message\n   -  p  prev  p  p p == null  p.next = null p = p.next p == null \n   - prev  mMessages p  mMessages.next null\n   -  next  p null prev.next mMessages.next\n\n   MessageQueue \n\n   ```java\n   mMessages = {Message(when = 0, next = {Message(when = 1000, next = null)})}\n   ```\n   \n3.  enqueueMessage when = 500\n  \n  ```java\n  Message p = mMessages;\n  ```\n  \n  mMessages  Message when = 0next  when = 500 if \n  \n  ```java\n  if (p == null || when == 0 || when < p.when){}\n  \n  // p  when = 500 p.when = 0 if \n  ```\n  \n   else  \n  \n  ```java\n  Message prev;\n  for (; ;) {\n      prev = p;\n      p = p.next;\n      if (p == null || when < p.when) {\n        break;\n      }\n  }\n  msg.next = p;\n  prev.next = msg;\n  ```\n  \n   mMessages  prev = p = p.next() \n  \n  - p == null \n  - when (500) < p.when (1000) \n  - prev = p = \n  \n   next  p prev  next \n\n\n\n### \n\n MessageQueue \n\nMessageQueue  mMessages  Message  next  when when \n\nMessageQueue \n\n```java\nmMessages = {\n  Message(when = 0, next = {\n    Message(when = 500, next = {\n      Message(when = 1000, next = null)\n    })\n  })\n}\n```\n\n\n\n####  MessageQueue \n\n\n\n O(1) O(n)\n\n next  next   O(1)  Message  next  O(n) \n\n Handler \n\n","source":"_posts/message-enqueue-process.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: Message \ntags: [Android]\ndate: 2019-10-26\n---\n\n\n\n Handler  MessageQueue\n\n\n\n<!-- more -->\n\n\n\nHandler  sendMessageAtTime  MessageQueue  Message  when  Message \n\n\n\n###  show time\n\n MessageQueue#enqueueMessage \n\n```java\nMessage mMessages;\nboolean enqueueMessage(Message msg, long when) {\n    msg.when = when; \n    Message p = mMessages;\n    if (p == null || when == 0 || when < p.when) {\n        msg.next = p;\n        mMessages = msg;\n    } else {\n        Message prev;\n        for (; ;) {\n            prev = p;\n            p = p.next;\n            if (p == null || when < p.when) {\n                break;\n            }\n        }\n        msg.next = p;\n        prev.next = msg;\n    }\n    return true;\n}\n```\n\n\n\n1.  when  sendMessageDelayed  + ****\n2.  when  msg.when = when\n3.  p  null\n\n\n\n### \n\n\n\n```java\nmHandler.sendEmptyMessage(100)\nmHandler.sendEmptyMessageDelayed(200, 1000)\nmHandler.sendEmptyMessageDelayed(300, 500)\n```\n\n\n\n1.  enqueueMessage when = 0\n\n   ```java\n   if (p == null || when == 0 || when < p.when){}\n   ```\n\n   p == null  mMessages  null p  next  next  mMessages \n\n2.  enqueueMessage when = 1000\n\n   ```java\n   Message p = mMessages;\n   ```\n\n    mMessages mMessages.next = nullmMessages.when = 0\n\n    if \n\n   - p == null p  mMessages \n   - when == 0 when  1000\n   - when < p.when 1000 < 0\n\n    else \n\n   ```java\n   Message prev;\n   for (; ;) {\n       prev = p;\n       p = p.next;\n       if (p == null || when < p.when) {\n         break;\n       }\n   }\n   msg.next = p;\n   prev.next = msg;\n   ```\n\n   -  Message  prev previous message\n   -  p  prev  p  p p == null  p.next = null p = p.next p == null \n   - prev  mMessages p  mMessages.next null\n   -  next  p null prev.next mMessages.next\n\n   MessageQueue \n\n   ```java\n   mMessages = {Message(when = 0, next = {Message(when = 1000, next = null)})}\n   ```\n   \n3.  enqueueMessage when = 500\n  \n  ```java\n  Message p = mMessages;\n  ```\n  \n  mMessages  Message when = 0next  when = 500 if \n  \n  ```java\n  if (p == null || when == 0 || when < p.when){}\n  \n  // p  when = 500 p.when = 0 if \n  ```\n  \n   else  \n  \n  ```java\n  Message prev;\n  for (; ;) {\n      prev = p;\n      p = p.next;\n      if (p == null || when < p.when) {\n        break;\n      }\n  }\n  msg.next = p;\n  prev.next = msg;\n  ```\n  \n   mMessages  prev = p = p.next() \n  \n  - p == null \n  - when (500) < p.when (1000) \n  - prev = p = \n  \n   next  p prev  next \n\n\n\n### \n\n MessageQueue \n\nMessageQueue  mMessages  Message  next  when when \n\nMessageQueue \n\n```java\nmMessages = {\n  Message(when = 0, next = {\n    Message(when = 500, next = {\n      Message(when = 1000, next = null)\n    })\n  })\n}\n```\n\n\n\n####  MessageQueue \n\n\n\n O(1) O(n)\n\n next  next   O(1)  Message  next  O(n) \n\n Handler \n\n","slug":"message-enqueue-process","published":1,"updated":"2019-10-26T07:42:15.935Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86cm000slh1poacbevkx","content":"<p> Handler  MessageQueue</p>\n<a id=\"more\"></a>\n<p>Handler  sendMessageAtTime  MessageQueue  Message  when  Message </p>\n<h3 id=\"-show-time\"><a href=\"#-show-time\" class=\"headerlink\" title=\" show time\"></a> show time</h3><p> MessageQueue#enqueueMessage </p>\n<pre><code class=\"java\">Message mMessages;\nboolean enqueueMessage(Message msg, long when) {\n    msg.when = when; \n    Message p = mMessages;\n    if (p == null || when == 0 || when &lt; p.when) {\n        msg.next = p;\n        mMessages = msg;\n    } else {\n        Message prev;\n        for (; ;) {\n            prev = p;\n            p = p.next;\n            if (p == null || when &lt; p.when) {\n                break;\n            }\n        }\n        msg.next = p;\n        prev.next = msg;\n    }\n    return true;\n}\n</code></pre>\n<p></p>\n<ol>\n<li> when  sendMessageDelayed  + <strong></strong></li>\n<li> when  msg.when = when</li>\n<li> p  null</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<pre><code class=\"java\">mHandler.sendEmptyMessage(100)\nmHandler.sendEmptyMessageDelayed(200, 1000)\nmHandler.sendEmptyMessageDelayed(300, 500)\n</code></pre>\n<p></p>\n<ol>\n<li><p> enqueueMessage when = 0</p>\n<pre><code class=\"java\">if (p == null || when == 0 || when &lt; p.when){}\n</code></pre>\n<p>p == null  mMessages  null p  next  next  mMessages </p>\n</li>\n<li><p> enqueueMessage when = 1000</p>\n<pre><code class=\"java\">Message p = mMessages;\n</code></pre>\n<p> mMessages mMessages.next = nullmMessages.when = 0</p>\n<p> if </p>\n<ul>\n<li>p == null p  mMessages </li>\n<li>when == 0 when  1000</li>\n<li>when &lt; p.when 1000 &lt; 0</li>\n</ul>\n<p> else </p>\n<pre><code class=\"java\">Message prev;\nfor (; ;) {\n    prev = p;\n    p = p.next;\n    if (p == null || when &lt; p.when) {\n      break;\n    }\n}\nmsg.next = p;\nprev.next = msg;\n</code></pre>\n<ul>\n<li> Message  prev previous message</li>\n<li> p  prev  p  p p == null  p.next = null p = p.next p == null </li>\n<li>prev  mMessages p  mMessages.next null</li>\n<li> next  p null prev.next mMessages.next</li>\n</ul>\n<p>MessageQueue </p>\n<pre><code class=\"java\">mMessages = {Message(when = 0, next = {Message(when = 1000, next = null)})}\n</code></pre>\n</li>\n<li><p> enqueueMessage when = 500</p>\n<pre><code class=\"java\">Message p = mMessages;\n</code></pre>\n<p>mMessages  Message when = 0next  when = 500 if </p>\n<pre><code class=\"java\">if (p == null || when == 0 || when &lt; p.when){}\n\n// p  when = 500 p.when = 0 if \n</code></pre>\n<p> else  </p>\n<pre><code class=\"java\">Message prev;\nfor (; ;) {\n   prev = p;\n   p = p.next;\n   if (p == null || when &lt; p.when) {\n     break;\n   }\n}\nmsg.next = p;\nprev.next = msg;\n</code></pre>\n<p> mMessages  prev = p = p.next() </p>\n<ul>\n<li>p == null </li>\n<li>when (500) &lt; p.when (1000) </li>\n<li>prev = p = </li>\n</ul>\n<p> next  p prev  next </p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> MessageQueue </p>\n<p>MessageQueue  mMessages  Message  next  when when </p>\n<p>MessageQueue </p>\n<pre><code class=\"java\">mMessages = {\n  Message(when = 0, next = {\n    Message(when = 500, next = {\n      Message(when = 1000, next = null)\n    })\n  })\n}\n</code></pre>\n<h4 id=\"-MessageQueue-\"><a href=\"#-MessageQueue-\" class=\"headerlink\" title=\" MessageQueue \"></a> MessageQueue </h4><p></p>\n<p> O(1) O(n)</p>\n<p> next  next   O(1)  Message  next  O(n) </p>\n<p> Handler </p>\n","site":{"data":{}},"excerpt":"<p> Handler  MessageQueue</p>","more":"<p>Handler  sendMessageAtTime  MessageQueue  Message  when  Message </p>\n<h3 id=\"-show-time\"><a href=\"#-show-time\" class=\"headerlink\" title=\" show time\"></a> show time</h3><p> MessageQueue#enqueueMessage </p>\n<pre><code class=\"java\">Message mMessages;\nboolean enqueueMessage(Message msg, long when) {\n    msg.when = when; \n    Message p = mMessages;\n    if (p == null || when == 0 || when &lt; p.when) {\n        msg.next = p;\n        mMessages = msg;\n    } else {\n        Message prev;\n        for (; ;) {\n            prev = p;\n            p = p.next;\n            if (p == null || when &lt; p.when) {\n                break;\n            }\n        }\n        msg.next = p;\n        prev.next = msg;\n    }\n    return true;\n}\n</code></pre>\n<p></p>\n<ol>\n<li> when  sendMessageDelayed  + <strong></strong></li>\n<li> when  msg.when = when</li>\n<li> p  null</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<pre><code class=\"java\">mHandler.sendEmptyMessage(100)\nmHandler.sendEmptyMessageDelayed(200, 1000)\nmHandler.sendEmptyMessageDelayed(300, 500)\n</code></pre>\n<p></p>\n<ol>\n<li><p> enqueueMessage when = 0</p>\n<pre><code class=\"java\">if (p == null || when == 0 || when &lt; p.when){}\n</code></pre>\n<p>p == null  mMessages  null p  next  next  mMessages </p>\n</li>\n<li><p> enqueueMessage when = 1000</p>\n<pre><code class=\"java\">Message p = mMessages;\n</code></pre>\n<p> mMessages mMessages.next = nullmMessages.when = 0</p>\n<p> if </p>\n<ul>\n<li>p == null p  mMessages </li>\n<li>when == 0 when  1000</li>\n<li>when &lt; p.when 1000 &lt; 0</li>\n</ul>\n<p> else </p>\n<pre><code class=\"java\">Message prev;\nfor (; ;) {\n    prev = p;\n    p = p.next;\n    if (p == null || when &lt; p.when) {\n      break;\n    }\n}\nmsg.next = p;\nprev.next = msg;\n</code></pre>\n<ul>\n<li> Message  prev previous message</li>\n<li> p  prev  p  p p == null  p.next = null p = p.next p == null </li>\n<li>prev  mMessages p  mMessages.next null</li>\n<li> next  p null prev.next mMessages.next</li>\n</ul>\n<p>MessageQueue </p>\n<pre><code class=\"java\">mMessages = {Message(when = 0, next = {Message(when = 1000, next = null)})}\n</code></pre>\n</li>\n<li><p> enqueueMessage when = 500</p>\n<pre><code class=\"java\">Message p = mMessages;\n</code></pre>\n<p>mMessages  Message when = 0next  when = 500 if </p>\n<pre><code class=\"java\">if (p == null || when == 0 || when &lt; p.when){}\n\n// p  when = 500 p.when = 0 if \n</code></pre>\n<p> else  </p>\n<pre><code class=\"java\">Message prev;\nfor (; ;) {\n   prev = p;\n   p = p.next;\n   if (p == null || when &lt; p.when) {\n     break;\n   }\n}\nmsg.next = p;\nprev.next = msg;\n</code></pre>\n<p> mMessages  prev = p = p.next() </p>\n<ul>\n<li>p == null </li>\n<li>when (500) &lt; p.when (1000) </li>\n<li>prev = p = </li>\n</ul>\n<p> next  p prev  next </p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> MessageQueue </p>\n<p>MessageQueue  mMessages  Message  next  when when </p>\n<p>MessageQueue </p>\n<pre><code class=\"java\">mMessages = {\n  Message(when = 0, next = {\n    Message(when = 500, next = {\n      Message(when = 1000, next = null)\n    })\n  })\n}\n</code></pre>\n<h4 id=\"-MessageQueue-\"><a href=\"#-MessageQueue-\" class=\"headerlink\" title=\" MessageQueue \"></a> MessageQueue </h4><p></p>\n<p> O(1) O(n)</p>\n<p> next  next   O(1)  Message  next  O(n) </p>\n<p> Handler </p>"},{"title":"java","date":"2018-03-08T16:00:00.000Z","_content":"\n\n\n\n\n```\n// \npublic class Parent {\n    public int aInt = -1;\n    public void func1() {\n        System.err.print(\" Parent func1 \");\n    }\n    public void func2() {\n        System.err.print(\" Parent func2 \");\n    }\n}\n```\n\n```\n// \npublic class Child extends Parent {\n    public int aInt = 1;\n    public void func1() {\n        System.err.print(\" Child func1 \");\n    }\n    public void func3() {\n        System.err.print(\" Child func3 \");\n    }\n}\n```\n\n#### \n```\n// test main()\npublic static void main(String[] args) {\n    Child child = new Child();\n    child.func1();\n    child.func2();\n    child.func3();\n\n    Parent parent = new Child();\n    parent.func1();\n    parent.func2();\n    parent.func3();\n}\n```\nChild\n```\nChild func1\nParent func2\nChild func3\n```\nChildfunc1()\nParentparent.fun3()ParentParentfunc3()\n```\nChild func1 // ParentChild\nParent func2\n```\n\n\n#### \n```\n// test main()\npublic static void main(String[] args) {\n    Parent parent = new Child();\n    Child child = new Child();\n    System.err.println(parent.aInt);\n    System.err.println(child.aInt);\n}\n```\n\n```\n-1\n1\n```\n1\n\n#### \n* \n  \n* \n  \n\n\njavathissuper","source":"_posts/polymorphism-of-java.md","raw":"---\ntitle: java\n\ntags: java\n\ndate: 2018-03-9\n---\n\n\n\n\n\n```\n// \npublic class Parent {\n    public int aInt = -1;\n    public void func1() {\n        System.err.print(\" Parent func1 \");\n    }\n    public void func2() {\n        System.err.print(\" Parent func2 \");\n    }\n}\n```\n\n```\n// \npublic class Child extends Parent {\n    public int aInt = 1;\n    public void func1() {\n        System.err.print(\" Child func1 \");\n    }\n    public void func3() {\n        System.err.print(\" Child func3 \");\n    }\n}\n```\n\n#### \n```\n// test main()\npublic static void main(String[] args) {\n    Child child = new Child();\n    child.func1();\n    child.func2();\n    child.func3();\n\n    Parent parent = new Child();\n    parent.func1();\n    parent.func2();\n    parent.func3();\n}\n```\nChild\n```\nChild func1\nParent func2\nChild func3\n```\nChildfunc1()\nParentparent.fun3()ParentParentfunc3()\n```\nChild func1 // ParentChild\nParent func2\n```\n\n\n#### \n```\n// test main()\npublic static void main(String[] args) {\n    Parent parent = new Child();\n    Child child = new Child();\n    System.err.println(parent.aInt);\n    System.err.println(child.aInt);\n}\n```\n\n```\n-1\n1\n```\n1\n\n#### \n* \n  \n* \n  \n\n\njavathissuper","slug":"polymorphism-of-java","published":1,"updated":"2018-08-14T10:11:51.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86co000ulh1p4nyxiwdg","content":"<p></p>\n<pre><code>// \npublic class Parent {\n    public int aInt = -1;\n    public void func1() {\n        System.err.print(&quot; Parent func1 &quot;);\n    }\n    public void func2() {\n        System.err.print(&quot; Parent func2 &quot;);\n    }\n}\n</code></pre><pre><code>// \npublic class Child extends Parent {\n    public int aInt = 1;\n    public void func1() {\n        System.err.print(&quot; Child func1 &quot;);\n    }\n    public void func3() {\n        System.err.print(&quot; Child func3 &quot;);\n    }\n}\n</code></pre><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code>// test main()\npublic static void main(String[] args) {\n    Child child = new Child();\n    child.func1();\n    child.func2();\n    child.func3();\n\n    Parent parent = new Child();\n    parent.func1();\n    parent.func2();\n    parent.func3();\n}\n</code></pre><p>Child</p>\n<pre><code>Child func1\nParent func2\nChild func3\n</code></pre><p>Childfunc1()<br>Parentparent.fun3()ParentParentfunc3()</p>\n<pre><code>Child func1 // ParentChild\nParent func2\n</code></pre><p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code>// test main()\npublic static void main(String[] args) {\n    Parent parent = new Child();\n    Child child = new Child();\n    System.err.println(parent.aInt);\n    System.err.println(child.aInt);\n}\n</code></pre><p></p>\n<pre><code>-1\n1\n</code></pre><p>1</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><br></li>\n<li><br></li>\n</ul>\n<p><br>javathissuper</p>\n","site":{"data":{}},"excerpt":"","more":"<p></p>\n<pre><code>// \npublic class Parent {\n    public int aInt = -1;\n    public void func1() {\n        System.err.print(&quot; Parent func1 &quot;);\n    }\n    public void func2() {\n        System.err.print(&quot; Parent func2 &quot;);\n    }\n}\n</code></pre><pre><code>// \npublic class Child extends Parent {\n    public int aInt = 1;\n    public void func1() {\n        System.err.print(&quot; Child func1 &quot;);\n    }\n    public void func3() {\n        System.err.print(&quot; Child func3 &quot;);\n    }\n}\n</code></pre><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code>// test main()\npublic static void main(String[] args) {\n    Child child = new Child();\n    child.func1();\n    child.func2();\n    child.func3();\n\n    Parent parent = new Child();\n    parent.func1();\n    parent.func2();\n    parent.func3();\n}\n</code></pre><p>Child</p>\n<pre><code>Child func1\nParent func2\nChild func3\n</code></pre><p>Childfunc1()<br>Parentparent.fun3()ParentParentfunc3()</p>\n<pre><code>Child func1 // ParentChild\nParent func2\n</code></pre><p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code>// test main()\npublic static void main(String[] args) {\n    Parent parent = new Child();\n    Child child = new Child();\n    System.err.println(parent.aInt);\n    System.err.println(child.aInt);\n}\n</code></pre><p></p>\n<pre><code>-1\n1\n</code></pre><p>1</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><br></li>\n<li><br></li>\n</ul>\n<p><br>javathissuper</p>\n"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410195304.jpg","title":"MeasureSpec ","date":"2019-04-09T16:00:00.000Z","_content":"\n\n\n\n\n\n\n View  MeasureSpec  \n\n\n\n<!-- more -->\n\n\n\n\n\n### MeasureSpec \n\n MeasureSpec \n\n> A MeasureSpec encapsulates the layout requirements passed from parent to child. Each MeasureSpec represents a requirement for either the width or the height. \n\nMeasureSpec  MeasureSpec  `mode`  `size` \n\nMeasureSpec UNSPECIFIEDEXACTLYAT_MOST\n\n- UNSPECIFIED\n\n   View \n\n  >  ListViewScrollView\n\n- EXACTLY\n\n  \n\n  >  100dp match_parent()\n\n- AT_MOST\n\n  \n\n  >  wrap_content\n\nMeasureSpec  32  int  <size, mode>  int  2  specMode 30  specSize\n\n\n\n** View  LayoutParams  MeasureSpec **\n\n MeasureSpec  MeasureSpec \n\n\n\n### MeasureSpec \n\n View  ViewRootImpl  performTraversals \n\n```java\n    int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);\n \t\tint childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);\n \t\t// Ask host how big it wants to be\n \t\tperformMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n```\n\n `getRootMeasureSpec`  MeasureSpec \n\n```java\nprivate static int getRootMeasureSpec(int windowSize, int rootDimension) {\n    int measureSpec;\n    switch (rootDimension) {\n        case ViewGroup.LayoutParams.MATCH_PARENT:\n            // Window can't resize. Force root view to be windowSize.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);\n            break;\n        case ViewGroup.LayoutParams.WRAP_CONTENT:\n            // Window can resize. Set max size for root view.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);\n            break;\n        default:\n            // Window wants to be an exact size. Force root view to be that size.\n            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);\n            break;\n    }\n    return measureSpec;\n}\n```\n\n View specSize  windowSize MATCH_PARENT  EXACTLYWRAP_CONTENT  AT_MOST MeasureSpec  `MeasureSpec.makeMeasureSpec` \n\nSpecMode  SpecSize  MeasureSpecMeasureSpec  SpecMode  SpecSize  int \n\n```java\npublic static int makeMeasureSpec(int size, int mode) {\n    if (sUseBrokenMakeMeasureSpec) {\n        //  + \n      \t// 323231mode30size\n        // size=100( 4)mode=AT_MOSTmeasureSpec=100+1000...00=1000..00100  \n        return size + mode;\n    } else {\n        return (size & ~MODE_MASK) | (mode & MODE_MASK);\n    }\n}\n\npublic static int getMode(int measureSpec) {\n  \t// MODE_MASK =  = 11 00000000000(11300)\n  \t// measureSpec2030\n    return (measureSpec & MODE_MASK);\n}\n\npublic static int getSize(int measureSpec) {\n    //  MASK  00 1111111111(00301) \n    //  32,31  0  mode30size\n    return (measureSpec & ~MODE_MASK);\n}\n```\n\n MeasureSpec MeasureSpec \n\n LinearLayout  measureVertical \n\n```java\nfinal LayoutParams lp = (LayoutParams) child.getLayoutParams();\nfinal int childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(\n        Math.max(0, childWidth), MeasureSpec.EXACTLY);\nfinal int childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,\n        mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin,\n        lp.height);\n//  View  MeasureSpec \nchild.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n```\n\n MeasureSpec  MeasureSpec.EXACTLY `getChildMeasureSpec`  LinearLayout  MeasureSpec  View  LayoutParams\n\n```java\n/**\n * ViewGroup#getChildMeasureSpec\n * \n * @param spec  MeasureSpec\n * @param padding  margin+padding\n * @param childDimension lp.height\n * @return\n */\npublic static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n  \t//  LinearLayout \n    int specMode = MeasureSpec.getMode(spec);\n    int specSize = MeasureSpec.getSize(spec);\n\n  \t//  padding  mode  size \n    int size = Math.max(0, specSize - padding);\n\n  \t//  child  size  mode\n    int resultSize = 0;\n    int resultMode = 0;\n\n    //  match  wrap\n    switch (specMode) {\n        //  EXACTLY 100dp match_parent \n        case MeasureSpec.EXACTLY: //  -2\n        \t\t//  100dp \n         \t\t//  EXACTLY\n            if (childDimension >= 0) {\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                //  EXACTLY\n                resultSize = size;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        //  AT_MOST\n        case MeasureSpec.AT_MOST:\n            if (childDimension >= 0) {\n                // \n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n              \t//  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        // ListViewGridView\n        case MeasureSpec.UNSPECIFIED:\n            if (childDimension >= 0) {\n                // Child wants a specific size... let him have it\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                // Child wants to be our size... find out how big it should\n                // be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                // Child wants to determine its own size.... find out how\n                // big it should be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            }\n            break;\n    }\n    //  MeasureSpec  child  lp\n    return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n```\n\n\n\n### \n\n View \n\n\n\n1. MeasureSpec  UNSPECIFIED  ScrollView  ListView  ScrollView  View  MeasureSpec.UNSPECIFIED  ListView  onMeasure \n\n   ```java\n   //  MeasureSpec.UNSPECIFIED + padding\n   if (heightMode == MeasureSpec.UNSPECIFIED) {\n      \theightSize = mListPadding.top + mListPadding.bottom + \n        \t\tchildHeight + getVerticalFadingEdgeLength() * 2;\n   }\n   ```\n\n    ListView [ScrollView  ListView ](<https://www.jianshu.com/p/061f734af3e9>)\n\n2. ** View *<u> View </u>*<u>**</u> MeasureSpec.EXACTLY**\n\n3. ** View  match_parent  specMode  specMode***<u> EXACTLY AT_MOST</u>*** specSize  size**\n\n4. ** View  wrap_content  specMode  AT_MOSTspecSize  size**\n\n\n\n### \n\n\n\n####  EXACTLY\n\n1. ViewGroup: match_parent, Child: 500dp x 500dp\n\n2. ViewGroup: 300dp x 300dp, Child: 500dp x 500dp\n\n   > \n   >\n   >  View \n\n   ```java\n   // \n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"300dp\"\n           android:layout_height=\"300dp\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180646.png)\n\n3. ViewGroup: match_parent, child: match_parent\n\n   >  MeasureSpec.EXACTLY\n\n   ```JAVA\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"match_parent\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180825.png)\n\n4. ViewGroup: match_parent, child: wrap_content\n\n   > \n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"wrap_content\"\n           android:layout_height=\"wrap_content\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180934.png)\n\n\n\n####  WRAP_CONTENT\n\n1. ViewGroup: wrap_content, child: match_parent\n\n   >  AT_MOST\n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"match_parent\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181341.png)\n\n2. ViewGroup: wrap_content, child: 300dp x 300dp\n\n   >  AT_MOST\n   >\n   >  View \n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"300dp\"\n           android:layout_height=\"300dp\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181429.png)\n\n3. ViewGroup: wrap_content, child: wrap_content\n\n   >  AT_MOST\n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"wrap_content\"\n           android:layout_height=\"wrap_content\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181519.png)\n\n","source":"_posts/Android-MeasureSpec.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410195304.jpg\ntitle: MeasureSpec \ntags: [Android]\ndate: 2019-04-10\n---\n\n\n\n\n\n\n\n View  MeasureSpec  \n\n\n\n<!-- more -->\n\n\n\n\n\n### MeasureSpec \n\n MeasureSpec \n\n> A MeasureSpec encapsulates the layout requirements passed from parent to child. Each MeasureSpec represents a requirement for either the width or the height. \n\nMeasureSpec  MeasureSpec  `mode`  `size` \n\nMeasureSpec UNSPECIFIEDEXACTLYAT_MOST\n\n- UNSPECIFIED\n\n   View \n\n  >  ListViewScrollView\n\n- EXACTLY\n\n  \n\n  >  100dp match_parent()\n\n- AT_MOST\n\n  \n\n  >  wrap_content\n\nMeasureSpec  32  int  <size, mode>  int  2  specMode 30  specSize\n\n\n\n** View  LayoutParams  MeasureSpec **\n\n MeasureSpec  MeasureSpec \n\n\n\n### MeasureSpec \n\n View  ViewRootImpl  performTraversals \n\n```java\n    int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);\n \t\tint childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);\n \t\t// Ask host how big it wants to be\n \t\tperformMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n```\n\n `getRootMeasureSpec`  MeasureSpec \n\n```java\nprivate static int getRootMeasureSpec(int windowSize, int rootDimension) {\n    int measureSpec;\n    switch (rootDimension) {\n        case ViewGroup.LayoutParams.MATCH_PARENT:\n            // Window can't resize. Force root view to be windowSize.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);\n            break;\n        case ViewGroup.LayoutParams.WRAP_CONTENT:\n            // Window can resize. Set max size for root view.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);\n            break;\n        default:\n            // Window wants to be an exact size. Force root view to be that size.\n            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);\n            break;\n    }\n    return measureSpec;\n}\n```\n\n View specSize  windowSize MATCH_PARENT  EXACTLYWRAP_CONTENT  AT_MOST MeasureSpec  `MeasureSpec.makeMeasureSpec` \n\nSpecMode  SpecSize  MeasureSpecMeasureSpec  SpecMode  SpecSize  int \n\n```java\npublic static int makeMeasureSpec(int size, int mode) {\n    if (sUseBrokenMakeMeasureSpec) {\n        //  + \n      \t// 323231mode30size\n        // size=100( 4)mode=AT_MOSTmeasureSpec=100+1000...00=1000..00100  \n        return size + mode;\n    } else {\n        return (size & ~MODE_MASK) | (mode & MODE_MASK);\n    }\n}\n\npublic static int getMode(int measureSpec) {\n  \t// MODE_MASK =  = 11 00000000000(11300)\n  \t// measureSpec2030\n    return (measureSpec & MODE_MASK);\n}\n\npublic static int getSize(int measureSpec) {\n    //  MASK  00 1111111111(00301) \n    //  32,31  0  mode30size\n    return (measureSpec & ~MODE_MASK);\n}\n```\n\n MeasureSpec MeasureSpec \n\n LinearLayout  measureVertical \n\n```java\nfinal LayoutParams lp = (LayoutParams) child.getLayoutParams();\nfinal int childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(\n        Math.max(0, childWidth), MeasureSpec.EXACTLY);\nfinal int childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,\n        mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin,\n        lp.height);\n//  View  MeasureSpec \nchild.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n```\n\n MeasureSpec  MeasureSpec.EXACTLY `getChildMeasureSpec`  LinearLayout  MeasureSpec  View  LayoutParams\n\n```java\n/**\n * ViewGroup#getChildMeasureSpec\n * \n * @param spec  MeasureSpec\n * @param padding  margin+padding\n * @param childDimension lp.height\n * @return\n */\npublic static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n  \t//  LinearLayout \n    int specMode = MeasureSpec.getMode(spec);\n    int specSize = MeasureSpec.getSize(spec);\n\n  \t//  padding  mode  size \n    int size = Math.max(0, specSize - padding);\n\n  \t//  child  size  mode\n    int resultSize = 0;\n    int resultMode = 0;\n\n    //  match  wrap\n    switch (specMode) {\n        //  EXACTLY 100dp match_parent \n        case MeasureSpec.EXACTLY: //  -2\n        \t\t//  100dp \n         \t\t//  EXACTLY\n            if (childDimension >= 0) {\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                //  EXACTLY\n                resultSize = size;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        //  AT_MOST\n        case MeasureSpec.AT_MOST:\n            if (childDimension >= 0) {\n                // \n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n              \t//  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        // ListViewGridView\n        case MeasureSpec.UNSPECIFIED:\n            if (childDimension >= 0) {\n                // Child wants a specific size... let him have it\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                // Child wants to be our size... find out how big it should\n                // be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                // Child wants to determine its own size.... find out how\n                // big it should be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            }\n            break;\n    }\n    //  MeasureSpec  child  lp\n    return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n```\n\n\n\n### \n\n View \n\n\n\n1. MeasureSpec  UNSPECIFIED  ScrollView  ListView  ScrollView  View  MeasureSpec.UNSPECIFIED  ListView  onMeasure \n\n   ```java\n   //  MeasureSpec.UNSPECIFIED + padding\n   if (heightMode == MeasureSpec.UNSPECIFIED) {\n      \theightSize = mListPadding.top + mListPadding.bottom + \n        \t\tchildHeight + getVerticalFadingEdgeLength() * 2;\n   }\n   ```\n\n    ListView [ScrollView  ListView ](<https://www.jianshu.com/p/061f734af3e9>)\n\n2. ** View *<u> View </u>*<u>**</u> MeasureSpec.EXACTLY**\n\n3. ** View  match_parent  specMode  specMode***<u> EXACTLY AT_MOST</u>*** specSize  size**\n\n4. ** View  wrap_content  specMode  AT_MOSTspecSize  size**\n\n\n\n### \n\n\n\n####  EXACTLY\n\n1. ViewGroup: match_parent, Child: 500dp x 500dp\n\n2. ViewGroup: 300dp x 300dp, Child: 500dp x 500dp\n\n   > \n   >\n   >  View \n\n   ```java\n   // \n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"300dp\"\n           android:layout_height=\"300dp\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180646.png)\n\n3. ViewGroup: match_parent, child: match_parent\n\n   >  MeasureSpec.EXACTLY\n\n   ```JAVA\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"match_parent\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180825.png)\n\n4. ViewGroup: match_parent, child: wrap_content\n\n   > \n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"wrap_content\"\n           android:layout_height=\"wrap_content\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180934.png)\n\n\n\n####  WRAP_CONTENT\n\n1. ViewGroup: wrap_content, child: match_parent\n\n   >  AT_MOST\n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"match_parent\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181341.png)\n\n2. ViewGroup: wrap_content, child: 300dp x 300dp\n\n   >  AT_MOST\n   >\n   >  View \n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"300dp\"\n           android:layout_height=\"300dp\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181429.png)\n\n3. ViewGroup: wrap_content, child: wrap_content\n\n   >  AT_MOST\n   >\n   >  AT_MOST\n\n   ```java\n   <com.ljt.rvanalysis.spec.MyLinearLayout\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:orientation=\"vertical\">\n   \n       <com.ljt.rvanalysis.spec.MyTextView\n           android:layout_width=\"wrap_content\"\n           android:layout_height=\"wrap_content\" />\n   \n   </com.ljt.rvanalysis.spec.MyLinearLayout>\n   ```\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181519.png)\n\n","slug":"Android-MeasureSpec","published":1,"updated":"2019-04-10T11:54:51.189Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86df0012lh1pdh6pyici","content":"<p> View  MeasureSpec  </p>\n<a id=\"more\"></a>\n<p></p>\n<h3 id=\"MeasureSpec-\"><a href=\"#MeasureSpec-\" class=\"headerlink\" title=\"MeasureSpec \"></a>MeasureSpec </h3><p> MeasureSpec </p>\n<blockquote>\n<p>A MeasureSpec encapsulates the layout requirements passed from parent to child. Each MeasureSpec represents a requirement for either the width or the height. </p>\n</blockquote>\n<p>MeasureSpec  MeasureSpec  <code>mode</code>  <code>size</code> </p>\n<p>MeasureSpec UNSPECIFIEDEXACTLYAT_MOST</p>\n<ul>\n<li><p>UNSPECIFIED</p>\n<p> View </p>\n<blockquote>\n<p> ListViewScrollView</p>\n</blockquote>\n</li>\n<li><p>EXACTLY</p>\n<p></p>\n<blockquote>\n<p> 100dp match_parent()</p>\n</blockquote>\n</li>\n<li><p>AT_MOST</p>\n<p></p>\n<blockquote>\n<p> wrap_content</p>\n</blockquote>\n</li>\n</ul>\n<p>MeasureSpec  32  int  &lt;size, mode&gt;  int  2  specMode 30  specSize</p>\n<p><strong> View  LayoutParams  MeasureSpec </strong></p>\n<p> MeasureSpec  MeasureSpec </p>\n<h3 id=\"MeasureSpec-\"><a href=\"#MeasureSpec-\" class=\"headerlink\" title=\"MeasureSpec \"></a>MeasureSpec </h3><p> View  ViewRootImpl  performTraversals </p>\n<pre><code class=\"java\">    int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);\n         int childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);\n         // Ask host how big it wants to be\n         performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n</code></pre>\n<p> <code>getRootMeasureSpec</code>  MeasureSpec </p>\n<pre><code class=\"java\">private static int getRootMeasureSpec(int windowSize, int rootDimension) {\n    int measureSpec;\n    switch (rootDimension) {\n        case ViewGroup.LayoutParams.MATCH_PARENT:\n            // Window can&#39;t resize. Force root view to be windowSize.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);\n            break;\n        case ViewGroup.LayoutParams.WRAP_CONTENT:\n            // Window can resize. Set max size for root view.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);\n            break;\n        default:\n            // Window wants to be an exact size. Force root view to be that size.\n            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);\n            break;\n    }\n    return measureSpec;\n}\n</code></pre>\n<p> View specSize  windowSize MATCH_PARENT  EXACTLYWRAP_CONTENT  AT_MOST MeasureSpec  <code>MeasureSpec.makeMeasureSpec</code> </p>\n<p>SpecMode  SpecSize  MeasureSpecMeasureSpec  SpecMode  SpecSize  int </p>\n<pre><code class=\"java\">public static int makeMeasureSpec(int size, int mode) {\n    if (sUseBrokenMakeMeasureSpec) {\n        //  + \n          // 323231mode30size\n        // size=100( 4)mode=AT_MOSTmeasureSpec=100+1000...00=1000..00100  \n        return size + mode;\n    } else {\n        return (size &amp; ~MODE_MASK) | (mode &amp; MODE_MASK);\n    }\n}\n\npublic static int getMode(int measureSpec) {\n      // MODE_MASK =  = 11 00000000000(11300)\n      // measureSpec2030\n    return (measureSpec &amp; MODE_MASK);\n}\n\npublic static int getSize(int measureSpec) {\n    //  MASK  00 1111111111(00301) \n    //  32,31  0  mode30size\n    return (measureSpec &amp; ~MODE_MASK);\n}\n</code></pre>\n<p> MeasureSpec MeasureSpec </p>\n<p> LinearLayout  measureVertical </p>\n<pre><code class=\"java\">final LayoutParams lp = (LayoutParams) child.getLayoutParams();\nfinal int childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(\n        Math.max(0, childWidth), MeasureSpec.EXACTLY);\nfinal int childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,\n        mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin,\n        lp.height);\n//  View  MeasureSpec \nchild.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n</code></pre>\n<p> MeasureSpec  MeasureSpec.EXACTLY <code>getChildMeasureSpec</code>  LinearLayout  MeasureSpec  View  LayoutParams</p>\n<pre><code class=\"java\">/**\n * ViewGroup#getChildMeasureSpec\n * \n * @param spec  MeasureSpec\n * @param padding  margin+padding\n * @param childDimension lp.height\n * @return\n */\npublic static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n      //  LinearLayout \n    int specMode = MeasureSpec.getMode(spec);\n    int specSize = MeasureSpec.getSize(spec);\n\n      //  padding  mode  size \n    int size = Math.max(0, specSize - padding);\n\n      //  child  size  mode\n    int resultSize = 0;\n    int resultMode = 0;\n\n    //  match  wrap\n    switch (specMode) {\n        //  EXACTLY 100dp match_parent \n        case MeasureSpec.EXACTLY: //  -2\n                //  100dp \n                 //  EXACTLY\n            if (childDimension &gt;= 0) {\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                //  EXACTLY\n                resultSize = size;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        //  AT_MOST\n        case MeasureSpec.AT_MOST:\n            if (childDimension &gt;= 0) {\n                // \n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                  //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        // ListViewGridView\n        case MeasureSpec.UNSPECIFIED:\n            if (childDimension &gt;= 0) {\n                // Child wants a specific size... let him have it\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                // Child wants to be our size... find out how big it should\n                // be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                // Child wants to determine its own size.... find out how\n                // big it should be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            }\n            break;\n    }\n    //  MeasureSpec  child  lp\n    return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> View </p>\n<p></p>\n<ol>\n<li><p>MeasureSpec  UNSPECIFIED  ScrollView  ListView  ScrollView  View  MeasureSpec.UNSPECIFIED  ListView  onMeasure </p>\n<pre><code class=\"java\">//  MeasureSpec.UNSPECIFIED + padding\nif (heightMode == MeasureSpec.UNSPECIFIED) {\n       heightSize = mListPadding.top + mListPadding.bottom + \n             childHeight + getVerticalFadingEdgeLength() * 2;\n}\n</code></pre>\n<p> ListView <a href=\"https://www.jianshu.com/p/061f734af3e9\" target=\"_blank\" rel=\"noopener\">ScrollView  ListView </a></p>\n</li>\n<li><p><strong> View <em><u> View </u></em><u><em></em></u> MeasureSpec.EXACTLY</strong></p>\n</li>\n<li><p><strong> View  match_parent  specMode  specMode</strong><em><u> EXACTLY AT_MOST</u></em><strong> specSize  size</strong></p>\n</li>\n<li><p><strong> View  wrap_content  specMode  AT_MOSTspecSize  size</strong></p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h4 id=\"-EXACTLY\"><a href=\"#-EXACTLY\" class=\"headerlink\" title=\" EXACTLY\"></a> EXACTLY</h4><ol>\n<li><p>ViewGroup: match_parent, Child: 500dp x 500dp</p>\n</li>\n<li><p>ViewGroup: 300dp x 300dp, Child: 500dp x 500dp</p>\n<blockquote>\n<p></p>\n<p> View </p>\n</blockquote>\n<pre><code class=\"java\">// \n&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;300dp&quot;\n        android:layout_height=&quot;300dp&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180646.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: match_parent, child: match_parent</p>\n<blockquote>\n<p> MeasureSpec.EXACTLY</p>\n</blockquote>\n<pre><code class=\"JAVA\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180825.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: match_parent, child: wrap_content</p>\n<blockquote>\n<p></p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180934.png\" alt=\"\"></p>\n</li>\n</ol>\n<h4 id=\"-WRAP-CONTENT\"><a href=\"#-WRAP-CONTENT\" class=\"headerlink\" title=\" WRAP_CONTENT\"></a> WRAP_CONTENT</h4><ol>\n<li><p>ViewGroup: wrap_content, child: match_parent</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181341.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: wrap_content, child: 300dp x 300dp</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> View </p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;300dp&quot;\n        android:layout_height=&quot;300dp&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181429.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: wrap_content, child: wrap_content</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181519.png\" alt=\"\"></p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p> View  MeasureSpec  </p>","more":"<p></p>\n<h3 id=\"MeasureSpec-\"><a href=\"#MeasureSpec-\" class=\"headerlink\" title=\"MeasureSpec \"></a>MeasureSpec </h3><p> MeasureSpec </p>\n<blockquote>\n<p>A MeasureSpec encapsulates the layout requirements passed from parent to child. Each MeasureSpec represents a requirement for either the width or the height. </p>\n</blockquote>\n<p>MeasureSpec  MeasureSpec  <code>mode</code>  <code>size</code> </p>\n<p>MeasureSpec UNSPECIFIEDEXACTLYAT_MOST</p>\n<ul>\n<li><p>UNSPECIFIED</p>\n<p> View </p>\n<blockquote>\n<p> ListViewScrollView</p>\n</blockquote>\n</li>\n<li><p>EXACTLY</p>\n<p></p>\n<blockquote>\n<p> 100dp match_parent()</p>\n</blockquote>\n</li>\n<li><p>AT_MOST</p>\n<p></p>\n<blockquote>\n<p> wrap_content</p>\n</blockquote>\n</li>\n</ul>\n<p>MeasureSpec  32  int  &lt;size, mode&gt;  int  2  specMode 30  specSize</p>\n<p><strong> View  LayoutParams  MeasureSpec </strong></p>\n<p> MeasureSpec  MeasureSpec </p>\n<h3 id=\"MeasureSpec-\"><a href=\"#MeasureSpec-\" class=\"headerlink\" title=\"MeasureSpec \"></a>MeasureSpec </h3><p> View  ViewRootImpl  performTraversals </p>\n<pre><code class=\"java\">    int childWidthMeasureSpec = getRootMeasureSpec(mWidth, lp.width);\n         int childHeightMeasureSpec = getRootMeasureSpec(mHeight, lp.height);\n         // Ask host how big it wants to be\n         performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n</code></pre>\n<p> <code>getRootMeasureSpec</code>  MeasureSpec </p>\n<pre><code class=\"java\">private static int getRootMeasureSpec(int windowSize, int rootDimension) {\n    int measureSpec;\n    switch (rootDimension) {\n        case ViewGroup.LayoutParams.MATCH_PARENT:\n            // Window can&#39;t resize. Force root view to be windowSize.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);\n            break;\n        case ViewGroup.LayoutParams.WRAP_CONTENT:\n            // Window can resize. Set max size for root view.\n            measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);\n            break;\n        default:\n            // Window wants to be an exact size. Force root view to be that size.\n            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);\n            break;\n    }\n    return measureSpec;\n}\n</code></pre>\n<p> View specSize  windowSize MATCH_PARENT  EXACTLYWRAP_CONTENT  AT_MOST MeasureSpec  <code>MeasureSpec.makeMeasureSpec</code> </p>\n<p>SpecMode  SpecSize  MeasureSpecMeasureSpec  SpecMode  SpecSize  int </p>\n<pre><code class=\"java\">public static int makeMeasureSpec(int size, int mode) {\n    if (sUseBrokenMakeMeasureSpec) {\n        //  + \n          // 323231mode30size\n        // size=100( 4)mode=AT_MOSTmeasureSpec=100+1000...00=1000..00100  \n        return size + mode;\n    } else {\n        return (size &amp; ~MODE_MASK) | (mode &amp; MODE_MASK);\n    }\n}\n\npublic static int getMode(int measureSpec) {\n      // MODE_MASK =  = 11 00000000000(11300)\n      // measureSpec2030\n    return (measureSpec &amp; MODE_MASK);\n}\n\npublic static int getSize(int measureSpec) {\n    //  MASK  00 1111111111(00301) \n    //  32,31  0  mode30size\n    return (measureSpec &amp; ~MODE_MASK);\n}\n</code></pre>\n<p> MeasureSpec MeasureSpec </p>\n<p> LinearLayout  measureVertical </p>\n<pre><code class=\"java\">final LayoutParams lp = (LayoutParams) child.getLayoutParams();\nfinal int childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(\n        Math.max(0, childWidth), MeasureSpec.EXACTLY);\nfinal int childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,\n        mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin,\n        lp.height);\n//  View  MeasureSpec \nchild.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n</code></pre>\n<p> MeasureSpec  MeasureSpec.EXACTLY <code>getChildMeasureSpec</code>  LinearLayout  MeasureSpec  View  LayoutParams</p>\n<pre><code class=\"java\">/**\n * ViewGroup#getChildMeasureSpec\n * \n * @param spec  MeasureSpec\n * @param padding  margin+padding\n * @param childDimension lp.height\n * @return\n */\npublic static int getChildMeasureSpec(int spec, int padding, int childDimension) {\n      //  LinearLayout \n    int specMode = MeasureSpec.getMode(spec);\n    int specSize = MeasureSpec.getSize(spec);\n\n      //  padding  mode  size \n    int size = Math.max(0, specSize - padding);\n\n      //  child  size  mode\n    int resultSize = 0;\n    int resultMode = 0;\n\n    //  match  wrap\n    switch (specMode) {\n        //  EXACTLY 100dp match_parent \n        case MeasureSpec.EXACTLY: //  -2\n                //  100dp \n                 //  EXACTLY\n            if (childDimension &gt;= 0) {\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                //  EXACTLY\n                resultSize = size;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        //  AT_MOST\n        case MeasureSpec.AT_MOST:\n            if (childDimension &gt;= 0) {\n                // \n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                  //  AT_MOST\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                resultSize = size;\n                resultMode = MeasureSpec.AT_MOST;\n            }\n            break;\n\n        // ListViewGridView\n        case MeasureSpec.UNSPECIFIED:\n            if (childDimension &gt;= 0) {\n                // Child wants a specific size... let him have it\n                resultSize = childDimension;\n                resultMode = MeasureSpec.EXACTLY;\n            } else if (childDimension == ViewGroup.LayoutParams.MATCH_PARENT) {\n                // Child wants to be our size... find out how big it should\n                // be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            } else if (childDimension == ViewGroup.LayoutParams.WRAP_CONTENT) {\n                // Child wants to determine its own size.... find out how\n                // big it should be\n                resultSize = View.sUseZeroUnspecifiedMeasureSpec ? 0 : size;\n                resultMode = MeasureSpec.UNSPECIFIED;\n            }\n            break;\n    }\n    //  MeasureSpec  child  lp\n    return MeasureSpec.makeMeasureSpec(resultSize, resultMode);\n}\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> View </p>\n<p></p>\n<ol>\n<li><p>MeasureSpec  UNSPECIFIED  ScrollView  ListView  ScrollView  View  MeasureSpec.UNSPECIFIED  ListView  onMeasure </p>\n<pre><code class=\"java\">//  MeasureSpec.UNSPECIFIED + padding\nif (heightMode == MeasureSpec.UNSPECIFIED) {\n       heightSize = mListPadding.top + mListPadding.bottom + \n             childHeight + getVerticalFadingEdgeLength() * 2;\n}\n</code></pre>\n<p> ListView <a href=\"https://www.jianshu.com/p/061f734af3e9\" target=\"_blank\" rel=\"noopener\">ScrollView  ListView </a></p>\n</li>\n<li><p><strong> View <em><u> View </u></em><u><em></em></u> MeasureSpec.EXACTLY</strong></p>\n</li>\n<li><p><strong> View  match_parent  specMode  specMode</strong><em><u> EXACTLY AT_MOST</u></em><strong> specSize  size</strong></p>\n</li>\n<li><p><strong> View  wrap_content  specMode  AT_MOSTspecSize  size</strong></p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h4 id=\"-EXACTLY\"><a href=\"#-EXACTLY\" class=\"headerlink\" title=\" EXACTLY\"></a> EXACTLY</h4><ol>\n<li><p>ViewGroup: match_parent, Child: 500dp x 500dp</p>\n</li>\n<li><p>ViewGroup: 300dp x 300dp, Child: 500dp x 500dp</p>\n<blockquote>\n<p></p>\n<p> View </p>\n</blockquote>\n<pre><code class=\"java\">// \n&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;300dp&quot;\n        android:layout_height=&quot;300dp&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180646.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: match_parent, child: match_parent</p>\n<blockquote>\n<p> MeasureSpec.EXACTLY</p>\n</blockquote>\n<pre><code class=\"JAVA\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180825.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: match_parent, child: wrap_content</p>\n<blockquote>\n<p></p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410180934.png\" alt=\"\"></p>\n</li>\n</ol>\n<h4 id=\"-WRAP-CONTENT\"><a href=\"#-WRAP-CONTENT\" class=\"headerlink\" title=\" WRAP_CONTENT\"></a> WRAP_CONTENT</h4><ol>\n<li><p>ViewGroup: wrap_content, child: match_parent</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181341.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: wrap_content, child: 300dp x 300dp</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> View </p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;300dp&quot;\n        android:layout_height=&quot;300dp&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181429.png\" alt=\"\"></p>\n</li>\n<li><p>ViewGroup: wrap_content, child: wrap_content</p>\n<blockquote>\n<p> AT_MOST</p>\n<p> AT_MOST</p>\n</blockquote>\n<pre><code class=\"java\">&lt;com.ljt.rvanalysis.spec.MyLinearLayout\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:orientation=&quot;vertical&quot;&gt;\n\n    &lt;com.ljt.rvanalysis.spec.MyTextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/com.ljt.rvanalysis.spec.MyLinearLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190410181519.png\" alt=\"\"></p>\n</li>\n</ol>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181408.jpg","title":"Java ","date":"2018-08-24T16:00:00.000Z","_content":"\n> Efficient.Android.Threading \n\n<!--more-->\n\n Android \n\n-  Java \n- \n- \n\n### \n\n `thread`  CPU  `task`\n\n#### \n\nAndroid  `java.lang.Thread`\n\n `java.lang.Runnable`  `run` \n\n```java\nprivate class MyTask implements Runnable { \n    public void run() {\n        //  run \n\t\tint i = 0; \n    }\n}\n```\n\n Thread \n\n```java\nThread thread = new Thread(new MyTask());\nthread.start();\n```\n\n `thread local data`  Java \n\n CPU  CPU  CPU ` scheduler` Java  `priority`  5 1-8 \n\nJava \n\n `context switch` CPU \n\n C \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182552.jpg)\n\n#### \n\n\n\n\n\n#### \n\n\n\n##### \n\n\n\n##### \n\n\n\n\n\n##### \n\n\n\n( `atomic region`Java\n\n  `atomic region` `synchronized`  \n\n```java\nsynchronized (this) { \n    sharedResource++;\n}\n```\n\n\n\n\n\n### \n\n\n\nAndroid \n\n- \n\n  `synchronized` \n\n- \n\n  `java.util.concurrent.locks.ReentrantLock`\n  `java.util.concurrent.locks.ReentrantReadWriteLock`\n\n\n#### Java\n\n`synchronized`  Java \n\n\n\n1.  `Blocked`\n\n   \n\n2.  `Executing`\n\n   \n\n3.  `Waiting`\n\n   \n\n![Java](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182549.jpg)\n\n\n\n1. `Enter the monitor`\n\n    Java \n\n2. `Acquire the lock`\n\n   \n\n3. `Release the lock and wait`\n\n    `Object.wait()` \n\n4. `Acquire the lock after signal`\n\n    `Object.notify()`  `Objecct.notifyAll()` \n\n5. `Release the lock and exit the monitor`\n\n   \n\n\n\n\n\n```java\n// (1) \nsynchronized (this) { \n    // Execute code (2) \n    wait(); // (3)\n\t// Execute code (4)\n} \n// (5)\n```\n\n#### \n\n\n\n##### \n\n`synchronized` \n\n- \n\n  ```java\n  synchronized void changeState() { \n      sharedResource++;\n  }\n  ```\n\n- \n\n  ```java\n  void changeState() { \n      synchronized(this) {\n      \tsharedResource++;\n      }\n  }\n  ```\n\n- \n\n  ```java\n  private final Object mLock = new Object();\n  void changeState() { \n      synchronized(mLock) {\n      \tsharedResource++;\n      } \n  }\n  ```\n\n- \n\n  ```java\n  synchronized static void changeState() { \n      staticSharedResource++;\n  }\n  ```\n\n- \n\n  ```java\n  static void changeState() { \n      synchronized(this.getClass()) {\n      \tstaticSharedResource++;\n      }\n  }\n  ```\n\n this  `synchronized` \n\n Class \n\n##### \n\n`ReentrantLock`  `ReentrantReadWriteLock`  `synchronized` \n\n```java\n// ReentrantLock \nint sharedResource;\nprivate ReentrantLock mLock = new ReentrantLock();\n\npublic void changeState(){\n    mLock.lock();\n    try{\n        sharedResource ++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n```\n\n`ReentrantLock`  `synchronized` synchronized  ReentrantLock \n\n`ReentrantReadWriteLock` \n\n```java\n// ReentrantReadWriteLock \nint sharedResource;\nprivate ReentrantReadWriteLock mLock = new ReentrantReadWriteLock();\n\npublic void changeState() { \n    mLock.writeLock().lock(); \n    try {\n        sharedResource++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n\npublic int readState(){\n    mLock.readLock().lock();\n    try{\n        return sharedResource;\n    }\n    finally{\n        mLock.readLock().unlock();\n    }\n}\n```\n\n`ReentrantReadWriteLock`  `ReentrantLock`  `synchronized` `ReentrantReadWriteLock` `ReentrantReadWriteLock` \n\n#### \n\n\n\n`ComsumerProducer`  LinkedList \n\n```java\npublic class ConsumerProducer{\n    private LinkedList<Integer> list = new LinkedList<>();\n    private final int LIMIT = 10;\n    private Object lock = new Object();\n    \n    public void produce(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == LIMIT){\n                    lock.wait();\n                }\n                list.add(value++);\n\t\t\t\tlock.notify();\n            }\n        }\n    }\n    \n    public void consume(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == 0){\n                    lock.wait();\n                }\n                list.removeFirst();\n                lock.notify();\n            }\n        }\n    } \n}\n```\n\n list  `lock.notify()` \n\n```java\nfinal ConsumerProducer cp = new ConsumerProducer();\n\n// producer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.produce();\n    }\n}).start();\n\n// consumer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.consume();\n    }\n}).start();\n```\n\n\n\n#### \n\n\n\n1. \n2. \n\n\n\n1. \n\n   \n\n2. \n\n    CPU \n\n\n\n##### \n\n- \n- \n\n\n\n#### \n\nAndroid\n\n","source":"_posts/Efficient-Android-Threading-chapter-2.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181408.jpg\ntitle: Java \ntags: [, Efficient.Android.Threading]\ndate: 2018-08-25\n---\n\n> Efficient.Android.Threading \n\n<!--more-->\n\n Android \n\n-  Java \n- \n- \n\n### \n\n `thread`  CPU  `task`\n\n#### \n\nAndroid  `java.lang.Thread`\n\n `java.lang.Runnable`  `run` \n\n```java\nprivate class MyTask implements Runnable { \n    public void run() {\n        //  run \n\t\tint i = 0; \n    }\n}\n```\n\n Thread \n\n```java\nThread thread = new Thread(new MyTask());\nthread.start();\n```\n\n `thread local data`  Java \n\n CPU  CPU  CPU ` scheduler` Java  `priority`  5 1-8 \n\nJava \n\n `context switch` CPU \n\n C \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182552.jpg)\n\n#### \n\n\n\n\n\n#### \n\n\n\n##### \n\n\n\n##### \n\n\n\n\n\n##### \n\n\n\n( `atomic region`Java\n\n  `atomic region` `synchronized`  \n\n```java\nsynchronized (this) { \n    sharedResource++;\n}\n```\n\n\n\n\n\n### \n\n\n\nAndroid \n\n- \n\n  `synchronized` \n\n- \n\n  `java.util.concurrent.locks.ReentrantLock`\n  `java.util.concurrent.locks.ReentrantReadWriteLock`\n\n\n#### Java\n\n`synchronized`  Java \n\n\n\n1.  `Blocked`\n\n   \n\n2.  `Executing`\n\n   \n\n3.  `Waiting`\n\n   \n\n![Java](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182549.jpg)\n\n\n\n1. `Enter the monitor`\n\n    Java \n\n2. `Acquire the lock`\n\n   \n\n3. `Release the lock and wait`\n\n    `Object.wait()` \n\n4. `Acquire the lock after signal`\n\n    `Object.notify()`  `Objecct.notifyAll()` \n\n5. `Release the lock and exit the monitor`\n\n   \n\n\n\n\n\n```java\n// (1) \nsynchronized (this) { \n    // Execute code (2) \n    wait(); // (3)\n\t// Execute code (4)\n} \n// (5)\n```\n\n#### \n\n\n\n##### \n\n`synchronized` \n\n- \n\n  ```java\n  synchronized void changeState() { \n      sharedResource++;\n  }\n  ```\n\n- \n\n  ```java\n  void changeState() { \n      synchronized(this) {\n      \tsharedResource++;\n      }\n  }\n  ```\n\n- \n\n  ```java\n  private final Object mLock = new Object();\n  void changeState() { \n      synchronized(mLock) {\n      \tsharedResource++;\n      } \n  }\n  ```\n\n- \n\n  ```java\n  synchronized static void changeState() { \n      staticSharedResource++;\n  }\n  ```\n\n- \n\n  ```java\n  static void changeState() { \n      synchronized(this.getClass()) {\n      \tstaticSharedResource++;\n      }\n  }\n  ```\n\n this  `synchronized` \n\n Class \n\n##### \n\n`ReentrantLock`  `ReentrantReadWriteLock`  `synchronized` \n\n```java\n// ReentrantLock \nint sharedResource;\nprivate ReentrantLock mLock = new ReentrantLock();\n\npublic void changeState(){\n    mLock.lock();\n    try{\n        sharedResource ++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n```\n\n`ReentrantLock`  `synchronized` synchronized  ReentrantLock \n\n`ReentrantReadWriteLock` \n\n```java\n// ReentrantReadWriteLock \nint sharedResource;\nprivate ReentrantReadWriteLock mLock = new ReentrantReadWriteLock();\n\npublic void changeState() { \n    mLock.writeLock().lock(); \n    try {\n        sharedResource++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n\npublic int readState(){\n    mLock.readLock().lock();\n    try{\n        return sharedResource;\n    }\n    finally{\n        mLock.readLock().unlock();\n    }\n}\n```\n\n`ReentrantReadWriteLock`  `ReentrantLock`  `synchronized` `ReentrantReadWriteLock` `ReentrantReadWriteLock` \n\n#### \n\n\n\n`ComsumerProducer`  LinkedList \n\n```java\npublic class ConsumerProducer{\n    private LinkedList<Integer> list = new LinkedList<>();\n    private final int LIMIT = 10;\n    private Object lock = new Object();\n    \n    public void produce(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == LIMIT){\n                    lock.wait();\n                }\n                list.add(value++);\n\t\t\t\tlock.notify();\n            }\n        }\n    }\n    \n    public void consume(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == 0){\n                    lock.wait();\n                }\n                list.removeFirst();\n                lock.notify();\n            }\n        }\n    } \n}\n```\n\n list  `lock.notify()` \n\n```java\nfinal ConsumerProducer cp = new ConsumerProducer();\n\n// producer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.produce();\n    }\n}).start();\n\n// consumer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.consume();\n    }\n}).start();\n```\n\n\n\n#### \n\n\n\n1. \n2. \n\n\n\n1. \n\n   \n\n2. \n\n    CPU \n\n\n\n##### \n\n- \n- \n\n\n\n#### \n\nAndroid\n\n","slug":"Efficient-Android-Threading-chapter-2","published":1,"updated":"2019-03-21T10:51:40.270Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dh0013lh1pkq0tk3hu","content":"<blockquote>\n<p>Efficient.Android.Threading </p>\n</blockquote>\n<a id=\"more\"></a>\n<p> Android </p>\n<ul>\n<li> Java </li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>thread</code>  CPU  <code>task</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Android  <code>java.lang.Thread</code></p>\n<p> <code>java.lang.Runnable</code>  <code>run</code> </p>\n<pre><code class=\"java\">private class MyTask implements Runnable { \n    public void run() {\n        //  run \n        int i = 0; \n    }\n}\n</code></pre>\n<p> Thread </p>\n<pre><code class=\"java\">Thread thread = new Thread(new MyTask());\nthread.start();\n</code></pre>\n<p> <code>thread local data</code>  Java </p>\n<p> CPU  CPU  CPU <code>scheduler</code> Java  <code>priority</code>  5 1-8 </p>\n<p>Java </p>\n<p> <code>context switch</code> CPU </p>\n<p> C </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182552.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p>( <code>atomic region</code>Java</p>\n<p>  <code>atomic region</code> <code>synchronized</code>  </p>\n<pre><code class=\"java\">synchronized (this) { \n    sharedResource++;\n}\n</code></pre>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>Android </p>\n<ul>\n<li><p></p>\n<p><code>synchronized</code> </p>\n</li>\n<li><p></p>\n<p><code>java.util.concurrent.locks.ReentrantLock</code><br><code>java.util.concurrent.locks.ReentrantReadWriteLock</code></p>\n</li>\n</ul>\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p><code>synchronized</code>  Java </p>\n<p></p>\n<ol>\n<li><p> <code>Blocked</code></p>\n<p></p>\n</li>\n<li><p> <code>Executing</code></p>\n<p></p>\n</li>\n<li><p> <code>Waiting</code></p>\n<p></p>\n</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182549.jpg\" alt=\"Java\"></p>\n<p></p>\n<ol>\n<li><p><code>Enter the monitor</code></p>\n<p> Java </p>\n</li>\n<li><p><code>Acquire the lock</code></p>\n<p></p>\n</li>\n<li><p><code>Release the lock and wait</code></p>\n<p> <code>Object.wait()</code> </p>\n</li>\n<li><p><code>Acquire the lock after signal</code></p>\n<p> <code>Object.notify()</code>  <code>Objecct.notifyAll()</code> </p>\n</li>\n<li><p><code>Release the lock and exit the monitor</code></p>\n<p></p>\n</li>\n</ol>\n<p></p>\n<pre><code class=\"java\">// (1) \nsynchronized (this) { \n    // Execute code (2) \n    wait(); // (3)\n    // Execute code (4)\n} \n// (5)\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>synchronized</code> </p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">synchronized void changeState() { \n    sharedResource++;\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">void changeState() { \n    synchronized(this) {\n        sharedResource++;\n    }\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">private final Object mLock = new Object();\nvoid changeState() { \n    synchronized(mLock) {\n        sharedResource++;\n    } \n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">synchronized static void changeState() { \n    staticSharedResource++;\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">static void changeState() { \n    synchronized(this.getClass()) {\n        staticSharedResource++;\n    }\n}\n</code></pre>\n</li>\n</ul>\n<p> this  <code>synchronized</code> </p>\n<p> Class </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>ReentrantLock</code>  <code>ReentrantReadWriteLock</code>  <code>synchronized</code> </p>\n<pre><code class=\"java\">// ReentrantLock \nint sharedResource;\nprivate ReentrantLock mLock = new ReentrantLock();\n\npublic void changeState(){\n    mLock.lock();\n    try{\n        sharedResource ++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n</code></pre>\n<p><code>ReentrantLock</code>  <code>synchronized</code> synchronized  ReentrantLock </p>\n<p><code>ReentrantReadWriteLock</code> </p>\n<pre><code class=\"java\">// ReentrantReadWriteLock \nint sharedResource;\nprivate ReentrantReadWriteLock mLock = new ReentrantReadWriteLock();\n\npublic void changeState() { \n    mLock.writeLock().lock(); \n    try {\n        sharedResource++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n\npublic int readState(){\n    mLock.readLock().lock();\n    try{\n        return sharedResource;\n    }\n    finally{\n        mLock.readLock().unlock();\n    }\n}\n</code></pre>\n<p><code>ReentrantReadWriteLock</code>  <code>ReentrantLock</code>  <code>synchronized</code> <code>ReentrantReadWriteLock</code> <code>ReentrantReadWriteLock</code> </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><code>ComsumerProducer</code>  LinkedList </p>\n<pre><code class=\"java\">public class ConsumerProducer{\n    private LinkedList&lt;Integer&gt; list = new LinkedList&lt;&gt;();\n    private final int LIMIT = 10;\n    private Object lock = new Object();\n\n    public void produce(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == LIMIT){\n                    lock.wait();\n                }\n                list.add(value++);\n                lock.notify();\n            }\n        }\n    }\n\n    public void consume(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == 0){\n                    lock.wait();\n                }\n                list.removeFirst();\n                lock.notify();\n            }\n        }\n    } \n}\n</code></pre>\n<p> list  <code>lock.notify()</code> </p>\n<pre><code class=\"java\">final ConsumerProducer cp = new ConsumerProducer();\n\n// producer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.produce();\n    }\n}).start();\n\n// consumer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.consume();\n    }\n}).start();\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<ol>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p> CPU </p>\n</li>\n</ol>\n<p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><ul>\n<li></li>\n<li></li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Android</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>Efficient.Android.Threading </p>\n</blockquote>","more":"<p> Android </p>\n<ul>\n<li> Java </li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>thread</code>  CPU  <code>task</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Android  <code>java.lang.Thread</code></p>\n<p> <code>java.lang.Runnable</code>  <code>run</code> </p>\n<pre><code class=\"java\">private class MyTask implements Runnable { \n    public void run() {\n        //  run \n        int i = 0; \n    }\n}\n</code></pre>\n<p> Thread </p>\n<pre><code class=\"java\">Thread thread = new Thread(new MyTask());\nthread.start();\n</code></pre>\n<p> <code>thread local data</code>  Java </p>\n<p> CPU  CPU  CPU <code>scheduler</code> Java  <code>priority</code>  5 1-8 </p>\n<p>Java </p>\n<p> <code>context switch</code> CPU </p>\n<p> C </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182552.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p>( <code>atomic region</code>Java</p>\n<p>  <code>atomic region</code> <code>synchronized</code>  </p>\n<pre><code class=\"java\">synchronized (this) { \n    sharedResource++;\n}\n</code></pre>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>Android </p>\n<ul>\n<li><p></p>\n<p><code>synchronized</code> </p>\n</li>\n<li><p></p>\n<p><code>java.util.concurrent.locks.ReentrantLock</code><br><code>java.util.concurrent.locks.ReentrantReadWriteLock</code></p>\n</li>\n</ul>\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p><code>synchronized</code>  Java </p>\n<p></p>\n<ol>\n<li><p> <code>Blocked</code></p>\n<p></p>\n</li>\n<li><p> <code>Executing</code></p>\n<p></p>\n</li>\n<li><p> <code>Waiting</code></p>\n<p></p>\n</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182549.jpg\" alt=\"Java\"></p>\n<p></p>\n<ol>\n<li><p><code>Enter the monitor</code></p>\n<p> Java </p>\n</li>\n<li><p><code>Acquire the lock</code></p>\n<p></p>\n</li>\n<li><p><code>Release the lock and wait</code></p>\n<p> <code>Object.wait()</code> </p>\n</li>\n<li><p><code>Acquire the lock after signal</code></p>\n<p> <code>Object.notify()</code>  <code>Objecct.notifyAll()</code> </p>\n</li>\n<li><p><code>Release the lock and exit the monitor</code></p>\n<p></p>\n</li>\n</ol>\n<p></p>\n<pre><code class=\"java\">// (1) \nsynchronized (this) { \n    // Execute code (2) \n    wait(); // (3)\n    // Execute code (4)\n} \n// (5)\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>synchronized</code> </p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">synchronized void changeState() { \n    sharedResource++;\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">void changeState() { \n    synchronized(this) {\n        sharedResource++;\n    }\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">private final Object mLock = new Object();\nvoid changeState() { \n    synchronized(mLock) {\n        sharedResource++;\n    } \n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">synchronized static void changeState() { \n    staticSharedResource++;\n}\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">static void changeState() { \n    synchronized(this.getClass()) {\n        staticSharedResource++;\n    }\n}\n</code></pre>\n</li>\n</ul>\n<p> this  <code>synchronized</code> </p>\n<p> Class </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>ReentrantLock</code>  <code>ReentrantReadWriteLock</code>  <code>synchronized</code> </p>\n<pre><code class=\"java\">// ReentrantLock \nint sharedResource;\nprivate ReentrantLock mLock = new ReentrantLock();\n\npublic void changeState(){\n    mLock.lock();\n    try{\n        sharedResource ++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n</code></pre>\n<p><code>ReentrantLock</code>  <code>synchronized</code> synchronized  ReentrantLock </p>\n<p><code>ReentrantReadWriteLock</code> </p>\n<pre><code class=\"java\">// ReentrantReadWriteLock \nint sharedResource;\nprivate ReentrantReadWriteLock mLock = new ReentrantReadWriteLock();\n\npublic void changeState() { \n    mLock.writeLock().lock(); \n    try {\n        sharedResource++;\n    }\n    finally{\n        mLock.unlock();\n    }\n}\n\npublic int readState(){\n    mLock.readLock().lock();\n    try{\n        return sharedResource;\n    }\n    finally{\n        mLock.readLock().unlock();\n    }\n}\n</code></pre>\n<p><code>ReentrantReadWriteLock</code>  <code>ReentrantLock</code>  <code>synchronized</code> <code>ReentrantReadWriteLock</code> <code>ReentrantReadWriteLock</code> </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><code>ComsumerProducer</code>  LinkedList </p>\n<pre><code class=\"java\">public class ConsumerProducer{\n    private LinkedList&lt;Integer&gt; list = new LinkedList&lt;&gt;();\n    private final int LIMIT = 10;\n    private Object lock = new Object();\n\n    public void produce(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == LIMIT){\n                    lock.wait();\n                }\n                list.add(value++);\n                lock.notify();\n            }\n        }\n    }\n\n    public void consume(){\n        int value = 0;\n        while(true){\n            synchronized(lock){\n                while(list.size() == 0){\n                    lock.wait();\n                }\n                list.removeFirst();\n                lock.notify();\n            }\n        }\n    } \n}\n</code></pre>\n<p> list  <code>lock.notify()</code> </p>\n<pre><code class=\"java\">final ConsumerProducer cp = new ConsumerProducer();\n\n// producer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.produce();\n    }\n}).start();\n\n// consumer\nnew Thread(new Runnable(){\n    @Override\n    public void run(){\n        cp.consume();\n    }\n}).start();\n</code></pre>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<ol>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p> CPU </p>\n</li>\n</ol>\n<p></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><ul>\n<li></li>\n<li></li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Android</p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg","title":" ","date":"2018-09-08T16:00:00.000Z","_content":"\n> Efficient.Android.Threading  \n\n<!--more-->\n\n Android  Java  Android  Handler / Looper \n\n- \n- \n-  `BlockingQueue` \n- \n-  UI \n\n### \n\n `Pipes`  `java.io`  Java  Android \n\nJava  Unix  `|` Java  Unix \n\n\n\n![Pipes](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182548.jpg)\n\n UI \n\n `PipedOutputStream`  `PipedInputStream`  `PipedWriter`  `PipedReader` \n\n#### \n\n\n\n```java\n// 1. - \nint BUFFER_SIZE_IN_CHARS = 1024 * 4; //  1024\nPipedReader r = new PipedReader(BUFFER_SIZE_IN_CHARS);\nPipedWriter w = new PipedWriter();\nw.connect(r); // r.connect(w);\n\n// 2., \nThread t = new MyReaderThread(r);\nt.start();\n\n// 3. \n// -\n//  write() \n//  read() \n// flush() \n//  read()  wait() \n// flush()  notify()\nw.write('A');\nw.flush();\n\nint i; //  int \nwhile((i = r.read()) != -1){\n    char c = (char)i;\n}\n\n// 4. \n//  writer, \n//  reader, \nw.close();\nr.close();\n```\n\n####  Android \n\n EditText  UI \n\n```java\nprivate static class TextHandlerTask implements Runnable {\n\tprivate final PipedReader reader;\n\tprivate TextHandlerTask(PipedReader reader) {\n    \tthis.reader = reader;\n    }\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            int i;\n            try {\n                while ((i = reader.read()) != -1) {\n                    char c = (char) i;\n                    Log.e(\"Test\", \"char -> \" + c);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nprivate PipedReader r = new PipedReader();\nprivate PipedWriter w = new PipedWriter();\nw.connect(r);\n\netSearch.addTextChangedListener(new TextWatcher() {\n\n    @Override\n    public void onTextChanged(CharSequence s, int start, int before, int count) {\n        if (count > before) { // \n            try {\n                w.write(s.subSequence(before, count).toString());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n});\n\nnew Thread(new TextHandlerTask(r)).start();\n\n```\n\n### \n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg)\n\n``````\n\n``\n\n#### \n\nJava \n\n![Thread signal](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182553.jpg)\n\n wait() / await() timeout \n\n notify() / notifyAll() \n\n``\n\n```java\nsynchronized(this){\n    while(isConditionFulfilled == false){\n\t\twait();\n    }\n    // \n}\n```\n\n\n\n Android  UI  Android \n\n### \n\nJava \n\n`java.util.concurrent.BlockingQueue`\n\n![BlockingQueue](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg)\n\n put()  take() \n\n```java\npublic class ConsumerProducer{\n    private final int LIMIT = 10;\n    private BlockingQueue<Integer> blockingQueue = \n        new LinkedBlockingQueue<Integer>(LIMIT);\n    \n    public void produce() throws InterruptedException{\n        int value = 0;\n        while(true){\n            blockingQueue.put(value++);\n        }\n    }\n    \n    public void consume() throws InterruptedException{\n        while(true){\n            int value = blockingQueue.take();\n        }\n    }\n    \n}\n```\n\n\n Android ~","source":"_posts/Efficient-Android-Threading-chapter-4-1.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg\ntitle:  \ntags: [, Efficient.Android.Threading]\ndate: 2018-09-09\n---\n\n> Efficient.Android.Threading  \n\n<!--more-->\n\n Android  Java  Android  Handler / Looper \n\n- \n- \n-  `BlockingQueue` \n- \n-  UI \n\n### \n\n `Pipes`  `java.io`  Java  Android \n\nJava  Unix  `|` Java  Unix \n\n\n\n![Pipes](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182548.jpg)\n\n UI \n\n `PipedOutputStream`  `PipedInputStream`  `PipedWriter`  `PipedReader` \n\n#### \n\n\n\n```java\n// 1. - \nint BUFFER_SIZE_IN_CHARS = 1024 * 4; //  1024\nPipedReader r = new PipedReader(BUFFER_SIZE_IN_CHARS);\nPipedWriter w = new PipedWriter();\nw.connect(r); // r.connect(w);\n\n// 2., \nThread t = new MyReaderThread(r);\nt.start();\n\n// 3. \n// -\n//  write() \n//  read() \n// flush() \n//  read()  wait() \n// flush()  notify()\nw.write('A');\nw.flush();\n\nint i; //  int \nwhile((i = r.read()) != -1){\n    char c = (char)i;\n}\n\n// 4. \n//  writer, \n//  reader, \nw.close();\nr.close();\n```\n\n####  Android \n\n EditText  UI \n\n```java\nprivate static class TextHandlerTask implements Runnable {\n\tprivate final PipedReader reader;\n\tprivate TextHandlerTask(PipedReader reader) {\n    \tthis.reader = reader;\n    }\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            int i;\n            try {\n                while ((i = reader.read()) != -1) {\n                    char c = (char) i;\n                    Log.e(\"Test\", \"char -> \" + c);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nprivate PipedReader r = new PipedReader();\nprivate PipedWriter w = new PipedWriter();\nw.connect(r);\n\netSearch.addTextChangedListener(new TextWatcher() {\n\n    @Override\n    public void onTextChanged(CharSequence s, int start, int before, int count) {\n        if (count > before) { // \n            try {\n                w.write(s.subSequence(before, count).toString());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n});\n\nnew Thread(new TextHandlerTask(r)).start();\n\n```\n\n### \n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg)\n\n``````\n\n``\n\n#### \n\nJava \n\n![Thread signal](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182553.jpg)\n\n wait() / await() timeout \n\n notify() / notifyAll() \n\n``\n\n```java\nsynchronized(this){\n    while(isConditionFulfilled == false){\n\t\twait();\n    }\n    // \n}\n```\n\n\n\n Android  UI  Android \n\n### \n\nJava \n\n`java.util.concurrent.BlockingQueue`\n\n![BlockingQueue](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg)\n\n put()  take() \n\n```java\npublic class ConsumerProducer{\n    private final int LIMIT = 10;\n    private BlockingQueue<Integer> blockingQueue = \n        new LinkedBlockingQueue<Integer>(LIMIT);\n    \n    public void produce() throws InterruptedException{\n        int value = 0;\n        while(true){\n            blockingQueue.put(value++);\n        }\n    }\n    \n    public void consume() throws InterruptedException{\n        while(true){\n            int value = blockingQueue.take();\n        }\n    }\n    \n}\n```\n\n\n Android ~","slug":"Efficient-Android-Threading-chapter-4-1","published":1,"updated":"2019-03-21T10:47:26.820Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86di0015lh1pu5edl6e8","content":"<blockquote>\n<p>Efficient.Android.Threading  </p>\n</blockquote>\n<a id=\"more\"></a>\n<p> Android  Java  Android  Handler / Looper </p>\n<ul>\n<li></li>\n<li></li>\n<li> <code>BlockingQueue</code> </li>\n<li></li>\n<li> UI </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>Pipes</code>  <code>java.io</code>  Java  Android </p>\n<p>Java  Unix  <code>|</code> Java  Unix </p>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182548.jpg\" alt=\"Pipes\"></p>\n<p> UI </p>\n<p> <code>PipedOutputStream</code>  <code>PipedInputStream</code>  <code>PipedWriter</code>  <code>PipedReader</code> </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">// 1. - \nint BUFFER_SIZE_IN_CHARS = 1024 * 4; //  1024\nPipedReader r = new PipedReader(BUFFER_SIZE_IN_CHARS);\nPipedWriter w = new PipedWriter();\nw.connect(r); // r.connect(w);\n\n// 2., \nThread t = new MyReaderThread(r);\nt.start();\n\n// 3. \n// -\n//  write() \n//  read() \n// flush() \n//  read()  wait() \n// flush()  notify()\nw.write(&#39;A&#39;);\nw.flush();\n\nint i; //  int \nwhile((i = r.read()) != -1){\n    char c = (char)i;\n}\n\n// 4. \n//  writer, \n//  reader, \nw.close();\nr.close();\n</code></pre>\n<h4 id=\"-Android-\"><a href=\"#-Android-\" class=\"headerlink\" title=\" Android \"></a> Android </h4><p> EditText  UI </p>\n<pre><code class=\"java\">private static class TextHandlerTask implements Runnable {\n    private final PipedReader reader;\n    private TextHandlerTask(PipedReader reader) {\n        this.reader = reader;\n    }\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            int i;\n            try {\n                while ((i = reader.read()) != -1) {\n                    char c = (char) i;\n                    Log.e(&quot;Test&quot;, &quot;char -&gt; &quot; + c);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nprivate PipedReader r = new PipedReader();\nprivate PipedWriter w = new PipedWriter();\nw.connect(r);\n\netSearch.addTextChangedListener(new TextWatcher() {\n\n    @Override\n    public void onTextChanged(CharSequence s, int start, int before, int count) {\n        if (count &gt; before) { // \n            try {\n                w.write(s.subSequence(before, count).toString());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n});\n\nnew Thread(new TextHandlerTask(r)).start();\n\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg\" alt=\"\"></p>\n<p><code></code><code></code><code></code></p>\n<p><code></code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Java </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182553.jpg\" alt=\"Thread signal\"></p>\n<p> wait() / await() timeout </p>\n<p> notify() / notifyAll() </p>\n<p><code></code></p>\n<pre><code class=\"java\">synchronized(this){\n    while(isConditionFulfilled == false){\n        wait();\n    }\n    // \n}\n</code></pre>\n<p></p>\n<p> Android  UI  Android </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Java </p>\n<p><code>java.util.concurrent.BlockingQueue</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg\" alt=\"BlockingQueue\"></p>\n<p> put()  take() </p>\n<pre><code class=\"java\">public class ConsumerProducer{\n    private final int LIMIT = 10;\n    private BlockingQueue&lt;Integer&gt; blockingQueue = \n        new LinkedBlockingQueue&lt;Integer&gt;(LIMIT);\n\n    public void produce() throws InterruptedException{\n        int value = 0;\n        while(true){\n            blockingQueue.put(value++);\n        }\n    }\n\n    public void consume() throws InterruptedException{\n        while(true){\n            int value = blockingQueue.take();\n        }\n    }\n\n}\n</code></pre>\n<p></p>\n<p> Android ~</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>Efficient.Android.Threading  </p>\n</blockquote>","more":"<p> Android  Java  Android  Handler / Looper </p>\n<ul>\n<li></li>\n<li></li>\n<li> <code>BlockingQueue</code> </li>\n<li></li>\n<li> UI </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>Pipes</code>  <code>java.io</code>  Java  Android </p>\n<p>Java  Unix  <code>|</code> Java  Unix </p>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182548.jpg\" alt=\"Pipes\"></p>\n<p> UI </p>\n<p> <code>PipedOutputStream</code>  <code>PipedInputStream</code>  <code>PipedWriter</code>  <code>PipedReader</code> </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<pre><code class=\"java\">// 1. - \nint BUFFER_SIZE_IN_CHARS = 1024 * 4; //  1024\nPipedReader r = new PipedReader(BUFFER_SIZE_IN_CHARS);\nPipedWriter w = new PipedWriter();\nw.connect(r); // r.connect(w);\n\n// 2., \nThread t = new MyReaderThread(r);\nt.start();\n\n// 3. \n// -\n//  write() \n//  read() \n// flush() \n//  read()  wait() \n// flush()  notify()\nw.write(&#39;A&#39;);\nw.flush();\n\nint i; //  int \nwhile((i = r.read()) != -1){\n    char c = (char)i;\n}\n\n// 4. \n//  writer, \n//  reader, \nw.close();\nr.close();\n</code></pre>\n<h4 id=\"-Android-\"><a href=\"#-Android-\" class=\"headerlink\" title=\" Android \"></a> Android </h4><p> EditText  UI </p>\n<pre><code class=\"java\">private static class TextHandlerTask implements Runnable {\n    private final PipedReader reader;\n    private TextHandlerTask(PipedReader reader) {\n        this.reader = reader;\n    }\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            int i;\n            try {\n                while ((i = reader.read()) != -1) {\n                    char c = (char) i;\n                    Log.e(&quot;Test&quot;, &quot;char -&gt; &quot; + c);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nprivate PipedReader r = new PipedReader();\nprivate PipedWriter w = new PipedWriter();\nw.connect(r);\n\netSearch.addTextChangedListener(new TextWatcher() {\n\n    @Override\n    public void onTextChanged(CharSequence s, int start, int before, int count) {\n        if (count &gt; before) { // \n            try {\n                w.write(s.subSequence(before, count).toString());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n});\n\nnew Thread(new TextHandlerTask(r)).start();\n\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg\" alt=\"\"></p>\n<p><code></code><code></code><code></code></p>\n<p><code></code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Java </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182553.jpg\" alt=\"Thread signal\"></p>\n<p> wait() / await() timeout </p>\n<p> notify() / notifyAll() </p>\n<p><code></code></p>\n<pre><code class=\"java\">synchronized(this){\n    while(isConditionFulfilled == false){\n        wait();\n    }\n    // \n}\n</code></pre>\n<p></p>\n<p> Android  UI  Android </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Java </p>\n<p><code>java.util.concurrent.BlockingQueue</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182555.jpg\" alt=\"BlockingQueue\"></p>\n<p> put()  take() </p>\n<pre><code class=\"java\">public class ConsumerProducer{\n    private final int LIMIT = 10;\n    private BlockingQueue&lt;Integer&gt; blockingQueue = \n        new LinkedBlockingQueue&lt;Integer&gt;(LIMIT);\n\n    public void produce() throws InterruptedException{\n        int value = 0;\n        while(true){\n            blockingQueue.put(value++);\n        }\n    }\n\n    public void consume() throws InterruptedException{\n        while(true){\n            int value = blockingQueue.take();\n        }\n    }\n\n}\n</code></pre>\n<p></p>\n<p> Android ~</p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321185255.png","title":"Android ","date":"2018-08-28T16:00:00.000Z","_content":"\n> Efficient.Android.Threading \n\n<!--more-->\n\n Android  Linux  Dalvik VM  UI binder \n\n-  UI binder \n- Linux thread coupling\n- \n-  Linux \n\n### Android \n\nAndroid  UI binder \n\n#### UI \n\nUI  Android UI  Android  UI  UI  Android UI Toolkit runtime  UI \n\nUI  Handler  UI \n\n#### Binder \n\nBinder Binder intents, content providers, services UI  `Service`  AIDL \n\n#### \n\n UI  UI \n\n Android UI  Linux UI  UI  Linux  Application Framework  Window Manager \n\n### Linux \n\nAndroid  Linux  Linux Android  Linux  fork  Zygote \n\n- User ID(UID)\n\n  Linux  Android  User ID\n\n- Process identifier (PID)\n\n  \n\n- Parent process identifier  (PPID)\n\n   Android  Zygote \n\n- Stack\n\n  \n\n- Heap\n\n  \n\n\n\n UI  UI UI  PID  4257 PPID  UI  PID\n\n![adb shell ps](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182600.jpg)\n\n#### \n\nLinux  Android  Linux  Dalvik \n\nLinux  `completely fair scheduler`  CFS \n\nLinux \n\n1. \n2.  Android  `control group`\n\n##### \n\n Linux  `niceness` / `nicevalue`  Android Linux  -20  19 0\n\n\n\n- java.lang.Thread\n\n```java\n// Java  0  10 \nsetPriority(int priority);\n```\n\n- android.os.Process\n\n```java\nProcess.setThreadPriority(int priority);\nProcess.setThreadPriority(int threadId, int priority);\n```\n\n##### \n\nAndroid  Linux  CFS  Linux \n\nAndroid \n\n 10% Android \n\n\n\n![](http://p5zd0id9p.bkt.clouddn.com/18-8-30/70891310.jpg)\n\n\n\n Home  cpu \n\n\n\n UI  cpu  UI  UI  UI \n\n UI  UI \n\n```java\n// \n// \nProcess.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);\n```\n\n### \n\nAndroid UIbinder Linux Posix UI  binder Android  UI  ANR  UI  UI  UI \n\n\n\n","source":"_posts/Efficient-Android-Threading-chapter-3.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321185255.png\ntitle: Android \ntags: [, Efficient.Android.Threading]\ndate: 2018-08-29\n---\n\n> Efficient.Android.Threading \n\n<!--more-->\n\n Android  Linux  Dalvik VM  UI binder \n\n-  UI binder \n- Linux thread coupling\n- \n-  Linux \n\n### Android \n\nAndroid  UI binder \n\n#### UI \n\nUI  Android UI  Android  UI  UI  Android UI Toolkit runtime  UI \n\nUI  Handler  UI \n\n#### Binder \n\nBinder Binder intents, content providers, services UI  `Service`  AIDL \n\n#### \n\n UI  UI \n\n Android UI  Linux UI  UI  Linux  Application Framework  Window Manager \n\n### Linux \n\nAndroid  Linux  Linux Android  Linux  fork  Zygote \n\n- User ID(UID)\n\n  Linux  Android  User ID\n\n- Process identifier (PID)\n\n  \n\n- Parent process identifier  (PPID)\n\n   Android  Zygote \n\n- Stack\n\n  \n\n- Heap\n\n  \n\n\n\n UI  UI UI  PID  4257 PPID  UI  PID\n\n![adb shell ps](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182600.jpg)\n\n#### \n\nLinux  Android  Linux  Dalvik \n\nLinux  `completely fair scheduler`  CFS \n\nLinux \n\n1. \n2.  Android  `control group`\n\n##### \n\n Linux  `niceness` / `nicevalue`  Android Linux  -20  19 0\n\n\n\n- java.lang.Thread\n\n```java\n// Java  0  10 \nsetPriority(int priority);\n```\n\n- android.os.Process\n\n```java\nProcess.setThreadPriority(int priority);\nProcess.setThreadPriority(int threadId, int priority);\n```\n\n##### \n\nAndroid  Linux  CFS  Linux \n\nAndroid \n\n 10% Android \n\n\n\n![](http://p5zd0id9p.bkt.clouddn.com/18-8-30/70891310.jpg)\n\n\n\n Home  cpu \n\n\n\n UI  cpu  UI  UI  UI \n\n UI  UI \n\n```java\n// \n// \nProcess.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);\n```\n\n### \n\nAndroid UIbinder Linux Posix UI  binder Android  UI  ANR  UI  UI  UI \n\n\n\n","slug":"Efficient-Android-Threading-chapter-3","published":1,"updated":"2019-03-21T10:53:39.443Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dk0017lh1p03r88n5a","content":"<blockquote>\n<p>Efficient.Android.Threading </p>\n</blockquote>\n<a id=\"more\"></a>\n<p> Android  Linux  Dalvik VM  UI binder </p>\n<ul>\n<li>UI binder </li>\n<li>Linux thread coupling</li>\n<li></li>\n<li> Linux </li>\n</ul>\n<h3 id=\"Android-\"><a href=\"#Android-\" class=\"headerlink\" title=\"Android \"></a>Android </h3><p>Android  UI binder </p>\n<h4 id=\"UI-\"><a href=\"#UI-\" class=\"headerlink\" title=\"UI \"></a>UI </h4><p>UI  Android UI  Android  UI  UI  Android UI Toolkit runtime  UI </p>\n<p>UI  Handler  UI </p>\n<h4 id=\"Binder-\"><a href=\"#Binder-\" class=\"headerlink\" title=\"Binder \"></a>Binder </h4><p>Binder Binder intents, content providers, services UI  <code>Service</code>  AIDL </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> UI  UI </p>\n<p> Android UI  Linux UI  UI  Linux  Application Framework  Window Manager </p>\n<h3 id=\"Linux-\"><a href=\"#Linux-\" class=\"headerlink\" title=\"Linux \"></a>Linux </h3><p>Android  Linux  Linux Android  Linux  fork  Zygote </p>\n<ul>\n<li><p>User ID(UID)</p>\n<p>Linux  Android  User ID</p>\n</li>\n<li><p>Process identifier (PID)</p>\n<p></p>\n</li>\n<li><p>Parent process identifier  (PPID)</p>\n<p> Android  Zygote </p>\n</li>\n<li><p>Stack</p>\n<p></p>\n</li>\n<li><p>Heap</p>\n<p></p>\n</li>\n</ul>\n<p></p>\n<p> UI  UI UI  PID  4257 PPID  UI  PID</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182600.jpg\" alt=\"adb shell ps\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Linux  Android  Linux  Dalvik </p>\n<p>Linux  <code>completely fair scheduler</code>  CFS </p>\n<p>Linux </p>\n<ol>\n<li></li>\n<li> Android  <code>control group</code></li>\n</ol>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> Linux  <code>niceness</code> / <code>nicevalue</code>  Android Linux  -20  19 0</p>\n<p></p>\n<ul>\n<li>java.lang.Thread</li>\n</ul>\n<pre><code class=\"java\">// Java  0  10 \nsetPriority(int priority);\n</code></pre>\n<ul>\n<li>android.os.Process</li>\n</ul>\n<pre><code class=\"java\">Process.setThreadPriority(int priority);\nProcess.setThreadPriority(int threadId, int priority);\n</code></pre>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Android  Linux  CFS  Linux </p>\n<p>Android </p>\n<p> 10% Android </p>\n<p></p>\n<p><img src=\"http://p5zd0id9p.bkt.clouddn.com/18-8-30/70891310.jpg\" alt=\"\"></p>\n<p></p>\n<p> Home  cpu </p>\n<p></p>\n<p> UI  cpu  UI  UI  UI </p>\n<p> UI  UI </p>\n<pre><code class=\"java\">// \n// \nProcess.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Android UIbinder Linux Posix UI  binder Android  UI  ANR  UI  UI  UI </p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>Efficient.Android.Threading </p>\n</blockquote>","more":"<p> Android  Linux  Dalvik VM  UI binder </p>\n<ul>\n<li>UI binder </li>\n<li>Linux thread coupling</li>\n<li></li>\n<li> Linux </li>\n</ul>\n<h3 id=\"Android-\"><a href=\"#Android-\" class=\"headerlink\" title=\"Android \"></a>Android </h3><p>Android  UI binder </p>\n<h4 id=\"UI-\"><a href=\"#UI-\" class=\"headerlink\" title=\"UI \"></a>UI </h4><p>UI  Android UI  Android  UI  UI  Android UI Toolkit runtime  UI </p>\n<p>UI  Handler  UI </p>\n<h4 id=\"Binder-\"><a href=\"#Binder-\" class=\"headerlink\" title=\"Binder \"></a>Binder </h4><p>Binder Binder intents, content providers, services UI  <code>Service</code>  AIDL </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> UI  UI </p>\n<p> Android UI  Linux UI  UI  Linux  Application Framework  Window Manager </p>\n<h3 id=\"Linux-\"><a href=\"#Linux-\" class=\"headerlink\" title=\"Linux \"></a>Linux </h3><p>Android  Linux  Linux Android  Linux  fork  Zygote </p>\n<ul>\n<li><p>User ID(UID)</p>\n<p>Linux  Android  User ID</p>\n</li>\n<li><p>Process identifier (PID)</p>\n<p></p>\n</li>\n<li><p>Parent process identifier  (PPID)</p>\n<p> Android  Zygote </p>\n</li>\n<li><p>Stack</p>\n<p></p>\n</li>\n<li><p>Heap</p>\n<p></p>\n</li>\n</ul>\n<p></p>\n<p> UI  UI UI  PID  4257 PPID  UI  PID</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182600.jpg\" alt=\"adb shell ps\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Linux  Android  Linux  Dalvik </p>\n<p>Linux  <code>completely fair scheduler</code>  CFS </p>\n<p>Linux </p>\n<ol>\n<li></li>\n<li> Android  <code>control group</code></li>\n</ol>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> Linux  <code>niceness</code> / <code>nicevalue</code>  Android Linux  -20  19 0</p>\n<p></p>\n<ul>\n<li>java.lang.Thread</li>\n</ul>\n<pre><code class=\"java\">// Java  0  10 \nsetPriority(int priority);\n</code></pre>\n<ul>\n<li>android.os.Process</li>\n</ul>\n<pre><code class=\"java\">Process.setThreadPriority(int priority);\nProcess.setThreadPriority(int threadId, int priority);\n</code></pre>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Android  Linux  CFS  Linux </p>\n<p>Android </p>\n<p> 10% Android </p>\n<p></p>\n<p><img src=\"http://p5zd0id9p.bkt.clouddn.com/18-8-30/70891310.jpg\" alt=\"\"></p>\n<p></p>\n<p> Home  cpu </p>\n<p></p>\n<p> UI  cpu  UI  UI  UI </p>\n<p> UI  UI </p>\n<pre><code class=\"java\">// \n// \nProcess.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Android UIbinder Linux Posix UI  binder Android  UI  ANR  UI  UI  UI </p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321184908.jpg","title":" Android  onCreate ","date":"2018-08-12T16:00:00.000Z","_content":"\n onCreate()  onResume()  View  setContentView \n\n<!--more-->\n\n\n\n```java\npublic class MainActivity extends AppCompatActivity {\n\n    @BindView(R.id.tv_test)\n    private TextView mTextView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        mTv.getHeight(); // 0\n\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        mTv.getHeight(); // 0\n    }\n\n}\n```\n\n View \n\n### setContentView()\n\n onCreate()  setContentView() ****setContentView() \n\n```java\n// 1. AppCompatDelegate  Activity \npublic abstract void setContentView(@LayoutRes int resId);\n\n// 2. Activity \npublic void setContentView(@LayoutRes int layoutResID) {\n    // Window  PhoneWindow\n    getWindow().setContentView(layoutResID);\n    initWindowDecorActionBar();\n}\n\n@Override\npublic void setContentView(int layoutResID) {\n    if (mContentParent == null) {\n        // 3.  DecorView\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n    ... ...\n}\n\nprivate void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // 4. mDecor  DecorView \n        // generateDecor(-1) : return new DecorView()\n        mDecor = generateDecor(-1);\n        ... ...\n    } else {\n        mDecor.setWindow(this);\n    }\n\n    if (mContentParent == null) {\n        // 5. \n        mContentParent = generateLayout(mDecor);\n    }\n}\n\n//  generateLayout(mDecor) \nprotected ViewGroup generateLayout(DecorView decor) {\n    // \n    TypedArray a = getWindowStyle();\n    ... ...\n\n    // \n    int layoutResource;\n    int features = getLocalFeatures();\n    if ((features & (1 << FEATURE_SWIPE_TO_DISMISS)) != 0) {\n        layoutResource = R.layout.screen_swipe_dismiss;\n        setCloseOnSwipeEnabled(true);\n    } else if ((features & (1 << FEATURE_NO_TITLE)) == 0) {\n        if (mIsFloating) {\n            TypedValue res = new TypedValue();\n            getContext().getTheme().resolveAttribute(\n                R.attr.dialogTitleDecorLayout, res, true);\n            layoutResource = res.resourceId;\n        } else if ((features & (1 << FEATURE_ACTION_BAR)) != 0) {\n            layoutResource = a.getResourceId(\n                R.styleable.Window_windowActionBarFullscreenDecorLayout,\n                R.layout.screen_action_bar);\n        } else {\n            layoutResource = R.layout.screen_title;\n        }\n    } else {\n        // \n        layoutResource = R.layout.screen_simple;\n    }\n\n    // 6.  DecorView \n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n    return contentParent;\n}\n\nvoid onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\n    // \n    final View root = inflater.inflate(layoutResource, null);\n\t... ...\n    // 7.  View  DecorView \n    addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n}\n\npublic void addView(View child, int index, LayoutParams params) {\n    // \n    //  requestLayout  View \n    requestLayout();\n    invalidate(true);\n    addViewInner(child, index, params, false);\n}\n```\n\n setContentView() \n\n View  requestLayout()  invalidate()  View  measure()  layout  draw \n\n setContentView()  View  View \n\n\n\n### \n\nsetContentView()  View  DecorView \n\n Activity \n\n```java\npublic void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: {\n            // 1. ActivityThread  H LAUNCH_ACTIVITY \n            handleLaunchActivity(r, null, \"LAUNCH_ACTIVITY\");\n        } break;\n }\n\n// 2.  ActivityThread  handleLaunchActivity() \nprivate void handleLaunchActivity(ActivityClientRecord r, Intent customIntent, String reason) {\n\n    // 3.  performLaunchActivity() \n    Activity a = performLaunchActivity(r, customIntent);\n\n    if (a != null) {\n        r.createdConfig = new Configuration(mConfiguration);\n        reportSizeConfigurations(r);\n        Bundle oldState = r.state;\n        // 4.  handleResumeActivity() \n        handleResumeActivity(r.token, false, r.isForward,\n                             !r.activity.mFinished && !r.startsNotResumed,\n                             r.lastProcessedSeq, reason);\n    }\n}\n\n// 3. performLaunchActivity()\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    //  Instrumentation  Activity \n    Activity activity = null;\n    try {\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(\n            cl, component.getClassName(), r.intent);\n        StrictMode.incrementExpectedActivityCount(activity.getClass());\n        r.intent.setExtrasClassLoader(cl);\n        r.intent.prepareToEnterProcess();\n        if (r.state != null) {\n            r.state.setClassLoader(cl);\n        }\n    }\n\n    try {\n        if (activity != null) {\n            // attach() \n            activity.attach(appContext, this, getInstrumentation(), r.token,\n                            r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                            r.embeddedID, r.lastNonConfigurationInstances, config,\n                            r.referrer, r.voiceInteractor, window, r.configCallback);\n\n            activity.mCalled = false;\n            // 3.1  Instrumentation  Activity  onCreate() \n            if (r.isPersistable()) {\n                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n            } else {\n                mInstrumentation.callActivityOnCreate(activity, r.state);\n            }\n            //  super \n            if (!activity.mCalled) {\n                throw new SuperNotCalledException(\n                    \"Activity \" + r.intent.getComponent().toShortString() +\n                    \" did not call through to super.onCreate()\");\n            }\n        }\n    }\n    return activity;\n}\n\npublic void callActivityOnCreate(Activity activity, Bundle icicle,PersistableBundle persistentState) {\n    prePerformCreate(activity);\n    // 3.2  Activity  performCreate() \n    activity.performCreate(icicle, persistentState);\n    postPerformCreate(activity);\n}\n\n// 3.3  onCreate()\nfinal void performCreate(Bundle icicle, PersistableBundle persistentState) {\n    restoreHasCurrentPermissionRequest(icicle);\n    onCreate(icicle, persistentState);\n    mActivityTransitionState.readState(icicle);\n    performCreateCommon();\n}\n\n// 4 performLaunchActivity()  handleResumeActivity()\n//  performResumeActivity() onResume()\n final void handleResumeActivity( ... ... ) {\n     //  onResume()\n     r = performResumeActivity(token, clearHide, reason);\n\n     if (r != null) {\n         final Activity a = r.activity;\n\n         if (r.window == null && !a.mFinished && willBeVisible) {\n             r.window = r.activity.getWindow();\n             View decor = r.window.getDecorView();\n             ViewManager wm = a.getWindowManager();\n             // 5.  WindowManagerImpl  addView()\n             //  WindowManagerGlobal  addView()\n             if (a.mVisibleFromClient) {\n                 if (!a.mWindowAdded) {\n                     a.mWindowAdded = true;\n                     wm.addView(decor, l);\n                 }\n             }\n         }\n     }\n }\n\npublic void addView( ... ... ) {\n     ViewRootImpl root;\n     synchronized (mLock) {\n         //  ViewRootImpl \n         root = new ViewRootImpl(view.getContext(), display);\n         try {\n             //  setView root  setView\n             //  view  DecorView \n             //  DecorView ViewRootImpl\n             root.setView(view, wparams, panelParentView);\n         }\n     }\n}\n\n// 6.  DecorView  WindowManager, View \npublic void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) {\n    //  View \n    //  setContentView()  ViewRootImpl \n    requestLayout();\n}\n\n@Override\npublic void requestLayout() {\n    if (!mHandlingLayoutInLayoutRequest) {\n        checkThread();\n        mLayoutRequested = true;\n        // 7.  post  Runnable \n        //  doTraversal() \n        //  performTraversals()  View \n        scheduleTraversals();\n    }\n}\n\nprivate void performTraversals() {\n\t... ...\n    // Ask host how big it wants to be\n    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n    ... ...\n    performLayout(lp, mWidth, mHeight);\n    ... ...\n    performDraw();\n    ... ...\n}\n```\n\n\n\nView  performTraversals()  onResume()  onCreate()  onResume()  View \n\n\n","source":"_posts/can-not-get-height-in-onCreate.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321184908.jpg\ntitle:  Android  onCreate \ntags: [Android]\ndate: 2018-08-13\n---\n\n onCreate()  onResume()  View  setContentView \n\n<!--more-->\n\n\n\n```java\npublic class MainActivity extends AppCompatActivity {\n\n    @BindView(R.id.tv_test)\n    private TextView mTextView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        mTv.getHeight(); // 0\n\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        mTv.getHeight(); // 0\n    }\n\n}\n```\n\n View \n\n### setContentView()\n\n onCreate()  setContentView() ****setContentView() \n\n```java\n// 1. AppCompatDelegate  Activity \npublic abstract void setContentView(@LayoutRes int resId);\n\n// 2. Activity \npublic void setContentView(@LayoutRes int layoutResID) {\n    // Window  PhoneWindow\n    getWindow().setContentView(layoutResID);\n    initWindowDecorActionBar();\n}\n\n@Override\npublic void setContentView(int layoutResID) {\n    if (mContentParent == null) {\n        // 3.  DecorView\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n    ... ...\n}\n\nprivate void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // 4. mDecor  DecorView \n        // generateDecor(-1) : return new DecorView()\n        mDecor = generateDecor(-1);\n        ... ...\n    } else {\n        mDecor.setWindow(this);\n    }\n\n    if (mContentParent == null) {\n        // 5. \n        mContentParent = generateLayout(mDecor);\n    }\n}\n\n//  generateLayout(mDecor) \nprotected ViewGroup generateLayout(DecorView decor) {\n    // \n    TypedArray a = getWindowStyle();\n    ... ...\n\n    // \n    int layoutResource;\n    int features = getLocalFeatures();\n    if ((features & (1 << FEATURE_SWIPE_TO_DISMISS)) != 0) {\n        layoutResource = R.layout.screen_swipe_dismiss;\n        setCloseOnSwipeEnabled(true);\n    } else if ((features & (1 << FEATURE_NO_TITLE)) == 0) {\n        if (mIsFloating) {\n            TypedValue res = new TypedValue();\n            getContext().getTheme().resolveAttribute(\n                R.attr.dialogTitleDecorLayout, res, true);\n            layoutResource = res.resourceId;\n        } else if ((features & (1 << FEATURE_ACTION_BAR)) != 0) {\n            layoutResource = a.getResourceId(\n                R.styleable.Window_windowActionBarFullscreenDecorLayout,\n                R.layout.screen_action_bar);\n        } else {\n            layoutResource = R.layout.screen_title;\n        }\n    } else {\n        // \n        layoutResource = R.layout.screen_simple;\n    }\n\n    // 6.  DecorView \n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n    return contentParent;\n}\n\nvoid onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\n    // \n    final View root = inflater.inflate(layoutResource, null);\n\t... ...\n    // 7.  View  DecorView \n    addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n}\n\npublic void addView(View child, int index, LayoutParams params) {\n    // \n    //  requestLayout  View \n    requestLayout();\n    invalidate(true);\n    addViewInner(child, index, params, false);\n}\n```\n\n setContentView() \n\n View  requestLayout()  invalidate()  View  measure()  layout  draw \n\n setContentView()  View  View \n\n\n\n### \n\nsetContentView()  View  DecorView \n\n Activity \n\n```java\npublic void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: {\n            // 1. ActivityThread  H LAUNCH_ACTIVITY \n            handleLaunchActivity(r, null, \"LAUNCH_ACTIVITY\");\n        } break;\n }\n\n// 2.  ActivityThread  handleLaunchActivity() \nprivate void handleLaunchActivity(ActivityClientRecord r, Intent customIntent, String reason) {\n\n    // 3.  performLaunchActivity() \n    Activity a = performLaunchActivity(r, customIntent);\n\n    if (a != null) {\n        r.createdConfig = new Configuration(mConfiguration);\n        reportSizeConfigurations(r);\n        Bundle oldState = r.state;\n        // 4.  handleResumeActivity() \n        handleResumeActivity(r.token, false, r.isForward,\n                             !r.activity.mFinished && !r.startsNotResumed,\n                             r.lastProcessedSeq, reason);\n    }\n}\n\n// 3. performLaunchActivity()\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    //  Instrumentation  Activity \n    Activity activity = null;\n    try {\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(\n            cl, component.getClassName(), r.intent);\n        StrictMode.incrementExpectedActivityCount(activity.getClass());\n        r.intent.setExtrasClassLoader(cl);\n        r.intent.prepareToEnterProcess();\n        if (r.state != null) {\n            r.state.setClassLoader(cl);\n        }\n    }\n\n    try {\n        if (activity != null) {\n            // attach() \n            activity.attach(appContext, this, getInstrumentation(), r.token,\n                            r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                            r.embeddedID, r.lastNonConfigurationInstances, config,\n                            r.referrer, r.voiceInteractor, window, r.configCallback);\n\n            activity.mCalled = false;\n            // 3.1  Instrumentation  Activity  onCreate() \n            if (r.isPersistable()) {\n                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n            } else {\n                mInstrumentation.callActivityOnCreate(activity, r.state);\n            }\n            //  super \n            if (!activity.mCalled) {\n                throw new SuperNotCalledException(\n                    \"Activity \" + r.intent.getComponent().toShortString() +\n                    \" did not call through to super.onCreate()\");\n            }\n        }\n    }\n    return activity;\n}\n\npublic void callActivityOnCreate(Activity activity, Bundle icicle,PersistableBundle persistentState) {\n    prePerformCreate(activity);\n    // 3.2  Activity  performCreate() \n    activity.performCreate(icicle, persistentState);\n    postPerformCreate(activity);\n}\n\n// 3.3  onCreate()\nfinal void performCreate(Bundle icicle, PersistableBundle persistentState) {\n    restoreHasCurrentPermissionRequest(icicle);\n    onCreate(icicle, persistentState);\n    mActivityTransitionState.readState(icicle);\n    performCreateCommon();\n}\n\n// 4 performLaunchActivity()  handleResumeActivity()\n//  performResumeActivity() onResume()\n final void handleResumeActivity( ... ... ) {\n     //  onResume()\n     r = performResumeActivity(token, clearHide, reason);\n\n     if (r != null) {\n         final Activity a = r.activity;\n\n         if (r.window == null && !a.mFinished && willBeVisible) {\n             r.window = r.activity.getWindow();\n             View decor = r.window.getDecorView();\n             ViewManager wm = a.getWindowManager();\n             // 5.  WindowManagerImpl  addView()\n             //  WindowManagerGlobal  addView()\n             if (a.mVisibleFromClient) {\n                 if (!a.mWindowAdded) {\n                     a.mWindowAdded = true;\n                     wm.addView(decor, l);\n                 }\n             }\n         }\n     }\n }\n\npublic void addView( ... ... ) {\n     ViewRootImpl root;\n     synchronized (mLock) {\n         //  ViewRootImpl \n         root = new ViewRootImpl(view.getContext(), display);\n         try {\n             //  setView root  setView\n             //  view  DecorView \n             //  DecorView ViewRootImpl\n             root.setView(view, wparams, panelParentView);\n         }\n     }\n}\n\n// 6.  DecorView  WindowManager, View \npublic void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) {\n    //  View \n    //  setContentView()  ViewRootImpl \n    requestLayout();\n}\n\n@Override\npublic void requestLayout() {\n    if (!mHandlingLayoutInLayoutRequest) {\n        checkThread();\n        mLayoutRequested = true;\n        // 7.  post  Runnable \n        //  doTraversal() \n        //  performTraversals()  View \n        scheduleTraversals();\n    }\n}\n\nprivate void performTraversals() {\n\t... ...\n    // Ask host how big it wants to be\n    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n    ... ...\n    performLayout(lp, mWidth, mHeight);\n    ... ...\n    performDraw();\n    ... ...\n}\n```\n\n\n\nView  performTraversals()  onResume()  onCreate()  onResume()  View \n\n\n","slug":"can-not-get-height-in-onCreate","published":1,"updated":"2019-03-21T10:50:48.542Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dl0018lh1pucv074ej","content":"<p> onCreate()  onResume()  View  setContentView </p>\n<a id=\"more\"></a>\n<p></p>\n<pre><code class=\"java\">public class MainActivity extends AppCompatActivity {\n\n    @BindView(R.id.tv_test)\n    private TextView mTextView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        mTv.getHeight(); // 0\n\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        mTv.getHeight(); // 0\n    }\n\n}\n</code></pre>\n<p> View </p>\n<h3 id=\"setContentView\"><a href=\"#setContentView\" class=\"headerlink\" title=\"setContentView()\"></a>setContentView()</h3><p> onCreate()  setContentView() <strong></strong>setContentView() </p>\n<pre><code class=\"java\">// 1. AppCompatDelegate  Activity \npublic abstract void setContentView(@LayoutRes int resId);\n\n// 2. Activity \npublic void setContentView(@LayoutRes int layoutResID) {\n    // Window  PhoneWindow\n    getWindow().setContentView(layoutResID);\n    initWindowDecorActionBar();\n}\n\n@Override\npublic void setContentView(int layoutResID) {\n    if (mContentParent == null) {\n        // 3.  DecorView\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n    ... ...\n}\n\nprivate void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // 4. mDecor  DecorView \n        // generateDecor(-1) : return new DecorView()\n        mDecor = generateDecor(-1);\n        ... ...\n    } else {\n        mDecor.setWindow(this);\n    }\n\n    if (mContentParent == null) {\n        // 5. \n        mContentParent = generateLayout(mDecor);\n    }\n}\n\n//  generateLayout(mDecor) \nprotected ViewGroup generateLayout(DecorView decor) {\n    // \n    TypedArray a = getWindowStyle();\n    ... ...\n\n    // \n    int layoutResource;\n    int features = getLocalFeatures();\n    if ((features &amp; (1 &lt;&lt; FEATURE_SWIPE_TO_DISMISS)) != 0) {\n        layoutResource = R.layout.screen_swipe_dismiss;\n        setCloseOnSwipeEnabled(true);\n    } else if ((features &amp; (1 &lt;&lt; FEATURE_NO_TITLE)) == 0) {\n        if (mIsFloating) {\n            TypedValue res = new TypedValue();\n            getContext().getTheme().resolveAttribute(\n                R.attr.dialogTitleDecorLayout, res, true);\n            layoutResource = res.resourceId;\n        } else if ((features &amp; (1 &lt;&lt; FEATURE_ACTION_BAR)) != 0) {\n            layoutResource = a.getResourceId(\n                R.styleable.Window_windowActionBarFullscreenDecorLayout,\n                R.layout.screen_action_bar);\n        } else {\n            layoutResource = R.layout.screen_title;\n        }\n    } else {\n        // \n        layoutResource = R.layout.screen_simple;\n    }\n\n    // 6.  DecorView \n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n    return contentParent;\n}\n\nvoid onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\n    // \n    final View root = inflater.inflate(layoutResource, null);\n    ... ...\n    // 7.  View  DecorView \n    addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n}\n\npublic void addView(View child, int index, LayoutParams params) {\n    // \n    //  requestLayout  View \n    requestLayout();\n    invalidate(true);\n    addViewInner(child, index, params, false);\n}\n</code></pre>\n<p> setContentView() </p>\n<p> View  requestLayout()  invalidate()  View  measure()  layout  draw </p>\n<p> setContentView()  View  View </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>setContentView()  View  DecorView </p>\n<p> Activity </p>\n<pre><code class=\"java\">public void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: {\n            // 1. ActivityThread  H LAUNCH_ACTIVITY \n            handleLaunchActivity(r, null, &quot;LAUNCH_ACTIVITY&quot;);\n        } break;\n }\n\n// 2.  ActivityThread  handleLaunchActivity() \nprivate void handleLaunchActivity(ActivityClientRecord r, Intent customIntent, String reason) {\n\n    // 3.  performLaunchActivity() \n    Activity a = performLaunchActivity(r, customIntent);\n\n    if (a != null) {\n        r.createdConfig = new Configuration(mConfiguration);\n        reportSizeConfigurations(r);\n        Bundle oldState = r.state;\n        // 4.  handleResumeActivity() \n        handleResumeActivity(r.token, false, r.isForward,\n                             !r.activity.mFinished &amp;&amp; !r.startsNotResumed,\n                             r.lastProcessedSeq, reason);\n    }\n}\n\n// 3. performLaunchActivity()\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    //  Instrumentation  Activity \n    Activity activity = null;\n    try {\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(\n            cl, component.getClassName(), r.intent);\n        StrictMode.incrementExpectedActivityCount(activity.getClass());\n        r.intent.setExtrasClassLoader(cl);\n        r.intent.prepareToEnterProcess();\n        if (r.state != null) {\n            r.state.setClassLoader(cl);\n        }\n    }\n\n    try {\n        if (activity != null) {\n            // attach() \n            activity.attach(appContext, this, getInstrumentation(), r.token,\n                            r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                            r.embeddedID, r.lastNonConfigurationInstances, config,\n                            r.referrer, r.voiceInteractor, window, r.configCallback);\n\n            activity.mCalled = false;\n            // 3.1  Instrumentation  Activity  onCreate() \n            if (r.isPersistable()) {\n                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n            } else {\n                mInstrumentation.callActivityOnCreate(activity, r.state);\n            }\n            //  super \n            if (!activity.mCalled) {\n                throw new SuperNotCalledException(\n                    &quot;Activity &quot; + r.intent.getComponent().toShortString() +\n                    &quot; did not call through to super.onCreate()&quot;);\n            }\n        }\n    }\n    return activity;\n}\n\npublic void callActivityOnCreate(Activity activity, Bundle icicle,PersistableBundle persistentState) {\n    prePerformCreate(activity);\n    // 3.2  Activity  performCreate() \n    activity.performCreate(icicle, persistentState);\n    postPerformCreate(activity);\n}\n\n// 3.3  onCreate()\nfinal void performCreate(Bundle icicle, PersistableBundle persistentState) {\n    restoreHasCurrentPermissionRequest(icicle);\n    onCreate(icicle, persistentState);\n    mActivityTransitionState.readState(icicle);\n    performCreateCommon();\n}\n\n// 4 performLaunchActivity()  handleResumeActivity()\n//  performResumeActivity() onResume()\n final void handleResumeActivity( ... ... ) {\n     //  onResume()\n     r = performResumeActivity(token, clearHide, reason);\n\n     if (r != null) {\n         final Activity a = r.activity;\n\n         if (r.window == null &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) {\n             r.window = r.activity.getWindow();\n             View decor = r.window.getDecorView();\n             ViewManager wm = a.getWindowManager();\n             // 5.  WindowManagerImpl  addView()\n             //  WindowManagerGlobal  addView()\n             if (a.mVisibleFromClient) {\n                 if (!a.mWindowAdded) {\n                     a.mWindowAdded = true;\n                     wm.addView(decor, l);\n                 }\n             }\n         }\n     }\n }\n\npublic void addView( ... ... ) {\n     ViewRootImpl root;\n     synchronized (mLock) {\n         //  ViewRootImpl \n         root = new ViewRootImpl(view.getContext(), display);\n         try {\n             //  setView root  setView\n             //  view  DecorView \n             //  DecorView ViewRootImpl\n             root.setView(view, wparams, panelParentView);\n         }\n     }\n}\n\n// 6.  DecorView  WindowManager, View \npublic void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) {\n    //  View \n    //  setContentView()  ViewRootImpl \n    requestLayout();\n}\n\n@Override\npublic void requestLayout() {\n    if (!mHandlingLayoutInLayoutRequest) {\n        checkThread();\n        mLayoutRequested = true;\n        // 7.  post  Runnable \n        //  doTraversal() \n        //  performTraversals()  View \n        scheduleTraversals();\n    }\n}\n\nprivate void performTraversals() {\n    ... ...\n    // Ask host how big it wants to be\n    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n    ... ...\n    performLayout(lp, mWidth, mHeight);\n    ... ...\n    performDraw();\n    ... ...\n}\n</code></pre>\n<p>View  performTraversals()  onResume()  onCreate()  onResume()  View </p>\n","site":{"data":{}},"excerpt":"<p> onCreate()  onResume()  View  setContentView </p>","more":"<p></p>\n<pre><code class=\"java\">public class MainActivity extends AppCompatActivity {\n\n    @BindView(R.id.tv_test)\n    private TextView mTextView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        mTv.getHeight(); // 0\n\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        mTv.getHeight(); // 0\n    }\n\n}\n</code></pre>\n<p> View </p>\n<h3 id=\"setContentView\"><a href=\"#setContentView\" class=\"headerlink\" title=\"setContentView()\"></a>setContentView()</h3><p> onCreate()  setContentView() <strong></strong>setContentView() </p>\n<pre><code class=\"java\">// 1. AppCompatDelegate  Activity \npublic abstract void setContentView(@LayoutRes int resId);\n\n// 2. Activity \npublic void setContentView(@LayoutRes int layoutResID) {\n    // Window  PhoneWindow\n    getWindow().setContentView(layoutResID);\n    initWindowDecorActionBar();\n}\n\n@Override\npublic void setContentView(int layoutResID) {\n    if (mContentParent == null) {\n        // 3.  DecorView\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n    ... ...\n}\n\nprivate void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // 4. mDecor  DecorView \n        // generateDecor(-1) : return new DecorView()\n        mDecor = generateDecor(-1);\n        ... ...\n    } else {\n        mDecor.setWindow(this);\n    }\n\n    if (mContentParent == null) {\n        // 5. \n        mContentParent = generateLayout(mDecor);\n    }\n}\n\n//  generateLayout(mDecor) \nprotected ViewGroup generateLayout(DecorView decor) {\n    // \n    TypedArray a = getWindowStyle();\n    ... ...\n\n    // \n    int layoutResource;\n    int features = getLocalFeatures();\n    if ((features &amp; (1 &lt;&lt; FEATURE_SWIPE_TO_DISMISS)) != 0) {\n        layoutResource = R.layout.screen_swipe_dismiss;\n        setCloseOnSwipeEnabled(true);\n    } else if ((features &amp; (1 &lt;&lt; FEATURE_NO_TITLE)) == 0) {\n        if (mIsFloating) {\n            TypedValue res = new TypedValue();\n            getContext().getTheme().resolveAttribute(\n                R.attr.dialogTitleDecorLayout, res, true);\n            layoutResource = res.resourceId;\n        } else if ((features &amp; (1 &lt;&lt; FEATURE_ACTION_BAR)) != 0) {\n            layoutResource = a.getResourceId(\n                R.styleable.Window_windowActionBarFullscreenDecorLayout,\n                R.layout.screen_action_bar);\n        } else {\n            layoutResource = R.layout.screen_title;\n        }\n    } else {\n        // \n        layoutResource = R.layout.screen_simple;\n    }\n\n    // 6.  DecorView \n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n    return contentParent;\n}\n\nvoid onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\n    // \n    final View root = inflater.inflate(layoutResource, null);\n    ... ...\n    // 7.  View  DecorView \n    addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n}\n\npublic void addView(View child, int index, LayoutParams params) {\n    // \n    //  requestLayout  View \n    requestLayout();\n    invalidate(true);\n    addViewInner(child, index, params, false);\n}\n</code></pre>\n<p> setContentView() </p>\n<p> View  requestLayout()  invalidate()  View  measure()  layout  draw </p>\n<p> setContentView()  View  View </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>setContentView()  View  DecorView </p>\n<p> Activity </p>\n<pre><code class=\"java\">public void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: {\n            // 1. ActivityThread  H LAUNCH_ACTIVITY \n            handleLaunchActivity(r, null, &quot;LAUNCH_ACTIVITY&quot;);\n        } break;\n }\n\n// 2.  ActivityThread  handleLaunchActivity() \nprivate void handleLaunchActivity(ActivityClientRecord r, Intent customIntent, String reason) {\n\n    // 3.  performLaunchActivity() \n    Activity a = performLaunchActivity(r, customIntent);\n\n    if (a != null) {\n        r.createdConfig = new Configuration(mConfiguration);\n        reportSizeConfigurations(r);\n        Bundle oldState = r.state;\n        // 4.  handleResumeActivity() \n        handleResumeActivity(r.token, false, r.isForward,\n                             !r.activity.mFinished &amp;&amp; !r.startsNotResumed,\n                             r.lastProcessedSeq, reason);\n    }\n}\n\n// 3. performLaunchActivity()\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    //  Instrumentation  Activity \n    Activity activity = null;\n    try {\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(\n            cl, component.getClassName(), r.intent);\n        StrictMode.incrementExpectedActivityCount(activity.getClass());\n        r.intent.setExtrasClassLoader(cl);\n        r.intent.prepareToEnterProcess();\n        if (r.state != null) {\n            r.state.setClassLoader(cl);\n        }\n    }\n\n    try {\n        if (activity != null) {\n            // attach() \n            activity.attach(appContext, this, getInstrumentation(), r.token,\n                            r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                            r.embeddedID, r.lastNonConfigurationInstances, config,\n                            r.referrer, r.voiceInteractor, window, r.configCallback);\n\n            activity.mCalled = false;\n            // 3.1  Instrumentation  Activity  onCreate() \n            if (r.isPersistable()) {\n                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n            } else {\n                mInstrumentation.callActivityOnCreate(activity, r.state);\n            }\n            //  super \n            if (!activity.mCalled) {\n                throw new SuperNotCalledException(\n                    &quot;Activity &quot; + r.intent.getComponent().toShortString() +\n                    &quot; did not call through to super.onCreate()&quot;);\n            }\n        }\n    }\n    return activity;\n}\n\npublic void callActivityOnCreate(Activity activity, Bundle icicle,PersistableBundle persistentState) {\n    prePerformCreate(activity);\n    // 3.2  Activity  performCreate() \n    activity.performCreate(icicle, persistentState);\n    postPerformCreate(activity);\n}\n\n// 3.3  onCreate()\nfinal void performCreate(Bundle icicle, PersistableBundle persistentState) {\n    restoreHasCurrentPermissionRequest(icicle);\n    onCreate(icicle, persistentState);\n    mActivityTransitionState.readState(icicle);\n    performCreateCommon();\n}\n\n// 4 performLaunchActivity()  handleResumeActivity()\n//  performResumeActivity() onResume()\n final void handleResumeActivity( ... ... ) {\n     //  onResume()\n     r = performResumeActivity(token, clearHide, reason);\n\n     if (r != null) {\n         final Activity a = r.activity;\n\n         if (r.window == null &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) {\n             r.window = r.activity.getWindow();\n             View decor = r.window.getDecorView();\n             ViewManager wm = a.getWindowManager();\n             // 5.  WindowManagerImpl  addView()\n             //  WindowManagerGlobal  addView()\n             if (a.mVisibleFromClient) {\n                 if (!a.mWindowAdded) {\n                     a.mWindowAdded = true;\n                     wm.addView(decor, l);\n                 }\n             }\n         }\n     }\n }\n\npublic void addView( ... ... ) {\n     ViewRootImpl root;\n     synchronized (mLock) {\n         //  ViewRootImpl \n         root = new ViewRootImpl(view.getContext(), display);\n         try {\n             //  setView root  setView\n             //  view  DecorView \n             //  DecorView ViewRootImpl\n             root.setView(view, wparams, panelParentView);\n         }\n     }\n}\n\n// 6.  DecorView  WindowManager, View \npublic void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) {\n    //  View \n    //  setContentView()  ViewRootImpl \n    requestLayout();\n}\n\n@Override\npublic void requestLayout() {\n    if (!mHandlingLayoutInLayoutRequest) {\n        checkThread();\n        mLayoutRequested = true;\n        // 7.  post  Runnable \n        //  doTraversal() \n        //  performTraversals()  View \n        scheduleTraversals();\n    }\n}\n\nprivate void performTraversals() {\n    ... ...\n    // Ask host how big it wants to be\n    performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\n    ... ...\n    performLayout(lp, mWidth, mHeight);\n    ... ...\n    performDraw();\n    ... ...\n}\n</code></pre>\n<p>View  performTraversals()  onResume()  onCreate()  onResume()  View </p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329164506.jpg","title":"View.inflate() ","date":"2019-03-28T16:00:00.000Z","_content":"\n\n\n LayoutInflater  inflate() \n\n<!-- more -->\n\n Android \n\n> 1. `View.inflate()`  `LayoutInflator.from().inflate()` \n> 2.  inflate()  null parent \n> 3.  LayoutInflater  attachToRoot \n\n\n\nLet's go !\n\n### \n\n\n\n```java\n/**\n * Inflate a view from an XML resource.  This convenience method wraps the {@link\n * LayoutInflater} class, which provides a full range of options for view inflation.\n */\npublic static View inflate(Context context, int resource, ViewGroup root) {\n    LayoutInflater factory = LayoutInflater.from(context);\n    return factory.inflate(resource, root);\n}\n```\n\n `LayoutInflater`  inflate  `LayoutInflater`  `LayoutInflater`  View \n\n `LayoutInflater` \n\n `LayoutInflator.from().inflate()`  \n\n```java\n// LayoutInflator#inflate(int, ViewGroup)\npublic View inflate(@LayoutRes int resource, @Nullable ViewGroup root) {\n\t\treturn inflate(resource, root, root != null);\n}\n```\n\n\n\n```java\n// LayoutInflator#inflate(int, ViewGroup, boolean)\npublic View inflate(int resource, ViewGroup root, boolean attachToRoot) {\n    final Resources res = getContext().getResources();\n    final XmlResourceParser parser = res.getLayout(resource);\n    try {\n        return inflate(parser, root, attachToRoot);\n    } finally {\n        parser.close();\n    }\n}\n```\n\n `LayoutInflator#inflate(int, ViewGroup, boolean)`  id  XmlResourceParser\n\n\n\n### \n\n `inflate` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    \n    // \n    View result = root;\n  \n    //  createViewFromTag()  layoutId  temp\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n  \n    // \n    if (root != null) {\n        //  root  LayoutParams\n        params = root.generateLayoutParams(attrs);\n        if (!attachToRoot) {\n            //  attachToRoot layoutparams\n            temp.setLayoutParams(params);\n        }\n    }\n\n    //  attachToRoot\n    if (root != null && attachToRoot) {\n        //  layoutparams  addView  \n        root.addView(temp, params);\n    }\n\n    //  attachToRoot layoutId\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n```\n\n\n\n* `View#inflate`  `LayoutInflater#inflate` ;\n\n* `LayoutInflater#inflate`  root  attachToRoot \n\n*  `root`  `attachToRoot` \n\n*   `root`  `layoutId` View  LayoutParams\n\n*   `root`  `attachToRoot` \n\n  *  `attachToRoot = true` \n\n     `layoutId`  `root`  `root` \n\n  *  `attachToRoot = false` \n\n     `layoutId`  `root`  `layoutId`  View\n\n    >  View  parent  parent null View  LayoutParams  parent  addView  `generateDefaultLayoutParams()`  View  LayoutParams\n\n\n\n###  & \n\n\n\n#### View.inflate(context, layoutId, null)\n\n `getLayoutInflater().inflate(layoutId, null)` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    View result = root;\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n```\n\n `root`  xml  View \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, null);\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329145224.jpg)\n\nroot  null  null\n\n\n\n#### View.inflate(context, layoutId, mParent)\n\n `getLayoutInflater().inflate(layoutId, root, true)` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    View result = root; \n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n    if (root != null) {\n        params = root.generateLayoutParams(attrs);\n    }\n    if (root != null && attachToRoot) {\n        root.addView(temp, params);\n    }\n    return result;\n}\n```\n\n result  rootroot  attachToRoot  true addView  root  root \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    setContentView(R.layout.layout_test);\n\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, mParent);\n\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n    Log.e(\"Test\", \"inflateView -> \" + inflateView);\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329153240.jpg)\n\n View  mParent id  ll_root\n\n\n\n####getLayoutInflater().inflate(layoutId, root, false) \n\n root  layoutId  root  root  root  layoutId \n\n `View#inflate`  `attachToRoot`  `getLayoutInflater().inflate(layoutId, root, false)`  false LayoutParams `parentView`  `layoutId` \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = getLayoutInflater().inflate(R.layout.main, mParent, false);\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329155230.jpg)\n\n id addView \n\n**** `params = root.generateLayoutParams(attrs);`  `layoutId`  params  root  parent  parent null View  LayoutParams  parent  null  `addView()`  childView  `generateDefaultLayoutParams()`  LayoutParams  childView\n\n#### attachToRoot  false\n\n `attachToRoot`  false true\n\n- RecylerView#onCreateViewHolder()\n\n   RecyclerView  ViewHolder  View  RecyclerView ViewattachToRoot  false\n\n  ```java\n  public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {  \n  \t\tLayoutInflater inflater = LayoutInflater.from(getActivity());  \n  \t\tView view = inflater.inflate(R.layout.item, parent, false);  \n  \t\treturn new ViewHolder(view);  \n  }\n  ```\n\n- Fragment#onCreateView()\n\n   Fragment  Activity  Activity  Fragment\n\n  ```java\n  Fragment fragment = new Fragment();\n  getSupportFragmentManager()\n          .beginTransaction()\n          .add(R.id.root_container, fragment)\n          .commit(); \n  ```\n\n   `R.id.root_container`  View  `Fragment#onCreateView()` :\n\n  ```java\n  public View onCreateView(LayoutInflater inflater, ViewGroup container, \n                           Bundle savedInstanceState) {\n      return inflater.inflate(R.layout.fragment_layout, parentViewGroup, false); \n  }\n  ```\n\n   inflate()  ViewGroupFragmentManager  Fragment  View  ViewGroup Fragment  ViewGroup  FragmentManager \n\n** View attachToRoot  false Rv  FragmentManager id  ViewGroup  attachToRoot  true addView child already has parent **\n\n\n\n\n\n#### \n\n- [LayoutInflater.inflate()](<https://juejin.im/entry/5a1513abf265da43052e4473>)\n- [LayoutInflater.inflateView.inflate](<https://www.jianshu.com/p/cdc9d4c0826e>)\n- [Android API 28 View.java / LayoutInflater.java / ViewGroup.java]()","source":"_posts/View-inflate-analysis.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329164506.jpg\ntitle: View.inflate() \ntags: [Android]\ndate: 2019-03-29\n---\n\n\n\n LayoutInflater  inflate() \n\n<!-- more -->\n\n Android \n\n> 1. `View.inflate()`  `LayoutInflator.from().inflate()` \n> 2.  inflate()  null parent \n> 3.  LayoutInflater  attachToRoot \n\n\n\nLet's go !\n\n### \n\n\n\n```java\n/**\n * Inflate a view from an XML resource.  This convenience method wraps the {@link\n * LayoutInflater} class, which provides a full range of options for view inflation.\n */\npublic static View inflate(Context context, int resource, ViewGroup root) {\n    LayoutInflater factory = LayoutInflater.from(context);\n    return factory.inflate(resource, root);\n}\n```\n\n `LayoutInflater`  inflate  `LayoutInflater`  `LayoutInflater`  View \n\n `LayoutInflater` \n\n `LayoutInflator.from().inflate()`  \n\n```java\n// LayoutInflator#inflate(int, ViewGroup)\npublic View inflate(@LayoutRes int resource, @Nullable ViewGroup root) {\n\t\treturn inflate(resource, root, root != null);\n}\n```\n\n\n\n```java\n// LayoutInflator#inflate(int, ViewGroup, boolean)\npublic View inflate(int resource, ViewGroup root, boolean attachToRoot) {\n    final Resources res = getContext().getResources();\n    final XmlResourceParser parser = res.getLayout(resource);\n    try {\n        return inflate(parser, root, attachToRoot);\n    } finally {\n        parser.close();\n    }\n}\n```\n\n `LayoutInflator#inflate(int, ViewGroup, boolean)`  id  XmlResourceParser\n\n\n\n### \n\n `inflate` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    \n    // \n    View result = root;\n  \n    //  createViewFromTag()  layoutId  temp\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n  \n    // \n    if (root != null) {\n        //  root  LayoutParams\n        params = root.generateLayoutParams(attrs);\n        if (!attachToRoot) {\n            //  attachToRoot layoutparams\n            temp.setLayoutParams(params);\n        }\n    }\n\n    //  attachToRoot\n    if (root != null && attachToRoot) {\n        //  layoutparams  addView  \n        root.addView(temp, params);\n    }\n\n    //  attachToRoot layoutId\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n```\n\n\n\n* `View#inflate`  `LayoutInflater#inflate` ;\n\n* `LayoutInflater#inflate`  root  attachToRoot \n\n*  `root`  `attachToRoot` \n\n*   `root`  `layoutId` View  LayoutParams\n\n*   `root`  `attachToRoot` \n\n  *  `attachToRoot = true` \n\n     `layoutId`  `root`  `root` \n\n  *  `attachToRoot = false` \n\n     `layoutId`  `root`  `layoutId`  View\n\n    >  View  parent  parent null View  LayoutParams  parent  addView  `generateDefaultLayoutParams()`  View  LayoutParams\n\n\n\n###  & \n\n\n\n#### View.inflate(context, layoutId, null)\n\n `getLayoutInflater().inflate(layoutId, null)` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    View result = root;\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n```\n\n `root`  xml  View \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, null);\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329145224.jpg)\n\nroot  null  null\n\n\n\n#### View.inflate(context, layoutId, mParent)\n\n `getLayoutInflater().inflate(layoutId, root, true)` \n\n```java\npublic View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    View result = root; \n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n    if (root != null) {\n        params = root.generateLayoutParams(attrs);\n    }\n    if (root != null && attachToRoot) {\n        root.addView(temp, params);\n    }\n    return result;\n}\n```\n\n result  rootroot  attachToRoot  true addView  root  root \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    setContentView(R.layout.layout_test);\n\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, mParent);\n\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n    Log.e(\"Test\", \"inflateView -> \" + inflateView);\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329153240.jpg)\n\n View  mParent id  ll_root\n\n\n\n####getLayoutInflater().inflate(layoutId, root, false) \n\n root  layoutId  root  root  root  layoutId \n\n `View#inflate`  `attachToRoot`  `getLayoutInflater().inflate(layoutId, root, false)`  false LayoutParams `parentView`  `layoutId` \n\n```java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = getLayoutInflater().inflate(R.layout.main, mParent, false);\n    Log.e(\"Test\", \"LayoutParams -> \" + inflateView.getLayoutParams());\n    Log.e(\"Test\", \"Parent -> \" + inflateView.getParent());\n}\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329155230.jpg)\n\n id addView \n\n**** `params = root.generateLayoutParams(attrs);`  `layoutId`  params  root  parent  parent null View  LayoutParams  parent  null  `addView()`  childView  `generateDefaultLayoutParams()`  LayoutParams  childView\n\n#### attachToRoot  false\n\n `attachToRoot`  false true\n\n- RecylerView#onCreateViewHolder()\n\n   RecyclerView  ViewHolder  View  RecyclerView ViewattachToRoot  false\n\n  ```java\n  public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {  \n  \t\tLayoutInflater inflater = LayoutInflater.from(getActivity());  \n  \t\tView view = inflater.inflate(R.layout.item, parent, false);  \n  \t\treturn new ViewHolder(view);  \n  }\n  ```\n\n- Fragment#onCreateView()\n\n   Fragment  Activity  Activity  Fragment\n\n  ```java\n  Fragment fragment = new Fragment();\n  getSupportFragmentManager()\n          .beginTransaction()\n          .add(R.id.root_container, fragment)\n          .commit(); \n  ```\n\n   `R.id.root_container`  View  `Fragment#onCreateView()` :\n\n  ```java\n  public View onCreateView(LayoutInflater inflater, ViewGroup container, \n                           Bundle savedInstanceState) {\n      return inflater.inflate(R.layout.fragment_layout, parentViewGroup, false); \n  }\n  ```\n\n   inflate()  ViewGroupFragmentManager  Fragment  View  ViewGroup Fragment  ViewGroup  FragmentManager \n\n** View attachToRoot  false Rv  FragmentManager id  ViewGroup  attachToRoot  true addView child already has parent **\n\n\n\n\n\n#### \n\n- [LayoutInflater.inflate()](<https://juejin.im/entry/5a1513abf265da43052e4473>)\n- [LayoutInflater.inflateView.inflate](<https://www.jianshu.com/p/cdc9d4c0826e>)\n- [Android API 28 View.java / LayoutInflater.java / ViewGroup.java]()","slug":"View-inflate-analysis","published":1,"updated":"2019-03-29T08:47:59.124Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dn0019lh1pqqq8oa2h","content":"<p> LayoutInflater  inflate() </p>\n<a id=\"more\"></a>\n<p> Android </p>\n<blockquote>\n<ol>\n<li><code>View.inflate()</code>  <code>LayoutInflator.from().inflate()</code> </li>\n<li> inflate()  null parent </li>\n<li> LayoutInflater  attachToRoot </li>\n</ol>\n</blockquote>\n<p></p>\n<p>Lets go !</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<pre><code class=\"java\">/**\n * Inflate a view from an XML resource.  This convenience method wraps the {@link\n * LayoutInflater} class, which provides a full range of options for view inflation.\n */\npublic static View inflate(Context context, int resource, ViewGroup root) {\n    LayoutInflater factory = LayoutInflater.from(context);\n    return factory.inflate(resource, root);\n}\n</code></pre>\n<p> <code>LayoutInflater</code>  inflate  <code>LayoutInflater</code>  <code>LayoutInflater</code>  View </p>\n<p> <code>LayoutInflater</code> </p>\n<p> <code>LayoutInflator.from().inflate()</code>  </p>\n<pre><code class=\"java\">// LayoutInflator#inflate(int, ViewGroup)\npublic View inflate(@LayoutRes int resource, @Nullable ViewGroup root) {\n        return inflate(resource, root, root != null);\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">// LayoutInflator#inflate(int, ViewGroup, boolean)\npublic View inflate(int resource, ViewGroup root, boolean attachToRoot) {\n    final Resources res = getContext().getResources();\n    final XmlResourceParser parser = res.getLayout(resource);\n    try {\n        return inflate(parser, root, attachToRoot);\n    } finally {\n        parser.close();\n    }\n}\n</code></pre>\n<p> <code>LayoutInflator#inflate(int, ViewGroup, boolean)</code>  id  XmlResourceParser</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>inflate</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n\n    // \n    View result = root;\n\n    //  createViewFromTag()  layoutId  temp\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n\n    // \n    if (root != null) {\n        //  root  LayoutParams\n        params = root.generateLayoutParams(attrs);\n        if (!attachToRoot) {\n            //  attachToRoot layoutparams\n            temp.setLayoutParams(params);\n        }\n    }\n\n    //  attachToRoot\n    if (root != null &amp;&amp; attachToRoot) {\n        //  layoutparams  addView  \n        root.addView(temp, params);\n    }\n\n    //  attachToRoot layoutId\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n</code></pre>\n<p></p>\n<ul>\n<li><p><code>View#inflate</code>  <code>LayoutInflater#inflate</code> ;</p>\n</li>\n<li><p><code>LayoutInflater#inflate</code>  root  attachToRoot </p>\n</li>\n<li><p> <code>root</code>  <code>attachToRoot</code> </p>\n</li>\n<li><p>  <code>root</code>  <code>layoutId</code> View  LayoutParams</p>\n</li>\n<li><p>  <code>root</code>  <code>attachToRoot</code> </p>\n<ul>\n<li><p><code>attachToRoot = true</code> </p>\n<p> <code>layoutId</code>  <code>root</code>  <code>root</code> </p>\n</li>\n<li><p><code>attachToRoot = false</code> </p>\n<p> <code>layoutId</code>  <code>root</code>  <code>layoutId</code>  View</p>\n<blockquote>\n<p> View  parent  parent null View  LayoutParams  parent  addView  <code>generateDefaultLayoutParams()</code>  View  LayoutParams</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"-amp-\"><a href=\"#-amp-\" class=\"headerlink\" title=\" &amp; \"></a> &amp; </h3><p></p>\n<h4 id=\"View-inflate-context-layoutId-null\"><a href=\"#View-inflate-context-layoutId-null\" class=\"headerlink\" title=\"View.inflate(context, layoutId, null)\"></a>View.inflate(context, layoutId, null)</h4><p> <code>getLayoutInflater().inflate(layoutId, null)</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    View result = root;\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n</code></pre>\n<p> <code>root</code>  xml  View </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, null);\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329145224.jpg\" alt=\"\"></p>\n<p>root  null  null</p>\n<h4 id=\"View-inflate-context-layoutId-mParent\"><a href=\"#View-inflate-context-layoutId-mParent\" class=\"headerlink\" title=\"View.inflate(context, layoutId, mParent)\"></a>View.inflate(context, layoutId, mParent)</h4><p> <code>getLayoutInflater().inflate(layoutId, root, true)</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    View result = root; \n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n    if (root != null) {\n        params = root.generateLayoutParams(attrs);\n    }\n    if (root != null &amp;&amp; attachToRoot) {\n        root.addView(temp, params);\n    }\n    return result;\n}\n</code></pre>\n<p> result  rootroot  attachToRoot  true addView  root  root </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    setContentView(R.layout.layout_test);\n\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, mParent);\n\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n    Log.e(&quot;Test&quot;, &quot;inflateView -&gt; &quot; + inflateView);\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329153240.jpg\" alt=\"\"></p>\n<p> View  mParent id  ll_root</p>\n<p>####getLayoutInflater().inflate(layoutId, root, false) </p>\n<p> root  layoutId  root  root  root  layoutId </p>\n<p> <code>View#inflate</code>  <code>attachToRoot</code>  <code>getLayoutInflater().inflate(layoutId, root, false)</code>  false LayoutParams <code>parentView</code>  <code>layoutId</code> </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = getLayoutInflater().inflate(R.layout.main, mParent, false);\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329155230.jpg\" alt=\"\"></p>\n<p> id addView </p>\n<p><strong></strong> <code>params = root.generateLayoutParams(attrs);</code>  <code>layoutId</code>  params  root  parent  parent null View  LayoutParams  parent  null  <code>addView()</code>  childView  <code>generateDefaultLayoutParams()</code>  LayoutParams  childView</p>\n<h4 id=\"attachToRoot--false\"><a href=\"#attachToRoot--false\" class=\"headerlink\" title=\"attachToRoot  false\"></a>attachToRoot  false</h4><p> <code>attachToRoot</code>  false true</p>\n<ul>\n<li><p>RecylerView#onCreateViewHolder()</p>\n<p> RecyclerView  ViewHolder  View  RecyclerView ViewattachToRoot  false</p>\n<pre><code class=\"java\">public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {  \n        LayoutInflater inflater = LayoutInflater.from(getActivity());  \n        View view = inflater.inflate(R.layout.item, parent, false);  \n        return new ViewHolder(view);  \n}\n</code></pre>\n</li>\n<li><p>Fragment#onCreateView()</p>\n<p> Fragment  Activity  Activity  Fragment</p>\n<pre><code class=\"java\">Fragment fragment = new Fragment();\ngetSupportFragmentManager()\n        .beginTransaction()\n        .add(R.id.root_container, fragment)\n        .commit(); \n</code></pre>\n<p> <code>R.id.root_container</code>  View  <code>Fragment#onCreateView()</code> :</p>\n<pre><code class=\"java\">public View onCreateView(LayoutInflater inflater, ViewGroup container, \n                         Bundle savedInstanceState) {\n    return inflater.inflate(R.layout.fragment_layout, parentViewGroup, false); \n}\n</code></pre>\n<p> inflate()  ViewGroupFragmentManager  Fragment  View  ViewGroup Fragment  ViewGroup  FragmentManager </p>\n</li>\n</ul>\n<p><strong> View attachToRoot  false Rv  FragmentManager id  ViewGroup  attachToRoot  true addView child already has parent </strong></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><a href=\"https://juejin.im/entry/5a1513abf265da43052e4473\" target=\"_blank\" rel=\"noopener\">LayoutInflater.inflate()</a></li>\n<li><a href=\"https://www.jianshu.com/p/cdc9d4c0826e\" target=\"_blank\" rel=\"noopener\">LayoutInflater.inflateView.inflate</a></li>\n<li><a href=\"\">Android API 28 View.java / LayoutInflater.java / ViewGroup.java</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> LayoutInflater  inflate() </p>","more":"<p> Android </p>\n<blockquote>\n<ol>\n<li><code>View.inflate()</code>  <code>LayoutInflator.from().inflate()</code> </li>\n<li> inflate()  null parent </li>\n<li> LayoutInflater  attachToRoot </li>\n</ol>\n</blockquote>\n<p></p>\n<p>Lets go !</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<pre><code class=\"java\">/**\n * Inflate a view from an XML resource.  This convenience method wraps the {@link\n * LayoutInflater} class, which provides a full range of options for view inflation.\n */\npublic static View inflate(Context context, int resource, ViewGroup root) {\n    LayoutInflater factory = LayoutInflater.from(context);\n    return factory.inflate(resource, root);\n}\n</code></pre>\n<p> <code>LayoutInflater</code>  inflate  <code>LayoutInflater</code>  <code>LayoutInflater</code>  View </p>\n<p> <code>LayoutInflater</code> </p>\n<p> <code>LayoutInflator.from().inflate()</code>  </p>\n<pre><code class=\"java\">// LayoutInflator#inflate(int, ViewGroup)\npublic View inflate(@LayoutRes int resource, @Nullable ViewGroup root) {\n        return inflate(resource, root, root != null);\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">// LayoutInflator#inflate(int, ViewGroup, boolean)\npublic View inflate(int resource, ViewGroup root, boolean attachToRoot) {\n    final Resources res = getContext().getResources();\n    final XmlResourceParser parser = res.getLayout(resource);\n    try {\n        return inflate(parser, root, attachToRoot);\n    } finally {\n        parser.close();\n    }\n}\n</code></pre>\n<p> <code>LayoutInflator#inflate(int, ViewGroup, boolean)</code>  id  XmlResourceParser</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>inflate</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n\n    // \n    View result = root;\n\n    //  createViewFromTag()  layoutId  temp\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n\n    // \n    if (root != null) {\n        //  root  LayoutParams\n        params = root.generateLayoutParams(attrs);\n        if (!attachToRoot) {\n            //  attachToRoot layoutparams\n            temp.setLayoutParams(params);\n        }\n    }\n\n    //  attachToRoot\n    if (root != null &amp;&amp; attachToRoot) {\n        //  layoutparams  addView  \n        root.addView(temp, params);\n    }\n\n    //  attachToRoot layoutId\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n</code></pre>\n<p></p>\n<ul>\n<li><p><code>View#inflate</code>  <code>LayoutInflater#inflate</code> ;</p>\n</li>\n<li><p><code>LayoutInflater#inflate</code>  root  attachToRoot </p>\n</li>\n<li><p> <code>root</code>  <code>attachToRoot</code> </p>\n</li>\n<li><p>  <code>root</code>  <code>layoutId</code> View  LayoutParams</p>\n</li>\n<li><p>  <code>root</code>  <code>attachToRoot</code> </p>\n<ul>\n<li><p><code>attachToRoot = true</code> </p>\n<p> <code>layoutId</code>  <code>root</code>  <code>root</code> </p>\n</li>\n<li><p><code>attachToRoot = false</code> </p>\n<p> <code>layoutId</code>  <code>root</code>  <code>layoutId</code>  View</p>\n<blockquote>\n<p> View  parent  parent null View  LayoutParams  parent  addView  <code>generateDefaultLayoutParams()</code>  View  LayoutParams</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"-amp-\"><a href=\"#-amp-\" class=\"headerlink\" title=\" &amp; \"></a> &amp; </h3><p></p>\n<h4 id=\"View-inflate-context-layoutId-null\"><a href=\"#View-inflate-context-layoutId-null\" class=\"headerlink\" title=\"View.inflate(context, layoutId, null)\"></a>View.inflate(context, layoutId, null)</h4><p> <code>getLayoutInflater().inflate(layoutId, null)</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    View result = root;\n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    if (root == null || !attachToRoot) {\n        result = temp;\n    }\n    return result;\n}\n</code></pre>\n<p> <code>root</code>  xml  View </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, null);\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329145224.jpg\" alt=\"\"></p>\n<p>root  null  null</p>\n<h4 id=\"View-inflate-context-layoutId-mParent\"><a href=\"#View-inflate-context-layoutId-mParent\" class=\"headerlink\" title=\"View.inflate(context, layoutId, mParent)\"></a>View.inflate(context, layoutId, mParent)</h4><p> <code>getLayoutInflater().inflate(layoutId, root, true)</code> </p>\n<pre><code class=\"java\">public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot) {\n    final Context inflaterContext = mContext;\n    final AttributeSet attrs = Xml.asAttributeSet(parser);\n    View result = root; \n    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n    ViewGroup.LayoutParams params = null;\n    if (root != null) {\n        params = root.generateLayoutParams(attrs);\n    }\n    if (root != null &amp;&amp; attachToRoot) {\n        root.addView(temp, params);\n    }\n    return result;\n}\n</code></pre>\n<p> result  rootroot  attachToRoot  true addView  root  root </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    setContentView(R.layout.layout_test);\n\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = View.inflate(this, R.layout.layout_basic_use_item, mParent);\n\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n    Log.e(&quot;Test&quot;, &quot;inflateView -&gt; &quot; + inflateView);\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329153240.jpg\" alt=\"\"></p>\n<p> View  mParent id  ll_root</p>\n<p>####getLayoutInflater().inflate(layoutId, root, false) </p>\n<p> root  layoutId  root  root  root  layoutId </p>\n<p> <code>View#inflate</code>  <code>attachToRoot</code>  <code>getLayoutInflater().inflate(layoutId, root, false)</code>  false LayoutParams <code>parentView</code>  <code>layoutId</code> </p>\n<pre><code class=\"java\">protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.layout_test);\n    LinearLayout mParent = findViewById(R.id.ll_root);\n    View inflateView = getLayoutInflater().inflate(R.layout.main, mParent, false);\n    Log.e(&quot;Test&quot;, &quot;LayoutParams -&gt; &quot; + inflateView.getLayoutParams());\n    Log.e(&quot;Test&quot;, &quot;Parent -&gt; &quot; + inflateView.getParent());\n}\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190329155230.jpg\" alt=\"\"></p>\n<p> id addView </p>\n<p><strong></strong> <code>params = root.generateLayoutParams(attrs);</code>  <code>layoutId</code>  params  root  parent  parent null View  LayoutParams  parent  null  <code>addView()</code>  childView  <code>generateDefaultLayoutParams()</code>  LayoutParams  childView</p>\n<h4 id=\"attachToRoot--false\"><a href=\"#attachToRoot--false\" class=\"headerlink\" title=\"attachToRoot  false\"></a>attachToRoot  false</h4><p> <code>attachToRoot</code>  false true</p>\n<ul>\n<li><p>RecylerView#onCreateViewHolder()</p>\n<p> RecyclerView  ViewHolder  View  RecyclerView ViewattachToRoot  false</p>\n<pre><code class=\"java\">public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {  \n        LayoutInflater inflater = LayoutInflater.from(getActivity());  \n        View view = inflater.inflate(R.layout.item, parent, false);  \n        return new ViewHolder(view);  \n}\n</code></pre>\n</li>\n<li><p>Fragment#onCreateView()</p>\n<p> Fragment  Activity  Activity  Fragment</p>\n<pre><code class=\"java\">Fragment fragment = new Fragment();\ngetSupportFragmentManager()\n        .beginTransaction()\n        .add(R.id.root_container, fragment)\n        .commit(); \n</code></pre>\n<p> <code>R.id.root_container</code>  View  <code>Fragment#onCreateView()</code> :</p>\n<pre><code class=\"java\">public View onCreateView(LayoutInflater inflater, ViewGroup container, \n                         Bundle savedInstanceState) {\n    return inflater.inflate(R.layout.fragment_layout, parentViewGroup, false); \n}\n</code></pre>\n<p> inflate()  ViewGroupFragmentManager  Fragment  View  ViewGroup Fragment  ViewGroup  FragmentManager </p>\n</li>\n</ul>\n<p><strong> View attachToRoot  false Rv  FragmentManager id  ViewGroup  attachToRoot  true addView child already has parent </strong></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><a href=\"https://juejin.im/entry/5a1513abf265da43052e4473\" target=\"_blank\" rel=\"noopener\">LayoutInflater.inflate()</a></li>\n<li><a href=\"https://www.jianshu.com/p/cdc9d4c0826e\" target=\"_blank\" rel=\"noopener\">LayoutInflater.inflateView.inflate</a></li>\n<li><a href=\"\">Android API 28 View.java / LayoutInflater.java / ViewGroup.java</a></li>\n</ul>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":" View ","date":"2019-04-14T16:00:00.000Z","_content":"\n\n\n View \n\n\n\n<!-- more -->\n\n\n\n### \n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190414212815.gif)\n\n### \n\n ViewPager  View \n\n\n\n1. \n2.  View  onMeasure \n3. \n4. Canvas#drawColor \n5. Canvas#drawCircle \n6. \n7.  View \n\n View practice makes perfect\n\n\n\n### \n\n\n\n1.  60\n2.  1/2\n3. \n\n onLayout  View \n\n```java\nprivate void initParams(Context context) {\n\n    // \n    mColorArray = context.getResources().getIntArray(R.array.splash_circle_colors);\n\n    // \n    mBigCircleRadius = getMeasuredWidth() / 4;\n    mSmallCircleRadius = mBigCircleRadius / 7;\n\n    // \n    mPaint = new Paint();\n    mPaint.setDither(true);\n    mPaint.setAntiAlias(true);\n\n    // \n    mCenterX = getMeasuredWidth() / 2;\n    mCenterY = getMeasuredHeight() / 2;\n\n}\n```\n\n\n\n```java\npublic void drawCircle(float cx, float cy, float radius, @NonNull Paint paint)\n```\n\n\n\n\n\n 0  2 View onDraw \n\n\n\n```java\nprivate void setRotateAnimation() {\n    mValueAnimator = ObjectAnimator.ofFloat(0, (float) Math.PI * 2);\n    mValueAnimator.setRepeatCount(-1);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME);\n    mValueAnimator.setInterpolator(new LinearInterpolator());\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mRotatedAngle = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    // \n    canvas.drawColor(Color.WHITE);\n\n    // \n    double percentAngle = Math.PI * 2 / mColorArray.length;\n\n    for (int i = 0; i < mColorArray.length; i++) {\n\n        mPaint.setColor(mColorArray[i]);\n\n        double currAngle = percentAngle * i + mRotatedAngle;\n\n        // x =  * cos()\n        float cx = mCenterX + (float) (mBigCircleRadius * Math.cos(currAngle));\n\n        // y =  * sin()\n        float cy = mCenterY + (float) (mBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n\n    }\n}\n```\n\n\n\n### \n\n****\n\n\n\n```java\nprivate void setMergeAnimation() {\n    //  0\n    mValueAnimator = ObjectAnimator.ofFloat(mBigCircleRadius, 0);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.setInterpolator(new AnticipateInterpolator(5f));\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    canvas.drawColor(Color.WHITE);\n    double percentAngle = Math.PI * 2 / mColorArray.length;\n    for (int i = 0; i < mColorArray.length; i++) {\n        mPaint.setColor(mColorArray[i]);\n        double currAngle = percentAngle * i + mRotatedAngle;\n        //  mCurrBigCircleRadius  \n        float cx = mCenterX + (float) (mCurrBigCircleRadius * Math.cos(currAngle));\n        float cy = mCenterY + (float) (mCurrBigCircleRadius * Math.sin(currAngle));\n      \n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n    }\n}\n```\n\n### \n\n\n\n\n\n```java\nprivate void setMergeAnimation() {\n  \t// mExtendRadius = (int) Math.sqrt(Math.pow(mCenterX, 2) + Math.pow(mCenterX, 2));\n    // mExtendRadius \n    mValueAnimator = ObjectAnimator.ofFloat(0, mExtendRadius);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n\t\t// mCurrBigCircleRadius \n  \t// mExtendRadius - mCurrBigCircleRadius -> \n    float strokeWidth = mExtendRadius - mCurrBigCircleRadius;\n    mPaint.setStrokeWidth(strokeWidth);\n    mPaint.setStyle(Paint.Style.STROKE); // \n    mPaint.setColor(Color.WHITE);\n\t\t// \n    float radius = strokeWidth / 2 + mCurrBigCircleRadius;\n    canvas.drawCircle(mCenterX, mCenterY, radius, mPaint);\n}\n\n```\n\n### ViewPager \n\n ViewPager  ViewPager ** View **\n\n- View\n\n LayoutInflater  setFactory  [Android  LayoutInflater setFactory](<https://blog.csdn.net/lmj623565791/article/details/51503977>)\n\n\n\n- \n\n   attrs \n\n  ```xml\n  <resources>\n      <!-- X -->\n      <attr name=\"translationXIn\" format=\"float\" />\n      <attr name=\"translationXOut\" format=\"float\" />\n      <!-- Y -->\n      <attr name=\"translationYIn\" format=\"float\" />\n      <attr name=\"translationYOut\" format=\"float\" />\n  </resources>\n  ```\n\n   View  View View  tag \n\n  ```xml\n  <resources>\n      <item name=\"parallax_tag\" type=\"id\"/>\n  </resources>\n  ```\n\n  ```java\n   private int[] mParallaxAttrs = new int[]{\n              R.attr.translationXIn, R.attr.translationXOut,\n              R.attr.translationYIn, R.attr.translationYOut\n      };\n  \n  private void analysisAttrs(View view, Context context, AttributeSet attrs) {\n      TypedArray array = context.obtainStyledAttributes(attrs, mParallaxAttrs);\n  \n      // \n      if (array != null && array.getIndexCount() != 0) {\n  \n          ParallaxTag parallaxTag = new ParallaxTag();\n          for (int i = 0; i < array.getIndexCount(); i++) {\n  \n              int arrayIndex = array.getIndex(i);\n  \n              switch (arrayIndex) {\n                  case 0:\n                      parallaxTag.setxIn(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 1:\n                      parallaxTag.setxOut(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 2:\n                      parallaxTag.setyIn(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 3:\n                      parallaxTag.setyOut(array.getFloat(arrayIndex, 0f));\n                      break;\n              }\n  \n              //  ->  View  tag\n              view.setTag(R.id.parallax_tag, parallaxTag);\n  \n              //  View \n              mParallaxViews.add(view);\n          }\n  \n          array.recycle();\n      }\n  }\n  ```\n  \n\n ViewPager  Fragment  ViewPager  Fragment  View  Fragment \n\n```java\naddOnPageChangeListener(new OnPageChangeListener() {\n    @Override\n    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {\n\n        //  fragment\n        ParallaxFragment outFragment = mFragments.get(position);\n\n\n        List<View> outFragmentParallaxViews = outFragment.getParallaxViews();\n        for (View view : outFragmentParallaxViews) {\n            ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n            view.setTranslationX(( -positionOffsetPixels) * parallaxTag.getxOut());\n            view.setTranslationY(( -positionOffsetPixels) * parallaxTag.getyOut());\n        }\n\n        try {\n            ParallaxFragment inFragment = mFragments.get(position + 1);\n            outFragmentParallaxViews = inFragment.getParallaxViews();\n            for (View view : outFragmentParallaxViews) {\n                ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n                view.setTranslationX(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getxIn());\n                view.setTranslationY(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getyIn());\n            }\n        } catch (Exception e) {}\n\n    }\n\n    @Override\n    public void onPageSelected(int position) {\n\n    }\n\n    @Override\n    public void onPageScrollStateChanged(int state) {\n\n    }\n});\n```\n\n~\n\n\n\n\n\n\n","source":"_posts/custom-view-parallax.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle:  View \ntags: [Android]\ndate: 2019-04-15\n---\n\n\n\n View \n\n\n\n<!-- more -->\n\n\n\n### \n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190414212815.gif)\n\n### \n\n ViewPager  View \n\n\n\n1. \n2.  View  onMeasure \n3. \n4. Canvas#drawColor \n5. Canvas#drawCircle \n6. \n7.  View \n\n View practice makes perfect\n\n\n\n### \n\n\n\n1.  60\n2.  1/2\n3. \n\n onLayout  View \n\n```java\nprivate void initParams(Context context) {\n\n    // \n    mColorArray = context.getResources().getIntArray(R.array.splash_circle_colors);\n\n    // \n    mBigCircleRadius = getMeasuredWidth() / 4;\n    mSmallCircleRadius = mBigCircleRadius / 7;\n\n    // \n    mPaint = new Paint();\n    mPaint.setDither(true);\n    mPaint.setAntiAlias(true);\n\n    // \n    mCenterX = getMeasuredWidth() / 2;\n    mCenterY = getMeasuredHeight() / 2;\n\n}\n```\n\n\n\n```java\npublic void drawCircle(float cx, float cy, float radius, @NonNull Paint paint)\n```\n\n\n\n\n\n 0  2 View onDraw \n\n\n\n```java\nprivate void setRotateAnimation() {\n    mValueAnimator = ObjectAnimator.ofFloat(0, (float) Math.PI * 2);\n    mValueAnimator.setRepeatCount(-1);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME);\n    mValueAnimator.setInterpolator(new LinearInterpolator());\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mRotatedAngle = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    // \n    canvas.drawColor(Color.WHITE);\n\n    // \n    double percentAngle = Math.PI * 2 / mColorArray.length;\n\n    for (int i = 0; i < mColorArray.length; i++) {\n\n        mPaint.setColor(mColorArray[i]);\n\n        double currAngle = percentAngle * i + mRotatedAngle;\n\n        // x =  * cos()\n        float cx = mCenterX + (float) (mBigCircleRadius * Math.cos(currAngle));\n\n        // y =  * sin()\n        float cy = mCenterY + (float) (mBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n\n    }\n}\n```\n\n\n\n### \n\n****\n\n\n\n```java\nprivate void setMergeAnimation() {\n    //  0\n    mValueAnimator = ObjectAnimator.ofFloat(mBigCircleRadius, 0);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.setInterpolator(new AnticipateInterpolator(5f));\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    canvas.drawColor(Color.WHITE);\n    double percentAngle = Math.PI * 2 / mColorArray.length;\n    for (int i = 0; i < mColorArray.length; i++) {\n        mPaint.setColor(mColorArray[i]);\n        double currAngle = percentAngle * i + mRotatedAngle;\n        //  mCurrBigCircleRadius  \n        float cx = mCenterX + (float) (mCurrBigCircleRadius * Math.cos(currAngle));\n        float cy = mCenterY + (float) (mCurrBigCircleRadius * Math.sin(currAngle));\n      \n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n    }\n}\n```\n\n### \n\n\n\n\n\n```java\nprivate void setMergeAnimation() {\n  \t// mExtendRadius = (int) Math.sqrt(Math.pow(mCenterX, 2) + Math.pow(mCenterX, 2));\n    // mExtendRadius \n    mValueAnimator = ObjectAnimator.ofFloat(0, mExtendRadius);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n\t\t// mCurrBigCircleRadius \n  \t// mExtendRadius - mCurrBigCircleRadius -> \n    float strokeWidth = mExtendRadius - mCurrBigCircleRadius;\n    mPaint.setStrokeWidth(strokeWidth);\n    mPaint.setStyle(Paint.Style.STROKE); // \n    mPaint.setColor(Color.WHITE);\n\t\t// \n    float radius = strokeWidth / 2 + mCurrBigCircleRadius;\n    canvas.drawCircle(mCenterX, mCenterY, radius, mPaint);\n}\n\n```\n\n### ViewPager \n\n ViewPager  ViewPager ** View **\n\n- View\n\n LayoutInflater  setFactory  [Android  LayoutInflater setFactory](<https://blog.csdn.net/lmj623565791/article/details/51503977>)\n\n\n\n- \n\n   attrs \n\n  ```xml\n  <resources>\n      <!-- X -->\n      <attr name=\"translationXIn\" format=\"float\" />\n      <attr name=\"translationXOut\" format=\"float\" />\n      <!-- Y -->\n      <attr name=\"translationYIn\" format=\"float\" />\n      <attr name=\"translationYOut\" format=\"float\" />\n  </resources>\n  ```\n\n   View  View View  tag \n\n  ```xml\n  <resources>\n      <item name=\"parallax_tag\" type=\"id\"/>\n  </resources>\n  ```\n\n  ```java\n   private int[] mParallaxAttrs = new int[]{\n              R.attr.translationXIn, R.attr.translationXOut,\n              R.attr.translationYIn, R.attr.translationYOut\n      };\n  \n  private void analysisAttrs(View view, Context context, AttributeSet attrs) {\n      TypedArray array = context.obtainStyledAttributes(attrs, mParallaxAttrs);\n  \n      // \n      if (array != null && array.getIndexCount() != 0) {\n  \n          ParallaxTag parallaxTag = new ParallaxTag();\n          for (int i = 0; i < array.getIndexCount(); i++) {\n  \n              int arrayIndex = array.getIndex(i);\n  \n              switch (arrayIndex) {\n                  case 0:\n                      parallaxTag.setxIn(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 1:\n                      parallaxTag.setxOut(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 2:\n                      parallaxTag.setyIn(array.getFloat(arrayIndex, 0f));\n                      break;\n                  case 3:\n                      parallaxTag.setyOut(array.getFloat(arrayIndex, 0f));\n                      break;\n              }\n  \n              //  ->  View  tag\n              view.setTag(R.id.parallax_tag, parallaxTag);\n  \n              //  View \n              mParallaxViews.add(view);\n          }\n  \n          array.recycle();\n      }\n  }\n  ```\n  \n\n ViewPager  Fragment  ViewPager  Fragment  View  Fragment \n\n```java\naddOnPageChangeListener(new OnPageChangeListener() {\n    @Override\n    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {\n\n        //  fragment\n        ParallaxFragment outFragment = mFragments.get(position);\n\n\n        List<View> outFragmentParallaxViews = outFragment.getParallaxViews();\n        for (View view : outFragmentParallaxViews) {\n            ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n            view.setTranslationX(( -positionOffsetPixels) * parallaxTag.getxOut());\n            view.setTranslationY(( -positionOffsetPixels) * parallaxTag.getyOut());\n        }\n\n        try {\n            ParallaxFragment inFragment = mFragments.get(position + 1);\n            outFragmentParallaxViews = inFragment.getParallaxViews();\n            for (View view : outFragmentParallaxViews) {\n                ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n                view.setTranslationX(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getxIn());\n                view.setTranslationY(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getyIn());\n            }\n        } catch (Exception e) {}\n\n    }\n\n    @Override\n    public void onPageSelected(int position) {\n\n    }\n\n    @Override\n    public void onPageScrollStateChanged(int state) {\n\n    }\n});\n```\n\n~\n\n\n\n\n\n\n","slug":"custom-view-parallax","published":1,"updated":"2019-04-15T09:24:13.834Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dp001clh1pmwrxyvss","content":"<p> View </p>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190414212815.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ViewPager  View </p>\n<p></p>\n<ol>\n<li></li>\n<li> View  onMeasure </li>\n<li></li>\n<li>Canvas#drawColor </li>\n<li>Canvas#drawCircle </li>\n<li></li>\n<li> View </li>\n</ol>\n<p> View practice makes perfect</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li> 60</li>\n<li> 1/2</li>\n<li></li>\n</ol>\n<p> onLayout  View </p>\n<pre><code class=\"java\">private void initParams(Context context) {\n\n    // \n    mColorArray = context.getResources().getIntArray(R.array.splash_circle_colors);\n\n    // \n    mBigCircleRadius = getMeasuredWidth() / 4;\n    mSmallCircleRadius = mBigCircleRadius / 7;\n\n    // \n    mPaint = new Paint();\n    mPaint.setDither(true);\n    mPaint.setAntiAlias(true);\n\n    // \n    mCenterX = getMeasuredWidth() / 2;\n    mCenterY = getMeasuredHeight() / 2;\n\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public void drawCircle(float cx, float cy, float radius, @NonNull Paint paint)\n</code></pre>\n<p></p>\n<p></p>\n<p> 0  2 View onDraw </p>\n<p></p>\n<pre><code class=\"java\">private void setRotateAnimation() {\n    mValueAnimator = ObjectAnimator.ofFloat(0, (float) Math.PI * 2);\n    mValueAnimator.setRepeatCount(-1);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME);\n    mValueAnimator.setInterpolator(new LinearInterpolator());\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mRotatedAngle = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    // \n    canvas.drawColor(Color.WHITE);\n\n    // \n    double percentAngle = Math.PI * 2 / mColorArray.length;\n\n    for (int i = 0; i &lt; mColorArray.length; i++) {\n\n        mPaint.setColor(mColorArray[i]);\n\n        double currAngle = percentAngle * i + mRotatedAngle;\n\n        // x =  * cos()\n        float cx = mCenterX + (float) (mBigCircleRadius * Math.cos(currAngle));\n\n        // y =  * sin()\n        float cy = mCenterY + (float) (mBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n\n    }\n}\n</code></pre>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong></p>\n<p></p>\n<pre><code class=\"java\">private void setMergeAnimation() {\n    //  0\n    mValueAnimator = ObjectAnimator.ofFloat(mBigCircleRadius, 0);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.setInterpolator(new AnticipateInterpolator(5f));\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    canvas.drawColor(Color.WHITE);\n    double percentAngle = Math.PI * 2 / mColorArray.length;\n    for (int i = 0; i &lt; mColorArray.length; i++) {\n        mPaint.setColor(mColorArray[i]);\n        double currAngle = percentAngle * i + mRotatedAngle;\n        //  mCurrBigCircleRadius  \n        float cx = mCenterX + (float) (mCurrBigCircleRadius * Math.cos(currAngle));\n        float cy = mCenterY + (float) (mCurrBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n    }\n}\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<pre><code class=\"java\">private void setMergeAnimation() {\n      // mExtendRadius = (int) Math.sqrt(Math.pow(mCenterX, 2) + Math.pow(mCenterX, 2));\n    // mExtendRadius \n    mValueAnimator = ObjectAnimator.ofFloat(0, mExtendRadius);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n        // mCurrBigCircleRadius \n      // mExtendRadius - mCurrBigCircleRadius -&gt; \n    float strokeWidth = mExtendRadius - mCurrBigCircleRadius;\n    mPaint.setStrokeWidth(strokeWidth);\n    mPaint.setStyle(Paint.Style.STROKE); // \n    mPaint.setColor(Color.WHITE);\n        // \n    float radius = strokeWidth / 2 + mCurrBigCircleRadius;\n    canvas.drawCircle(mCenterX, mCenterY, radius, mPaint);\n}\n\n</code></pre>\n<h3 id=\"ViewPager-\"><a href=\"#ViewPager-\" class=\"headerlink\" title=\"ViewPager \"></a>ViewPager </h3><p> ViewPager  ViewPager <strong> View </strong></p>\n<ul>\n<li>View</li>\n</ul>\n<p> LayoutInflater  setFactory  <a href=\"https://blog.csdn.net/lmj623565791/article/details/51503977\" target=\"_blank\" rel=\"noopener\">Android  LayoutInflater setFactory</a></p>\n<p></p>\n<ul>\n<li><p></p>\n<p> attrs </p>\n<pre><code class=\"xml\">&lt;resources&gt;\n    &lt;!-- X --&gt;\n    &lt;attr name=&quot;translationXIn&quot; format=&quot;float&quot; /&gt;\n    &lt;attr name=&quot;translationXOut&quot; format=&quot;float&quot; /&gt;\n    &lt;!-- Y --&gt;\n    &lt;attr name=&quot;translationYIn&quot; format=&quot;float&quot; /&gt;\n    &lt;attr name=&quot;translationYOut&quot; format=&quot;float&quot; /&gt;\n&lt;/resources&gt;\n</code></pre>\n<p> View  View View  tag </p>\n<pre><code class=\"xml\">&lt;resources&gt;\n    &lt;item name=&quot;parallax_tag&quot; type=&quot;id&quot;/&gt;\n&lt;/resources&gt;\n</code></pre>\n<pre><code class=\"java\"> private int[] mParallaxAttrs = new int[]{\n            R.attr.translationXIn, R.attr.translationXOut,\n            R.attr.translationYIn, R.attr.translationYOut\n    };\n\nprivate void analysisAttrs(View view, Context context, AttributeSet attrs) {\n    TypedArray array = context.obtainStyledAttributes(attrs, mParallaxAttrs);\n\n    // \n    if (array != null &amp;&amp; array.getIndexCount() != 0) {\n\n        ParallaxTag parallaxTag = new ParallaxTag();\n        for (int i = 0; i &lt; array.getIndexCount(); i++) {\n\n            int arrayIndex = array.getIndex(i);\n\n            switch (arrayIndex) {\n                case 0:\n                    parallaxTag.setxIn(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 1:\n                    parallaxTag.setxOut(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 2:\n                    parallaxTag.setyIn(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 3:\n                    parallaxTag.setyOut(array.getFloat(arrayIndex, 0f));\n                    break;\n            }\n\n            //  -&gt;  View  tag\n            view.setTag(R.id.parallax_tag, parallaxTag);\n\n            //  View \n            mParallaxViews.add(view);\n        }\n\n        array.recycle();\n    }\n}\n</code></pre>\n</li>\n</ul>\n<p> ViewPager  Fragment  ViewPager  Fragment  View  Fragment </p>\n<pre><code class=\"java\">addOnPageChangeListener(new OnPageChangeListener() {\n    @Override\n    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {\n\n        //  fragment\n        ParallaxFragment outFragment = mFragments.get(position);\n\n\n        List&lt;View&gt; outFragmentParallaxViews = outFragment.getParallaxViews();\n        for (View view : outFragmentParallaxViews) {\n            ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n            view.setTranslationX(( -positionOffsetPixels) * parallaxTag.getxOut());\n            view.setTranslationY(( -positionOffsetPixels) * parallaxTag.getyOut());\n        }\n\n        try {\n            ParallaxFragment inFragment = mFragments.get(position + 1);\n            outFragmentParallaxViews = inFragment.getParallaxViews();\n            for (View view : outFragmentParallaxViews) {\n                ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n                view.setTranslationX(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getxIn());\n                view.setTranslationY(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getyIn());\n            }\n        } catch (Exception e) {}\n\n    }\n\n    @Override\n    public void onPageSelected(int position) {\n\n    }\n\n    @Override\n    public void onPageScrollStateChanged(int state) {\n\n    }\n});\n</code></pre>\n<p>~</p>\n","site":{"data":{}},"excerpt":"<p> View </p>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190414212815.gif\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ViewPager  View </p>\n<p></p>\n<ol>\n<li></li>\n<li> View  onMeasure </li>\n<li></li>\n<li>Canvas#drawColor </li>\n<li>Canvas#drawCircle </li>\n<li></li>\n<li> View </li>\n</ol>\n<p> View practice makes perfect</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li> 60</li>\n<li> 1/2</li>\n<li></li>\n</ol>\n<p> onLayout  View </p>\n<pre><code class=\"java\">private void initParams(Context context) {\n\n    // \n    mColorArray = context.getResources().getIntArray(R.array.splash_circle_colors);\n\n    // \n    mBigCircleRadius = getMeasuredWidth() / 4;\n    mSmallCircleRadius = mBigCircleRadius / 7;\n\n    // \n    mPaint = new Paint();\n    mPaint.setDither(true);\n    mPaint.setAntiAlias(true);\n\n    // \n    mCenterX = getMeasuredWidth() / 2;\n    mCenterY = getMeasuredHeight() / 2;\n\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">public void drawCircle(float cx, float cy, float radius, @NonNull Paint paint)\n</code></pre>\n<p></p>\n<p></p>\n<p> 0  2 View onDraw </p>\n<p></p>\n<pre><code class=\"java\">private void setRotateAnimation() {\n    mValueAnimator = ObjectAnimator.ofFloat(0, (float) Math.PI * 2);\n    mValueAnimator.setRepeatCount(-1);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME);\n    mValueAnimator.setInterpolator(new LinearInterpolator());\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mRotatedAngle = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    // \n    canvas.drawColor(Color.WHITE);\n\n    // \n    double percentAngle = Math.PI * 2 / mColorArray.length;\n\n    for (int i = 0; i &lt; mColorArray.length; i++) {\n\n        mPaint.setColor(mColorArray[i]);\n\n        double currAngle = percentAngle * i + mRotatedAngle;\n\n        // x =  * cos()\n        float cx = mCenterX + (float) (mBigCircleRadius * Math.cos(currAngle));\n\n        // y =  * sin()\n        float cy = mCenterY + (float) (mBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n\n    }\n}\n</code></pre>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong></p>\n<p></p>\n<pre><code class=\"java\">private void setMergeAnimation() {\n    //  0\n    mValueAnimator = ObjectAnimator.ofFloat(mBigCircleRadius, 0);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.setInterpolator(new AnticipateInterpolator(5f));\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n    canvas.drawColor(Color.WHITE);\n    double percentAngle = Math.PI * 2 / mColorArray.length;\n    for (int i = 0; i &lt; mColorArray.length; i++) {\n        mPaint.setColor(mColorArray[i]);\n        double currAngle = percentAngle * i + mRotatedAngle;\n        //  mCurrBigCircleRadius  \n        float cx = mCenterX + (float) (mCurrBigCircleRadius * Math.cos(currAngle));\n        float cy = mCenterY + (float) (mCurrBigCircleRadius * Math.sin(currAngle));\n\n        canvas.drawCircle(cx, cy, mSmallCircleRadius, mPaint);\n    }\n}\n</code></pre>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<pre><code class=\"java\">private void setMergeAnimation() {\n      // mExtendRadius = (int) Math.sqrt(Math.pow(mCenterX, 2) + Math.pow(mCenterX, 2));\n    // mExtendRadius \n    mValueAnimator = ObjectAnimator.ofFloat(0, mExtendRadius);\n    mValueAnimator.setDuration(ROTATION_ANIMATION_TIME / 2);\n    mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n        @Override\n        public void onAnimationUpdate(ValueAnimator animation) {\n            mCurrBigCircleRadius = (float) animation.getAnimatedValue();\n            invalidate();\n        }\n    });\n    mValueAnimator.start();\n}\n\npublic void draw(Canvas canvas) {\n        // mCurrBigCircleRadius \n      // mExtendRadius - mCurrBigCircleRadius -&gt; \n    float strokeWidth = mExtendRadius - mCurrBigCircleRadius;\n    mPaint.setStrokeWidth(strokeWidth);\n    mPaint.setStyle(Paint.Style.STROKE); // \n    mPaint.setColor(Color.WHITE);\n        // \n    float radius = strokeWidth / 2 + mCurrBigCircleRadius;\n    canvas.drawCircle(mCenterX, mCenterY, radius, mPaint);\n}\n\n</code></pre>\n<h3 id=\"ViewPager-\"><a href=\"#ViewPager-\" class=\"headerlink\" title=\"ViewPager \"></a>ViewPager </h3><p> ViewPager  ViewPager <strong> View </strong></p>\n<ul>\n<li>View</li>\n</ul>\n<p> LayoutInflater  setFactory  <a href=\"https://blog.csdn.net/lmj623565791/article/details/51503977\" target=\"_blank\" rel=\"noopener\">Android  LayoutInflater setFactory</a></p>\n<p></p>\n<ul>\n<li><p></p>\n<p> attrs </p>\n<pre><code class=\"xml\">&lt;resources&gt;\n    &lt;!-- X --&gt;\n    &lt;attr name=&quot;translationXIn&quot; format=&quot;float&quot; /&gt;\n    &lt;attr name=&quot;translationXOut&quot; format=&quot;float&quot; /&gt;\n    &lt;!-- Y --&gt;\n    &lt;attr name=&quot;translationYIn&quot; format=&quot;float&quot; /&gt;\n    &lt;attr name=&quot;translationYOut&quot; format=&quot;float&quot; /&gt;\n&lt;/resources&gt;\n</code></pre>\n<p> View  View View  tag </p>\n<pre><code class=\"xml\">&lt;resources&gt;\n    &lt;item name=&quot;parallax_tag&quot; type=&quot;id&quot;/&gt;\n&lt;/resources&gt;\n</code></pre>\n<pre><code class=\"java\"> private int[] mParallaxAttrs = new int[]{\n            R.attr.translationXIn, R.attr.translationXOut,\n            R.attr.translationYIn, R.attr.translationYOut\n    };\n\nprivate void analysisAttrs(View view, Context context, AttributeSet attrs) {\n    TypedArray array = context.obtainStyledAttributes(attrs, mParallaxAttrs);\n\n    // \n    if (array != null &amp;&amp; array.getIndexCount() != 0) {\n\n        ParallaxTag parallaxTag = new ParallaxTag();\n        for (int i = 0; i &lt; array.getIndexCount(); i++) {\n\n            int arrayIndex = array.getIndex(i);\n\n            switch (arrayIndex) {\n                case 0:\n                    parallaxTag.setxIn(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 1:\n                    parallaxTag.setxOut(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 2:\n                    parallaxTag.setyIn(array.getFloat(arrayIndex, 0f));\n                    break;\n                case 3:\n                    parallaxTag.setyOut(array.getFloat(arrayIndex, 0f));\n                    break;\n            }\n\n            //  -&gt;  View  tag\n            view.setTag(R.id.parallax_tag, parallaxTag);\n\n            //  View \n            mParallaxViews.add(view);\n        }\n\n        array.recycle();\n    }\n}\n</code></pre>\n</li>\n</ul>\n<p> ViewPager  Fragment  ViewPager  Fragment  View  Fragment </p>\n<pre><code class=\"java\">addOnPageChangeListener(new OnPageChangeListener() {\n    @Override\n    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {\n\n        //  fragment\n        ParallaxFragment outFragment = mFragments.get(position);\n\n\n        List&lt;View&gt; outFragmentParallaxViews = outFragment.getParallaxViews();\n        for (View view : outFragmentParallaxViews) {\n            ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n            view.setTranslationX(( -positionOffsetPixels) * parallaxTag.getxOut());\n            view.setTranslationY(( -positionOffsetPixels) * parallaxTag.getyOut());\n        }\n\n        try {\n            ParallaxFragment inFragment = mFragments.get(position + 1);\n            outFragmentParallaxViews = inFragment.getParallaxViews();\n            for (View view : outFragmentParallaxViews) {\n                ParallaxTag parallaxTag = (ParallaxTag) view.getTag(R.id.parallax_tag);\n                view.setTranslationX(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getxIn());\n                view.setTranslationY(\n                  (getMeasuredWidth() - positionOffsetPixels) * parallaxTag.getyIn());\n            }\n        } catch (Exception e) {}\n\n    }\n\n    @Override\n    public void onPageSelected(int position) {\n\n    }\n\n    @Override\n    public void onPageScrollStateChanged(int state) {\n\n    }\n});\n</code></pre>\n<p>~</p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg","title":"Java ","date":"2019-08-13T16:00:00.000Z","_content":"\n\n\n Hook  activity \n\n<!-- more -->\n\n### \n\n\n\n> \n\n\n\n\n\n\n\n\n\n#### \n\nUML \n\n```java\n\npublic interface IRentHouse{\n  void rentHouse();\n}\n\npublic class Couple implements IRentHouse{\n  \n  public void rentHouse(){\n    System.out.println(\"\");\n  }\n  \n}\n\npublic class RentAgent implements IRentHouse{\n\n  private IRentHouse mClient;\n  \n  public RentAgent(IRentHouse client){\n    mClient = client;\n  }\n  \n  public void rentHouse(){\n    System.out.println(\"\");\n    if(mClient != null){\n      \tmClient.rentHouse();\n    }\n    System.out.println(\"\");\n  }\n\n}\n\n```\n\n`RentAgent`  `Couple`  `Couple`  `RentAgent`  `Couple` \n\n\n\n```java\npublic static void main(String[] args) {\n\n  Couple couple = new Couple();\n  RentAgent rentAgent = new RentAgent(couple);\n  rentAgent.rentHouse();\n\n}\n```\n\n```java\n\n\n\n```\n\n\n\n\n\n\n\n#### \n\n JDK  JDK API\n\n JDK  **JDK **\n\n\n\n:\n\n- java.lang.reflect.Proxy\n\n  ```java\n  // Proxy \n  //  InvocationHandler \n  Object newProxyInstance(ClassLoader loader,\t\t // \n                          Class<?>[] interfaces, // \n                          InvocationHandler h\t\t // \n                          ){}\n  ```\n\n- java.lang.reflect.InvocationHandler\n\n  ```java\n  // \n  // \n  Object invoke(Object proxy, Method method, Object[] args){}\n  ```\n\n\n\n```java\nclass RentInvocationHandler implements InvocationHandler {\n\n    private Object mClient;\n\n    public RentInvocationHandler(Object client) {\n        this.mClient = client;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\n        System.out.println(\"\");\n        Object invoke = method.invoke(mClient, args);\n        System.out.println(\"\");\n\n        return invoke;\n    }\n}\n```\n\n\n\n```java\nCouple couple = new Couple();\n// \nIRentHouse rentProxy =(IRentHouse)Proxy.newProxyInstance(\n  \t\t\t\t\t\t\t\t\t\t\t\t\t\tcouple.getClass().getClassLoader(),\n               \t\t\t\t\t\t\t\tcouple.getClass().getInterfaces(), \n  \t\t\t\t\t\t\t\t\t\t\t\t\t\tnew RentInvocationHandler(couple));\nrentProxy.rentHouse(); // \n```\n\n\n\n```java\n\n\n\n```\n\n\n\n1. \n\n    final  public \n\n2. \n\n    $ProxyN N  Proxy  N  Proxy  N  Proxy \n\n3. \n\n   $Proxy0 extends Proxy implements InterfaceA, InterfaceB, InterfaceX\n\n Java  Proxy \n\n\n\n### Cglib \n\nCglib cglib\n\nCglib  Android Spring \n\ncglib[cglibjar](https://repo1.maven.org/maven2/cglib/cglib/3.2.5/cglib-3.2.5.jar)\n\n```java\npublic class ProxyFactory implements MethodInterceptor{\n\n    private Object target;\t//\n    public ProxyFactory(Object target) {\n        this.target = target;\n    }\n    \n    //\n    public Object getProxyInstance() {\n        //\n        Enhancer en = new Enhancer();\n        //\n        en.setSuperclass(target.getClass());\n        //\n        en.setCallback(this);\n        //\n        return en.create();\n    }\n\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println(\"\");\n        // \n        Object returnValue = method.invoke(target, args);\n        System.out.println(\"\");\n        return returnValue;\n    }\n}\n```\n\n\n\n\n\n###  vs \n\n\n\n UML //\n\n- \n\n  \n\n- \n\n  \n\n\n\n\n\n1.  RecyclerView Wrapper  adapter  RecyclerView\n\n2. Retrofit  create \n\n   ```java\n   public <T> T create(final Class<T> service) {\n       return (T) Proxy.newProxyInstance(\n         \t\t\t\t\t\tservice.getClassLoader(), \n         \t\t\t\t\t\tnew Class<?>[] { service }, \n         \t\t\t\t\t\tnew InvocationHandler() {}});\n   }\n   ```\n\n\n\n### \n\n- [Java](https://www.jianshu.com/p/6f6bb2f0ece9)\n\n- [Java ](https://www.ibm.com/developerworks/cn/java/j-lo-proxy1/)\n\n- [Java(jdkcglib)](https://www.cnblogs.com/fillPv/p/5939277.html)\n\n- [Javacglib](https://segmentfault.com/a/1190000011291179)\n\n- [Java](https://segmentfault.com/a/1190000009235245)\n\n  \n\n","source":"_posts/java-proxy-pattern.md","raw":"---\n\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190415172255.jpg\ntitle: Java \ntags: [design-pattern]\ndate: 2019-08-14\n\n---\n\n\n\n Hook  activity \n\n<!-- more -->\n\n### \n\n\n\n> \n\n\n\n\n\n\n\n\n\n#### \n\nUML \n\n```java\n\npublic interface IRentHouse{\n  void rentHouse();\n}\n\npublic class Couple implements IRentHouse{\n  \n  public void rentHouse(){\n    System.out.println(\"\");\n  }\n  \n}\n\npublic class RentAgent implements IRentHouse{\n\n  private IRentHouse mClient;\n  \n  public RentAgent(IRentHouse client){\n    mClient = client;\n  }\n  \n  public void rentHouse(){\n    System.out.println(\"\");\n    if(mClient != null){\n      \tmClient.rentHouse();\n    }\n    System.out.println(\"\");\n  }\n\n}\n\n```\n\n`RentAgent`  `Couple`  `Couple`  `RentAgent`  `Couple` \n\n\n\n```java\npublic static void main(String[] args) {\n\n  Couple couple = new Couple();\n  RentAgent rentAgent = new RentAgent(couple);\n  rentAgent.rentHouse();\n\n}\n```\n\n```java\n\n\n\n```\n\n\n\n\n\n\n\n#### \n\n JDK  JDK API\n\n JDK  **JDK **\n\n\n\n:\n\n- java.lang.reflect.Proxy\n\n  ```java\n  // Proxy \n  //  InvocationHandler \n  Object newProxyInstance(ClassLoader loader,\t\t // \n                          Class<?>[] interfaces, // \n                          InvocationHandler h\t\t // \n                          ){}\n  ```\n\n- java.lang.reflect.InvocationHandler\n\n  ```java\n  // \n  // \n  Object invoke(Object proxy, Method method, Object[] args){}\n  ```\n\n\n\n```java\nclass RentInvocationHandler implements InvocationHandler {\n\n    private Object mClient;\n\n    public RentInvocationHandler(Object client) {\n        this.mClient = client;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\n        System.out.println(\"\");\n        Object invoke = method.invoke(mClient, args);\n        System.out.println(\"\");\n\n        return invoke;\n    }\n}\n```\n\n\n\n```java\nCouple couple = new Couple();\n// \nIRentHouse rentProxy =(IRentHouse)Proxy.newProxyInstance(\n  \t\t\t\t\t\t\t\t\t\t\t\t\t\tcouple.getClass().getClassLoader(),\n               \t\t\t\t\t\t\t\tcouple.getClass().getInterfaces(), \n  \t\t\t\t\t\t\t\t\t\t\t\t\t\tnew RentInvocationHandler(couple));\nrentProxy.rentHouse(); // \n```\n\n\n\n```java\n\n\n\n```\n\n\n\n1. \n\n    final  public \n\n2. \n\n    $ProxyN N  Proxy  N  Proxy  N  Proxy \n\n3. \n\n   $Proxy0 extends Proxy implements InterfaceA, InterfaceB, InterfaceX\n\n Java  Proxy \n\n\n\n### Cglib \n\nCglib cglib\n\nCglib  Android Spring \n\ncglib[cglibjar](https://repo1.maven.org/maven2/cglib/cglib/3.2.5/cglib-3.2.5.jar)\n\n```java\npublic class ProxyFactory implements MethodInterceptor{\n\n    private Object target;\t//\n    public ProxyFactory(Object target) {\n        this.target = target;\n    }\n    \n    //\n    public Object getProxyInstance() {\n        //\n        Enhancer en = new Enhancer();\n        //\n        en.setSuperclass(target.getClass());\n        //\n        en.setCallback(this);\n        //\n        return en.create();\n    }\n\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println(\"\");\n        // \n        Object returnValue = method.invoke(target, args);\n        System.out.println(\"\");\n        return returnValue;\n    }\n}\n```\n\n\n\n\n\n###  vs \n\n\n\n UML //\n\n- \n\n  \n\n- \n\n  \n\n\n\n\n\n1.  RecyclerView Wrapper  adapter  RecyclerView\n\n2. Retrofit  create \n\n   ```java\n   public <T> T create(final Class<T> service) {\n       return (T) Proxy.newProxyInstance(\n         \t\t\t\t\t\tservice.getClassLoader(), \n         \t\t\t\t\t\tnew Class<?>[] { service }, \n         \t\t\t\t\t\tnew InvocationHandler() {}});\n   }\n   ```\n\n\n\n### \n\n- [Java](https://www.jianshu.com/p/6f6bb2f0ece9)\n\n- [Java ](https://www.ibm.com/developerworks/cn/java/j-lo-proxy1/)\n\n- [Java(jdkcglib)](https://www.cnblogs.com/fillPv/p/5939277.html)\n\n- [Javacglib](https://segmentfault.com/a/1190000011291179)\n\n- [Java](https://segmentfault.com/a/1190000009235245)\n\n  \n\n","slug":"java-proxy-pattern","published":1,"updated":"2019-08-14T09:15:19.456Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dr001elh1p2e8klfdt","content":"<p> Hook  activity </p>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>UML </p>\n<pre><code class=\"java\">\npublic interface IRentHouse{\n  void rentHouse();\n}\n\npublic class Couple implements IRentHouse{\n\n  public void rentHouse(){\n    System.out.println(&quot;&quot;);\n  }\n\n}\n\npublic class RentAgent implements IRentHouse{\n\n  private IRentHouse mClient;\n\n  public RentAgent(IRentHouse client){\n    mClient = client;\n  }\n\n  public void rentHouse(){\n    System.out.println(&quot;&quot;);\n    if(mClient != null){\n          mClient.rentHouse();\n    }\n    System.out.println(&quot;&quot;);\n  }\n\n}\n\n</code></pre>\n<p><code>RentAgent</code>  <code>Couple</code>  <code>Couple</code>  <code>RentAgent</code>  <code>Couple</code> </p>\n<p></p>\n<pre><code class=\"java\">public static void main(String[] args) {\n\n  Couple couple = new Couple();\n  RentAgent rentAgent = new RentAgent(couple);\n  rentAgent.rentHouse();\n\n}\n</code></pre>\n<pre><code class=\"java\">\n\n\n</code></pre>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> JDK  JDK API</p>\n<p> JDK  <strong>JDK </strong></p>\n<p></p>\n<p>:</p>\n<ul>\n<li><p>java.lang.reflect.Proxy</p>\n<pre><code class=\"java\">// Proxy \n//  InvocationHandler \nObject newProxyInstance(ClassLoader loader,         // \n                        Class&lt;?&gt;[] interfaces, // \n                        InvocationHandler h         // \n                        ){}\n</code></pre>\n</li>\n<li><p>java.lang.reflect.InvocationHandler</p>\n<pre><code class=\"java\">// \n// \nObject invoke(Object proxy, Method method, Object[] args){}\n</code></pre>\n</li>\n</ul>\n<p></p>\n<pre><code class=\"java\">class RentInvocationHandler implements InvocationHandler {\n\n    private Object mClient;\n\n    public RentInvocationHandler(Object client) {\n        this.mClient = client;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\n        System.out.println(&quot;&quot;);\n        Object invoke = method.invoke(mClient, args);\n        System.out.println(&quot;&quot;);\n\n        return invoke;\n    }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">Couple couple = new Couple();\n// \nIRentHouse rentProxy =(IRentHouse)Proxy.newProxyInstance(\n                                                          couple.getClass().getClassLoader(),\n                                               couple.getClass().getInterfaces(), \n                                                          new RentInvocationHandler(couple));\nrentProxy.rentHouse(); // \n</code></pre>\n<p></p>\n<pre><code class=\"java\">\n\n\n</code></pre>\n<p></p>\n<ol>\n<li><p></p>\n<p> final  public </p>\n</li>\n<li><p></p>\n<p> $ProxyN N  Proxy  N  Proxy  N  Proxy </p>\n</li>\n<li><p></p>\n<p>$Proxy0 extends Proxy implements InterfaceA, InterfaceB, InterfaceX</p>\n</li>\n</ol>\n<p> Java  Proxy </p>\n<h3 id=\"Cglib-\"><a href=\"#Cglib-\" class=\"headerlink\" title=\"Cglib \"></a>Cglib </h3><p>Cglib cglib</p>\n<p>Cglib  Android Spring </p>\n<p>cglib<a href=\"https://repo1.maven.org/maven2/cglib/cglib/3.2.5/cglib-3.2.5.jar\" target=\"_blank\" rel=\"noopener\">cglibjar</a></p>\n<pre><code class=\"java\">public class ProxyFactory implements MethodInterceptor{\n\n    private Object target;    //\n    public ProxyFactory(Object target) {\n        this.target = target;\n    }\n\n    //\n    public Object getProxyInstance() {\n        //\n        Enhancer en = new Enhancer();\n        //\n        en.setSuperclass(target.getClass());\n        //\n        en.setCallback(this);\n        //\n        return en.create();\n    }\n\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println(&quot;&quot;);\n        // \n        Object returnValue = method.invoke(target, args);\n        System.out.println(&quot;&quot;);\n        return returnValue;\n    }\n}\n</code></pre>\n<p></p>\n<h3 id=\"-vs-\"><a href=\"#-vs-\" class=\"headerlink\" title=\" vs \"></a> vs </h3><p></p>\n<p> UML //</p>\n<ul>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p></p>\n</li>\n</ul>\n<p></p>\n<p></p>\n<ol>\n<li><p> RecyclerView Wrapper  adapter  RecyclerView</p>\n</li>\n<li><p>Retrofit  create </p>\n<pre><code class=\"java\">public &lt;T&gt; T create(final Class&lt;T&gt; service) {\n    return (T) Proxy.newProxyInstance(\n                              service.getClassLoader(), \n                              new Class&lt;?&gt;[] { service }, \n                              new InvocationHandler() {}});\n}\n</code></pre>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p><a href=\"https://www.jianshu.com/p/6f6bb2f0ece9\" target=\"_blank\" rel=\"noopener\">Java</a></p>\n</li>\n<li><p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-proxy1/\" target=\"_blank\" rel=\"noopener\">Java </a></p>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/fillPv/p/5939277.html\" target=\"_blank\" rel=\"noopener\">Java(jdkcglib)</a></p>\n</li>\n<li><p><a href=\"https://segmentfault.com/a/1190000011291179\" target=\"_blank\" rel=\"noopener\">Javacglib</a></p>\n</li>\n<li><p><a href=\"https://segmentfault.com/a/1190000009235245\" target=\"_blank\" rel=\"noopener\">Java</a></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> Hook  activity </p>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>UML </p>\n<pre><code class=\"java\">\npublic interface IRentHouse{\n  void rentHouse();\n}\n\npublic class Couple implements IRentHouse{\n\n  public void rentHouse(){\n    System.out.println(&quot;&quot;);\n  }\n\n}\n\npublic class RentAgent implements IRentHouse{\n\n  private IRentHouse mClient;\n\n  public RentAgent(IRentHouse client){\n    mClient = client;\n  }\n\n  public void rentHouse(){\n    System.out.println(&quot;&quot;);\n    if(mClient != null){\n          mClient.rentHouse();\n    }\n    System.out.println(&quot;&quot;);\n  }\n\n}\n\n</code></pre>\n<p><code>RentAgent</code>  <code>Couple</code>  <code>Couple</code>  <code>RentAgent</code>  <code>Couple</code> </p>\n<p></p>\n<pre><code class=\"java\">public static void main(String[] args) {\n\n  Couple couple = new Couple();\n  RentAgent rentAgent = new RentAgent(couple);\n  rentAgent.rentHouse();\n\n}\n</code></pre>\n<pre><code class=\"java\">\n\n\n</code></pre>\n<p></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> JDK  JDK API</p>\n<p> JDK  <strong>JDK </strong></p>\n<p></p>\n<p>:</p>\n<ul>\n<li><p>java.lang.reflect.Proxy</p>\n<pre><code class=\"java\">// Proxy \n//  InvocationHandler \nObject newProxyInstance(ClassLoader loader,         // \n                        Class&lt;?&gt;[] interfaces, // \n                        InvocationHandler h         // \n                        ){}\n</code></pre>\n</li>\n<li><p>java.lang.reflect.InvocationHandler</p>\n<pre><code class=\"java\">// \n// \nObject invoke(Object proxy, Method method, Object[] args){}\n</code></pre>\n</li>\n</ul>\n<p></p>\n<pre><code class=\"java\">class RentInvocationHandler implements InvocationHandler {\n\n    private Object mClient;\n\n    public RentInvocationHandler(Object client) {\n        this.mClient = client;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\n        System.out.println(&quot;&quot;);\n        Object invoke = method.invoke(mClient, args);\n        System.out.println(&quot;&quot;);\n\n        return invoke;\n    }\n}\n</code></pre>\n<p></p>\n<pre><code class=\"java\">Couple couple = new Couple();\n// \nIRentHouse rentProxy =(IRentHouse)Proxy.newProxyInstance(\n                                                          couple.getClass().getClassLoader(),\n                                               couple.getClass().getInterfaces(), \n                                                          new RentInvocationHandler(couple));\nrentProxy.rentHouse(); // \n</code></pre>\n<p></p>\n<pre><code class=\"java\">\n\n\n</code></pre>\n<p></p>\n<ol>\n<li><p></p>\n<p> final  public </p>\n</li>\n<li><p></p>\n<p> $ProxyN N  Proxy  N  Proxy  N  Proxy </p>\n</li>\n<li><p></p>\n<p>$Proxy0 extends Proxy implements InterfaceA, InterfaceB, InterfaceX</p>\n</li>\n</ol>\n<p> Java  Proxy </p>\n<h3 id=\"Cglib-\"><a href=\"#Cglib-\" class=\"headerlink\" title=\"Cglib \"></a>Cglib </h3><p>Cglib cglib</p>\n<p>Cglib  Android Spring </p>\n<p>cglib<a href=\"https://repo1.maven.org/maven2/cglib/cglib/3.2.5/cglib-3.2.5.jar\" target=\"_blank\" rel=\"noopener\">cglibjar</a></p>\n<pre><code class=\"java\">public class ProxyFactory implements MethodInterceptor{\n\n    private Object target;    //\n    public ProxyFactory(Object target) {\n        this.target = target;\n    }\n\n    //\n    public Object getProxyInstance() {\n        //\n        Enhancer en = new Enhancer();\n        //\n        en.setSuperclass(target.getClass());\n        //\n        en.setCallback(this);\n        //\n        return en.create();\n    }\n\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println(&quot;&quot;);\n        // \n        Object returnValue = method.invoke(target, args);\n        System.out.println(&quot;&quot;);\n        return returnValue;\n    }\n}\n</code></pre>\n<p></p>\n<h3 id=\"-vs-\"><a href=\"#-vs-\" class=\"headerlink\" title=\" vs \"></a> vs </h3><p></p>\n<p> UML //</p>\n<ul>\n<li><p></p>\n<p></p>\n</li>\n<li><p></p>\n<p></p>\n</li>\n</ul>\n<p></p>\n<p></p>\n<ol>\n<li><p> RecyclerView Wrapper  adapter  RecyclerView</p>\n</li>\n<li><p>Retrofit  create </p>\n<pre><code class=\"java\">public &lt;T&gt; T create(final Class&lt;T&gt; service) {\n    return (T) Proxy.newProxyInstance(\n                              service.getClassLoader(), \n                              new Class&lt;?&gt;[] { service }, \n                              new InvocationHandler() {}});\n}\n</code></pre>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p><a href=\"https://www.jianshu.com/p/6f6bb2f0ece9\" target=\"_blank\" rel=\"noopener\">Java</a></p>\n</li>\n<li><p><a href=\"https://www.ibm.com/developerworks/cn/java/j-lo-proxy1/\" target=\"_blank\" rel=\"noopener\">Java </a></p>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/fillPv/p/5939277.html\" target=\"_blank\" rel=\"noopener\">Java(jdkcglib)</a></p>\n</li>\n<li><p><a href=\"https://segmentfault.com/a/1190000011291179\" target=\"_blank\" rel=\"noopener\">Javacglib</a></p>\n</li>\n<li><p><a href=\"https://segmentfault.com/a/1190000009235245\" target=\"_blank\" rel=\"noopener\">Java</a></p>\n</li>\n</ul>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181407.jpg","title":"Context ","date":"2019-11-13T16:00:00.000Z","_content":"\nContext  Android API \n\n\n\n<!-- more -->\n\n\n\n* + [](https://www.freecodecamp.org/news/mastering-android-context-7055c8478a22/)*\n\n Android Context Context  Android \n\n> Context  Android API  **God object** \n\n\n\n###\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182421.png)\n\n\n\n`Activity``Service``Application`  `Context`  App \n\n`getContext()\t``this``getBaseContext()` `getApplicationContext()`  yes\n\n\n\n### Context \n\n Android APK  Android  Manifest  Activity(UI)Service(Background) BroadcastReceiver (Action), ContentProvider (Data),  Resources (images, strings ) \n\n IntentFilter  \n\nAndroid  WifiManagerVibrator  PackageManager\n\nContext  Context \n\n##### 1. \n\n Context  Activity, Content Provider, BroadcastReceiver  Context \n\n##### 2. \n\nContext  Android  Context  `context.getSystemService(Context.WIFI_SERVICE)`   WifiManager \n\n##### 3.  App \n\n Intent-filter\n\n```java\nIntent emailIntent = new Intent(android.content.Intent.ACTION_SEND);\nemailIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nemailIntent.setType(\"vnd.android.cursor.item/email\");\nemailIntent.putExtra(android.content.Intent.EXTRA_EMAIL, new String[]{address});\nemailIntent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject);\nemailIntent.putExtra(android.content.Intent.EXTRA_TEXT, content);\n```\n\n App \n\n** Android  Context **Context \n\n\n\n### Context \n\n Context **** Context \n\n-  Activity  Application \n\n-  Activity  this Activity \n\n-  Activity  getApplicationContext() \n\n-  Activity  getBaseContext()\n\n-  Fragment  View  getContext()\n\n- Broadcast Receiver  Service  Context \n\n-  Service  this Service \n\n-  Service  getApplicationContext() \n\n-  Context  getApplicationContext() \n\n Context UI Context  Non-UI Context\n\n##### UI Context\n\n ContextThemeWrapper  UI Context Context +  Theme \n\n Activity  ContextThemeWrapper Non-UI Context \n\n Activity  Context  UI Context Fragment  getContext()   Activity Fragment  Activity  FragmentManager \n\n*View.getContext()  UI Context*\n\n View  LayoutInflator  LayoutInflator  Context  UI Context View  Context  UI Context Context  UI Context Non-UI Context\n\n<u>*UI Context*</u>\n\n\n-  Activity  this Activity \n-  Fragment  getContext()\n- * UI Context * View  getContext()\n\n##### Non-UI Context\n\n UI Context  Non-UI Context ContextThemeWrapper  UI Context\n\nNon-UI Context  UI Context  Non-UI Context **** Non-UI Context \n\n<u>*Non-UI Context*</u>\n\n-  Activity  Application \n- Broadcast Receiver  Service  Context \n-  Service  this Service \n-  Service  getApplicationContext() \n-  Activity  getApplicationContext() \n-  Context  getApplicationContext() \n\n Context UI Context  Context + Theme ContextThemeWrapper  Context  Non-UI Context\n\n<u> Context  Application context  Application  getApplicationContext()  Context </u>\n\n\n\n### \n\n#####  1\n\n Non-UI Context \n\n#####  2\n\n UI Context UI Context = Contex + ThemeNon-UI Context  UI Context \n\n#####  3\n\n 2  UI Context \n\n UI Context \n\n Android \n\n**Context **\n\n Context \n\n Context \n\n1.  UI  UI Context Non-UI Context\n2.  Application Context\n\n\n\n###  Context \n\nthisgetApplicationContext()  getBaseContext() \n\n App  App  Context \n\n\n\n\n\n Context  magic method\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182356.png)\n\n createConfigurationContext() \n\n```java\npublic Context createConfigurationContext(Configuration overrideConfiguration){\n \tConfiguration configuration = getResources().getConfiguration();\n\tconfiguration.setLocale(your_custom_locale);\n\tcontext = createConfigurationContext(configuration);\n  return context;\n}\n```\n\n Context  Context \n\n**thisgetApplicationContext()  getBaseContext() **\n\n Activity  Context \n\n1. this  Activity UI Context** context\n\n2. baseContext  Context  Application  createConfigurationContext()  Context  attachBaseContext()  Context \n\n    baseContext Activity  Context  Context Activity  getBaseContext()  Activity \n\nContext  Android App  App  Context Android  Context  Context App  Java \n\n\n\n### Android = Context + Java code\n\n Context \n\n Context \n\n Context  UI Context  Non-UI Context Context\n\n Context UI \n\n Context  App  Context  thisapplicationContext  baseContext \n\n Application Context\n\n Application Context Context","source":"_posts/what's the fuck is Context.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181407.jpg\ntitle: Context \ntags: [Android]\ndate: 2019-11-14\n---\n\nContext  Android API \n\n\n\n<!-- more -->\n\n\n\n* + [](https://www.freecodecamp.org/news/mastering-android-context-7055c8478a22/)*\n\n Android Context Context  Android \n\n> Context  Android API  **God object** \n\n\n\n###\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182421.png)\n\n\n\n`Activity``Service``Application`  `Context`  App \n\n`getContext()\t``this``getBaseContext()` `getApplicationContext()`  yes\n\n\n\n### Context \n\n Android APK  Android  Manifest  Activity(UI)Service(Background) BroadcastReceiver (Action), ContentProvider (Data),  Resources (images, strings ) \n\n IntentFilter  \n\nAndroid  WifiManagerVibrator  PackageManager\n\nContext  Context \n\n##### 1. \n\n Context  Activity, Content Provider, BroadcastReceiver  Context \n\n##### 2. \n\nContext  Android  Context  `context.getSystemService(Context.WIFI_SERVICE)`   WifiManager \n\n##### 3.  App \n\n Intent-filter\n\n```java\nIntent emailIntent = new Intent(android.content.Intent.ACTION_SEND);\nemailIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nemailIntent.setType(\"vnd.android.cursor.item/email\");\nemailIntent.putExtra(android.content.Intent.EXTRA_EMAIL, new String[]{address});\nemailIntent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject);\nemailIntent.putExtra(android.content.Intent.EXTRA_TEXT, content);\n```\n\n App \n\n** Android  Context **Context \n\n\n\n### Context \n\n Context **** Context \n\n-  Activity  Application \n\n-  Activity  this Activity \n\n-  Activity  getApplicationContext() \n\n-  Activity  getBaseContext()\n\n-  Fragment  View  getContext()\n\n- Broadcast Receiver  Service  Context \n\n-  Service  this Service \n\n-  Service  getApplicationContext() \n\n-  Context  getApplicationContext() \n\n Context UI Context  Non-UI Context\n\n##### UI Context\n\n ContextThemeWrapper  UI Context Context +  Theme \n\n Activity  ContextThemeWrapper Non-UI Context \n\n Activity  Context  UI Context Fragment  getContext()   Activity Fragment  Activity  FragmentManager \n\n*View.getContext()  UI Context*\n\n View  LayoutInflator  LayoutInflator  Context  UI Context View  Context  UI Context Context  UI Context Non-UI Context\n\n<u>*UI Context*</u>\n\n\n-  Activity  this Activity \n-  Fragment  getContext()\n- * UI Context * View  getContext()\n\n##### Non-UI Context\n\n UI Context  Non-UI Context ContextThemeWrapper  UI Context\n\nNon-UI Context  UI Context  Non-UI Context **** Non-UI Context \n\n<u>*Non-UI Context*</u>\n\n-  Activity  Application \n- Broadcast Receiver  Service  Context \n-  Service  this Service \n-  Service  getApplicationContext() \n-  Activity  getApplicationContext() \n-  Context  getApplicationContext() \n\n Context UI Context  Context + Theme ContextThemeWrapper  Context  Non-UI Context\n\n<u> Context  Application context  Application  getApplicationContext()  Context </u>\n\n\n\n### \n\n#####  1\n\n Non-UI Context \n\n#####  2\n\n UI Context UI Context = Contex + ThemeNon-UI Context  UI Context \n\n#####  3\n\n 2  UI Context \n\n UI Context \n\n Android \n\n**Context **\n\n Context \n\n Context \n\n1.  UI  UI Context Non-UI Context\n2.  Application Context\n\n\n\n###  Context \n\nthisgetApplicationContext()  getBaseContext() \n\n App  App  Context \n\n\n\n\n\n Context  magic method\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182356.png)\n\n createConfigurationContext() \n\n```java\npublic Context createConfigurationContext(Configuration overrideConfiguration){\n \tConfiguration configuration = getResources().getConfiguration();\n\tconfiguration.setLocale(your_custom_locale);\n\tcontext = createConfigurationContext(configuration);\n  return context;\n}\n```\n\n Context  Context \n\n**thisgetApplicationContext()  getBaseContext() **\n\n Activity  Context \n\n1. this  Activity UI Context** context\n\n2. baseContext  Context  Application  createConfigurationContext()  Context  attachBaseContext()  Context \n\n    baseContext Activity  Context  Context Activity  getBaseContext()  Activity \n\nContext  Android App  App  Context Android  Context  Context App  Java \n\n\n\n### Android = Context + Java code\n\n Context \n\n Context \n\n Context  UI Context  Non-UI Context Context\n\n Context UI \n\n Context  App  Context  thisapplicationContext  baseContext \n\n Application Context\n\n Application Context Context","slug":"what's the fuck is Context","published":1,"updated":"2019-11-14T10:44:32.836Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86dt001hlh1p7ddmr0qu","content":"<p>Context  Android API </p>\n<a id=\"more\"></a>\n<p><em> + <a href=\"https://www.freecodecamp.org/news/mastering-android-context-7055c8478a22/\" target=\"_blank\" rel=\"noopener\"></a></em></p>\n<p> Android Context Context  Android </p>\n<blockquote>\n<p>Context  Android API  <strong>God object</strong> </p>\n</blockquote>\n<p>###</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182421.png\" alt=\"\"></p>\n<p></p>\n<p><code>Activity</code><code>Service</code><code>Application</code>  <code>Context</code>  App </p>\n<p><code>getContext()</code><code>this</code><code>getBaseContext()</code> <code>getApplicationContext()</code>  yes</p>\n<h3 id=\"Context-\"><a href=\"#Context-\" class=\"headerlink\" title=\"Context \"></a>Context </h3><p> Android APK  Android  Manifest  Activity(UI)Service(Background) BroadcastReceiver (Action), ContentProvider (Data),  Resources (images, strings ) </p>\n<p> IntentFilter  </p>\n<p>Android  WifiManagerVibrator  PackageManager</p>\n<p>Context  Context </p>\n<h5 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h5><p> Context  Activity, Content Provider, BroadcastReceiver  Context </p>\n<h5 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h5><p>Context  Android  Context  <code>context.getSystemService(Context.WIFI_SERVICE)</code>   WifiManager </p>\n<h5 id=\"3--App-\"><a href=\"#3--App-\" class=\"headerlink\" title=\"3.  App \"></a>3.  App </h5><p> Intent-filter</p>\n<pre><code class=\"java\">Intent emailIntent = new Intent(android.content.Intent.ACTION_SEND);\nemailIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nemailIntent.setType(&quot;vnd.android.cursor.item/email&quot;);\nemailIntent.putExtra(android.content.Intent.EXTRA_EMAIL, new String[]{address});\nemailIntent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject);\nemailIntent.putExtra(android.content.Intent.EXTRA_TEXT, content);\n</code></pre>\n<p> App </p>\n<p><strong> Android  Context </strong>Context </p>\n<h3 id=\"Context-\"><a href=\"#Context-\" class=\"headerlink\" title=\"Context \"></a>Context </h3><p> Context <strong></strong> Context </p>\n<ul>\n<li><p> Activity  Application </p>\n</li>\n<li><p> Activity  this Activity </p>\n</li>\n<li><p> Activity  getApplicationContext() </p>\n</li>\n<li><p> Activity  getBaseContext()</p>\n</li>\n<li><p> Fragment  View  getContext()</p>\n</li>\n<li><p>Broadcast Receiver  Service  Context </p>\n</li>\n<li><p> Service  this Service </p>\n</li>\n<li><p> Service  getApplicationContext() </p>\n</li>\n<li><p> Context  getApplicationContext() </p>\n</li>\n</ul>\n<p> Context UI Context  Non-UI Context</p>\n<h5 id=\"UI-Context\"><a href=\"#UI-Context\" class=\"headerlink\" title=\"UI Context\"></a>UI Context</h5><p> ContextThemeWrapper  UI Context Context +  Theme </p>\n<p> Activity  ContextThemeWrapper Non-UI Context </p>\n<p> Activity  Context  UI Context Fragment  getContext()   Activity Fragment  Activity  FragmentManager </p>\n<p><em>View.getContext()  UI Context</em></p>\n<p> View  LayoutInflator  LayoutInflator  Context  UI Context View  Context  UI Context Context  UI Context Non-UI Context</p>\n<p><u><em>UI Context</em></u></p>\n<ul>\n<li> Activity  this Activity </li>\n<li> Fragment  getContext()</li>\n<li><em> UI Context </em> View  getContext()</li>\n</ul>\n<h5 id=\"Non-UI-Context\"><a href=\"#Non-UI-Context\" class=\"headerlink\" title=\"Non-UI Context\"></a>Non-UI Context</h5><p> UI Context  Non-UI Context ContextThemeWrapper  UI Context</p>\n<p>Non-UI Context  UI Context  Non-UI Context <strong></strong> Non-UI Context </p>\n<p><u><em>Non-UI Context</em></u></p>\n<ul>\n<li> Activity  Application </li>\n<li>Broadcast Receiver  Service  Context </li>\n<li> Service  this Service </li>\n<li> Service  getApplicationContext() </li>\n<li> Activity  getApplicationContext() </li>\n<li> Context  getApplicationContext() </li>\n</ul>\n<p> Context UI Context  Context + Theme ContextThemeWrapper  Context  Non-UI Context</p>\n<p><u> Context  Application context  Application  getApplicationContext()  Context </u></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h5 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\" 1\"></a> 1</h5><p> Non-UI Context </p>\n<h5 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\" 2\"></a> 2</h5><p> UI Context UI Context = Contex + ThemeNon-UI Context  UI Context </p>\n<h5 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\" 3\"></a> 3</h5><p> 2  UI Context </p>\n<p> UI Context </p>\n<p> Android </p>\n<p><strong>Context </strong></p>\n<p> Context </p>\n<p> Context </p>\n<ol>\n<li> UI  UI Context Non-UI Context</li>\n<li> Application Context</li>\n</ol>\n<h3 id=\"-Context-\"><a href=\"#-Context-\" class=\"headerlink\" title=\" Context \"></a> Context </h3><p>thisgetApplicationContext()  getBaseContext() </p>\n<p> App  App  Context </p>\n<p></p>\n<p></p>\n<p> Context  magic method</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182356.png\" alt=\"\"></p>\n<p> createConfigurationContext() </p>\n<pre><code class=\"java\">public Context createConfigurationContext(Configuration overrideConfiguration){\n     Configuration configuration = getResources().getConfiguration();\n    configuration.setLocale(your_custom_locale);\n    context = createConfigurationContext(configuration);\n  return context;\n}\n</code></pre>\n<p> Context  Context </p>\n<p><strong>thisgetApplicationContext()  getBaseContext() </strong></p>\n<p> Activity  Context </p>\n<ol>\n<li><p>this  Activity UI Context<em></em> context</p>\n</li>\n<li><p>baseContext  Context  Application  createConfigurationContext()  Context  attachBaseContext()  Context </p>\n<p> baseContext Activity  Context  Context Activity  getBaseContext()  Activity </p>\n</li>\n</ol>\n<p>Context  Android App  App  Context Android  Context  Context App  Java </p>\n<h3 id=\"Android-Context-Java-code\"><a href=\"#Android-Context-Java-code\" class=\"headerlink\" title=\"Android = Context + Java code\"></a>Android = Context + Java code</h3><p> Context </p>\n<p> Context </p>\n<p> Context  UI Context  Non-UI Context Context</p>\n<p> Context UI </p>\n<p> Context  App  Context  thisapplicationContext  baseContext </p>\n<p> Application Context</p>\n<p> Application Context Context</p>\n","site":{"data":{}},"excerpt":"<p>Context  Android API </p>","more":"<p><em> + <a href=\"https://www.freecodecamp.org/news/mastering-android-context-7055c8478a22/\" target=\"_blank\" rel=\"noopener\"></a></em></p>\n<p> Android Context Context  Android </p>\n<blockquote>\n<p>Context  Android API  <strong>God object</strong> </p>\n</blockquote>\n<p>###</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182421.png\" alt=\"\"></p>\n<p></p>\n<p><code>Activity</code><code>Service</code><code>Application</code>  <code>Context</code>  App </p>\n<p><code>getContext()</code><code>this</code><code>getBaseContext()</code> <code>getApplicationContext()</code>  yes</p>\n<h3 id=\"Context-\"><a href=\"#Context-\" class=\"headerlink\" title=\"Context \"></a>Context </h3><p> Android APK  Android  Manifest  Activity(UI)Service(Background) BroadcastReceiver (Action), ContentProvider (Data),  Resources (images, strings ) </p>\n<p> IntentFilter  </p>\n<p>Android  WifiManagerVibrator  PackageManager</p>\n<p>Context  Context </p>\n<h5 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1. \"></a>1. </h5><p> Context  Activity, Content Provider, BroadcastReceiver  Context </p>\n<h5 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2. \"></a>2. </h5><p>Context  Android  Context  <code>context.getSystemService(Context.WIFI_SERVICE)</code>   WifiManager </p>\n<h5 id=\"3--App-\"><a href=\"#3--App-\" class=\"headerlink\" title=\"3.  App \"></a>3.  App </h5><p> Intent-filter</p>\n<pre><code class=\"java\">Intent emailIntent = new Intent(android.content.Intent.ACTION_SEND);\nemailIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nemailIntent.setType(&quot;vnd.android.cursor.item/email&quot;);\nemailIntent.putExtra(android.content.Intent.EXTRA_EMAIL, new String[]{address});\nemailIntent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject);\nemailIntent.putExtra(android.content.Intent.EXTRA_TEXT, content);\n</code></pre>\n<p> App </p>\n<p><strong> Android  Context </strong>Context </p>\n<h3 id=\"Context-\"><a href=\"#Context-\" class=\"headerlink\" title=\"Context \"></a>Context </h3><p> Context <strong></strong> Context </p>\n<ul>\n<li><p> Activity  Application </p>\n</li>\n<li><p> Activity  this Activity </p>\n</li>\n<li><p> Activity  getApplicationContext() </p>\n</li>\n<li><p> Activity  getBaseContext()</p>\n</li>\n<li><p> Fragment  View  getContext()</p>\n</li>\n<li><p>Broadcast Receiver  Service  Context </p>\n</li>\n<li><p> Service  this Service </p>\n</li>\n<li><p> Service  getApplicationContext() </p>\n</li>\n<li><p> Context  getApplicationContext() </p>\n</li>\n</ul>\n<p> Context UI Context  Non-UI Context</p>\n<h5 id=\"UI-Context\"><a href=\"#UI-Context\" class=\"headerlink\" title=\"UI Context\"></a>UI Context</h5><p> ContextThemeWrapper  UI Context Context +  Theme </p>\n<p> Activity  ContextThemeWrapper Non-UI Context </p>\n<p> Activity  Context  UI Context Fragment  getContext()   Activity Fragment  Activity  FragmentManager </p>\n<p><em>View.getContext()  UI Context</em></p>\n<p> View  LayoutInflator  LayoutInflator  Context  UI Context View  Context  UI Context Context  UI Context Non-UI Context</p>\n<p><u><em>UI Context</em></u></p>\n<ul>\n<li> Activity  this Activity </li>\n<li> Fragment  getContext()</li>\n<li><em> UI Context </em> View  getContext()</li>\n</ul>\n<h5 id=\"Non-UI-Context\"><a href=\"#Non-UI-Context\" class=\"headerlink\" title=\"Non-UI Context\"></a>Non-UI Context</h5><p> UI Context  Non-UI Context ContextThemeWrapper  UI Context</p>\n<p>Non-UI Context  UI Context  Non-UI Context <strong></strong> Non-UI Context </p>\n<p><u><em>Non-UI Context</em></u></p>\n<ul>\n<li> Activity  Application </li>\n<li>Broadcast Receiver  Service  Context </li>\n<li> Service  this Service </li>\n<li> Service  getApplicationContext() </li>\n<li> Activity  getApplicationContext() </li>\n<li> Context  getApplicationContext() </li>\n</ul>\n<p> Context UI Context  Context + Theme ContextThemeWrapper  Context  Non-UI Context</p>\n<p><u> Context  Application context  Application  getApplicationContext()  Context </u></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h5 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\" 1\"></a> 1</h5><p> Non-UI Context </p>\n<h5 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\" 2\"></a> 2</h5><p> UI Context UI Context = Contex + ThemeNon-UI Context  UI Context </p>\n<h5 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\" 3\"></a> 3</h5><p> 2  UI Context </p>\n<p> UI Context </p>\n<p> Android </p>\n<p><strong>Context </strong></p>\n<p> Context </p>\n<p> Context </p>\n<ol>\n<li> UI  UI Context Non-UI Context</li>\n<li> Application Context</li>\n</ol>\n<h3 id=\"-Context-\"><a href=\"#-Context-\" class=\"headerlink\" title=\" Context \"></a> Context </h3><p>thisgetApplicationContext()  getBaseContext() </p>\n<p> App  App  Context </p>\n<p></p>\n<p></p>\n<p> Context  magic method</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20191114182356.png\" alt=\"\"></p>\n<p> createConfigurationContext() </p>\n<pre><code class=\"java\">public Context createConfigurationContext(Configuration overrideConfiguration){\n     Configuration configuration = getResources().getConfiguration();\n    configuration.setLocale(your_custom_locale);\n    context = createConfigurationContext(configuration);\n  return context;\n}\n</code></pre>\n<p> Context  Context </p>\n<p><strong>thisgetApplicationContext()  getBaseContext() </strong></p>\n<p> Activity  Context </p>\n<ol>\n<li><p>this  Activity UI Context<em></em> context</p>\n</li>\n<li><p>baseContext  Context  Application  createConfigurationContext()  Context  attachBaseContext()  Context </p>\n<p> baseContext Activity  Context  Context Activity  getBaseContext()  Activity </p>\n</li>\n</ol>\n<p>Context  Android App  App  Context Android  Context  Context App  Java </p>\n<h3 id=\"Android-Context-Java-code\"><a href=\"#Android-Context-Java-code\" class=\"headerlink\" title=\"Android = Context + Java code\"></a>Android = Context + Java code</h3><p> Context </p>\n<p> Context </p>\n<p> Context  UI Context  Non-UI Context Context</p>\n<p> Context UI </p>\n<p> Context  App  Context  thisapplicationContext  baseContext </p>\n<p> Application Context</p>\n<p> Application Context Context</p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322185113.png","title":"ConstraintLayout ","date":"2019-03-21T16:00:00.000Z","_content":"\nAndroid  ConstraintLayout  LinearLayout\n\n\n\n<!-- more -->\n\n\n\n~\n\n#### \n\n##### \n\n RelativeLayout  RelativeLayout FrameLayout \n\n```xml\nlayout_constraintLeft_toLeftOf   \nlayout_constraintLeft_toRightOf  \nlayout_constraintRight_toLeftOf  \nlayout_constraintRight_toRightOf \n\nlayout_constraintStart_toEndOf   \nlayout_constraintStart_toStartOf\nlayout_constraintEnd_toStartOf\nlayout_constraintEnd_toEndOf\n\nlayout_constraintTop_toTopOf       \nlayout_constraintTop_toBottomOf    \nlayout_constraintBottom_toTopOf    \nlayout_constraintBottom_toBottomOf \n\nlayout_constraintBaseline_toBaselineOf \n```\n\n##### \n\n```xml\n<!--  -->\n\n<!--  parent  -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintTop_toTopOf=\"parent\"\n    app:layout_constraintBottom_toBottomOf=\"parent\"\n    app:layout_constraintLeft_toLeftOf=\"parent\"\n    app:layout_constraintRight_toRightOf=\"parent\"/>\n\n<!--  parent -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintLeft_toLeftOf=\"parent\"\n    app:layout_constraintRight_toRightOf=\"parent\"/>\n\n<!--  parent -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintTop_toTopOf=\"parent\"\n    app:layout_constraintBottom_toBottomOf=\"parent\"/>\n```\n\n item \n\n![ConstraintLayout  item ](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322142136.png)\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:padding=\"5dp\">\n\n    <ImageView\n        android:id=\"@+id/iv_logo\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"@mipmap/ic_launcher\" />\n\n    <!--  View  logo  -->\n    <TextView\n        android:id=\"@+id/tv_title\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginLeft=\"10dp\"\n        android:text=\"\"\n        app:layout_constraintLeft_toRightOf=\"@+id/iv_logo\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <!--  View  titleView titleView  -->\n    <TextView\n        android:id=\"@+id/tv_price\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"64/\"\n        android:textSize=\"13sp\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"@id/tv_title\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_title\" />\n\n    <!--  distanceView  priceView -->\n    <TextView\n        android:id=\"@+id/tv_distance\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"1.1km\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"@id/tv_price\" />\n\n    <!--  areaView  priceView ivLogo-->\n    <TextView\n        android:id=\"@+id/tv_area\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\" \"\n        android:textSize=\"13sp\"\n        app:layout_constraintBottom_toBottomOf=\"@id/iv_logo\"\n        app:layout_constraintLeft_toLeftOf=\"@id/tv_price\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_price\" />\n\n    <!--  hotView  areaView -->\n    <TextView\n        android:id=\"@+id/tv_curr_hot\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"89\"\n        android:textSize=\"13sp\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"@id/tv_area\" />\n\n    <!-- dividerView  ivLogo  -->\n    <View\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"1px\"\n        android:layout_marginTop=\"7dp\"\n        android:background=\"@android:color/darker_gray\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/iv_logo\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n RL  LL  RL \n\n\n\n#### Bias \n\n RL \n\n`bias` **** `layout_constraintHorizontal_bias`  `layout_constraintVertical_bias`  parent View\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintLeft_toLeftOf=\"parent\" />\n\n    <TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintHorizontal_bias=\"0.3\"\n        app:layout_constraintLeft_toRightOf=\"@id/tv1\"\n        app:layout_constraintRight_toLeftOf=\"@id/tv3\" />\n\n    <TextView\n        android:id=\"@+id/tv3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n TextView  TextView  `layout_constraintHorizontal_bias`  0.5 TextView \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322145701.jpg)\n\n\n\n#### Circle \n\n B  A \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322153304.jpg)\n\n```\nlayout_constraintCircle       \nlayout_constraintCircleRadius \nlayout_constraintCircleAngle  \n```\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <TextView\n        android:id=\"@+id/tv_center\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        android:text=\"Circle Center\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n    \n    <!--  tv_center  135  100dp  -->\n    <TextView\n        android:text=\"\"\n        app:layout_constraintCircle=\"@id/tv_center\"\n        app:layout_constraintCircleAngle=\"135\"\n        app:layout_constraintCircleRadius=\"100dp\"\n        android:textColor=\"@android:color/black\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n\n\n####  MATCH_PARENT  MATCH_CONSTRAINT\n\nmatch_parentmatch_constraint\n\n View  0dp  View \n\n```\nlayout_constraintWidth_min   \nlayout_constraintHeight_min  \n\nlayout_constraintWidth_max   \nlayout_constraintHeight_max  \n\nlayout_constraintWidth_percent   \nlayout_constraintHeight_percent  \n```\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Test Button\"\n        app:layout_constraintLeft_toLeftOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/btn2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/btn3\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constrainedWidth=\"true\"\n        android:text=\"Button\"\n        app:layout_constraintWidth_min=\"wrap\"\n        app:layout_constraintWidth_max=\"wrap\"\n        app:layout_constraintWidth_percent=\"0.3\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn1\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn2\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322163826.jpg)\n\n\n\n#### Chains \n\n View  View  Chains()\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322170158.jpg)\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn2\" />\n\n    <Button\n        android:id=\"@+id/btn2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn1\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn3\" />\n\n    <Button\n        android:id=\"@+id/btn3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn2\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n Button  Chain\n\n\n\n```\nlayout_constraintHorizontal_chainStyle\nlayout_constraintVertical_chainStyle\n```\n\nspreadspread_insidepacked\n\n\n\n1. spread\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171443.jpg)\n\n2. spread_inside\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171444.jpg)\n\n3. packed\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171442.jpg)\n\n Chains\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322172439.jpg)\n\n\n\n#### \n\n ViewGroup ConstraintLayout \n\n##### GuideLine\n\nGuideLine  ConstraintLayout \n\n\n\n```xml\norientation \nlayout_constraintGuide_begin \nlayout_constraintGuide_end \nlayout_constraintGuide_percent \n\npercent  begin end percent \n```\n\nxml \n\n```xml\n<android.support.constraint.ConstraintLayout        \t\t\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <!--  ImageView  GL -->\n    <android.support.constraint.Guideline\n        android:id=\"@+id/gl_vertical\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"vertical\"\n        app:layout_constraintGuide_percent=\"0.8\"/>\n\n    <android.support.constraint.Guideline\n        android:id=\"@+id/gl_horizontal\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"0dp\"\n        android:orientation=\"horizontal\"\n        app:layout_constraintGuide_percent=\"0.8\" />\n\n    <ImageView\n        android:src=\"@mipmap/ic_launcher\"\n        app:layout_constraintLeft_toRightOf=\"@id/gl_vertical\"\n        app:layout_constraintTop_toBottomOf=\"@id/gl_horizontal\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322174954.jpg)\n\n\n\n##### Barrier\n\n GuideLine \n\nBarrier \n\n- barrierDirection\n\n  >   top, bottom, left, right, start, end\n\n   View  View  right  end\n\n- constraint_referenced_ids\n\n   View  viewIdbarrier  View \n\n\n\n> \n\n `barrier`  barrier barrier  barrier  barrier \n\n```XML\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:padding=\"10dp\">\n\n    <TextView\n        android:id=\"@+id/tv_name\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_gender\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_name\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_phone\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_gender\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_birthday\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_phone\"\n        android:text=\":\"/>\n\n    <android.support.constraint.Barrier\n        android:id=\"@+id/barrier\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:barrierDirection=\"end\"\n        app:constraint_referenced_ids=\"tv_name,tv_phone,tv_gender,tv_birthday\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        android:text=\"\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_name\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        android:text=\"\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_gender\"\n        android:text=\"13800138000\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_phone\"\n        android:text=\"200011\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322182306.jpg)\n\n\n\n##### Group\n\nGroup  View  ViewGroup View barrier  constraint_referenced_ids  ViewId \n\n\n\n```xml\n<android.support.constraint.Group\n    app:constraint_referenced_ids=\"tv_gender,tv_sex_value\"\n    android:visibility=\"gone\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\" />\n```\n\n key  value  id  gone\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322183030.jpg)\n\n Group \n\n> 1. ViewGroupViewGroupViewViewGroupViewGroupGroup\n>\n> 2. GroupsetVisibilityViewGroupConstrainLayoutpreLayoutpreLayoutlayout\n\n\n\n#### Optimizer\n\napplayout_optimizationLevel ConstraintLayout \n\n```xml\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    app:layout_optimizationLevel=\"standard|dimensions|chains\"/>\n```\n\n- none \n- standard \n- direct \n- barrier \n- chain\n- dimensions\n\n\n\n#### \n\n- [ConstraintLayout ](https://juejin.im/post/5c0bd6b05188257c3045dc50#heading-7)\n- [ ConstraintLayout](<https://mp.weixin.qq.com/s/vI-fPaNoJ7ZBlZcMkEGdLQ>)","source":"_posts/ConstraintLayout-learning.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322185113.png\ntitle: ConstraintLayout \ntags: [Android]\ndate: 2019-03-22\n---\n\nAndroid  ConstraintLayout  LinearLayout\n\n\n\n<!-- more -->\n\n\n\n~\n\n#### \n\n##### \n\n RelativeLayout  RelativeLayout FrameLayout \n\n```xml\nlayout_constraintLeft_toLeftOf   \nlayout_constraintLeft_toRightOf  \nlayout_constraintRight_toLeftOf  \nlayout_constraintRight_toRightOf \n\nlayout_constraintStart_toEndOf   \nlayout_constraintStart_toStartOf\nlayout_constraintEnd_toStartOf\nlayout_constraintEnd_toEndOf\n\nlayout_constraintTop_toTopOf       \nlayout_constraintTop_toBottomOf    \nlayout_constraintBottom_toTopOf    \nlayout_constraintBottom_toBottomOf \n\nlayout_constraintBaseline_toBaselineOf \n```\n\n##### \n\n```xml\n<!--  -->\n\n<!--  parent  -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintTop_toTopOf=\"parent\"\n    app:layout_constraintBottom_toBottomOf=\"parent\"\n    app:layout_constraintLeft_toLeftOf=\"parent\"\n    app:layout_constraintRight_toRightOf=\"parent\"/>\n\n<!--  parent -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintLeft_toLeftOf=\"parent\"\n    app:layout_constraintRight_toRightOf=\"parent\"/>\n\n<!--  parent -->\n<TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"\"\n    app:layout_constraintTop_toTopOf=\"parent\"\n    app:layout_constraintBottom_toBottomOf=\"parent\"/>\n```\n\n item \n\n![ConstraintLayout  item ](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322142136.png)\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:padding=\"5dp\">\n\n    <ImageView\n        android:id=\"@+id/iv_logo\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"@mipmap/ic_launcher\" />\n\n    <!--  View  logo  -->\n    <TextView\n        android:id=\"@+id/tv_title\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginLeft=\"10dp\"\n        android:text=\"\"\n        app:layout_constraintLeft_toRightOf=\"@+id/iv_logo\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <!--  View  titleView titleView  -->\n    <TextView\n        android:id=\"@+id/tv_price\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"64/\"\n        android:textSize=\"13sp\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"@id/tv_title\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_title\" />\n\n    <!--  distanceView  priceView -->\n    <TextView\n        android:id=\"@+id/tv_distance\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"1.1km\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"@id/tv_price\" />\n\n    <!--  areaView  priceView ivLogo-->\n    <TextView\n        android:id=\"@+id/tv_area\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\" \"\n        android:textSize=\"13sp\"\n        app:layout_constraintBottom_toBottomOf=\"@id/iv_logo\"\n        app:layout_constraintLeft_toLeftOf=\"@id/tv_price\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_price\" />\n\n    <!--  hotView  areaView -->\n    <TextView\n        android:id=\"@+id/tv_curr_hot\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"89\"\n        android:textSize=\"13sp\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"@id/tv_area\" />\n\n    <!-- dividerView  ivLogo  -->\n    <View\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"1px\"\n        android:layout_marginTop=\"7dp\"\n        android:background=\"@android:color/darker_gray\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/iv_logo\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n RL  LL  RL \n\n\n\n#### Bias \n\n RL \n\n`bias` **** `layout_constraintHorizontal_bias`  `layout_constraintVertical_bias`  parent View\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintLeft_toLeftOf=\"parent\" />\n\n    <TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintHorizontal_bias=\"0.3\"\n        app:layout_constraintLeft_toRightOf=\"@id/tv1\"\n        app:layout_constraintRight_toLeftOf=\"@id/tv3\" />\n\n    <TextView\n        android:id=\"@+id/tv3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"this is a text\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n TextView  TextView  `layout_constraintHorizontal_bias`  0.5 TextView \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322145701.jpg)\n\n\n\n#### Circle \n\n B  A \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322153304.jpg)\n\n```\nlayout_constraintCircle       \nlayout_constraintCircleRadius \nlayout_constraintCircleAngle  \n```\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <TextView\n        android:id=\"@+id/tv_center\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        android:text=\"Circle Center\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n    \n    <!--  tv_center  135  100dp  -->\n    <TextView\n        android:text=\"\"\n        app:layout_constraintCircle=\"@id/tv_center\"\n        app:layout_constraintCircleAngle=\"135\"\n        app:layout_constraintCircleRadius=\"100dp\"\n        android:textColor=\"@android:color/black\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n\n\n####  MATCH_PARENT  MATCH_CONSTRAINT\n\nmatch_parentmatch_constraint\n\n View  0dp  View \n\n```\nlayout_constraintWidth_min   \nlayout_constraintHeight_min  \n\nlayout_constraintWidth_max   \nlayout_constraintHeight_max  \n\nlayout_constraintWidth_percent   \nlayout_constraintHeight_percent  \n```\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Test Button\"\n        app:layout_constraintLeft_toLeftOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/btn2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/btn3\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constrainedWidth=\"true\"\n        android:text=\"Button\"\n        app:layout_constraintWidth_min=\"wrap\"\n        app:layout_constraintWidth_max=\"wrap\"\n        app:layout_constraintWidth_percent=\"0.3\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn1\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn2\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322163826.jpg)\n\n\n\n#### Chains \n\n View  View  Chains()\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322170158.jpg)\n\n\n\n```xml\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn2\" />\n\n    <Button\n        android:id=\"@+id/btn2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn1\"\n        app:layout_constraintRight_toLeftOf=\"@id/btn3\" />\n\n    <Button\n        android:id=\"@+id/btn3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button\"\n        app:layout_constraintLeft_toRightOf=\"@id/btn2\"\n        app:layout_constraintRight_toRightOf=\"parent\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n Button  Chain\n\n\n\n```\nlayout_constraintHorizontal_chainStyle\nlayout_constraintVertical_chainStyle\n```\n\nspreadspread_insidepacked\n\n\n\n1. spread\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171443.jpg)\n\n2. spread_inside\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171444.jpg)\n\n3. packed\n\n   ![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171442.jpg)\n\n Chains\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322172439.jpg)\n\n\n\n#### \n\n ViewGroup ConstraintLayout \n\n##### GuideLine\n\nGuideLine  ConstraintLayout \n\n\n\n```xml\norientation \nlayout_constraintGuide_begin \nlayout_constraintGuide_end \nlayout_constraintGuide_percent \n\npercent  begin end percent \n```\n\nxml \n\n```xml\n<android.support.constraint.ConstraintLayout        \t\t\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <!--  ImageView  GL -->\n    <android.support.constraint.Guideline\n        android:id=\"@+id/gl_vertical\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"vertical\"\n        app:layout_constraintGuide_percent=\"0.8\"/>\n\n    <android.support.constraint.Guideline\n        android:id=\"@+id/gl_horizontal\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"0dp\"\n        android:orientation=\"horizontal\"\n        app:layout_constraintGuide_percent=\"0.8\" />\n\n    <ImageView\n        android:src=\"@mipmap/ic_launcher\"\n        app:layout_constraintLeft_toRightOf=\"@id/gl_vertical\"\n        app:layout_constraintTop_toBottomOf=\"@id/gl_horizontal\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322174954.jpg)\n\n\n\n##### Barrier\n\n GuideLine \n\nBarrier \n\n- barrierDirection\n\n  >   top, bottom, left, right, start, end\n\n   View  View  right  end\n\n- constraint_referenced_ids\n\n   View  viewIdbarrier  View \n\n\n\n> \n\n `barrier`  barrier barrier  barrier  barrier \n\n```XML\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:padding=\"10dp\">\n\n    <TextView\n        android:id=\"@+id/tv_name\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_gender\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_name\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_phone\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_gender\"\n        android:text=\":\"/>\n\n    <TextView\n        android:id=\"@+id/tv_birthday\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_phone\"\n        android:text=\":\"/>\n\n    <android.support.constraint.Barrier\n        android:id=\"@+id/barrier\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:barrierDirection=\"end\"\n        app:constraint_referenced_ids=\"tv_name,tv_phone,tv_gender,tv_birthday\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        android:text=\"\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_name\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        android:text=\"\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_gender\"\n        android:text=\"13800138000\"/>\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:layout_constraintLeft_toRightOf=\"@id/barrier\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv_phone\"\n        android:text=\"200011\" />\n\n</android.support.constraint.ConstraintLayout>\n```\n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322182306.jpg)\n\n\n\n##### Group\n\nGroup  View  ViewGroup View barrier  constraint_referenced_ids  ViewId \n\n\n\n```xml\n<android.support.constraint.Group\n    app:constraint_referenced_ids=\"tv_gender,tv_sex_value\"\n    android:visibility=\"gone\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\" />\n```\n\n key  value  id  gone\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322183030.jpg)\n\n Group \n\n> 1. ViewGroupViewGroupViewViewGroupViewGroupGroup\n>\n> 2. GroupsetVisibilityViewGroupConstrainLayoutpreLayoutpreLayoutlayout\n\n\n\n#### Optimizer\n\napplayout_optimizationLevel ConstraintLayout \n\n```xml\n<android.support.constraint.ConstraintLayout \n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    app:layout_optimizationLevel=\"standard|dimensions|chains\"/>\n```\n\n- none \n- standard \n- direct \n- barrier \n- chain\n- dimensions\n\n\n\n#### \n\n- [ConstraintLayout ](https://juejin.im/post/5c0bd6b05188257c3045dc50#heading-7)\n- [ ConstraintLayout](<https://mp.weixin.qq.com/s/vI-fPaNoJ7ZBlZcMkEGdLQ>)","slug":"ConstraintLayout-learning","published":1,"updated":"2019-03-22T10:51:31.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ep001tlh1pxdspgpfw","content":"<p>Android  ConstraintLayout  LinearLayout</p>\n<a id=\"more\"></a>\n<p>~</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> RelativeLayout  RelativeLayout FrameLayout </p>\n<pre><code class=\"xml\">layout_constraintLeft_toLeftOf   \nlayout_constraintLeft_toRightOf  \nlayout_constraintRight_toLeftOf  \nlayout_constraintRight_toRightOf \n\nlayout_constraintStart_toEndOf   \nlayout_constraintStart_toStartOf\nlayout_constraintEnd_toStartOf\nlayout_constraintEnd_toEndOf\n\nlayout_constraintTop_toTopOf       \nlayout_constraintTop_toBottomOf    \nlayout_constraintBottom_toTopOf    \nlayout_constraintBottom_toBottomOf \n\nlayout_constraintBaseline_toBaselineOf \n</code></pre>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><pre><code class=\"xml\">&lt;!--  --&gt;\n\n&lt;!--  parent  --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintTop_toTopOf=&quot;parent&quot;\n    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n    app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n    app:layout_constraintRight_toRightOf=&quot;parent&quot;/&gt;\n\n&lt;!--  parent --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n    app:layout_constraintRight_toRightOf=&quot;parent&quot;/&gt;\n\n&lt;!--  parent --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintTop_toTopOf=&quot;parent&quot;\n    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;/&gt;\n</code></pre>\n<p> item </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322142136.png\" alt=\"ConstraintLayout  item \"></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:padding=&quot;5dp&quot;&gt;\n\n    &lt;ImageView\n        android:id=&quot;@+id/iv_logo&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:background=&quot;@mipmap/ic_launcher&quot; /&gt;\n\n    &lt;!--  View  logo  --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_title&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginLeft=&quot;10dp&quot;\n        android:text=&quot;&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@+id/iv_logo&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;\n\n    &lt;!--  View  titleView titleView  --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_price&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;64/&quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;@id/tv_title&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_title&quot; /&gt;\n\n    &lt;!--  distanceView  priceView --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_distance&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;1.1km&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;@id/tv_price&quot; /&gt;\n\n    &lt;!--  areaView  priceView ivLogo--&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_area&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot; &quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;@id/iv_logo&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;@id/tv_price&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_price&quot; /&gt;\n\n    &lt;!--  hotView  areaView --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_curr_hot&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;89&quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;@id/tv_area&quot; /&gt;\n\n    &lt;!-- dividerView  ivLogo  --&gt;\n    &lt;View\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;1px&quot;\n        android:layout_marginTop=&quot;7dp&quot;\n        android:background=&quot;@android:color/darker_gray&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/iv_logo&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> RL  LL  RL </p>\n<h4 id=\"Bias-\"><a href=\"#Bias-\" class=\"headerlink\" title=\"Bias \"></a>Bias </h4><p> RL </p>\n<p><code>bias</code> <strong></strong> <code>layout_constraintHorizontal_bias</code>  <code>layout_constraintVertical_bias</code>  parent View</p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintHorizontal_bias=&quot;0.3&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/tv1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/tv3&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv3&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> TextView  TextView  <code>layout_constraintHorizontal_bias</code>  0.5 TextView </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322145701.jpg\" alt=\"\"></p>\n<h4 id=\"Circle-\"><a href=\"#Circle-\" class=\"headerlink\" title=\"Circle \"></a>Circle </h4><p> B  A </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322153304.jpg\" alt=\"\"></p>\n<pre><code>layout_constraintCircle       \nlayout_constraintCircleRadius \nlayout_constraintCircleAngle  \n</code></pre><p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_center&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        android:text=&quot;Circle Center&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n    &lt;!--  tv_center  135  100dp  --&gt;\n    &lt;TextView\n        android:text=&quot;&quot;\n        app:layout_constraintCircle=&quot;@id/tv_center&quot;\n        app:layout_constraintCircleAngle=&quot;135&quot;\n        app:layout_constraintCircleRadius=&quot;100dp&quot;\n        android:textColor=&quot;@android:color/black&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<h4 id=\"-MATCH-PARENT--MATCH-CONSTRAINT\"><a href=\"#-MATCH-PARENT--MATCH-CONSTRAINT\" class=\"headerlink\" title=\" MATCH_PARENT  MATCH_CONSTRAINT\"></a> MATCH_PARENT  MATCH_CONSTRAINT</h4><p>match_parentmatch_constraint</p>\n<p> View  0dp  View </p>\n<pre><code>layout_constraintWidth_min   \nlayout_constraintHeight_min  \n\nlayout_constraintWidth_max   \nlayout_constraintHeight_max  \n\nlayout_constraintWidth_percent   \nlayout_constraintHeight_percent  \n</code></pre><p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Test Button&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn3&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constrainedWidth=&quot;true&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintWidth_min=&quot;wrap&quot;\n        app:layout_constraintWidth_max=&quot;wrap&quot;\n        app:layout_constraintWidth_percent=&quot;0.3&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn2&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322163826.jpg\" alt=\"\"></p>\n<h4 id=\"Chains-\"><a href=\"#Chains-\" class=\"headerlink\" title=\"Chains \"></a>Chains </h4><p> View  View  Chains()</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322170158.jpg\" alt=\"\"></p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn2&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn3&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn3&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn2&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> Button  Chain</p>\n<p></p>\n<pre><code>layout_constraintHorizontal_chainStyle\nlayout_constraintVertical_chainStyle\n</code></pre><p>spreadspread_insidepacked</p>\n<p></p>\n<ol>\n<li>spread</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171443.jpg\" alt=\"\"></p>\n<ol>\n<li><p>spread_inside</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171444.jpg\" alt=\"\"></p>\n</li>\n<li><p>packed</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171442.jpg\" alt=\"\"></p>\n</li>\n</ol>\n<p> Chains</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322172439.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> ViewGroup ConstraintLayout </p>\n<h5 id=\"GuideLine\"><a href=\"#GuideLine\" class=\"headerlink\" title=\"GuideLine\"></a>GuideLine</h5><p>GuideLine  ConstraintLayout </p>\n<p></p>\n<pre><code class=\"xml\">orientation \nlayout_constraintGuide_begin \nlayout_constraintGuide_end \nlayout_constraintGuide_percent \n\npercent  begin end percent \n</code></pre>\n<p>xml </p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout                \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;!--  ImageView  GL --&gt;\n    &lt;android.support.constraint.Guideline\n        android:id=&quot;@+id/gl_vertical&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:orientation=&quot;vertical&quot;\n        app:layout_constraintGuide_percent=&quot;0.8&quot;/&gt;\n\n    &lt;android.support.constraint.Guideline\n        android:id=&quot;@+id/gl_horizontal&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:orientation=&quot;horizontal&quot;\n        app:layout_constraintGuide_percent=&quot;0.8&quot; /&gt;\n\n    &lt;ImageView\n        android:src=&quot;@mipmap/ic_launcher&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/gl_vertical&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/gl_horizontal&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322174954.jpg\" alt=\"\"></p>\n<h5 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h5><p> GuideLine </p>\n<p>Barrier </p>\n<ul>\n<li><p>barrierDirection</p>\n<blockquote>\n<p>  top, bottom, left, right, start, end</p>\n</blockquote>\n<p> View  View  right  end</p>\n</li>\n<li><p>constraint_referenced_ids</p>\n<p> View  viewIdbarrier  View </p>\n</li>\n</ul>\n<p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p> <code>barrier</code>  barrier barrier  barrier  barrier </p>\n<pre><code class=\"XML\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:padding=&quot;10dp&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_name&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_gender&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_name&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_phone&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_gender&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_birthday&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_phone&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;android.support.constraint.Barrier\n        android:id=&quot;@+id/barrier&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:barrierDirection=&quot;end&quot;\n        app:constraint_referenced_ids=&quot;tv_name,tv_phone,tv_gender,tv_birthday&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        android:text=&quot;&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_name&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        android:text=&quot;&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_gender&quot;\n        android:text=&quot;13800138000&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_phone&quot;\n        android:text=&quot;200011&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322182306.jpg\" alt=\"\"></p>\n<h5 id=\"Group\"><a href=\"#Group\" class=\"headerlink\" title=\"Group\"></a>Group</h5><p>Group  View  ViewGroup View barrier  constraint_referenced_ids  ViewId </p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.Group\n    app:constraint_referenced_ids=&quot;tv_gender,tv_sex_value&quot;\n    android:visibility=&quot;gone&quot;\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot; /&gt;\n</code></pre>\n<p> key  value  id  gone</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322183030.jpg\" alt=\"\"></p>\n<p> Group </p>\n<blockquote>\n<ol>\n<li><p>ViewGroupViewGroupViewViewGroupViewGroupGroup</p>\n</li>\n<li><p>GroupsetVisibilityViewGroupConstrainLayoutpreLayoutpreLayoutlayout</p>\n</li>\n</ol>\n</blockquote>\n<h4 id=\"Optimizer\"><a href=\"#Optimizer\" class=\"headerlink\" title=\"Optimizer\"></a>Optimizer</h4><p>applayout_optimizationLevel ConstraintLayout </p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    app:layout_optimizationLevel=&quot;standard|dimensions|chains&quot;/&gt;\n</code></pre>\n<ul>\n<li>none </li>\n<li>standard </li>\n<li>direct </li>\n<li>barrier </li>\n<li>chain</li>\n<li>dimensions</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><a href=\"https://juejin.im/post/5c0bd6b05188257c3045dc50#heading-7\" target=\"_blank\" rel=\"noopener\">ConstraintLayout </a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/vI-fPaNoJ7ZBlZcMkEGdLQ\" target=\"_blank\" rel=\"noopener\"> ConstraintLayout</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>Android  ConstraintLayout  LinearLayout</p>","more":"<p>~</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> RelativeLayout  RelativeLayout FrameLayout </p>\n<pre><code class=\"xml\">layout_constraintLeft_toLeftOf   \nlayout_constraintLeft_toRightOf  \nlayout_constraintRight_toLeftOf  \nlayout_constraintRight_toRightOf \n\nlayout_constraintStart_toEndOf   \nlayout_constraintStart_toStartOf\nlayout_constraintEnd_toStartOf\nlayout_constraintEnd_toEndOf\n\nlayout_constraintTop_toTopOf       \nlayout_constraintTop_toBottomOf    \nlayout_constraintBottom_toTopOf    \nlayout_constraintBottom_toBottomOf \n\nlayout_constraintBaseline_toBaselineOf \n</code></pre>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><pre><code class=\"xml\">&lt;!--  --&gt;\n\n&lt;!--  parent  --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintTop_toTopOf=&quot;parent&quot;\n    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n    app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n    app:layout_constraintRight_toRightOf=&quot;parent&quot;/&gt;\n\n&lt;!--  parent --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n    app:layout_constraintRight_toRightOf=&quot;parent&quot;/&gt;\n\n&lt;!--  parent --&gt;\n&lt;TextView\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:text=&quot;&quot;\n    app:layout_constraintTop_toTopOf=&quot;parent&quot;\n    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;/&gt;\n</code></pre>\n<p> item </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322142136.png\" alt=\"ConstraintLayout  item \"></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    android:padding=&quot;5dp&quot;&gt;\n\n    &lt;ImageView\n        android:id=&quot;@+id/iv_logo&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:background=&quot;@mipmap/ic_launcher&quot; /&gt;\n\n    &lt;!--  View  logo  --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_title&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginLeft=&quot;10dp&quot;\n        android:text=&quot;&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@+id/iv_logo&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;\n\n    &lt;!--  View  titleView titleView  --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_price&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;64/&quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;@id/tv_title&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_title&quot; /&gt;\n\n    &lt;!--  distanceView  priceView --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_distance&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;1.1km&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;@id/tv_price&quot; /&gt;\n\n    &lt;!--  areaView  priceView ivLogo--&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_area&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot; &quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;@id/iv_logo&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;@id/tv_price&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_price&quot; /&gt;\n\n    &lt;!--  hotView  areaView --&gt;\n    &lt;TextView\n        android:id=&quot;@+id/tv_curr_hot&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;89&quot;\n        android:textSize=&quot;13sp&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;@id/tv_area&quot; /&gt;\n\n    &lt;!-- dividerView  ivLogo  --&gt;\n    &lt;View\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;1px&quot;\n        android:layout_marginTop=&quot;7dp&quot;\n        android:background=&quot;@android:color/darker_gray&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/iv_logo&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> RL  LL  RL </p>\n<h4 id=\"Bias-\"><a href=\"#Bias-\" class=\"headerlink\" title=\"Bias \"></a>Bias </h4><p> RL </p>\n<p><code>bias</code> <strong></strong> <code>layout_constraintHorizontal_bias</code>  <code>layout_constraintVertical_bias</code>  parent View</p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintHorizontal_bias=&quot;0.3&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/tv1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/tv3&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv3&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;this is a text&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> TextView  TextView  <code>layout_constraintHorizontal_bias</code>  0.5 TextView </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322145701.jpg\" alt=\"\"></p>\n<h4 id=\"Circle-\"><a href=\"#Circle-\" class=\"headerlink\" title=\"Circle \"></a>Circle </h4><p> B  A </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322153304.jpg\" alt=\"\"></p>\n<pre><code>layout_constraintCircle       \nlayout_constraintCircleRadius \nlayout_constraintCircleAngle  \n</code></pre><p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_center&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        android:text=&quot;Circle Center&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n    &lt;!--  tv_center  135  100dp  --&gt;\n    &lt;TextView\n        android:text=&quot;&quot;\n        app:layout_constraintCircle=&quot;@id/tv_center&quot;\n        app:layout_constraintCircleAngle=&quot;135&quot;\n        app:layout_constraintCircleRadius=&quot;100dp&quot;\n        android:textColor=&quot;@android:color/black&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<h4 id=\"-MATCH-PARENT--MATCH-CONSTRAINT\"><a href=\"#-MATCH-PARENT--MATCH-CONSTRAINT\" class=\"headerlink\" title=\" MATCH_PARENT  MATCH_CONSTRAINT\"></a> MATCH_PARENT  MATCH_CONSTRAINT</h4><p>match_parentmatch_constraint</p>\n<p> View  0dp  View </p>\n<pre><code>layout_constraintWidth_min   \nlayout_constraintHeight_min  \n\nlayout_constraintWidth_max   \nlayout_constraintHeight_max  \n\nlayout_constraintWidth_percent   \nlayout_constraintHeight_percent  \n</code></pre><p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Test Button&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn3&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constrainedWidth=&quot;true&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintWidth_min=&quot;wrap&quot;\n        app:layout_constraintWidth_max=&quot;wrap&quot;\n        app:layout_constraintWidth_percent=&quot;0.3&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn2&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322163826.jpg\" alt=\"\"></p>\n<h4 id=\"Chains-\"><a href=\"#Chains-\" class=\"headerlink\" title=\"Chains \"></a>Chains </h4><p> View  View  Chains()</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322170158.jpg\" alt=\"\"></p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn1&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn2&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn2&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn1&quot;\n        app:layout_constraintRight_toLeftOf=&quot;@id/btn3&quot; /&gt;\n\n    &lt;Button\n        android:id=&quot;@+id/btn3&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Button&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/btn2&quot;\n        app:layout_constraintRight_toRightOf=&quot;parent&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p> Button  Chain</p>\n<p></p>\n<pre><code>layout_constraintHorizontal_chainStyle\nlayout_constraintVertical_chainStyle\n</code></pre><p>spreadspread_insidepacked</p>\n<p></p>\n<ol>\n<li>spread</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171443.jpg\" alt=\"\"></p>\n<ol>\n<li><p>spread_inside</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171444.jpg\" alt=\"\"></p>\n</li>\n<li><p>packed</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322171442.jpg\" alt=\"\"></p>\n</li>\n</ol>\n<p> Chains</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322172439.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> ViewGroup ConstraintLayout </p>\n<h5 id=\"GuideLine\"><a href=\"#GuideLine\" class=\"headerlink\" title=\"GuideLine\"></a>GuideLine</h5><p>GuideLine  ConstraintLayout </p>\n<p></p>\n<pre><code class=\"xml\">orientation \nlayout_constraintGuide_begin \nlayout_constraintGuide_end \nlayout_constraintGuide_percent \n\npercent  begin end percent \n</code></pre>\n<p>xml </p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout                \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n\n    &lt;!--  ImageView  GL --&gt;\n    &lt;android.support.constraint.Guideline\n        android:id=&quot;@+id/gl_vertical&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:orientation=&quot;vertical&quot;\n        app:layout_constraintGuide_percent=&quot;0.8&quot;/&gt;\n\n    &lt;android.support.constraint.Guideline\n        android:id=&quot;@+id/gl_horizontal&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:orientation=&quot;horizontal&quot;\n        app:layout_constraintGuide_percent=&quot;0.8&quot; /&gt;\n\n    &lt;ImageView\n        android:src=&quot;@mipmap/ic_launcher&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/gl_vertical&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/gl_horizontal&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322174954.jpg\" alt=\"\"></p>\n<h5 id=\"Barrier\"><a href=\"#Barrier\" class=\"headerlink\" title=\"Barrier\"></a>Barrier</h5><p> GuideLine </p>\n<p>Barrier </p>\n<ul>\n<li><p>barrierDirection</p>\n<blockquote>\n<p>  top, bottom, left, right, start, end</p>\n</blockquote>\n<p> View  View  right  end</p>\n</li>\n<li><p>constraint_referenced_ids</p>\n<p> View  viewIdbarrier  View </p>\n</li>\n</ul>\n<p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p> <code>barrier</code>  barrier barrier  barrier  barrier </p>\n<pre><code class=\"XML\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:padding=&quot;10dp&quot;&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_name&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_gender&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_name&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_phone&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_gender&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/tv_birthday&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_phone&quot;\n        android:text=&quot;:&quot;/&gt;\n\n    &lt;android.support.constraint.Barrier\n        android:id=&quot;@+id/barrier&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:barrierDirection=&quot;end&quot;\n        app:constraint_referenced_ids=&quot;tv_name,tv_phone,tv_gender,tv_birthday&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        android:text=&quot;&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_name&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        android:text=&quot;&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_gender&quot;\n        android:text=&quot;13800138000&quot;/&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:layout_constraintLeft_toRightOf=&quot;@id/barrier&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/tv_phone&quot;\n        android:text=&quot;200011&quot; /&gt;\n\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322182306.jpg\" alt=\"\"></p>\n<h5 id=\"Group\"><a href=\"#Group\" class=\"headerlink\" title=\"Group\"></a>Group</h5><p>Group  View  ViewGroup View barrier  constraint_referenced_ids  ViewId </p>\n<p></p>\n<pre><code class=\"xml\">&lt;android.support.constraint.Group\n    app:constraint_referenced_ids=&quot;tv_gender,tv_sex_value&quot;\n    android:visibility=&quot;gone&quot;\n    android:layout_width=&quot;wrap_content&quot;\n    android:layout_height=&quot;wrap_content&quot; /&gt;\n</code></pre>\n<p> key  value  id  gone</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190322183030.jpg\" alt=\"\"></p>\n<p> Group </p>\n<blockquote>\n<ol>\n<li><p>ViewGroupViewGroupViewViewGroupViewGroupGroup</p>\n</li>\n<li><p>GroupsetVisibilityViewGroupConstrainLayoutpreLayoutpreLayoutlayout</p>\n</li>\n</ol>\n</blockquote>\n<h4 id=\"Optimizer\"><a href=\"#Optimizer\" class=\"headerlink\" title=\"Optimizer\"></a>Optimizer</h4><p>applayout_optimizationLevel ConstraintLayout </p>\n<pre><code class=\"xml\">&lt;android.support.constraint.ConstraintLayout \n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    app:layout_optimizationLevel=&quot;standard|dimensions|chains&quot;/&gt;\n</code></pre>\n<ul>\n<li>none </li>\n<li>standard </li>\n<li>direct </li>\n<li>barrier </li>\n<li>chain</li>\n<li>dimensions</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><a href=\"https://juejin.im/post/5c0bd6b05188257c3045dc50#heading-7\" target=\"_blank\" rel=\"noopener\">ConstraintLayout </a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/vI-fPaNoJ7ZBlZcMkEGdLQ\" target=\"_blank\" rel=\"noopener\"> ConstraintLayout</a></li>\n</ul>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181407.jpg","title":"Android View.post ","date":"2018-08-13T16:00:00.000Z","_content":"\n>  View \n\n<!-- more -->\n\n### \n\n onCreate()  onResume()  View  View#post  View \n\n View#post  run() \n\n View#post \n\n\n\n- View#post \n- post() \n- post()  Runnable#run \n- View#post \n- Android 7.0  View#post \n- \n\n### View#post \n\n\n\n```java\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    View view = findViewById(R.id.test);\n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            //  View \n            Log.e(\"Test\", \"view.post ---- > \" + view.getHeight());\n        }\n    });\n}\n```\n\n API 26 \n\nAndroid  API 24 \n\n\n\n### post() \n\n#### 1. View#post \n View#post \n\n```java\n/**\n * Causes the Runnable to be added to the message queue.\n * The runnable will be run on the user interface thread.\n *  Runnable  UI \n */\npublic boolean post(Runnable action) {\n    // AttachInfo  View \n    //  mAttachInfo  null\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        // attachInfo  Handler \n        return attachInfo.mHandler.post(action);\n    }\n\n    // Postpone the runnable until we know on which thread it needs to run.\n    // Assume that the runnable will be successfully placed after attach.\n    //  Runnable \n    //  attach  Runnable placed\n    // \n    getRunQueue().post(action);\n    return true;\n}\n```\n\n**Runnable  UI **\n\n **mAttachInfo** \n\n```java\nvoid dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n```\n\n dispatchAttachedToWindow  ViewRootImpl#performTraversals \n\n **getRunQueue().post()** \n\n```java\n/**\n *  RunQueue  post \n * Returns the queue of runnable for this view.\n *  View  View \n */\nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n```\n\n\n\n#### 2. HandlerActionQueue \n\n post  HandlerActionQueue \n\n```java\n/**\n * Class used to enqueue pending work from Views when no Handler is attached.\n *  View  Handler \n */\npublic class HandlerActionQueue {\n    private HandlerAction[] mActions;\n    private int mCount;\n\n    //  post  postDelayed \n    public void post(Runnable action) {\n        postDelayed(action, 0);\n    }\n\n    //  Runnable \n    public void postDelayed(Runnable action, long delayMillis) {\n        final HandlerAction handlerAction = new HandlerAction(action, delayMillis);\n\n        synchronized (this) {\n            if (mActions == null) {\n                mActions = new HandlerAction[4];\n            }\n            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);\n            mCount++;\n        }\n    }\n\n    // \n    public void executeActions(Handler handler) {\n        synchronized (this) {\n            final HandlerAction[] actions = mActions;\n            for (int i = 0, count = mCount; i < count; i++) {\n                final HandlerAction handlerAction = actions[i];\n                handler.postDelayed(handlerAction.action, handlerAction.delay);\n            }\n\n            mActions = null;\n            mCount = 0;\n        }\n    }\n}\n```\n\n HandlerActionQueue  onCreate()  View  post  run \n\n View \n\nHandlerActionQueue#executeActions \n\n** Handler Handler  Runnable  post  Handler  Runnable **\n\n** Handler  Runnable **\n\n\n\n![executeActions() ](http://upload-images.jianshu.io/upload_images/5419805-e0cf86fbea081bc9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n View#dispatchAttachToWindow ViewRootImpl#performTraversals\n\n#### 3.  performTraversals()\n\n performTraversals \n\n View  View \n\n```java\nprivate void performTraversals() {\n    \n    //  host  DecorView dispatchAttachedToWindow\n    // mAttachInfo  View#post \n    //  mAttachInfo  ViewRootImpl  ViewRootImpl  Handler \n    host.dispatchAttachedToWindow(mAttachInfo, 0);\n    getRunQueue().executeActions(mAttachInfo.mHandler);\n    \n    // \n    performMeasure();\n    performLayout();\n    performDraw();\n}\n```\n\n dispatchAttachedToWindow \n\n```java\nvoid dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n```\n****\n\n1.  post  View  findViewById  View \n2.  AttachInfo  ViewRootImpl  AttachInfo ViewRootImpl  Handler  executeActions() **executeActions()** ** Handler  Runnable **\n\n\n mRunQueue  post()  View#getRunQueue View Runnable  **mRunQueue  executeActions()  View  Runnable  ViewRootImpl  Handler ** View  mRunQueue  ViewRootImpl \n\n\n\n```java\n// Postpone the runnable until we know on which thread it needs to run.\n// Assume that the runnable will be successfully placed after attach.\n//  Runnable  attach \ngetRunQueue().post(action);\n\n// Transfer all pending runnables.\n// ( ViewRootImpl )\nif (mRunQueue != null) {\n    mRunQueue.executeActions(info.mHandler);\n    mRunQueue = null;\n}\n```\n\ndispatch  performTraversals() \n\n```java\n// \n//  mAttachInfo.mHandler  getRunQueue()  Runnable \ngetRunQueue().executeActions(mAttachInfo.mHandler);\n```\n\n ViewRootImpl  getRunQueue()  View#post\n\n```java\n// ViewRootImpl#getRunQueue\n//  ThreadLocal  HandlerActionQueue\nstatic HandlerActionQueue getRunQueue() {\n    // sRunQueues  ThreadLocal<HandlerActionQueue> \n    HandlerActionQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new HandlerActionQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n\n// View#post\n//  View  dispatchAttachToWindow  UI \nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n```\n\n performTraversals()  getRunQueue()  UI \n\n****HandlerActionQueue** Handler **\n\n\n\n1. View#post  View  HandlerActionQueue  Runnable \n2.  ViewRootImpl#performTraversals  View#dispatchAttachedToWindow  ViewRootImpl  Handler  Handler  Runnable  UI  View  HandlerActionQueue \n3. ViewRootImpl#performTraversals  UI  HandlerActionQueue  ThreadLocal  Runnable \n4.  ViewRootImpl#performTraversals  View \n\n\n\n### View#post  Runnable#run \n\n**HandlerActionQueue#executeActions  View **\n\nAndroid  Handler  ViewRootImpl#performTraversals HandlerActionQueue#executeActions  Handler  Runnable post  UI  View#post \n\n UI  ViewRootImpl#performTraversal View  Runnable#run  View \n\n\n\n```JAVA\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n\n    final ViewGroup viewGroup = (ViewGroup) getWindow().getDecorView();\n\n    //  Add \n    view = new View(this) {\n        @Override\n        protected void onLayout( ... ... ) {\n            super.onLayout(changed, left, top, right, bottom);\n            Log.e(\"Test\", \"onLayout()\");\n        }\n    };\n\n    //  Handler \n    mHandler.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(\"Test\", \"mHandler.post ---- > \" + view.getHeight());\n        }\n    });\n\n    // onCreate()  mAttachInfo  ViewRootImpl  Handler \n    // \n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(\"Test\", \"view.post ---- > \" + view.getHeight());\n        }\n    });\n\n    viewGroup.addView(view);\n}\n```\n\n\n\n![image](http://upload-images.jianshu.io/upload_images/5419805-ec13fe6929791de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n\n1. Handler#post  post  onCreate()  performTraversals() \n2. ViewRootImpl#performTraversal  View#dispatchAttachedToWindow  Runnable  layout \n3.  View#post  View#dispatchAttachedToWindow  ViewRootImpl  Handler postDelay  Runnable  ViewRootImpl#performTraversal \n\n### View#post \n\n\n\n View#post \n\n1.  View attach  Window  HandlerActionQueue  Runnable  Attach  Window  ( ViewRootImpl  performTraversal )  Runnable  ViewRootImpl \n2.  View#dispatchAttachedToWindow  View  AttachInfo  ViewRootImpl  View  Runnable  ViewRootImpl \n3.  ViewRootImpl  performTraversal  ViewRootImpl#getRunQueue  ThreadLocal  HandlerActionQueue ViewRootImpl  Runnable \n4.  View  post  HandlerActionQueue  View#dispatchAttachedToWindow  ViewRootImpl \n\n\n\n### Android 7.0  View#post \n\nView#post \n\n> Android  API 24 \n\n\n\n bug bug ** View  attach  window  View#post **\n\n API23  View#post\n\n```java\n// Android API23 View#post\npublic boolean post(Runnable action) {\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        return attachInfo.mHandler.post(action);\n    }\n    // Assume that post will succeed later\n    //  ViewRootImpl#getRunQueue \n    ViewRootImpl.getRunQueue().post(action);\n    return true;\n}\n```\n\nAPI23 View#post  attach  window  mAttachInfo  null  ViewRootImpl#getRunQueue \n\n ViewRootImpl#getRunQueue \n\n```java\nstatic final ThreadLocal<RunQueue> sRunQueues = new ThreadLocal<RunQueue>();\nstatic RunQueue getRunQueue() {\n    RunQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new RunQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n```\n\n key  ThreadLocal executeActions()  ViewRootImpl#performTraversal  23 \n\n** post  runnable key  Runnable**\n\n** attach  window **View  mAttachInfo  ViewRootImpl  Runnable  ViewRootImpl  Handler ****\n\nViewRootImpl  ThreadLocal https://blog.csdn.net/a740169405/article/details/69668957\n\n**Google  View#post  View  attach  window  ViewRootImpl  AttachInfo  View  Runnable **\n\n\n\n### \n\n\n\n##### https://blog.csdn.net/a740169405/article/details/69668957\n\n##### https://blog.csdn.net/scnuxisan225/article/details/49815269\n\n##### https://www.cnblogs.com/plokmju/p/7481727.html\n\n","source":"_posts/android-view-post.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181407.jpg\ntitle: Android View.post \ntags: [Android]\ndate: 2018-08-14\n---\n\n>  View \n\n<!-- more -->\n\n### \n\n onCreate()  onResume()  View  View#post  View \n\n View#post  run() \n\n View#post \n\n\n\n- View#post \n- post() \n- post()  Runnable#run \n- View#post \n- Android 7.0  View#post \n- \n\n### View#post \n\n\n\n```java\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    View view = findViewById(R.id.test);\n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            //  View \n            Log.e(\"Test\", \"view.post ---- > \" + view.getHeight());\n        }\n    });\n}\n```\n\n API 26 \n\nAndroid  API 24 \n\n\n\n### post() \n\n#### 1. View#post \n View#post \n\n```java\n/**\n * Causes the Runnable to be added to the message queue.\n * The runnable will be run on the user interface thread.\n *  Runnable  UI \n */\npublic boolean post(Runnable action) {\n    // AttachInfo  View \n    //  mAttachInfo  null\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        // attachInfo  Handler \n        return attachInfo.mHandler.post(action);\n    }\n\n    // Postpone the runnable until we know on which thread it needs to run.\n    // Assume that the runnable will be successfully placed after attach.\n    //  Runnable \n    //  attach  Runnable placed\n    // \n    getRunQueue().post(action);\n    return true;\n}\n```\n\n**Runnable  UI **\n\n **mAttachInfo** \n\n```java\nvoid dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n```\n\n dispatchAttachedToWindow  ViewRootImpl#performTraversals \n\n **getRunQueue().post()** \n\n```java\n/**\n *  RunQueue  post \n * Returns the queue of runnable for this view.\n *  View  View \n */\nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n```\n\n\n\n#### 2. HandlerActionQueue \n\n post  HandlerActionQueue \n\n```java\n/**\n * Class used to enqueue pending work from Views when no Handler is attached.\n *  View  Handler \n */\npublic class HandlerActionQueue {\n    private HandlerAction[] mActions;\n    private int mCount;\n\n    //  post  postDelayed \n    public void post(Runnable action) {\n        postDelayed(action, 0);\n    }\n\n    //  Runnable \n    public void postDelayed(Runnable action, long delayMillis) {\n        final HandlerAction handlerAction = new HandlerAction(action, delayMillis);\n\n        synchronized (this) {\n            if (mActions == null) {\n                mActions = new HandlerAction[4];\n            }\n            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);\n            mCount++;\n        }\n    }\n\n    // \n    public void executeActions(Handler handler) {\n        synchronized (this) {\n            final HandlerAction[] actions = mActions;\n            for (int i = 0, count = mCount; i < count; i++) {\n                final HandlerAction handlerAction = actions[i];\n                handler.postDelayed(handlerAction.action, handlerAction.delay);\n            }\n\n            mActions = null;\n            mCount = 0;\n        }\n    }\n}\n```\n\n HandlerActionQueue  onCreate()  View  post  run \n\n View \n\nHandlerActionQueue#executeActions \n\n** Handler Handler  Runnable  post  Handler  Runnable **\n\n** Handler  Runnable **\n\n\n\n![executeActions() ](http://upload-images.jianshu.io/upload_images/5419805-e0cf86fbea081bc9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n View#dispatchAttachToWindow ViewRootImpl#performTraversals\n\n#### 3.  performTraversals()\n\n performTraversals \n\n View  View \n\n```java\nprivate void performTraversals() {\n    \n    //  host  DecorView dispatchAttachedToWindow\n    // mAttachInfo  View#post \n    //  mAttachInfo  ViewRootImpl  ViewRootImpl  Handler \n    host.dispatchAttachedToWindow(mAttachInfo, 0);\n    getRunQueue().executeActions(mAttachInfo.mHandler);\n    \n    // \n    performMeasure();\n    performLayout();\n    performDraw();\n}\n```\n\n dispatchAttachedToWindow \n\n```java\nvoid dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n```\n****\n\n1.  post  View  findViewById  View \n2.  AttachInfo  ViewRootImpl  AttachInfo ViewRootImpl  Handler  executeActions() **executeActions()** ** Handler  Runnable **\n\n\n mRunQueue  post()  View#getRunQueue View Runnable  **mRunQueue  executeActions()  View  Runnable  ViewRootImpl  Handler ** View  mRunQueue  ViewRootImpl \n\n\n\n```java\n// Postpone the runnable until we know on which thread it needs to run.\n// Assume that the runnable will be successfully placed after attach.\n//  Runnable  attach \ngetRunQueue().post(action);\n\n// Transfer all pending runnables.\n// ( ViewRootImpl )\nif (mRunQueue != null) {\n    mRunQueue.executeActions(info.mHandler);\n    mRunQueue = null;\n}\n```\n\ndispatch  performTraversals() \n\n```java\n// \n//  mAttachInfo.mHandler  getRunQueue()  Runnable \ngetRunQueue().executeActions(mAttachInfo.mHandler);\n```\n\n ViewRootImpl  getRunQueue()  View#post\n\n```java\n// ViewRootImpl#getRunQueue\n//  ThreadLocal  HandlerActionQueue\nstatic HandlerActionQueue getRunQueue() {\n    // sRunQueues  ThreadLocal<HandlerActionQueue> \n    HandlerActionQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new HandlerActionQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n\n// View#post\n//  View  dispatchAttachToWindow  UI \nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n```\n\n performTraversals()  getRunQueue()  UI \n\n****HandlerActionQueue** Handler **\n\n\n\n1. View#post  View  HandlerActionQueue  Runnable \n2.  ViewRootImpl#performTraversals  View#dispatchAttachedToWindow  ViewRootImpl  Handler  Handler  Runnable  UI  View  HandlerActionQueue \n3. ViewRootImpl#performTraversals  UI  HandlerActionQueue  ThreadLocal  Runnable \n4.  ViewRootImpl#performTraversals  View \n\n\n\n### View#post  Runnable#run \n\n**HandlerActionQueue#executeActions  View **\n\nAndroid  Handler  ViewRootImpl#performTraversals HandlerActionQueue#executeActions  Handler  Runnable post  UI  View#post \n\n UI  ViewRootImpl#performTraversal View  Runnable#run  View \n\n\n\n```JAVA\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n\n    final ViewGroup viewGroup = (ViewGroup) getWindow().getDecorView();\n\n    //  Add \n    view = new View(this) {\n        @Override\n        protected void onLayout( ... ... ) {\n            super.onLayout(changed, left, top, right, bottom);\n            Log.e(\"Test\", \"onLayout()\");\n        }\n    };\n\n    //  Handler \n    mHandler.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(\"Test\", \"mHandler.post ---- > \" + view.getHeight());\n        }\n    });\n\n    // onCreate()  mAttachInfo  ViewRootImpl  Handler \n    // \n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(\"Test\", \"view.post ---- > \" + view.getHeight());\n        }\n    });\n\n    viewGroup.addView(view);\n}\n```\n\n\n\n![image](http://upload-images.jianshu.io/upload_images/5419805-ec13fe6929791de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n\n1. Handler#post  post  onCreate()  performTraversals() \n2. ViewRootImpl#performTraversal  View#dispatchAttachedToWindow  Runnable  layout \n3.  View#post  View#dispatchAttachedToWindow  ViewRootImpl  Handler postDelay  Runnable  ViewRootImpl#performTraversal \n\n### View#post \n\n\n\n View#post \n\n1.  View attach  Window  HandlerActionQueue  Runnable  Attach  Window  ( ViewRootImpl  performTraversal )  Runnable  ViewRootImpl \n2.  View#dispatchAttachedToWindow  View  AttachInfo  ViewRootImpl  View  Runnable  ViewRootImpl \n3.  ViewRootImpl  performTraversal  ViewRootImpl#getRunQueue  ThreadLocal  HandlerActionQueue ViewRootImpl  Runnable \n4.  View  post  HandlerActionQueue  View#dispatchAttachedToWindow  ViewRootImpl \n\n\n\n### Android 7.0  View#post \n\nView#post \n\n> Android  API 24 \n\n\n\n bug bug ** View  attach  window  View#post **\n\n API23  View#post\n\n```java\n// Android API23 View#post\npublic boolean post(Runnable action) {\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        return attachInfo.mHandler.post(action);\n    }\n    // Assume that post will succeed later\n    //  ViewRootImpl#getRunQueue \n    ViewRootImpl.getRunQueue().post(action);\n    return true;\n}\n```\n\nAPI23 View#post  attach  window  mAttachInfo  null  ViewRootImpl#getRunQueue \n\n ViewRootImpl#getRunQueue \n\n```java\nstatic final ThreadLocal<RunQueue> sRunQueues = new ThreadLocal<RunQueue>();\nstatic RunQueue getRunQueue() {\n    RunQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new RunQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n```\n\n key  ThreadLocal executeActions()  ViewRootImpl#performTraversal  23 \n\n** post  runnable key  Runnable**\n\n** attach  window **View  mAttachInfo  ViewRootImpl  Runnable  ViewRootImpl  Handler ****\n\nViewRootImpl  ThreadLocal https://blog.csdn.net/a740169405/article/details/69668957\n\n**Google  View#post  View  attach  window  ViewRootImpl  AttachInfo  View  Runnable **\n\n\n\n### \n\n\n\n##### https://blog.csdn.net/a740169405/article/details/69668957\n\n##### https://blog.csdn.net/scnuxisan225/article/details/49815269\n\n##### https://www.cnblogs.com/plokmju/p/7481727.html\n\n","slug":"android-view-post","published":1,"updated":"2019-03-21T10:15:31.549Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86ep001ulh1p5atkwl16","content":"<blockquote>\n<p> View </p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> onCreate()  onResume()  View  View#post  View </p>\n<p> View#post  run() </p>\n<p> View#post </p>\n<p></p>\n<ul>\n<li>View#post </li>\n<li>post() </li>\n<li>post()  Runnable#run </li>\n<li>View#post </li>\n<li>Android 7.0  View#post </li>\n<li></li>\n</ul>\n<h3 id=\"View-post-\"><a href=\"#View-post-\" class=\"headerlink\" title=\"View#post \"></a>View#post </h3><p></p>\n<pre><code class=\"java\">@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    View view = findViewById(R.id.test);\n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            //  View \n            Log.e(&quot;Test&quot;, &quot;view.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n}\n</code></pre>\n<p> API 26 </p>\n<p>Android  API 24 </p>\n<h3 id=\"post-\"><a href=\"#post-\" class=\"headerlink\" title=\"post() \"></a>post() </h3><h4 id=\"1-View-post-\"><a href=\"#1-View-post-\" class=\"headerlink\" title=\"1. View#post \"></a>1. View#post </h4><p> View#post </p>\n<pre><code class=\"java\">/**\n * Causes the Runnable to be added to the message queue.\n * The runnable will be run on the user interface thread.\n *  Runnable  UI \n */\npublic boolean post(Runnable action) {\n    // AttachInfo  View \n    //  mAttachInfo  null\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        // attachInfo  Handler \n        return attachInfo.mHandler.post(action);\n    }\n\n    // Postpone the runnable until we know on which thread it needs to run.\n    // Assume that the runnable will be successfully placed after attach.\n    //  Runnable \n    //  attach  Runnable placed\n    // \n    getRunQueue().post(action);\n    return true;\n}\n</code></pre>\n<p><strong>Runnable  UI </strong></p>\n<p> <strong>mAttachInfo</strong> </p>\n<pre><code class=\"java\">void dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n</code></pre>\n<p> dispatchAttachedToWindow  ViewRootImpl#performTraversals </p>\n<p> <strong>getRunQueue().post()</strong> </p>\n<pre><code class=\"java\">/**\n *  RunQueue  post \n * Returns the queue of runnable for this view.\n *  View  View \n */\nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n</code></pre>\n<h4 id=\"2-HandlerActionQueue-\"><a href=\"#2-HandlerActionQueue-\" class=\"headerlink\" title=\"2. HandlerActionQueue \"></a>2. HandlerActionQueue </h4><p> post  HandlerActionQueue </p>\n<pre><code class=\"java\">/**\n * Class used to enqueue pending work from Views when no Handler is attached.\n *  View  Handler \n */\npublic class HandlerActionQueue {\n    private HandlerAction[] mActions;\n    private int mCount;\n\n    //  post  postDelayed \n    public void post(Runnable action) {\n        postDelayed(action, 0);\n    }\n\n    //  Runnable \n    public void postDelayed(Runnable action, long delayMillis) {\n        final HandlerAction handlerAction = new HandlerAction(action, delayMillis);\n\n        synchronized (this) {\n            if (mActions == null) {\n                mActions = new HandlerAction[4];\n            }\n            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);\n            mCount++;\n        }\n    }\n\n    // \n    public void executeActions(Handler handler) {\n        synchronized (this) {\n            final HandlerAction[] actions = mActions;\n            for (int i = 0, count = mCount; i &lt; count; i++) {\n                final HandlerAction handlerAction = actions[i];\n                handler.postDelayed(handlerAction.action, handlerAction.delay);\n            }\n\n            mActions = null;\n            mCount = 0;\n        }\n    }\n}\n</code></pre>\n<p> HandlerActionQueue  onCreate()  View  post  run </p>\n<p> View </p>\n<p>HandlerActionQueue#executeActions </p>\n<p><strong> Handler Handler  Runnable  post  Handler  Runnable </strong></p>\n<p><strong> Handler  Runnable </strong></p>\n<p></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/5419805-e0cf86fbea081bc9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"executeActions() \"></p>\n<p> View#dispatchAttachToWindow ViewRootImpl#performTraversals</p>\n<h4 id=\"3--performTraversals\"><a href=\"#3--performTraversals\" class=\"headerlink\" title=\"3.  performTraversals()\"></a>3.  performTraversals()</h4><p> performTraversals </p>\n<p> View  View </p>\n<pre><code class=\"java\">private void performTraversals() {\n\n    //  host  DecorView dispatchAttachedToWindow\n    // mAttachInfo  View#post \n    //  mAttachInfo  ViewRootImpl  ViewRootImpl  Handler \n    host.dispatchAttachedToWindow(mAttachInfo, 0);\n    getRunQueue().executeActions(mAttachInfo.mHandler);\n\n    // \n    performMeasure();\n    performLayout();\n    performDraw();\n}\n</code></pre>\n<p> dispatchAttachedToWindow </p>\n<pre><code class=\"java\">void dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n</code></pre>\n<p><strong></strong></p>\n<ol>\n<li> post  View  findViewById  View </li>\n<li> AttachInfo  ViewRootImpl  AttachInfo ViewRootImpl  Handler  executeActions() <strong>executeActions()</strong> <strong> Handler  Runnable </strong></li>\n</ol>\n<p> mRunQueue  post()  View#getRunQueue View Runnable  <strong>mRunQueue  executeActions()  View  Runnable  ViewRootImpl  Handler </strong> View  mRunQueue  ViewRootImpl </p>\n<p></p>\n<pre><code class=\"java\">// Postpone the runnable until we know on which thread it needs to run.\n// Assume that the runnable will be successfully placed after attach.\n//  Runnable  attach \ngetRunQueue().post(action);\n\n// Transfer all pending runnables.\n// ( ViewRootImpl )\nif (mRunQueue != null) {\n    mRunQueue.executeActions(info.mHandler);\n    mRunQueue = null;\n}\n</code></pre>\n<p>dispatch  performTraversals() </p>\n<pre><code class=\"java\">// \n//  mAttachInfo.mHandler  getRunQueue()  Runnable \ngetRunQueue().executeActions(mAttachInfo.mHandler);\n</code></pre>\n<p> ViewRootImpl  getRunQueue()  View#post</p>\n<pre><code class=\"java\">// ViewRootImpl#getRunQueue\n//  ThreadLocal  HandlerActionQueue\nstatic HandlerActionQueue getRunQueue() {\n    // sRunQueues  ThreadLocal&lt;HandlerActionQueue&gt; \n    HandlerActionQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new HandlerActionQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n\n// View#post\n//  View  dispatchAttachToWindow  UI \nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n</code></pre>\n<p> performTraversals()  getRunQueue()  UI </p>\n<p><strong></strong>HandlerActionQueue<strong> Handler </strong></p>\n<p></p>\n<ol>\n<li>View#post  View  HandlerActionQueue  Runnable </li>\n<li> ViewRootImpl#performTraversals  View#dispatchAttachedToWindow  ViewRootImpl  Handler  Handler  Runnable  UI  View  HandlerActionQueue </li>\n<li>ViewRootImpl#performTraversals  UI  HandlerActionQueue  ThreadLocal  Runnable </li>\n<li> ViewRootImpl#performTraversals  View </li>\n</ol>\n<h3 id=\"View-post--Runnable-run-\"><a href=\"#View-post--Runnable-run-\" class=\"headerlink\" title=\"View#post  Runnable#run \"></a>View#post  Runnable#run </h3><p><strong>HandlerActionQueue#executeActions  View </strong></p>\n<p>Android  Handler  ViewRootImpl#performTraversals HandlerActionQueue#executeActions  Handler  Runnable post  UI  View#post </p>\n<p> UI  ViewRootImpl#performTraversal View  Runnable#run  View </p>\n<p></p>\n<pre><code class=\"JAVA\">@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n\n    final ViewGroup viewGroup = (ViewGroup) getWindow().getDecorView();\n\n    //  Add \n    view = new View(this) {\n        @Override\n        protected void onLayout( ... ... ) {\n            super.onLayout(changed, left, top, right, bottom);\n            Log.e(&quot;Test&quot;, &quot;onLayout()&quot;);\n        }\n    };\n\n    //  Handler \n    mHandler.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(&quot;Test&quot;, &quot;mHandler.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n\n    // onCreate()  mAttachInfo  ViewRootImpl  Handler \n    // \n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(&quot;Test&quot;, &quot;view.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n\n    viewGroup.addView(view);\n}\n</code></pre>\n<p></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/5419805-ec13fe6929791de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image\"></p>\n<p></p>\n<ol>\n<li>Handler#post  post  onCreate()  performTraversals() </li>\n<li>ViewRootImpl#performTraversal  View#dispatchAttachedToWindow  Runnable  layout </li>\n<li> View#post  View#dispatchAttachedToWindow  ViewRootImpl  Handler postDelay  Runnable  ViewRootImpl#performTraversal </li>\n</ol>\n<h3 id=\"View-post-\"><a href=\"#View-post-\" class=\"headerlink\" title=\"View#post \"></a>View#post </h3><p></p>\n<p> View#post </p>\n<ol>\n<li> View attach  Window  HandlerActionQueue  Runnable  Attach  Window  ( ViewRootImpl  performTraversal )  Runnable  ViewRootImpl </li>\n<li> View#dispatchAttachedToWindow  View  AttachInfo  ViewRootImpl  View  Runnable  ViewRootImpl </li>\n<li> ViewRootImpl  performTraversal  ViewRootImpl#getRunQueue  ThreadLocal  HandlerActionQueue ViewRootImpl  Runnable </li>\n<li> View  post  HandlerActionQueue  View#dispatchAttachedToWindow  ViewRootImpl </li>\n</ol>\n<h3 id=\"Android-7-0--View-post-\"><a href=\"#Android-7-0--View-post-\" class=\"headerlink\" title=\"Android 7.0  View#post \"></a>Android 7.0  View#post </h3><p>View#post </p>\n<blockquote>\n<p>Android  API 24 </p>\n</blockquote>\n<p></p>\n<p> bug bug <strong> View  attach  window  View#post </strong></p>\n<p> API23  View#post</p>\n<pre><code class=\"java\">// Android API23 View#post\npublic boolean post(Runnable action) {\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        return attachInfo.mHandler.post(action);\n    }\n    // Assume that post will succeed later\n    //  ViewRootImpl#getRunQueue \n    ViewRootImpl.getRunQueue().post(action);\n    return true;\n}\n</code></pre>\n<p>API23 View#post  attach  window  mAttachInfo  null  ViewRootImpl#getRunQueue </p>\n<p> ViewRootImpl#getRunQueue </p>\n<pre><code class=\"java\">static final ThreadLocal&lt;RunQueue&gt; sRunQueues = new ThreadLocal&lt;RunQueue&gt;();\nstatic RunQueue getRunQueue() {\n    RunQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new RunQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n</code></pre>\n<p> key  ThreadLocal executeActions()  ViewRootImpl#performTraversal  23 </p>\n<p><strong> post  runnable key  Runnable</strong></p>\n<p><strong> attach  window </strong>View  mAttachInfo  ViewRootImpl  Runnable  ViewRootImpl  Handler <strong></strong></p>\n<p>ViewRootImpl  ThreadLocal <a href=\"https://blog.csdn.net/a740169405/article/details/69668957\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/a740169405/article/details/69668957</a></p>\n<p><strong>Google  View#post  View  attach  window  ViewRootImpl  AttachInfo  View  Runnable </strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h5 id=\"https-blog-csdn-net-a740169405-article-details-69668957\"><a href=\"#https-blog-csdn-net-a740169405-article-details-69668957\" class=\"headerlink\" title=\"https://blog.csdn.net/a740169405/article/details/69668957\"></a><a href=\"https://blog.csdn.net/a740169405/article/details/69668957\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/a740169405/article/details/69668957</a></h5><h5 id=\"https-blog-csdn-net-scnuxisan225-article-details-49815269\"><a href=\"#https-blog-csdn-net-scnuxisan225-article-details-49815269\" class=\"headerlink\" title=\"https://blog.csdn.net/scnuxisan225/article/details/49815269\"></a><a href=\"https://blog.csdn.net/scnuxisan225/article/details/49815269\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/scnuxisan225/article/details/49815269</a></h5><h5 id=\"https-www-cnblogs-com-plokmju-p-7481727-html\"><a href=\"#https-www-cnblogs-com-plokmju-p-7481727-html\" class=\"headerlink\" title=\"https://www.cnblogs.com/plokmju/p/7481727.html\"></a><a href=\"https://www.cnblogs.com/plokmju/p/7481727.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/plokmju/p/7481727.html</a></h5>","site":{"data":{}},"excerpt":"<blockquote>\n<p> View </p>\n</blockquote>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> onCreate()  onResume()  View  View#post  View </p>\n<p> View#post  run() </p>\n<p> View#post </p>\n<p></p>\n<ul>\n<li>View#post </li>\n<li>post() </li>\n<li>post()  Runnable#run </li>\n<li>View#post </li>\n<li>Android 7.0  View#post </li>\n<li></li>\n</ul>\n<h3 id=\"View-post-\"><a href=\"#View-post-\" class=\"headerlink\" title=\"View#post \"></a>View#post </h3><p></p>\n<pre><code class=\"java\">@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    View view = findViewById(R.id.test);\n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            //  View \n            Log.e(&quot;Test&quot;, &quot;view.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n}\n</code></pre>\n<p> API 26 </p>\n<p>Android  API 24 </p>\n<h3 id=\"post-\"><a href=\"#post-\" class=\"headerlink\" title=\"post() \"></a>post() </h3><h4 id=\"1-View-post-\"><a href=\"#1-View-post-\" class=\"headerlink\" title=\"1. View#post \"></a>1. View#post </h4><p> View#post </p>\n<pre><code class=\"java\">/**\n * Causes the Runnable to be added to the message queue.\n * The runnable will be run on the user interface thread.\n *  Runnable  UI \n */\npublic boolean post(Runnable action) {\n    // AttachInfo  View \n    //  mAttachInfo  null\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        // attachInfo  Handler \n        return attachInfo.mHandler.post(action);\n    }\n\n    // Postpone the runnable until we know on which thread it needs to run.\n    // Assume that the runnable will be successfully placed after attach.\n    //  Runnable \n    //  attach  Runnable placed\n    // \n    getRunQueue().post(action);\n    return true;\n}\n</code></pre>\n<p><strong>Runnable  UI </strong></p>\n<p> <strong>mAttachInfo</strong> </p>\n<pre><code class=\"java\">void dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n</code></pre>\n<p> dispatchAttachedToWindow  ViewRootImpl#performTraversals </p>\n<p> <strong>getRunQueue().post()</strong> </p>\n<pre><code class=\"java\">/**\n *  RunQueue  post \n * Returns the queue of runnable for this view.\n *  View  View \n */\nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n</code></pre>\n<h4 id=\"2-HandlerActionQueue-\"><a href=\"#2-HandlerActionQueue-\" class=\"headerlink\" title=\"2. HandlerActionQueue \"></a>2. HandlerActionQueue </h4><p> post  HandlerActionQueue </p>\n<pre><code class=\"java\">/**\n * Class used to enqueue pending work from Views when no Handler is attached.\n *  View  Handler \n */\npublic class HandlerActionQueue {\n    private HandlerAction[] mActions;\n    private int mCount;\n\n    //  post  postDelayed \n    public void post(Runnable action) {\n        postDelayed(action, 0);\n    }\n\n    //  Runnable \n    public void postDelayed(Runnable action, long delayMillis) {\n        final HandlerAction handlerAction = new HandlerAction(action, delayMillis);\n\n        synchronized (this) {\n            if (mActions == null) {\n                mActions = new HandlerAction[4];\n            }\n            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);\n            mCount++;\n        }\n    }\n\n    // \n    public void executeActions(Handler handler) {\n        synchronized (this) {\n            final HandlerAction[] actions = mActions;\n            for (int i = 0, count = mCount; i &lt; count; i++) {\n                final HandlerAction handlerAction = actions[i];\n                handler.postDelayed(handlerAction.action, handlerAction.delay);\n            }\n\n            mActions = null;\n            mCount = 0;\n        }\n    }\n}\n</code></pre>\n<p> HandlerActionQueue  onCreate()  View  post  run </p>\n<p> View </p>\n<p>HandlerActionQueue#executeActions </p>\n<p><strong> Handler Handler  Runnable  post  Handler  Runnable </strong></p>\n<p><strong> Handler  Runnable </strong></p>\n<p></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/5419805-e0cf86fbea081bc9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"executeActions() \"></p>\n<p> View#dispatchAttachToWindow ViewRootImpl#performTraversals</p>\n<h4 id=\"3--performTraversals\"><a href=\"#3--performTraversals\" class=\"headerlink\" title=\"3.  performTraversals()\"></a>3.  performTraversals()</h4><p> performTraversals </p>\n<p> View  View </p>\n<pre><code class=\"java\">private void performTraversals() {\n\n    //  host  DecorView dispatchAttachedToWindow\n    // mAttachInfo  View#post \n    //  mAttachInfo  ViewRootImpl  ViewRootImpl  Handler \n    host.dispatchAttachedToWindow(mAttachInfo, 0);\n    getRunQueue().executeActions(mAttachInfo.mHandler);\n\n    // \n    performMeasure();\n    performLayout();\n    performDraw();\n}\n</code></pre>\n<p> dispatchAttachedToWindow </p>\n<pre><code class=\"java\">void dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    mAttachInfo = info;\n    // Transfer all pending runnables. \n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // \n    onAttachedToWindow();\n}\n</code></pre>\n<p><strong></strong></p>\n<ol>\n<li> post  View  findViewById  View </li>\n<li> AttachInfo  ViewRootImpl  AttachInfo ViewRootImpl  Handler  executeActions() <strong>executeActions()</strong> <strong> Handler  Runnable </strong></li>\n</ol>\n<p> mRunQueue  post()  View#getRunQueue View Runnable  <strong>mRunQueue  executeActions()  View  Runnable  ViewRootImpl  Handler </strong> View  mRunQueue  ViewRootImpl </p>\n<p></p>\n<pre><code class=\"java\">// Postpone the runnable until we know on which thread it needs to run.\n// Assume that the runnable will be successfully placed after attach.\n//  Runnable  attach \ngetRunQueue().post(action);\n\n// Transfer all pending runnables.\n// ( ViewRootImpl )\nif (mRunQueue != null) {\n    mRunQueue.executeActions(info.mHandler);\n    mRunQueue = null;\n}\n</code></pre>\n<p>dispatch  performTraversals() </p>\n<pre><code class=\"java\">// \n//  mAttachInfo.mHandler  getRunQueue()  Runnable \ngetRunQueue().executeActions(mAttachInfo.mHandler);\n</code></pre>\n<p> ViewRootImpl  getRunQueue()  View#post</p>\n<pre><code class=\"java\">// ViewRootImpl#getRunQueue\n//  ThreadLocal  HandlerActionQueue\nstatic HandlerActionQueue getRunQueue() {\n    // sRunQueues  ThreadLocal&lt;HandlerActionQueue&gt; \n    HandlerActionQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new HandlerActionQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n\n// View#post\n//  View  dispatchAttachToWindow  UI \nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n</code></pre>\n<p> performTraversals()  getRunQueue()  UI </p>\n<p><strong></strong>HandlerActionQueue<strong> Handler </strong></p>\n<p></p>\n<ol>\n<li>View#post  View  HandlerActionQueue  Runnable </li>\n<li> ViewRootImpl#performTraversals  View#dispatchAttachedToWindow  ViewRootImpl  Handler  Handler  Runnable  UI  View  HandlerActionQueue </li>\n<li>ViewRootImpl#performTraversals  UI  HandlerActionQueue  ThreadLocal  Runnable </li>\n<li> ViewRootImpl#performTraversals  View </li>\n</ol>\n<h3 id=\"View-post--Runnable-run-\"><a href=\"#View-post--Runnable-run-\" class=\"headerlink\" title=\"View#post  Runnable#run \"></a>View#post  Runnable#run </h3><p><strong>HandlerActionQueue#executeActions  View </strong></p>\n<p>Android  Handler  ViewRootImpl#performTraversals HandlerActionQueue#executeActions  Handler  Runnable post  UI  View#post </p>\n<p> UI  ViewRootImpl#performTraversal View  Runnable#run  View </p>\n<p></p>\n<pre><code class=\"JAVA\">@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n\n    final ViewGroup viewGroup = (ViewGroup) getWindow().getDecorView();\n\n    //  Add \n    view = new View(this) {\n        @Override\n        protected void onLayout( ... ... ) {\n            super.onLayout(changed, left, top, right, bottom);\n            Log.e(&quot;Test&quot;, &quot;onLayout()&quot;);\n        }\n    };\n\n    //  Handler \n    mHandler.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(&quot;Test&quot;, &quot;mHandler.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n\n    // onCreate()  mAttachInfo  ViewRootImpl  Handler \n    // \n    view.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.e(&quot;Test&quot;, &quot;view.post ---- &gt; &quot; + view.getHeight());\n        }\n    });\n\n    viewGroup.addView(view);\n}\n</code></pre>\n<p></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/5419805-ec13fe6929791de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"image\"></p>\n<p></p>\n<ol>\n<li>Handler#post  post  onCreate()  performTraversals() </li>\n<li>ViewRootImpl#performTraversal  View#dispatchAttachedToWindow  Runnable  layout </li>\n<li> View#post  View#dispatchAttachedToWindow  ViewRootImpl  Handler postDelay  Runnable  ViewRootImpl#performTraversal </li>\n</ol>\n<h3 id=\"View-post-\"><a href=\"#View-post-\" class=\"headerlink\" title=\"View#post \"></a>View#post </h3><p></p>\n<p> View#post </p>\n<ol>\n<li> View attach  Window  HandlerActionQueue  Runnable  Attach  Window  ( ViewRootImpl  performTraversal )  Runnable  ViewRootImpl </li>\n<li> View#dispatchAttachedToWindow  View  AttachInfo  ViewRootImpl  View  Runnable  ViewRootImpl </li>\n<li> ViewRootImpl  performTraversal  ViewRootImpl#getRunQueue  ThreadLocal  HandlerActionQueue ViewRootImpl  Runnable </li>\n<li> View  post  HandlerActionQueue  View#dispatchAttachedToWindow  ViewRootImpl </li>\n</ol>\n<h3 id=\"Android-7-0--View-post-\"><a href=\"#Android-7-0--View-post-\" class=\"headerlink\" title=\"Android 7.0  View#post \"></a>Android 7.0  View#post </h3><p>View#post </p>\n<blockquote>\n<p>Android  API 24 </p>\n</blockquote>\n<p></p>\n<p> bug bug <strong> View  attach  window  View#post </strong></p>\n<p> API23  View#post</p>\n<pre><code class=\"java\">// Android API23 View#post\npublic boolean post(Runnable action) {\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        return attachInfo.mHandler.post(action);\n    }\n    // Assume that post will succeed later\n    //  ViewRootImpl#getRunQueue \n    ViewRootImpl.getRunQueue().post(action);\n    return true;\n}\n</code></pre>\n<p>API23 View#post  attach  window  mAttachInfo  null  ViewRootImpl#getRunQueue </p>\n<p> ViewRootImpl#getRunQueue </p>\n<pre><code class=\"java\">static final ThreadLocal&lt;RunQueue&gt; sRunQueues = new ThreadLocal&lt;RunQueue&gt;();\nstatic RunQueue getRunQueue() {\n    RunQueue rq = sRunQueues.get();\n    if (rq != null) {\n        return rq;\n    }\n    rq = new RunQueue();\n    sRunQueues.set(rq);\n    return rq;\n}\n</code></pre>\n<p> key  ThreadLocal executeActions()  ViewRootImpl#performTraversal  23 </p>\n<p><strong> post  runnable key  Runnable</strong></p>\n<p><strong> attach  window </strong>View  mAttachInfo  ViewRootImpl  Runnable  ViewRootImpl  Handler <strong></strong></p>\n<p>ViewRootImpl  ThreadLocal <a href=\"https://blog.csdn.net/a740169405/article/details/69668957\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/a740169405/article/details/69668957</a></p>\n<p><strong>Google  View#post  View  attach  window  ViewRootImpl  AttachInfo  View  Runnable </strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h5 id=\"https-blog-csdn-net-a740169405-article-details-69668957\"><a href=\"#https-blog-csdn-net-a740169405-article-details-69668957\" class=\"headerlink\" title=\"https://blog.csdn.net/a740169405/article/details/69668957\"></a><a href=\"https://blog.csdn.net/a740169405/article/details/69668957\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/a740169405/article/details/69668957</a></h5><h5 id=\"https-blog-csdn-net-scnuxisan225-article-details-49815269\"><a href=\"#https-blog-csdn-net-scnuxisan225-article-details-49815269\" class=\"headerlink\" title=\"https://blog.csdn.net/scnuxisan225/article/details/49815269\"></a><a href=\"https://blog.csdn.net/scnuxisan225/article/details/49815269\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/scnuxisan225/article/details/49815269</a></h5><h5 id=\"https-www-cnblogs-com-plokmju-p-7481727-html\"><a href=\"#https-www-cnblogs-com-plokmju-p-7481727-html\" class=\"headerlink\" title=\"https://www.cnblogs.com/plokmju/p/7481727.html\"></a><a href=\"https://www.cnblogs.com/plokmju/p/7481727.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/plokmju/p/7481727.html</a></h5>"},{"thumbnail":"//raw.githubusercontent.com/Joeljt/BlogImage/master/20190410195304.jpg","title":"Activity ","date":"2019-08-29T16:00:00.000Z","_content":"\n\n\n startActivity() \n\n\n\n<!-- more --> \n\n\n\n## \n\n Activity \n\n API23 \n\n Activity \n\n1. Binder \n2. Handler  \n3. Instrumentation\n4. ActivityThread\n5. ApplicationThread\n6. ActivityManagerService\n\n\n\n\n\n\n## \n\n###  Binder \n\n Binder  Android  Linux  App  Android \n\nsocket Android Binder  Android Binder **** Binder  ActivityManagerService  Binder  App  App  Binder ****\n\n**Binder Binder Client  Server Server Client C/S  binder **\n\n\n\n\n\n Client Server binder  binder \n\n binder  binder [](https://blog.csdn.net/universus/article/details/6211589)8 \n\n\n\n### Instrumentation\n\n Instrumentation  application  App  activity  Instrumentation Instrumentation Activity  Instrumentation \n\n\n\n### ActivityThread\n\n App  Android Java  main() Android  main()  ActivityThread  App  App  Looper  attach()  App  AMS  App \n\nActivityThread  Thread UI  ActivityThread  UI \n\n\n\n### ApplicationThread\n\nApplicationThread  ActivityThread  IApplicationThread ApplicationThreadProxy  ActivityManagerService  binder ActivityManagerService  ApplicationThreadProxy  ApplicationThread  binder  application  activity \n\n\n\n### ActivityManagerService\n\n AMSAMS  Android  Android AMS  binder AMS \n\n\n\n## Activity \n\n\n\n\n\n Activity \n\n** startActivity  Instrumentation  AMS  binder  ApplicationThread  Handler  LAUNCH_ACTIVITY  Instrumentation  Activity **\n\n\n\n1. Activity#startActivity -> Activity#startActivityForResult \n\n   ```java\n   @Override\n   public void startActivity(Intent intent) {\n     this.startActivity(intent, null);\n   }\n   \n   @Override\n   public void startActivity(Intent intent, @Nullable Bundle options) {\n     if (options != null) {\n       startActivityForResult(intent, -1, options);\n     } else {\n       // Note we want to go through this call for compatibility with\n       // applications that may have overridden the method.\n       startActivityForResult(intent, -1);\n     }\n   }\n   \n   public void startActivityForResult(@RequiresPermission Intent intent, int requestCode) {\n       startActivityForResult(intent, requestCode, null);\n   }\n   \n   public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,\n               @Nullable Bundle options) {\n       if (mParent == null) {\n         Instrumentation.ActivityResult ar =\n           mInstrumentation.execStartActivity(\n           this, mMainThread.getApplicationThread(), mToken, this,\n           intent, requestCode, options);\n       } else {\n         if (options != null) {\n           mParent.startActivityFromChild(this, intent, requestCode, options);\n         } else {\n           mParent.startActivityFromChild(this, intent, requestCode);\n         }\n       }\n   }\n   ```\n\n    startActivity  startActivityForResultrequestCode  -1 startActivityForResult  requestCode  -1\n\n    startActivityForResult  Instrumentation#execStartActivity IPC \n\n2. Instrumentation#execStartActivity\n\n   ```java\n   public ActivityResult execStartActivity(\n     Context who, IBinder contextThread, IBinder token, Activity target,\n     Intent intent, int requestCode, Bundle options) {\n   \n     \t// contextThread  mMainThread.getApplicationThread()\n     \t//  ActivityThread  ApplicationThread \n       IApplicationThread whoThread = (IApplicationThread) contextThread;\n   \n     \t// \n       int result = ActivityManager.getService()\n         .startActivity(whoThread, who.getBasePackageName(), intent,\n                        intent.resolveTypeIfNeeded(who.getContentResolver()),\n                        token, target != null ? target.mEmbeddedID : null,\n                        requestCode, 0, null, options);\n   \n       checkStartActivityResult(result, intent);\n   \n       return null;\n   }\n   \n   ```\n\n   binder \n\n   ```java\n   public static IActivityManager getService() {\n     \treturn IActivityManagerSingleton.get();\n   }\n   \n   private static final Singleton<IActivityManager> IActivityManagerSingleton =\n       new Singleton<IActivityManager>() {\n           @Override\n           protected IActivityManager create() {\n               final IBinder b =ServiceManager.getService(Context.ACTIVITY_SERVICE);\n               final IActivityManager am = IActivityManager.Stub.asInterface(b);\n               return am;\n           }\n   };\n   ```\n\n    AIDL  ActivityManager.getService()  IActivityManager  getService()  IActivityManager \n\n    binder  binder  IActivityManager  ActivityManagerService getService()  AMS \n\n   \n\n   ```java\n   int result = ActivityManager.getService().startActivity()\n   ```\n\n    AMS  startActivity() \n\n3. ActivityManagerService#startActivity\n\n   ```java\n   @Override\n   public final int startActivity( ... ... ) {\n     \treturn startActivityAsUser(... ...);\n   }\n   ```\n\n   AMS  activity \n\n   - API 23  ActivityStackSupervisorActivityStack Activity  activity  ActivityStackSupervisor#realStartActivityLocked  ApplicationThread\n   - API 28  ActivityStarter  AMS  Activity  ActivityStackSupervisor  resolveIntentresolveActivity  activity  AMS  ActivityStackSupervisor#realStartActivityLocked \n   - API 28 Android 9.0 Activity app.thread.scheduleLaunchActivity \n\n4. ActivityStackSupervisor#realStartActivityLocked\n\n   ```java\n   final boolean realStartActivityLocked(... ...) {\n     \tapp.thread.scheduleLaunchActivity(... ...);\n   \t\treturn true;\n   }\n   ```\n\n    app.thread  IApplicationThread  IApplicationThread  Client  ApplicationThread ApplicationThread  scheduleLaunchActivity\n\n5. ApplicationThread#scheduleLaunchActivity\n\n   ```java\n   @Override\n   public final void scheduleLaunchActivity( ... ...) {\n       ActivityClientRecord r = new ActivityClientRecord();\n       sendMessage(H.LAUNCH_ACTIVITY, r);\n   }\n   \n   public void handleMessage(Message msg) {\n       switch (msg.what) {\n           case LAUNCH_ACTIVITY: \n               final ActivityClientRecord r = (ActivityClientRecord) msg.obj;\n               handleLaunchActivity(r, null, \"LAUNCH_ACTIVITY\");\n               break;\n       }\n   }\n    \n   private void handleLaunchActivity(... ...) {\n   \t\tActivity a = performLaunchActivity(... ...);\n   }\n   \n   private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n     \t Activity activity = null;\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n     \t return activity;\n   }\n   ```\n\n    IApplicationThread  Client  ActivityThread  LAUNCH_ACTIVITY  Handler  handleLaunchActivity  performLaunchActivity() \n\n    activity  Instrumentation \n\n\n\nActivity \n\n\n\n## UI \n\n Activity binder  ActivityManager.getService()  IActivityManager  Server  AMS AMS  IApplicationThread  Client  ApplicationThread \n\n Server  AMS  Client  Client \n\n App ActivityThread#main()  \n\n main()  mainLooper attach() \n\nActivityThread#main() & ActivityThread#attach()   \n\n```java\npublic static void main(String[] args) {\n  \t//  MainLooper\n    Looper.prepareMainLooper();\n\t\t\n  \t//  ActivityThread  attach  false\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\t\t\n  \t//  Looper \n    Looper.loop();\n  \n  \t//  Looper \n    throw new RuntimeException(\"Main thread loop unexpectedly exited\");\n}\n\nprivate void attach(boolean system) {\n    sCurrentActivityThread = this;\n    mSystemThread = system;\n  \t// \n    if (!system) {\n      \tIActivityManager mgr = ActivityManager.getService();\n      \tmgr.attachApplication(mAppThread);\n    } else {\n      \t//  Instrumentation  ContextApplication \n      \t//  application  onCreate \n        mInstrumentation = new Instrumentation();\n        ContextImpl context = ContextImpl.createAppContext(\n          this, getSystemContext().mPackageInfo);\n        mInitialApplication = context.mPackageInfo.makeApplication(true, null);\n        mInitialApplication.onCreate();\n    }\n}\n```\n\n attach()  ActivityThread  false SystemServer  true\n\nActivityThread#systemMain SystemServer#createSystemContext() \n\n```java\npublic static ActivityThread systemMain() {\n    ActivityThread thread = new ActivityThread();\n    thread.attach(true);\n    return thread;\n}\n```\n\n binder  IActivityManager  AMS   attachApplication  IApplicationThread  AMSIActivityManager  IApplicationThread \n\n\n\n## Application \n\n application \n\n```java\n// ActivityManagerService#attachApplication\npublic final void attachApplication(IApplicationThread thread) {\n    synchronized (this) {\n      int callingPid = Binder.getCallingPid();\n      final long origId = Binder.clearCallingIdentity();\n      attachApplicationLocked(thread, callingPid);\n      Binder.restoreCallingIdentity(origId);\n    }\n}\n\n// ActivityManagerService#attachApplicationLocked\nprivate boolean attachApplicationLocked(IApplicationThread thread, int pid) {\n\n    if (app.instr != null) {\n      thread.bindApplication(processName, appInfo, providers,\n                             app.instr.mClass,\n                             profilerInfo, app.instr.mArguments,\n                             app.instr.mWatcher,\n                             app.instr.mUiAutomationConnection, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    } else {\n      thread.bindApplication(processName, appInfo, providers, null, profilerInfo,\n                             null, null, null, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    }\n\n  \treturn true;\n}\n\n//  IApplicationThread  Client \n// ApplicationThread#bindApplication\npublic final void bindApplication(... ...) {\n  \tsendMessage(H.BIND_APPLICATION, data);\n}\n\n//  ActivityThread#H \npublic void handleMessage(Message msg) {\n    case BIND_APPLICATION:\n        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"bindApplication\");\n        AppBindData data = (AppBindData)msg.obj;\n        handleBindApplication(data);\n        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n    break;\n}\n\n// ActivityThread#handleBindApplication\nprivate void handleBindApplication(AppBindData data) {\n\n    final InstrumentationInfo ii;\n    if (data.instrumentationName != null) {\n        ii = new ApplicationPackageManager(null, getPackageManager())\n          .getInstrumentationInfo(data.instrumentationName, 0);\n    } else {\n      \tii = null;\n    }\n\n    //  mInstrumentation \n  \t// 1.  ClassLoader 2.  new \n    if (ii != null) {\n        final ApplicationInfo instrApp = new ApplicationInfo();\n        ii.copyTo(instrApp);\n        instrApp.initForUser(UserHandle.myUserId());\n        final LoadedApk pi = getPackageInfo(......);\n        final ContextImpl instrContext = ContextImpl.createAppContext(this, pi);\n\n        try {\n          final ClassLoader cl = instrContext.getClassLoader();\n          mInstrumentation = (Instrumentation)\n            cl.loadClass(data.instrumentationName.getClassName()).newInstance();\n        } \n\n        final ComponentName component = new ComponentName(ii.packageName, ii.name);\n        mInstrumentation.init(... ...);\n    } else {\n      \tmInstrumentation = new Instrumentation();\n    }\n\n    try {\n      \t//  makeApplication  App  Application \n        Application app = data.info.makeApplication(data.restrictedBackupMode, null);\n        mInitialApplication = app; \n      \t\n      \t//  application  mInstrumentation  application  onCreate \n        mInstrumentation.onCreate(data.instrumentationArgs);\n        mInstrumentation.callApplicationOnCreate(app);\n    }\n}\n\n// LoadedApk#makeApplication\npublic Application makeApplication(boolean forceDefaultAppClass,\n                                   Instrumentation instrumentation) {\n    if (mApplication != null) {\n      return mApplication;\n    }\n\n    java.lang.ClassLoader cl = getClassLoader();\n    ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);\n    //  instrumentation  null ActivityThread  mInstrumentation\n    app = mActivityThread.mInstrumentation.newApplication(cl, appClass, appContext);\n    appContext.setOuterContext(app);\n\n    //  null if\n    if (instrumentation != null) {\n      instrumentation.callApplicationOnCreate(app);   \n    }\n\n    return app;\n}\n\n```\n\nApplication  Instrumentation \n\n```java\npublic Application newApplication(ClassLoader cl, String className, Context context) {\n  \treturn newApplication(cl.loadClass(className), context);\n}\n\nstatic public Application newApplication(Class<?> clazz, Context context){\n    Application app = (Application)clazz.newInstance();\n    app.attach(context);\n    return app;\n}\n```\n\napplication \n\nApplication C/S  App  Instumentation \n\n\n\n   \n\n   \n\n   \n\n   ","source":"_posts/start-activity-procedure.md","raw":"---\nthumbnail: //raw.githubusercontent.com/Joeljt/BlogImage/master/20190410195304.jpg\ntitle: Activity \ntags: [Android]\ndate: 2019-08-30\n---\n\n\n\n startActivity() \n\n\n\n<!-- more --> \n\n\n\n## \n\n Activity \n\n API23 \n\n Activity \n\n1. Binder \n2. Handler  \n3. Instrumentation\n4. ActivityThread\n5. ApplicationThread\n6. ActivityManagerService\n\n\n\n\n\n\n## \n\n###  Binder \n\n Binder  Android  Linux  App  Android \n\nsocket Android Binder  Android Binder **** Binder  ActivityManagerService  Binder  App  App  Binder ****\n\n**Binder Binder Client  Server Server Client C/S  binder **\n\n\n\n\n\n Client Server binder  binder \n\n binder  binder [](https://blog.csdn.net/universus/article/details/6211589)8 \n\n\n\n### Instrumentation\n\n Instrumentation  application  App  activity  Instrumentation Instrumentation Activity  Instrumentation \n\n\n\n### ActivityThread\n\n App  Android Java  main() Android  main()  ActivityThread  App  App  Looper  attach()  App  AMS  App \n\nActivityThread  Thread UI  ActivityThread  UI \n\n\n\n### ApplicationThread\n\nApplicationThread  ActivityThread  IApplicationThread ApplicationThreadProxy  ActivityManagerService  binder ActivityManagerService  ApplicationThreadProxy  ApplicationThread  binder  application  activity \n\n\n\n### ActivityManagerService\n\n AMSAMS  Android  Android AMS  binder AMS \n\n\n\n## Activity \n\n\n\n\n\n Activity \n\n** startActivity  Instrumentation  AMS  binder  ApplicationThread  Handler  LAUNCH_ACTIVITY  Instrumentation  Activity **\n\n\n\n1. Activity#startActivity -> Activity#startActivityForResult \n\n   ```java\n   @Override\n   public void startActivity(Intent intent) {\n     this.startActivity(intent, null);\n   }\n   \n   @Override\n   public void startActivity(Intent intent, @Nullable Bundle options) {\n     if (options != null) {\n       startActivityForResult(intent, -1, options);\n     } else {\n       // Note we want to go through this call for compatibility with\n       // applications that may have overridden the method.\n       startActivityForResult(intent, -1);\n     }\n   }\n   \n   public void startActivityForResult(@RequiresPermission Intent intent, int requestCode) {\n       startActivityForResult(intent, requestCode, null);\n   }\n   \n   public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,\n               @Nullable Bundle options) {\n       if (mParent == null) {\n         Instrumentation.ActivityResult ar =\n           mInstrumentation.execStartActivity(\n           this, mMainThread.getApplicationThread(), mToken, this,\n           intent, requestCode, options);\n       } else {\n         if (options != null) {\n           mParent.startActivityFromChild(this, intent, requestCode, options);\n         } else {\n           mParent.startActivityFromChild(this, intent, requestCode);\n         }\n       }\n   }\n   ```\n\n    startActivity  startActivityForResultrequestCode  -1 startActivityForResult  requestCode  -1\n\n    startActivityForResult  Instrumentation#execStartActivity IPC \n\n2. Instrumentation#execStartActivity\n\n   ```java\n   public ActivityResult execStartActivity(\n     Context who, IBinder contextThread, IBinder token, Activity target,\n     Intent intent, int requestCode, Bundle options) {\n   \n     \t// contextThread  mMainThread.getApplicationThread()\n     \t//  ActivityThread  ApplicationThread \n       IApplicationThread whoThread = (IApplicationThread) contextThread;\n   \n     \t// \n       int result = ActivityManager.getService()\n         .startActivity(whoThread, who.getBasePackageName(), intent,\n                        intent.resolveTypeIfNeeded(who.getContentResolver()),\n                        token, target != null ? target.mEmbeddedID : null,\n                        requestCode, 0, null, options);\n   \n       checkStartActivityResult(result, intent);\n   \n       return null;\n   }\n   \n   ```\n\n   binder \n\n   ```java\n   public static IActivityManager getService() {\n     \treturn IActivityManagerSingleton.get();\n   }\n   \n   private static final Singleton<IActivityManager> IActivityManagerSingleton =\n       new Singleton<IActivityManager>() {\n           @Override\n           protected IActivityManager create() {\n               final IBinder b =ServiceManager.getService(Context.ACTIVITY_SERVICE);\n               final IActivityManager am = IActivityManager.Stub.asInterface(b);\n               return am;\n           }\n   };\n   ```\n\n    AIDL  ActivityManager.getService()  IActivityManager  getService()  IActivityManager \n\n    binder  binder  IActivityManager  ActivityManagerService getService()  AMS \n\n   \n\n   ```java\n   int result = ActivityManager.getService().startActivity()\n   ```\n\n    AMS  startActivity() \n\n3. ActivityManagerService#startActivity\n\n   ```java\n   @Override\n   public final int startActivity( ... ... ) {\n     \treturn startActivityAsUser(... ...);\n   }\n   ```\n\n   AMS  activity \n\n   - API 23  ActivityStackSupervisorActivityStack Activity  activity  ActivityStackSupervisor#realStartActivityLocked  ApplicationThread\n   - API 28  ActivityStarter  AMS  Activity  ActivityStackSupervisor  resolveIntentresolveActivity  activity  AMS  ActivityStackSupervisor#realStartActivityLocked \n   - API 28 Android 9.0 Activity app.thread.scheduleLaunchActivity \n\n4. ActivityStackSupervisor#realStartActivityLocked\n\n   ```java\n   final boolean realStartActivityLocked(... ...) {\n     \tapp.thread.scheduleLaunchActivity(... ...);\n   \t\treturn true;\n   }\n   ```\n\n    app.thread  IApplicationThread  IApplicationThread  Client  ApplicationThread ApplicationThread  scheduleLaunchActivity\n\n5. ApplicationThread#scheduleLaunchActivity\n\n   ```java\n   @Override\n   public final void scheduleLaunchActivity( ... ...) {\n       ActivityClientRecord r = new ActivityClientRecord();\n       sendMessage(H.LAUNCH_ACTIVITY, r);\n   }\n   \n   public void handleMessage(Message msg) {\n       switch (msg.what) {\n           case LAUNCH_ACTIVITY: \n               final ActivityClientRecord r = (ActivityClientRecord) msg.obj;\n               handleLaunchActivity(r, null, \"LAUNCH_ACTIVITY\");\n               break;\n       }\n   }\n    \n   private void handleLaunchActivity(... ...) {\n   \t\tActivity a = performLaunchActivity(... ...);\n   }\n   \n   private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n     \t Activity activity = null;\n        java.lang.ClassLoader cl = appContext.getClassLoader();\n        activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n     \t return activity;\n   }\n   ```\n\n    IApplicationThread  Client  ActivityThread  LAUNCH_ACTIVITY  Handler  handleLaunchActivity  performLaunchActivity() \n\n    activity  Instrumentation \n\n\n\nActivity \n\n\n\n## UI \n\n Activity binder  ActivityManager.getService()  IActivityManager  Server  AMS AMS  IApplicationThread  Client  ApplicationThread \n\n Server  AMS  Client  Client \n\n App ActivityThread#main()  \n\n main()  mainLooper attach() \n\nActivityThread#main() & ActivityThread#attach()   \n\n```java\npublic static void main(String[] args) {\n  \t//  MainLooper\n    Looper.prepareMainLooper();\n\t\t\n  \t//  ActivityThread  attach  false\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\t\t\n  \t//  Looper \n    Looper.loop();\n  \n  \t//  Looper \n    throw new RuntimeException(\"Main thread loop unexpectedly exited\");\n}\n\nprivate void attach(boolean system) {\n    sCurrentActivityThread = this;\n    mSystemThread = system;\n  \t// \n    if (!system) {\n      \tIActivityManager mgr = ActivityManager.getService();\n      \tmgr.attachApplication(mAppThread);\n    } else {\n      \t//  Instrumentation  ContextApplication \n      \t//  application  onCreate \n        mInstrumentation = new Instrumentation();\n        ContextImpl context = ContextImpl.createAppContext(\n          this, getSystemContext().mPackageInfo);\n        mInitialApplication = context.mPackageInfo.makeApplication(true, null);\n        mInitialApplication.onCreate();\n    }\n}\n```\n\n attach()  ActivityThread  false SystemServer  true\n\nActivityThread#systemMain SystemServer#createSystemContext() \n\n```java\npublic static ActivityThread systemMain() {\n    ActivityThread thread = new ActivityThread();\n    thread.attach(true);\n    return thread;\n}\n```\n\n binder  IActivityManager  AMS   attachApplication  IApplicationThread  AMSIActivityManager  IApplicationThread \n\n\n\n## Application \n\n application \n\n```java\n// ActivityManagerService#attachApplication\npublic final void attachApplication(IApplicationThread thread) {\n    synchronized (this) {\n      int callingPid = Binder.getCallingPid();\n      final long origId = Binder.clearCallingIdentity();\n      attachApplicationLocked(thread, callingPid);\n      Binder.restoreCallingIdentity(origId);\n    }\n}\n\n// ActivityManagerService#attachApplicationLocked\nprivate boolean attachApplicationLocked(IApplicationThread thread, int pid) {\n\n    if (app.instr != null) {\n      thread.bindApplication(processName, appInfo, providers,\n                             app.instr.mClass,\n                             profilerInfo, app.instr.mArguments,\n                             app.instr.mWatcher,\n                             app.instr.mUiAutomationConnection, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    } else {\n      thread.bindApplication(processName, appInfo, providers, null, profilerInfo,\n                             null, null, null, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    }\n\n  \treturn true;\n}\n\n//  IApplicationThread  Client \n// ApplicationThread#bindApplication\npublic final void bindApplication(... ...) {\n  \tsendMessage(H.BIND_APPLICATION, data);\n}\n\n//  ActivityThread#H \npublic void handleMessage(Message msg) {\n    case BIND_APPLICATION:\n        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"bindApplication\");\n        AppBindData data = (AppBindData)msg.obj;\n        handleBindApplication(data);\n        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n    break;\n}\n\n// ActivityThread#handleBindApplication\nprivate void handleBindApplication(AppBindData data) {\n\n    final InstrumentationInfo ii;\n    if (data.instrumentationName != null) {\n        ii = new ApplicationPackageManager(null, getPackageManager())\n          .getInstrumentationInfo(data.instrumentationName, 0);\n    } else {\n      \tii = null;\n    }\n\n    //  mInstrumentation \n  \t// 1.  ClassLoader 2.  new \n    if (ii != null) {\n        final ApplicationInfo instrApp = new ApplicationInfo();\n        ii.copyTo(instrApp);\n        instrApp.initForUser(UserHandle.myUserId());\n        final LoadedApk pi = getPackageInfo(......);\n        final ContextImpl instrContext = ContextImpl.createAppContext(this, pi);\n\n        try {\n          final ClassLoader cl = instrContext.getClassLoader();\n          mInstrumentation = (Instrumentation)\n            cl.loadClass(data.instrumentationName.getClassName()).newInstance();\n        } \n\n        final ComponentName component = new ComponentName(ii.packageName, ii.name);\n        mInstrumentation.init(... ...);\n    } else {\n      \tmInstrumentation = new Instrumentation();\n    }\n\n    try {\n      \t//  makeApplication  App  Application \n        Application app = data.info.makeApplication(data.restrictedBackupMode, null);\n        mInitialApplication = app; \n      \t\n      \t//  application  mInstrumentation  application  onCreate \n        mInstrumentation.onCreate(data.instrumentationArgs);\n        mInstrumentation.callApplicationOnCreate(app);\n    }\n}\n\n// LoadedApk#makeApplication\npublic Application makeApplication(boolean forceDefaultAppClass,\n                                   Instrumentation instrumentation) {\n    if (mApplication != null) {\n      return mApplication;\n    }\n\n    java.lang.ClassLoader cl = getClassLoader();\n    ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);\n    //  instrumentation  null ActivityThread  mInstrumentation\n    app = mActivityThread.mInstrumentation.newApplication(cl, appClass, appContext);\n    appContext.setOuterContext(app);\n\n    //  null if\n    if (instrumentation != null) {\n      instrumentation.callApplicationOnCreate(app);   \n    }\n\n    return app;\n}\n\n```\n\nApplication  Instrumentation \n\n```java\npublic Application newApplication(ClassLoader cl, String className, Context context) {\n  \treturn newApplication(cl.loadClass(className), context);\n}\n\nstatic public Application newApplication(Class<?> clazz, Context context){\n    Application app = (Application)clazz.newInstance();\n    app.attach(context);\n    return app;\n}\n```\n\napplication \n\nApplication C/S  App  Instumentation \n\n\n\n   \n\n   \n\n   \n\n   ","slug":"start-activity-procedure","published":1,"updated":"2019-08-30T08:48:14.858Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86eq001wlh1pzl6ybvq9","content":"<p> startActivity() </p>\n<a id=\"more\"></a> \n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Activity </p>\n<p> API23 </p>\n<p> Activity </p>\n<ol>\n<li>Binder </li>\n<li>Handler  </li>\n<li>Instrumentation</li>\n<li>ActivityThread</li>\n<li>ApplicationThread</li>\n<li>ActivityManagerService</li>\n</ol>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-Binder-\"><a href=\"#-Binder-\" class=\"headerlink\" title=\" Binder \"></a> Binder </h3><p> Binder  Android  Linux  App  Android </p>\n<p>socket Android Binder  Android Binder <strong></strong> Binder  ActivityManagerService  Binder  App  App  Binder <strong></strong></p>\n<p><strong>Binder Binder Client  Server Server Client C/S  binder </strong></p>\n<p></p>\n<p></p>\n<p> Client Server binder  binder </p>\n<p> binder  binder <a href=\"https://blog.csdn.net/universus/article/details/6211589\" target=\"_blank\" rel=\"noopener\"></a>8 </p>\n<h3 id=\"Instrumentation\"><a href=\"#Instrumentation\" class=\"headerlink\" title=\"Instrumentation\"></a>Instrumentation</h3><p> Instrumentation  application  App  activity  Instrumentation Instrumentation Activity  Instrumentation </p>\n<h3 id=\"ActivityThread\"><a href=\"#ActivityThread\" class=\"headerlink\" title=\"ActivityThread\"></a>ActivityThread</h3><p> App  Android Java  main() Android  main()  ActivityThread  App  App  Looper  attach()  App  AMS  App </p>\n<p>ActivityThread  Thread UI  ActivityThread  UI </p>\n<h3 id=\"ApplicationThread\"><a href=\"#ApplicationThread\" class=\"headerlink\" title=\"ApplicationThread\"></a>ApplicationThread</h3><p>ApplicationThread  ActivityThread  IApplicationThread ApplicationThreadProxy  ActivityManagerService  binder ActivityManagerService  ApplicationThreadProxy  ApplicationThread  binder  application  activity </p>\n<h3 id=\"ActivityManagerService\"><a href=\"#ActivityManagerService\" class=\"headerlink\" title=\"ActivityManagerService\"></a>ActivityManagerService</h3><p> AMSAMS  Android  Android AMS  binder AMS </p>\n<h2 id=\"Activity-\"><a href=\"#Activity-\" class=\"headerlink\" title=\"Activity \"></a>Activity </h2><p></p>\n<p></p>\n<p> Activity </p>\n<p><strong> startActivity  Instrumentation  AMS  binder  ApplicationThread  Handler  LAUNCH_ACTIVITY  Instrumentation  Activity </strong></p>\n<p></p>\n<ol>\n<li><p>Activity#startActivity -&gt; Activity#startActivityForResult </p>\n<pre><code class=\"java\">@Override\npublic void startActivity(Intent intent) {\n  this.startActivity(intent, null);\n}\n\n@Override\npublic void startActivity(Intent intent, @Nullable Bundle options) {\n  if (options != null) {\n    startActivityForResult(intent, -1, options);\n  } else {\n    // Note we want to go through this call for compatibility with\n    // applications that may have overridden the method.\n    startActivityForResult(intent, -1);\n  }\n}\n\npublic void startActivityForResult(@RequiresPermission Intent intent, int requestCode) {\n    startActivityForResult(intent, requestCode, null);\n}\n\npublic void startActivityForResult(@RequiresPermission Intent intent, int requestCode,\n            @Nullable Bundle options) {\n    if (mParent == null) {\n      Instrumentation.ActivityResult ar =\n        mInstrumentation.execStartActivity(\n        this, mMainThread.getApplicationThread(), mToken, this,\n        intent, requestCode, options);\n    } else {\n      if (options != null) {\n        mParent.startActivityFromChild(this, intent, requestCode, options);\n      } else {\n        mParent.startActivityFromChild(this, intent, requestCode);\n      }\n    }\n}\n</code></pre>\n<p> startActivity  startActivityForResultrequestCode  -1 startActivityForResult  requestCode  -1</p>\n<p> startActivityForResult  Instrumentation#execStartActivity IPC </p>\n</li>\n<li><p>Instrumentation#execStartActivity</p>\n<pre><code class=\"java\">public ActivityResult execStartActivity(\n  Context who, IBinder contextThread, IBinder token, Activity target,\n  Intent intent, int requestCode, Bundle options) {\n\n      // contextThread  mMainThread.getApplicationThread()\n      //  ActivityThread  ApplicationThread \n    IApplicationThread whoThread = (IApplicationThread) contextThread;\n\n      // \n    int result = ActivityManager.getService()\n      .startActivity(whoThread, who.getBasePackageName(), intent,\n                     intent.resolveTypeIfNeeded(who.getContentResolver()),\n                     token, target != null ? target.mEmbeddedID : null,\n                     requestCode, 0, null, options);\n\n    checkStartActivityResult(result, intent);\n\n    return null;\n}\n\n</code></pre>\n<p>binder </p>\n<pre><code class=\"java\">public static IActivityManager getService() {\n      return IActivityManagerSingleton.get();\n}\n\nprivate static final Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =\n    new Singleton&lt;IActivityManager&gt;() {\n        @Override\n        protected IActivityManager create() {\n            final IBinder b =ServiceManager.getService(Context.ACTIVITY_SERVICE);\n            final IActivityManager am = IActivityManager.Stub.asInterface(b);\n            return am;\n        }\n};\n</code></pre>\n<p> AIDL  ActivityManager.getService()  IActivityManager  getService()  IActivityManager </p>\n<p> binder  binder  IActivityManager  ActivityManagerService getService()  AMS </p>\n<p></p>\n<pre><code class=\"java\">int result = ActivityManager.getService().startActivity()\n</code></pre>\n<p> AMS  startActivity() </p>\n</li>\n<li><p>ActivityManagerService#startActivity</p>\n<pre><code class=\"java\">@Override\npublic final int startActivity( ... ... ) {\n      return startActivityAsUser(... ...);\n}\n</code></pre>\n<p>AMS  activity </p>\n<ul>\n<li>API 23  ActivityStackSupervisorActivityStack Activity  activity  ActivityStackSupervisor#realStartActivityLocked  ApplicationThread</li>\n<li>API 28  ActivityStarter  AMS  Activity  ActivityStackSupervisor  resolveIntentresolveActivity  activity  AMS  ActivityStackSupervisor#realStartActivityLocked </li>\n<li>API 28 Android 9.0 Activity app.thread.scheduleLaunchActivity </li>\n</ul>\n</li>\n<li><p>ActivityStackSupervisor#realStartActivityLocked</p>\n<pre><code class=\"java\">final boolean realStartActivityLocked(... ...) {\n      app.thread.scheduleLaunchActivity(... ...);\n        return true;\n}\n</code></pre>\n<p> app.thread  IApplicationThread  IApplicationThread  Client  ApplicationThread ApplicationThread  scheduleLaunchActivity</p>\n</li>\n<li><p>ApplicationThread#scheduleLaunchActivity</p>\n<pre><code class=\"java\">@Override\npublic final void scheduleLaunchActivity( ... ...) {\n    ActivityClientRecord r = new ActivityClientRecord();\n    sendMessage(H.LAUNCH_ACTIVITY, r);\n}\n\npublic void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: \n            final ActivityClientRecord r = (ActivityClientRecord) msg.obj;\n            handleLaunchActivity(r, null, &quot;LAUNCH_ACTIVITY&quot;);\n            break;\n    }\n}\n\nprivate void handleLaunchActivity(... ...) {\n        Activity a = performLaunchActivity(... ...);\n}\n\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n       Activity activity = null;\n     java.lang.ClassLoader cl = appContext.getClassLoader();\n     activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n       return activity;\n}\n</code></pre>\n<p> IApplicationThread  Client  ActivityThread  LAUNCH_ACTIVITY  Handler  handleLaunchActivity  performLaunchActivity() </p>\n<p> activity  Instrumentation </p>\n</li>\n</ol>\n<p>Activity </p>\n<h2 id=\"UI-\"><a href=\"#UI-\" class=\"headerlink\" title=\"UI \"></a>UI </h2><p> Activity binder  ActivityManager.getService()  IActivityManager  Server  AMS AMS  IApplicationThread  Client  ApplicationThread </p>\n<p> Server  AMS  Client  Client </p>\n<p> App ActivityThread#main()  </p>\n<p> main()  mainLooper attach() </p>\n<p>ActivityThread#main() &amp; ActivityThread#attach()   </p>\n<pre><code class=\"java\">public static void main(String[] args) {\n      //  MainLooper\n    Looper.prepareMainLooper();\n\n      //  ActivityThread  attach  false\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\n      //  Looper \n    Looper.loop();\n\n      //  Looper \n    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);\n}\n\nprivate void attach(boolean system) {\n    sCurrentActivityThread = this;\n    mSystemThread = system;\n      // \n    if (!system) {\n          IActivityManager mgr = ActivityManager.getService();\n          mgr.attachApplication(mAppThread);\n    } else {\n          //  Instrumentation  ContextApplication \n          //  application  onCreate \n        mInstrumentation = new Instrumentation();\n        ContextImpl context = ContextImpl.createAppContext(\n          this, getSystemContext().mPackageInfo);\n        mInitialApplication = context.mPackageInfo.makeApplication(true, null);\n        mInitialApplication.onCreate();\n    }\n}\n</code></pre>\n<p> attach()  ActivityThread  false SystemServer  true</p>\n<p>ActivityThread#systemMain SystemServer#createSystemContext() </p>\n<pre><code class=\"java\">public static ActivityThread systemMain() {\n    ActivityThread thread = new ActivityThread();\n    thread.attach(true);\n    return thread;\n}\n</code></pre>\n<p> binder  IActivityManager  AMS   attachApplication  IApplicationThread  AMSIActivityManager  IApplicationThread </p>\n<h2 id=\"Application-\"><a href=\"#Application-\" class=\"headerlink\" title=\"Application \"></a>Application </h2><p> application </p>\n<pre><code class=\"java\">// ActivityManagerService#attachApplication\npublic final void attachApplication(IApplicationThread thread) {\n    synchronized (this) {\n      int callingPid = Binder.getCallingPid();\n      final long origId = Binder.clearCallingIdentity();\n      attachApplicationLocked(thread, callingPid);\n      Binder.restoreCallingIdentity(origId);\n    }\n}\n\n// ActivityManagerService#attachApplicationLocked\nprivate boolean attachApplicationLocked(IApplicationThread thread, int pid) {\n\n    if (app.instr != null) {\n      thread.bindApplication(processName, appInfo, providers,\n                             app.instr.mClass,\n                             profilerInfo, app.instr.mArguments,\n                             app.instr.mWatcher,\n                             app.instr.mUiAutomationConnection, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    } else {\n      thread.bindApplication(processName, appInfo, providers, null, profilerInfo,\n                             null, null, null, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    }\n\n      return true;\n}\n\n//  IApplicationThread  Client \n// ApplicationThread#bindApplication\npublic final void bindApplication(... ...) {\n      sendMessage(H.BIND_APPLICATION, data);\n}\n\n//  ActivityThread#H \npublic void handleMessage(Message msg) {\n    case BIND_APPLICATION:\n        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;bindApplication&quot;);\n        AppBindData data = (AppBindData)msg.obj;\n        handleBindApplication(data);\n        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n    break;\n}\n\n// ActivityThread#handleBindApplication\nprivate void handleBindApplication(AppBindData data) {\n\n    final InstrumentationInfo ii;\n    if (data.instrumentationName != null) {\n        ii = new ApplicationPackageManager(null, getPackageManager())\n          .getInstrumentationInfo(data.instrumentationName, 0);\n    } else {\n          ii = null;\n    }\n\n    //  mInstrumentation \n      // 1.  ClassLoader 2.  new \n    if (ii != null) {\n        final ApplicationInfo instrApp = new ApplicationInfo();\n        ii.copyTo(instrApp);\n        instrApp.initForUser(UserHandle.myUserId());\n        final LoadedApk pi = getPackageInfo(......);\n        final ContextImpl instrContext = ContextImpl.createAppContext(this, pi);\n\n        try {\n          final ClassLoader cl = instrContext.getClassLoader();\n          mInstrumentation = (Instrumentation)\n            cl.loadClass(data.instrumentationName.getClassName()).newInstance();\n        } \n\n        final ComponentName component = new ComponentName(ii.packageName, ii.name);\n        mInstrumentation.init(... ...);\n    } else {\n          mInstrumentation = new Instrumentation();\n    }\n\n    try {\n          //  makeApplication  App  Application \n        Application app = data.info.makeApplication(data.restrictedBackupMode, null);\n        mInitialApplication = app; \n\n          //  application  mInstrumentation  application  onCreate \n        mInstrumentation.onCreate(data.instrumentationArgs);\n        mInstrumentation.callApplicationOnCreate(app);\n    }\n}\n\n// LoadedApk#makeApplication\npublic Application makeApplication(boolean forceDefaultAppClass,\n                                   Instrumentation instrumentation) {\n    if (mApplication != null) {\n      return mApplication;\n    }\n\n    java.lang.ClassLoader cl = getClassLoader();\n    ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);\n    //  instrumentation  null ActivityThread  mInstrumentation\n    app = mActivityThread.mInstrumentation.newApplication(cl, appClass, appContext);\n    appContext.setOuterContext(app);\n\n    //  null if\n    if (instrumentation != null) {\n      instrumentation.callApplicationOnCreate(app);   \n    }\n\n    return app;\n}\n\n</code></pre>\n<p>Application  Instrumentation </p>\n<pre><code class=\"java\">public Application newApplication(ClassLoader cl, String className, Context context) {\n      return newApplication(cl.loadClass(className), context);\n}\n\nstatic public Application newApplication(Class&lt;?&gt; clazz, Context context){\n    Application app = (Application)clazz.newInstance();\n    app.attach(context);\n    return app;\n}\n</code></pre>\n<p>application </p>\n<p>Application C/S  App  Instumentation </p>\n<p></p>\n","site":{"data":{}},"excerpt":"<p> startActivity() </p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Activity </p>\n<p> API23 </p>\n<p> Activity </p>\n<ol>\n<li>Binder </li>\n<li>Handler  </li>\n<li>Instrumentation</li>\n<li>ActivityThread</li>\n<li>ApplicationThread</li>\n<li>ActivityManagerService</li>\n</ol>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-Binder-\"><a href=\"#-Binder-\" class=\"headerlink\" title=\" Binder \"></a> Binder </h3><p> Binder  Android  Linux  App  Android </p>\n<p>socket Android Binder  Android Binder <strong></strong> Binder  ActivityManagerService  Binder  App  App  Binder <strong></strong></p>\n<p><strong>Binder Binder Client  Server Server Client C/S  binder </strong></p>\n<p></p>\n<p></p>\n<p> Client Server binder  binder </p>\n<p> binder  binder <a href=\"https://blog.csdn.net/universus/article/details/6211589\" target=\"_blank\" rel=\"noopener\"></a>8 </p>\n<h3 id=\"Instrumentation\"><a href=\"#Instrumentation\" class=\"headerlink\" title=\"Instrumentation\"></a>Instrumentation</h3><p> Instrumentation  application  App  activity  Instrumentation Instrumentation Activity  Instrumentation </p>\n<h3 id=\"ActivityThread\"><a href=\"#ActivityThread\" class=\"headerlink\" title=\"ActivityThread\"></a>ActivityThread</h3><p> App  Android Java  main() Android  main()  ActivityThread  App  App  Looper  attach()  App  AMS  App </p>\n<p>ActivityThread  Thread UI  ActivityThread  UI </p>\n<h3 id=\"ApplicationThread\"><a href=\"#ApplicationThread\" class=\"headerlink\" title=\"ApplicationThread\"></a>ApplicationThread</h3><p>ApplicationThread  ActivityThread  IApplicationThread ApplicationThreadProxy  ActivityManagerService  binder ActivityManagerService  ApplicationThreadProxy  ApplicationThread  binder  application  activity </p>\n<h3 id=\"ActivityManagerService\"><a href=\"#ActivityManagerService\" class=\"headerlink\" title=\"ActivityManagerService\"></a>ActivityManagerService</h3><p> AMSAMS  Android  Android AMS  binder AMS </p>\n<h2 id=\"Activity-\"><a href=\"#Activity-\" class=\"headerlink\" title=\"Activity \"></a>Activity </h2><p></p>\n<p></p>\n<p> Activity </p>\n<p><strong> startActivity  Instrumentation  AMS  binder  ApplicationThread  Handler  LAUNCH_ACTIVITY  Instrumentation  Activity </strong></p>\n<p></p>\n<ol>\n<li><p>Activity#startActivity -&gt; Activity#startActivityForResult </p>\n<pre><code class=\"java\">@Override\npublic void startActivity(Intent intent) {\n  this.startActivity(intent, null);\n}\n\n@Override\npublic void startActivity(Intent intent, @Nullable Bundle options) {\n  if (options != null) {\n    startActivityForResult(intent, -1, options);\n  } else {\n    // Note we want to go through this call for compatibility with\n    // applications that may have overridden the method.\n    startActivityForResult(intent, -1);\n  }\n}\n\npublic void startActivityForResult(@RequiresPermission Intent intent, int requestCode) {\n    startActivityForResult(intent, requestCode, null);\n}\n\npublic void startActivityForResult(@RequiresPermission Intent intent, int requestCode,\n            @Nullable Bundle options) {\n    if (mParent == null) {\n      Instrumentation.ActivityResult ar =\n        mInstrumentation.execStartActivity(\n        this, mMainThread.getApplicationThread(), mToken, this,\n        intent, requestCode, options);\n    } else {\n      if (options != null) {\n        mParent.startActivityFromChild(this, intent, requestCode, options);\n      } else {\n        mParent.startActivityFromChild(this, intent, requestCode);\n      }\n    }\n}\n</code></pre>\n<p> startActivity  startActivityForResultrequestCode  -1 startActivityForResult  requestCode  -1</p>\n<p> startActivityForResult  Instrumentation#execStartActivity IPC </p>\n</li>\n<li><p>Instrumentation#execStartActivity</p>\n<pre><code class=\"java\">public ActivityResult execStartActivity(\n  Context who, IBinder contextThread, IBinder token, Activity target,\n  Intent intent, int requestCode, Bundle options) {\n\n      // contextThread  mMainThread.getApplicationThread()\n      //  ActivityThread  ApplicationThread \n    IApplicationThread whoThread = (IApplicationThread) contextThread;\n\n      // \n    int result = ActivityManager.getService()\n      .startActivity(whoThread, who.getBasePackageName(), intent,\n                     intent.resolveTypeIfNeeded(who.getContentResolver()),\n                     token, target != null ? target.mEmbeddedID : null,\n                     requestCode, 0, null, options);\n\n    checkStartActivityResult(result, intent);\n\n    return null;\n}\n\n</code></pre>\n<p>binder </p>\n<pre><code class=\"java\">public static IActivityManager getService() {\n      return IActivityManagerSingleton.get();\n}\n\nprivate static final Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =\n    new Singleton&lt;IActivityManager&gt;() {\n        @Override\n        protected IActivityManager create() {\n            final IBinder b =ServiceManager.getService(Context.ACTIVITY_SERVICE);\n            final IActivityManager am = IActivityManager.Stub.asInterface(b);\n            return am;\n        }\n};\n</code></pre>\n<p> AIDL  ActivityManager.getService()  IActivityManager  getService()  IActivityManager </p>\n<p> binder  binder  IActivityManager  ActivityManagerService getService()  AMS </p>\n<p></p>\n<pre><code class=\"java\">int result = ActivityManager.getService().startActivity()\n</code></pre>\n<p> AMS  startActivity() </p>\n</li>\n<li><p>ActivityManagerService#startActivity</p>\n<pre><code class=\"java\">@Override\npublic final int startActivity( ... ... ) {\n      return startActivityAsUser(... ...);\n}\n</code></pre>\n<p>AMS  activity </p>\n<ul>\n<li>API 23  ActivityStackSupervisorActivityStack Activity  activity  ActivityStackSupervisor#realStartActivityLocked  ApplicationThread</li>\n<li>API 28  ActivityStarter  AMS  Activity  ActivityStackSupervisor  resolveIntentresolveActivity  activity  AMS  ActivityStackSupervisor#realStartActivityLocked </li>\n<li>API 28 Android 9.0 Activity app.thread.scheduleLaunchActivity </li>\n</ul>\n</li>\n<li><p>ActivityStackSupervisor#realStartActivityLocked</p>\n<pre><code class=\"java\">final boolean realStartActivityLocked(... ...) {\n      app.thread.scheduleLaunchActivity(... ...);\n        return true;\n}\n</code></pre>\n<p> app.thread  IApplicationThread  IApplicationThread  Client  ApplicationThread ApplicationThread  scheduleLaunchActivity</p>\n</li>\n<li><p>ApplicationThread#scheduleLaunchActivity</p>\n<pre><code class=\"java\">@Override\npublic final void scheduleLaunchActivity( ... ...) {\n    ActivityClientRecord r = new ActivityClientRecord();\n    sendMessage(H.LAUNCH_ACTIVITY, r);\n}\n\npublic void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: \n            final ActivityClientRecord r = (ActivityClientRecord) msg.obj;\n            handleLaunchActivity(r, null, &quot;LAUNCH_ACTIVITY&quot;);\n            break;\n    }\n}\n\nprivate void handleLaunchActivity(... ...) {\n        Activity a = performLaunchActivity(... ...);\n}\n\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n       Activity activity = null;\n     java.lang.ClassLoader cl = appContext.getClassLoader();\n     activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n       return activity;\n}\n</code></pre>\n<p> IApplicationThread  Client  ActivityThread  LAUNCH_ACTIVITY  Handler  handleLaunchActivity  performLaunchActivity() </p>\n<p> activity  Instrumentation </p>\n</li>\n</ol>\n<p>Activity </p>\n<h2 id=\"UI-\"><a href=\"#UI-\" class=\"headerlink\" title=\"UI \"></a>UI </h2><p> Activity binder  ActivityManager.getService()  IActivityManager  Server  AMS AMS  IApplicationThread  Client  ApplicationThread </p>\n<p> Server  AMS  Client  Client </p>\n<p> App ActivityThread#main()  </p>\n<p> main()  mainLooper attach() </p>\n<p>ActivityThread#main() &amp; ActivityThread#attach()   </p>\n<pre><code class=\"java\">public static void main(String[] args) {\n      //  MainLooper\n    Looper.prepareMainLooper();\n\n      //  ActivityThread  attach  false\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\n      //  Looper \n    Looper.loop();\n\n      //  Looper \n    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);\n}\n\nprivate void attach(boolean system) {\n    sCurrentActivityThread = this;\n    mSystemThread = system;\n      // \n    if (!system) {\n          IActivityManager mgr = ActivityManager.getService();\n          mgr.attachApplication(mAppThread);\n    } else {\n          //  Instrumentation  ContextApplication \n          //  application  onCreate \n        mInstrumentation = new Instrumentation();\n        ContextImpl context = ContextImpl.createAppContext(\n          this, getSystemContext().mPackageInfo);\n        mInitialApplication = context.mPackageInfo.makeApplication(true, null);\n        mInitialApplication.onCreate();\n    }\n}\n</code></pre>\n<p> attach()  ActivityThread  false SystemServer  true</p>\n<p>ActivityThread#systemMain SystemServer#createSystemContext() </p>\n<pre><code class=\"java\">public static ActivityThread systemMain() {\n    ActivityThread thread = new ActivityThread();\n    thread.attach(true);\n    return thread;\n}\n</code></pre>\n<p> binder  IActivityManager  AMS   attachApplication  IApplicationThread  AMSIActivityManager  IApplicationThread </p>\n<h2 id=\"Application-\"><a href=\"#Application-\" class=\"headerlink\" title=\"Application \"></a>Application </h2><p> application </p>\n<pre><code class=\"java\">// ActivityManagerService#attachApplication\npublic final void attachApplication(IApplicationThread thread) {\n    synchronized (this) {\n      int callingPid = Binder.getCallingPid();\n      final long origId = Binder.clearCallingIdentity();\n      attachApplicationLocked(thread, callingPid);\n      Binder.restoreCallingIdentity(origId);\n    }\n}\n\n// ActivityManagerService#attachApplicationLocked\nprivate boolean attachApplicationLocked(IApplicationThread thread, int pid) {\n\n    if (app.instr != null) {\n      thread.bindApplication(processName, appInfo, providers,\n                             app.instr.mClass,\n                             profilerInfo, app.instr.mArguments,\n                             app.instr.mWatcher,\n                             app.instr.mUiAutomationConnection, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    } else {\n      thread.bindApplication(processName, appInfo, providers, null, profilerInfo,\n                             null, null, null, testMode,\n                             mBinderTransactionTrackingEnabled, enableTrackAllocation,\n                             isRestrictedBackupMode || !normalMode, app.persistent,\n                             new Configuration(getGlobalConfiguration()), app.compat,\n                             getCommonServicesLocked(app.isolated),\n                             mCoreSettingsObserver.getCoreSettingsLocked(),\n                             buildSerial);\n    }\n\n      return true;\n}\n\n//  IApplicationThread  Client \n// ApplicationThread#bindApplication\npublic final void bindApplication(... ...) {\n      sendMessage(H.BIND_APPLICATION, data);\n}\n\n//  ActivityThread#H \npublic void handleMessage(Message msg) {\n    case BIND_APPLICATION:\n        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;bindApplication&quot;);\n        AppBindData data = (AppBindData)msg.obj;\n        handleBindApplication(data);\n        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\n    break;\n}\n\n// ActivityThread#handleBindApplication\nprivate void handleBindApplication(AppBindData data) {\n\n    final InstrumentationInfo ii;\n    if (data.instrumentationName != null) {\n        ii = new ApplicationPackageManager(null, getPackageManager())\n          .getInstrumentationInfo(data.instrumentationName, 0);\n    } else {\n          ii = null;\n    }\n\n    //  mInstrumentation \n      // 1.  ClassLoader 2.  new \n    if (ii != null) {\n        final ApplicationInfo instrApp = new ApplicationInfo();\n        ii.copyTo(instrApp);\n        instrApp.initForUser(UserHandle.myUserId());\n        final LoadedApk pi = getPackageInfo(......);\n        final ContextImpl instrContext = ContextImpl.createAppContext(this, pi);\n\n        try {\n          final ClassLoader cl = instrContext.getClassLoader();\n          mInstrumentation = (Instrumentation)\n            cl.loadClass(data.instrumentationName.getClassName()).newInstance();\n        } \n\n        final ComponentName component = new ComponentName(ii.packageName, ii.name);\n        mInstrumentation.init(... ...);\n    } else {\n          mInstrumentation = new Instrumentation();\n    }\n\n    try {\n          //  makeApplication  App  Application \n        Application app = data.info.makeApplication(data.restrictedBackupMode, null);\n        mInitialApplication = app; \n\n          //  application  mInstrumentation  application  onCreate \n        mInstrumentation.onCreate(data.instrumentationArgs);\n        mInstrumentation.callApplicationOnCreate(app);\n    }\n}\n\n// LoadedApk#makeApplication\npublic Application makeApplication(boolean forceDefaultAppClass,\n                                   Instrumentation instrumentation) {\n    if (mApplication != null) {\n      return mApplication;\n    }\n\n    java.lang.ClassLoader cl = getClassLoader();\n    ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);\n    //  instrumentation  null ActivityThread  mInstrumentation\n    app = mActivityThread.mInstrumentation.newApplication(cl, appClass, appContext);\n    appContext.setOuterContext(app);\n\n    //  null if\n    if (instrumentation != null) {\n      instrumentation.callApplicationOnCreate(app);   \n    }\n\n    return app;\n}\n\n</code></pre>\n<p>Application  Instrumentation </p>\n<pre><code class=\"java\">public Application newApplication(ClassLoader cl, String className, Context context) {\n      return newApplication(cl.loadClass(className), context);\n}\n\nstatic public Application newApplication(Class&lt;?&gt; clazz, Context context){\n    Application app = (Application)clazz.newInstance();\n    app.attach(context);\n    return app;\n}\n</code></pre>\n<p>application </p>\n<p>Application C/S  App  Instumentation </p>\n<p></p>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg","title":" ","date":"2018-09-08T16:00:00.000Z","_content":"\n> Efficient.Android.Threading  \n\n<!--more-->\n\n### Android \n\n Java  Java  Android  UI \n\nAndroid  UI Android -UI \n\nAndroid  API  `android.os` \n\n![Android Message API](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182551.jpg)\n\n`android.os.Looper`\n\n\n\n`android.os.Handler`\n\n Looper  Handler \n\n`android.os.MessageQueue`\n\n Looper  Looper \n\n MessageQueue,  LinkedList\n\n`android.os.Message`\n\n\n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182556.jpg)\n\n\n\n1.  Handler \n2. Looper \n3. Handler  Handler Looper  Handler \n\n#### \n\n```java\npublic class LooperActivity extends Activity {\n\n    LooperThread mLooperThread;\n\n    // 1.\n    private static class LooperThread extends Thread {\n\n        public Handler mHandler;\n\n        public void run() {\n            // 2. Looper MessageQueue\n            Looper.prepare();\n            // 3. Handler  Looper \n            //  Looper.prepare()  Looper\n            mHandler = new Handler() {\n                // 4. \n                public void handleMessage(Message msg) {\n                    if(msg.what == 0) {\n                        doLongRunningOperation();\n                    }\n                }\n            };\n            // 5. \n            //  blocking call\n            Looper.loop();\n        }\n\n        private void doLongRunningOperation() {\n            // Add long running operation here.\n        }\n    }\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_looper);\n        // 6. \n        mLooperThread = new LooperThread();\n        mLooperThread.start();\n    }\n\n    public void onClick(View v) {\n        // 7. Handler  Handler \n        if (mLooperThread.mHandler != null) {\n            // 8.  Message what  0\n            Message msg = mLooperThread.mHandler.obtainMessage(0);\n            // 9. \n            mLooperThread.mHandler.sendMessage(msg);\n        }\n    }\n\n    protected void onDestroy() {\n        super.onDestroy();\n        // 10.  loop() \n        mLooperThread.mHandler.getLooper().quit();\n    }\n}\n```\n\n####  Classes\n\n##### MessageQueue\n\n `android.os.MessageQueue` \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182557.jpg)\n\n t1 < t2 < t3 t1  t3 `disptch barrier` , \n\n Looper  `dispatch barrier`  `dispatch barrier` \n\n##### MessageQueue.IdleHandler\n\n Looper  `android.os.MessageQueue.IdleHandler` \n\n```java\n/**\n * \n */\npublic static interface IdleHandler {  \n    boolean queueIdle();\n}\n\n// \n// \nMessageQueue myQueue = Looper.myQueue();\n//  IdleHandler \nMessageQueue.IdleHandler idleHandler = new MessageQueue.IdleHandler() {\n    @Override\n    public boolean queueIdle() {\n        return false;\n    }\n};\n// \nmyQueue.addIdleHandler(idleHandler);\n// \nmyQueue.removeIdleHandler(idleHandler);\n\n```\n\n IdleHandler  `queueIdle` \n\n `queueIdle` \n\n- true\n\n   IdleHandler  time slots MessageQueue \n\n- false\n\n   IdleHandler  MessageQueue.removeIdleHandler()  MessageQueue \n\n#####  IdleHandler \n\n IdleHandler \n\n IdleHandler \n\n time slots.\n\n```java\npublic class ConsumeAndQuitThreadActivity extends Activity {\n    \n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        final ConsumeAndQuitThread consumeAndQuitThread = new ConsumeAndQuitThread();\n        consumeAndQuitThread.start();\n        for (int i = 0; i < 10; i++) {\n            // \n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for (int i = 0; i < 10; i++) {\n                        SystemClock.sleep(new Random().nextInt(10));\n                        consumeAndQuitThread.enqueueData(i);\n                    }\n                }\n            }).start();\n        }\n    }\n\n    /**\n     *  Looper \n     *  Looper.loop() \n     */\n    private static class ConsumeAndQuitThread extends Thread implements MessageQueue.IdleHandler {\n\n        private static final String THREAD_NAME = \"ConsumeAndQuitThread\";\n\n        public Handler mConsumerHandler;\n        private boolean mIsFirstIdle = true;\n\n        public ConsumeAndQuitThread() {\n            super(THREAD_NAME);\n        }\n\n        @Override\n        public void run() {\n            Looper.prepare();\n\n            mConsumerHandler = new Handler() {\n                @Override\n                public void handleMessage(Message msg) {\n                    // Consume data\n                }\n            };\n            // 1.  Looper IdleHandler \n            Looper.myQueue().addIdleHandler(this);\n            Looper.loop();\n        }\n\n\n        @Override\n        public boolean queueIdle() {\n            // 2.  queueIdle() \n            //  true\n            if (mIsFirstIdle) { \n                mIsFirstIdle = false;\n                return true;\n            }\n            // 3. \n            mConsumerHandler.getLooper().quit();\n            return false;\n        }\n\n        public void enqueueData(int i) {\n            mConsumerHandler.sendEmptyMessage(i);\n        }\n    }\n}\n```\n\n\n\n##### Message\n\nMessage  Runnable \n\nMessage  Handler  Handler \n\n```java\n//  obtain()  Handler  Message.target \nMessage m = Message.obtain(handler, runnbale);\nm.sendToTarget();\n\npublic void sendToTarget() {\n    // target  Handler  Handler  sendMessage \n\ttarget.sendMessage(this);\n}\n```\n\nMessage \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182601.jpg)\n\n handleMessage  Runnable  run  handleMessage \n\nMessage \n\n- Initialized\n\n   Message \n\n  - \n\n    ```java\n    Message m = new Message();\n    ```\n\n  - \n\n    - \n\n      ```java\n      Message m = Message.obtain();\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Handler h);\n      Message m = Message.obtain(Handler h, int what);\n      Message m = Message.obtain(Handler h, int what, Object o);\n      Message m = Message.obtain(Handler h, int what, int arg1, int arg2); \n      Message m = Message.obtain(Handler h, int what, int arg1, int arg2, Object o);\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Handler h, Runnable task);\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Message originalMsg);\n      ```\n\n- Pending\n\n  \n\n- Disptached\n\n  Looper Looper  loop  Message.target  Handler \n\n- Recycled\n\n  Message Looper  Message \n\n  >  Handler  Message \n\n\n\n##### Looper\n\n`android.os.Looper`  Handler  Looper \n\n Looper  Looper Looper  MessageQueue UI  Looper  Looper \n\n```java\nnew Thread() {\n    @Override\n    public void run() {\n        // prepare() \n        // \n        Looper.prepare();\n        \n        // ... ...\n        \n        //  blocking call run() \n        //  run() Looper \n        Looper.loop();\n    }\n}.start();\n```\n\n Looper Looper  MessageQueue\n\n##### Looper \n\n- quit()\n\n  \n\n- quitSafely()\n\n  Looper \n\n Looper  loop()  Looper  Looper  Looper  Looper Looper.prepare()  Looper.loop() \n\n##### UI  Looper\n\nUI  Looper \n\n-  Looper.getMainLooper()  UI Looper\n- UI  Looper \n- Java  Looper.prepareMainLooper()  UI  Looper main looper \n\n\n\n##### Handler\n\nAndroid  `android.os.Handler`  UI \n\n- \n- \n- \n- \n\nHandler  Looper  MQ  Handler  Looper \n\n1.  Looper  Handler \n\n   ```java\n   //  Looper \n   new Handler();\n   new Handler(Handler.Callback);\n   ```\n\n2.  Looper \n\n   ```java\n   new Handler(Looper);\n   new Handler(Looper, Handler.Callback);\n   ```\n\n Handler  Handler  Message  target  Handler\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182554.jpg)\n\n>  Handler Message \n\n##### Message creation\n\nHandler  Message  Handler \n\n```java\n//  Message.obtain()  Handler \nMessage obtainMessage(int what, int arg1, int arg2)\nMessage obtainMessage()\nMessage obtainMessage(int what, int arg1, int arg2, Object obj) \nMessage obtainMessage(int what)\nMessage obtainMessage(int what, Object obj)\n```\n\n##### Message insertion\n\nHandler \n\n```java\n//  postXxx() \nboolean post(Runnable r)\nboolean postAtFrontOfQueue(Runnable r)\nboolean postAtTime(Runnable r, Object token, long uptimeMillis) \nboolean postAtTime(Runnable r, long uptimeMillis)\nboolean postDelayed(Runnable r, long delayMillis)\n    \n//  sendXxx() \n// \nboolean sendMessage(Message msg) \n// \nboolean sendMessageAtFrontOfQueue(Message msg)\n// \nboolean sendMessageAtTime(Message msg, long uptimeMillis) \nboolean sendMessageDelayed(Message msg, long delayMillis)\nboolean sendEmptyMessage(int what)\nboolean sendEmptyMessageAtTime(int what, long uptimeMillis) \nboolean sendEmptyMessageDelayed(int what, long delayMillis)\n```\n\n when \n\n\n\n- Message has no Handler\n\n  Message was created from a Message.obtain() method without a specified Handler.\n\n- Message has already been disptached and is being processed\n\n  The same message instance was inserted twice.\n\n- Looper has exited\n\n  Message is inserted after Looper.quit() has been called.\n\n> Looper  Handler  dispatchMessage \n\n##### Message processing\n\nMessage \n\n- Task messages\n\n   Runnbale  Runnable  run  `Handler.handMessage()` \n\n- Data messages\n\n   `Handler.handMessage()` \n\n Handler  Handler  loop() \n\n```java\nclass ConsumerThread extends Thread{\n    Handler mHandler;\n    @Override\n    public void run(){\n        Looper.prepare();\n        mHandler = new Handler(){\n            public void handleMessage(Message msg){\n                // process data message here\n            }\n        };\n        Looper.loop();\n    }\n}\n```\n\n `Handler.Callback`  `handleMessage` \n\n```java\npublic interface Callback {\n    // true: \n    // false:  Handler.handleMessage \n\tpublic boolean handleMessage(Message msg);\n}\n\n// \npublic void dispatchMessage(Message msg) {\n\tif (msg.callback != null) {\n\t\thandleCallback(msg);\n\t} else {\n\t\tif (mCallback != null) {\n            //  true \n\t\t\tif (mCallback.handleMessage(msg)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\thandleMessage(msg);\n\t}\t\n}\n```\n\n Handler  Callback  Handler  Handler  handleMessage()\n\n```java\npublic class HandlerCallbackActivity extends Activity implements Handler.Callback {\n    Handler mUiHandler;\n    \n    @Override\n    public void onCreate(Bundle savedInstanceState){\n        super.onCreate(savedInstanceState);\n        mUiHandler = new Handler(this); // \n    }\n    \n    @Override\n    public boolean handleMessage(Message msg){\n        // process msg\n        return true;\n    }\n}\n```\n\n####  UI \n\nUI  Looper  UI  UI \n\n UI \n\n1.  Handler  UI  Looper\n\n   ```java\n   Runnable task = new Runnable(){...};\n   new Handler(Looper.getMainLooper()).post(task);\n   ```\n\n   task  UI Looper  UI MessageQueue\n\n2.  UI \n\n   ```java\n   private void postFromUiThreadToUiThread(){\n       new Handler().post(new Runnable(){...})\n   }\n   ```\n\n3. Activity.runOnUiThread\n\n   ```java\n   private void postFromUiThreadToUiThread(){\n       runOnUiThread(new Runnable(){...})\n   }\n   ```\n\n    UI  Activity  runOnUIThread  UI  ID \n\n   ```java\n   public class MyApplication extends Application{\n       private long mUiThreadId;\n       private Handler mUiHandler;\n       \n       @Override\n       public void onCreate(){\n           super.onCreate();\n           mUiThread = Thread.currentThread().getId();\n           mUiHandler = new Handler();\n       }\n       \n       public void customRunOnUiThread(Runnable action){\n           if(Thread.currentThread().getId() != mUiThreadId){\n               mUiHandler.post(action);\n           } else{\n               action.run();\n           }\n       }\n   }\n   ```\n\n   ","source":"_posts/Efficient-Android-Threading-chapter-4-2.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321181341.jpg\ntitle:  \ntags: [, Efficient.Android.Threading]\ndate: 2018-09-09\n---\n\n> Efficient.Android.Threading  \n\n<!--more-->\n\n### Android \n\n Java  Java  Android  UI \n\nAndroid  UI Android -UI \n\nAndroid  API  `android.os` \n\n![Android Message API](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182551.jpg)\n\n`android.os.Looper`\n\n\n\n`android.os.Handler`\n\n Looper  Handler \n\n`android.os.MessageQueue`\n\n Looper  Looper \n\n MessageQueue,  LinkedList\n\n`android.os.Message`\n\n\n\n\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182556.jpg)\n\n\n\n1.  Handler \n2. Looper \n3. Handler  Handler Looper  Handler \n\n#### \n\n```java\npublic class LooperActivity extends Activity {\n\n    LooperThread mLooperThread;\n\n    // 1.\n    private static class LooperThread extends Thread {\n\n        public Handler mHandler;\n\n        public void run() {\n            // 2. Looper MessageQueue\n            Looper.prepare();\n            // 3. Handler  Looper \n            //  Looper.prepare()  Looper\n            mHandler = new Handler() {\n                // 4. \n                public void handleMessage(Message msg) {\n                    if(msg.what == 0) {\n                        doLongRunningOperation();\n                    }\n                }\n            };\n            // 5. \n            //  blocking call\n            Looper.loop();\n        }\n\n        private void doLongRunningOperation() {\n            // Add long running operation here.\n        }\n    }\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_looper);\n        // 6. \n        mLooperThread = new LooperThread();\n        mLooperThread.start();\n    }\n\n    public void onClick(View v) {\n        // 7. Handler  Handler \n        if (mLooperThread.mHandler != null) {\n            // 8.  Message what  0\n            Message msg = mLooperThread.mHandler.obtainMessage(0);\n            // 9. \n            mLooperThread.mHandler.sendMessage(msg);\n        }\n    }\n\n    protected void onDestroy() {\n        super.onDestroy();\n        // 10.  loop() \n        mLooperThread.mHandler.getLooper().quit();\n    }\n}\n```\n\n####  Classes\n\n##### MessageQueue\n\n `android.os.MessageQueue` \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182557.jpg)\n\n t1 < t2 < t3 t1  t3 `disptch barrier` , \n\n Looper  `dispatch barrier`  `dispatch barrier` \n\n##### MessageQueue.IdleHandler\n\n Looper  `android.os.MessageQueue.IdleHandler` \n\n```java\n/**\n * \n */\npublic static interface IdleHandler {  \n    boolean queueIdle();\n}\n\n// \n// \nMessageQueue myQueue = Looper.myQueue();\n//  IdleHandler \nMessageQueue.IdleHandler idleHandler = new MessageQueue.IdleHandler() {\n    @Override\n    public boolean queueIdle() {\n        return false;\n    }\n};\n// \nmyQueue.addIdleHandler(idleHandler);\n// \nmyQueue.removeIdleHandler(idleHandler);\n\n```\n\n IdleHandler  `queueIdle` \n\n `queueIdle` \n\n- true\n\n   IdleHandler  time slots MessageQueue \n\n- false\n\n   IdleHandler  MessageQueue.removeIdleHandler()  MessageQueue \n\n#####  IdleHandler \n\n IdleHandler \n\n IdleHandler \n\n time slots.\n\n```java\npublic class ConsumeAndQuitThreadActivity extends Activity {\n    \n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        final ConsumeAndQuitThread consumeAndQuitThread = new ConsumeAndQuitThread();\n        consumeAndQuitThread.start();\n        for (int i = 0; i < 10; i++) {\n            // \n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for (int i = 0; i < 10; i++) {\n                        SystemClock.sleep(new Random().nextInt(10));\n                        consumeAndQuitThread.enqueueData(i);\n                    }\n                }\n            }).start();\n        }\n    }\n\n    /**\n     *  Looper \n     *  Looper.loop() \n     */\n    private static class ConsumeAndQuitThread extends Thread implements MessageQueue.IdleHandler {\n\n        private static final String THREAD_NAME = \"ConsumeAndQuitThread\";\n\n        public Handler mConsumerHandler;\n        private boolean mIsFirstIdle = true;\n\n        public ConsumeAndQuitThread() {\n            super(THREAD_NAME);\n        }\n\n        @Override\n        public void run() {\n            Looper.prepare();\n\n            mConsumerHandler = new Handler() {\n                @Override\n                public void handleMessage(Message msg) {\n                    // Consume data\n                }\n            };\n            // 1.  Looper IdleHandler \n            Looper.myQueue().addIdleHandler(this);\n            Looper.loop();\n        }\n\n\n        @Override\n        public boolean queueIdle() {\n            // 2.  queueIdle() \n            //  true\n            if (mIsFirstIdle) { \n                mIsFirstIdle = false;\n                return true;\n            }\n            // 3. \n            mConsumerHandler.getLooper().quit();\n            return false;\n        }\n\n        public void enqueueData(int i) {\n            mConsumerHandler.sendEmptyMessage(i);\n        }\n    }\n}\n```\n\n\n\n##### Message\n\nMessage  Runnable \n\nMessage  Handler  Handler \n\n```java\n//  obtain()  Handler  Message.target \nMessage m = Message.obtain(handler, runnbale);\nm.sendToTarget();\n\npublic void sendToTarget() {\n    // target  Handler  Handler  sendMessage \n\ttarget.sendMessage(this);\n}\n```\n\nMessage \n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182601.jpg)\n\n handleMessage  Runnable  run  handleMessage \n\nMessage \n\n- Initialized\n\n   Message \n\n  - \n\n    ```java\n    Message m = new Message();\n    ```\n\n  - \n\n    - \n\n      ```java\n      Message m = Message.obtain();\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Handler h);\n      Message m = Message.obtain(Handler h, int what);\n      Message m = Message.obtain(Handler h, int what, Object o);\n      Message m = Message.obtain(Handler h, int what, int arg1, int arg2); \n      Message m = Message.obtain(Handler h, int what, int arg1, int arg2, Object o);\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Handler h, Runnable task);\n      ```\n\n    - \n\n      ```java\n      Message m = Message.obtain(Message originalMsg);\n      ```\n\n- Pending\n\n  \n\n- Disptached\n\n  Looper Looper  loop  Message.target  Handler \n\n- Recycled\n\n  Message Looper  Message \n\n  >  Handler  Message \n\n\n\n##### Looper\n\n`android.os.Looper`  Handler  Looper \n\n Looper  Looper Looper  MessageQueue UI  Looper  Looper \n\n```java\nnew Thread() {\n    @Override\n    public void run() {\n        // prepare() \n        // \n        Looper.prepare();\n        \n        // ... ...\n        \n        //  blocking call run() \n        //  run() Looper \n        Looper.loop();\n    }\n}.start();\n```\n\n Looper Looper  MessageQueue\n\n##### Looper \n\n- quit()\n\n  \n\n- quitSafely()\n\n  Looper \n\n Looper  loop()  Looper  Looper  Looper  Looper Looper.prepare()  Looper.loop() \n\n##### UI  Looper\n\nUI  Looper \n\n-  Looper.getMainLooper()  UI Looper\n- UI  Looper \n- Java  Looper.prepareMainLooper()  UI  Looper main looper \n\n\n\n##### Handler\n\nAndroid  `android.os.Handler`  UI \n\n- \n- \n- \n- \n\nHandler  Looper  MQ  Handler  Looper \n\n1.  Looper  Handler \n\n   ```java\n   //  Looper \n   new Handler();\n   new Handler(Handler.Callback);\n   ```\n\n2.  Looper \n\n   ```java\n   new Handler(Looper);\n   new Handler(Looper, Handler.Callback);\n   ```\n\n Handler  Handler  Message  target  Handler\n\n![](https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182554.jpg)\n\n>  Handler Message \n\n##### Message creation\n\nHandler  Message  Handler \n\n```java\n//  Message.obtain()  Handler \nMessage obtainMessage(int what, int arg1, int arg2)\nMessage obtainMessage()\nMessage obtainMessage(int what, int arg1, int arg2, Object obj) \nMessage obtainMessage(int what)\nMessage obtainMessage(int what, Object obj)\n```\n\n##### Message insertion\n\nHandler \n\n```java\n//  postXxx() \nboolean post(Runnable r)\nboolean postAtFrontOfQueue(Runnable r)\nboolean postAtTime(Runnable r, Object token, long uptimeMillis) \nboolean postAtTime(Runnable r, long uptimeMillis)\nboolean postDelayed(Runnable r, long delayMillis)\n    \n//  sendXxx() \n// \nboolean sendMessage(Message msg) \n// \nboolean sendMessageAtFrontOfQueue(Message msg)\n// \nboolean sendMessageAtTime(Message msg, long uptimeMillis) \nboolean sendMessageDelayed(Message msg, long delayMillis)\nboolean sendEmptyMessage(int what)\nboolean sendEmptyMessageAtTime(int what, long uptimeMillis) \nboolean sendEmptyMessageDelayed(int what, long delayMillis)\n```\n\n when \n\n\n\n- Message has no Handler\n\n  Message was created from a Message.obtain() method without a specified Handler.\n\n- Message has already been disptached and is being processed\n\n  The same message instance was inserted twice.\n\n- Looper has exited\n\n  Message is inserted after Looper.quit() has been called.\n\n> Looper  Handler  dispatchMessage \n\n##### Message processing\n\nMessage \n\n- Task messages\n\n   Runnbale  Runnable  run  `Handler.handMessage()` \n\n- Data messages\n\n   `Handler.handMessage()` \n\n Handler  Handler  loop() \n\n```java\nclass ConsumerThread extends Thread{\n    Handler mHandler;\n    @Override\n    public void run(){\n        Looper.prepare();\n        mHandler = new Handler(){\n            public void handleMessage(Message msg){\n                // process data message here\n            }\n        };\n        Looper.loop();\n    }\n}\n```\n\n `Handler.Callback`  `handleMessage` \n\n```java\npublic interface Callback {\n    // true: \n    // false:  Handler.handleMessage \n\tpublic boolean handleMessage(Message msg);\n}\n\n// \npublic void dispatchMessage(Message msg) {\n\tif (msg.callback != null) {\n\t\thandleCallback(msg);\n\t} else {\n\t\tif (mCallback != null) {\n            //  true \n\t\t\tif (mCallback.handleMessage(msg)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\thandleMessage(msg);\n\t}\t\n}\n```\n\n Handler  Callback  Handler  Handler  handleMessage()\n\n```java\npublic class HandlerCallbackActivity extends Activity implements Handler.Callback {\n    Handler mUiHandler;\n    \n    @Override\n    public void onCreate(Bundle savedInstanceState){\n        super.onCreate(savedInstanceState);\n        mUiHandler = new Handler(this); // \n    }\n    \n    @Override\n    public boolean handleMessage(Message msg){\n        // process msg\n        return true;\n    }\n}\n```\n\n####  UI \n\nUI  Looper  UI  UI \n\n UI \n\n1.  Handler  UI  Looper\n\n   ```java\n   Runnable task = new Runnable(){...};\n   new Handler(Looper.getMainLooper()).post(task);\n   ```\n\n   task  UI Looper  UI MessageQueue\n\n2.  UI \n\n   ```java\n   private void postFromUiThreadToUiThread(){\n       new Handler().post(new Runnable(){...})\n   }\n   ```\n\n3. Activity.runOnUiThread\n\n   ```java\n   private void postFromUiThreadToUiThread(){\n       runOnUiThread(new Runnable(){...})\n   }\n   ```\n\n    UI  Activity  runOnUIThread  UI  ID \n\n   ```java\n   public class MyApplication extends Application{\n       private long mUiThreadId;\n       private Handler mUiHandler;\n       \n       @Override\n       public void onCreate(){\n           super.onCreate();\n           mUiThread = Thread.currentThread().getId();\n           mUiHandler = new Handler();\n       }\n       \n       public void customRunOnUiThread(Runnable action){\n           if(Thread.currentThread().getId() != mUiThreadId){\n               mUiHandler.post(action);\n           } else{\n               action.run();\n           }\n       }\n   }\n   ```\n\n   ","slug":"Efficient-Android-Threading-chapter-4-2","published":1,"updated":"2019-03-21T10:47:37.178Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86f6001zlh1pji1bujb1","content":"<blockquote>\n<p>Efficient.Android.Threading  </p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"Android-\"><a href=\"#Android-\" class=\"headerlink\" title=\"Android \"></a>Android </h3><p> Java  Java  Android  UI </p>\n<p>Android  UI Android -UI </p>\n<p>Android  API  <code>android.os</code> </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182551.jpg\" alt=\"Android Message API\"></p>\n<p><code>android.os.Looper</code></p>\n<p></p>\n<p><code>android.os.Handler</code></p>\n<p> Looper  Handler </p>\n<p><code>android.os.MessageQueue</code></p>\n<p> Looper  Looper </p>\n<p> MessageQueue,  LinkedList</p>\n<p><code>android.os.Message</code></p>\n<p></p>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182556.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li> Handler </li>\n<li>Looper </li>\n<li>Handler  Handler Looper  Handler </li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code class=\"java\">public class LooperActivity extends Activity {\n\n    LooperThread mLooperThread;\n\n    // 1.\n    private static class LooperThread extends Thread {\n\n        public Handler mHandler;\n\n        public void run() {\n            // 2. Looper MessageQueue\n            Looper.prepare();\n            // 3. Handler  Looper \n            //  Looper.prepare()  Looper\n            mHandler = new Handler() {\n                // 4. \n                public void handleMessage(Message msg) {\n                    if(msg.what == 0) {\n                        doLongRunningOperation();\n                    }\n                }\n            };\n            // 5. \n            //  blocking call\n            Looper.loop();\n        }\n\n        private void doLongRunningOperation() {\n            // Add long running operation here.\n        }\n    }\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_looper);\n        // 6. \n        mLooperThread = new LooperThread();\n        mLooperThread.start();\n    }\n\n    public void onClick(View v) {\n        // 7. Handler  Handler \n        if (mLooperThread.mHandler != null) {\n            // 8.  Message what  0\n            Message msg = mLooperThread.mHandler.obtainMessage(0);\n            // 9. \n            mLooperThread.mHandler.sendMessage(msg);\n        }\n    }\n\n    protected void onDestroy() {\n        super.onDestroy();\n        // 10.  loop() \n        mLooperThread.mHandler.getLooper().quit();\n    }\n}\n</code></pre>\n<h4 id=\"-Classes\"><a href=\"#-Classes\" class=\"headerlink\" title=\" Classes\"></a> Classes</h4><h5 id=\"MessageQueue\"><a href=\"#MessageQueue\" class=\"headerlink\" title=\"MessageQueue\"></a>MessageQueue</h5><p> <code>android.os.MessageQueue</code> </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182557.jpg\" alt=\"\"></p>\n<p> t1 &lt; t2 &lt; t3 t1  t3 <code>disptch barrier</code> , </p>\n<p> Looper  <code>dispatch barrier</code>  <code>dispatch barrier</code> </p>\n<h5 id=\"MessageQueue-IdleHandler\"><a href=\"#MessageQueue-IdleHandler\" class=\"headerlink\" title=\"MessageQueue.IdleHandler\"></a>MessageQueue.IdleHandler</h5><p> Looper  <code>android.os.MessageQueue.IdleHandler</code> </p>\n<pre><code class=\"java\">/**\n * \n */\npublic static interface IdleHandler {  \n    boolean queueIdle();\n}\n\n// \n// \nMessageQueue myQueue = Looper.myQueue();\n//  IdleHandler \nMessageQueue.IdleHandler idleHandler = new MessageQueue.IdleHandler() {\n    @Override\n    public boolean queueIdle() {\n        return false;\n    }\n};\n// \nmyQueue.addIdleHandler(idleHandler);\n// \nmyQueue.removeIdleHandler(idleHandler);\n\n</code></pre>\n<p> IdleHandler  <code>queueIdle</code> </p>\n<p> <code>queueIdle</code> </p>\n<ul>\n<li><p>true</p>\n<p> IdleHandler  time slots MessageQueue </p>\n</li>\n<li><p>false</p>\n<p> IdleHandler  MessageQueue.removeIdleHandler()  MessageQueue </p>\n</li>\n</ul>\n<h5 id=\"-IdleHandler-\"><a href=\"#-IdleHandler-\" class=\"headerlink\" title=\" IdleHandler \"></a> IdleHandler </h5><p> IdleHandler </p>\n<p> IdleHandler </p>\n<p> time slots.</p>\n<pre><code class=\"java\">public class ConsumeAndQuitThreadActivity extends Activity {\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        final ConsumeAndQuitThread consumeAndQuitThread = new ConsumeAndQuitThread();\n        consumeAndQuitThread.start();\n        for (int i = 0; i &lt; 10; i++) {\n            // \n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for (int i = 0; i &lt; 10; i++) {\n                        SystemClock.sleep(new Random().nextInt(10));\n                        consumeAndQuitThread.enqueueData(i);\n                    }\n                }\n            }).start();\n        }\n    }\n\n    /**\n     *  Looper \n     *  Looper.loop() \n     */\n    private static class ConsumeAndQuitThread extends Thread implements MessageQueue.IdleHandler {\n\n        private static final String THREAD_NAME = &quot;ConsumeAndQuitThread&quot;;\n\n        public Handler mConsumerHandler;\n        private boolean mIsFirstIdle = true;\n\n        public ConsumeAndQuitThread() {\n            super(THREAD_NAME);\n        }\n\n        @Override\n        public void run() {\n            Looper.prepare();\n\n            mConsumerHandler = new Handler() {\n                @Override\n                public void handleMessage(Message msg) {\n                    // Consume data\n                }\n            };\n            // 1.  Looper IdleHandler \n            Looper.myQueue().addIdleHandler(this);\n            Looper.loop();\n        }\n\n\n        @Override\n        public boolean queueIdle() {\n            // 2.  queueIdle() \n            //  true\n            if (mIsFirstIdle) { \n                mIsFirstIdle = false;\n                return true;\n            }\n            // 3. \n            mConsumerHandler.getLooper().quit();\n            return false;\n        }\n\n        public void enqueueData(int i) {\n            mConsumerHandler.sendEmptyMessage(i);\n        }\n    }\n}\n</code></pre>\n<h5 id=\"Message\"><a href=\"#Message\" class=\"headerlink\" title=\"Message\"></a>Message</h5><p>Message  Runnable </p>\n<p>Message  Handler  Handler </p>\n<pre><code class=\"java\">//  obtain()  Handler  Message.target \nMessage m = Message.obtain(handler, runnbale);\nm.sendToTarget();\n\npublic void sendToTarget() {\n    // target  Handler  Handler  sendMessage \n    target.sendMessage(this);\n}\n</code></pre>\n<p>Message </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182601.jpg\" alt=\"\"></p>\n<p> handleMessage  Runnable  run  handleMessage </p>\n<p>Message </p>\n<ul>\n<li><p>Initialized</p>\n<p> Message </p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">Message m = new Message();\n</code></pre>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain();\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Handler h);\nMessage m = Message.obtain(Handler h, int what);\nMessage m = Message.obtain(Handler h, int what, Object o);\nMessage m = Message.obtain(Handler h, int what, int arg1, int arg2); \nMessage m = Message.obtain(Handler h, int what, int arg1, int arg2, Object o);\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Handler h, Runnable task);\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Message originalMsg);\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Pending</p>\n<p></p>\n</li>\n<li><p>Disptached</p>\n<p>Looper Looper  loop  Message.target  Handler </p>\n</li>\n<li><p>Recycled</p>\n<p>Message Looper  Message </p>\n<blockquote>\n<p> Handler  Message </p>\n</blockquote>\n</li>\n</ul>\n<h5 id=\"Looper\"><a href=\"#Looper\" class=\"headerlink\" title=\"Looper\"></a>Looper</h5><p><code>android.os.Looper</code>  Handler  Looper </p>\n<p> Looper  Looper Looper  MessageQueue UI  Looper  Looper </p>\n<pre><code class=\"java\">new Thread() {\n    @Override\n    public void run() {\n        // prepare() \n        // \n        Looper.prepare();\n\n        // ... ...\n\n        //  blocking call run() \n        //  run() Looper \n        Looper.loop();\n    }\n}.start();\n</code></pre>\n<p> Looper Looper  MessageQueue</p>\n<h5 id=\"Looper-\"><a href=\"#Looper-\" class=\"headerlink\" title=\"Looper \"></a>Looper </h5><ul>\n<li><p>quit()</p>\n<p></p>\n</li>\n<li><p>quitSafely()</p>\n<p>Looper </p>\n</li>\n</ul>\n<p> Looper  loop()  Looper  Looper  Looper  Looper Looper.prepare()  Looper.loop() </p>\n<h5 id=\"UI--Looper\"><a href=\"#UI--Looper\" class=\"headerlink\" title=\"UI  Looper\"></a>UI  Looper</h5><p>UI  Looper </p>\n<ul>\n<li> Looper.getMainLooper()  UI Looper</li>\n<li>UI  Looper </li>\n<li>Java  Looper.prepareMainLooper()  UI  Looper main looper </li>\n</ul>\n<h5 id=\"Handler\"><a href=\"#Handler\" class=\"headerlink\" title=\"Handler\"></a>Handler</h5><p>Android  <code>android.os.Handler</code>  UI </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Handler  Looper  MQ  Handler  Looper </p>\n<ol>\n<li><p> Looper  Handler </p>\n<pre><code class=\"java\">//  Looper \nnew Handler();\nnew Handler(Handler.Callback);\n</code></pre>\n</li>\n<li><p> Looper </p>\n<pre><code class=\"java\">new Handler(Looper);\nnew Handler(Looper, Handler.Callback);\n</code></pre>\n</li>\n</ol>\n<p> Handler  Handler  Message  target  Handler</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182554.jpg\" alt=\"\"></p>\n<blockquote>\n<p> Handler Message </p>\n</blockquote>\n<h5 id=\"Message-creation\"><a href=\"#Message-creation\" class=\"headerlink\" title=\"Message creation\"></a>Message creation</h5><p>Handler  Message  Handler </p>\n<pre><code class=\"java\">//  Message.obtain()  Handler \nMessage obtainMessage(int what, int arg1, int arg2)\nMessage obtainMessage()\nMessage obtainMessage(int what, int arg1, int arg2, Object obj) \nMessage obtainMessage(int what)\nMessage obtainMessage(int what, Object obj)\n</code></pre>\n<h5 id=\"Message-insertion\"><a href=\"#Message-insertion\" class=\"headerlink\" title=\"Message insertion\"></a>Message insertion</h5><p>Handler </p>\n<pre><code class=\"java\">//  postXxx() \nboolean post(Runnable r)\nboolean postAtFrontOfQueue(Runnable r)\nboolean postAtTime(Runnable r, Object token, long uptimeMillis) \nboolean postAtTime(Runnable r, long uptimeMillis)\nboolean postDelayed(Runnable r, long delayMillis)\n\n//  sendXxx() \n// \nboolean sendMessage(Message msg) \n// \nboolean sendMessageAtFrontOfQueue(Message msg)\n// \nboolean sendMessageAtTime(Message msg, long uptimeMillis) \nboolean sendMessageDelayed(Message msg, long delayMillis)\nboolean sendEmptyMessage(int what)\nboolean sendEmptyMessageAtTime(int what, long uptimeMillis) \nboolean sendEmptyMessageDelayed(int what, long delayMillis)\n</code></pre>\n<p> when </p>\n<p></p>\n<ul>\n<li><p>Message has no Handler</p>\n<p>Message was created from a Message.obtain() method without a specified Handler.</p>\n</li>\n<li><p>Message has already been disptached and is being processed</p>\n<p>The same message instance was inserted twice.</p>\n</li>\n<li><p>Looper has exited</p>\n<p>Message is inserted after Looper.quit() has been called.</p>\n</li>\n</ul>\n<blockquote>\n<p>Looper  Handler  dispatchMessage </p>\n</blockquote>\n<h5 id=\"Message-processing\"><a href=\"#Message-processing\" class=\"headerlink\" title=\"Message processing\"></a>Message processing</h5><p>Message </p>\n<ul>\n<li><p>Task messages</p>\n<p> Runnbale  Runnable  run  <code>Handler.handMessage()</code> </p>\n</li>\n<li><p>Data messages</p>\n<p> <code>Handler.handMessage()</code> </p>\n</li>\n</ul>\n<p> Handler  Handler  loop() </p>\n<pre><code class=\"java\">class ConsumerThread extends Thread{\n    Handler mHandler;\n    @Override\n    public void run(){\n        Looper.prepare();\n        mHandler = new Handler(){\n            public void handleMessage(Message msg){\n                // process data message here\n            }\n        };\n        Looper.loop();\n    }\n}\n</code></pre>\n<p> <code>Handler.Callback</code>  <code>handleMessage</code> </p>\n<pre><code class=\"java\">public interface Callback {\n    // true: \n    // false:  Handler.handleMessage \n    public boolean handleMessage(Message msg);\n}\n\n// \npublic void dispatchMessage(Message msg) {\n    if (msg.callback != null) {\n        handleCallback(msg);\n    } else {\n        if (mCallback != null) {\n            //  true \n            if (mCallback.handleMessage(msg)) {\n                return;\n            }\n        }\n        handleMessage(msg);\n    }    \n}\n</code></pre>\n<p> Handler  Callback  Handler  Handler  handleMessage()</p>\n<pre><code class=\"java\">public class HandlerCallbackActivity extends Activity implements Handler.Callback {\n    Handler mUiHandler;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState){\n        super.onCreate(savedInstanceState);\n        mUiHandler = new Handler(this); // \n    }\n\n    @Override\n    public boolean handleMessage(Message msg){\n        // process msg\n        return true;\n    }\n}\n</code></pre>\n<h4 id=\"-UI-\"><a href=\"#-UI-\" class=\"headerlink\" title=\" UI \"></a> UI </h4><p>UI  Looper  UI  UI </p>\n<p> UI </p>\n<ol>\n<li><p> Handler  UI  Looper</p>\n<pre><code class=\"java\">Runnable task = new Runnable(){...};\nnew Handler(Looper.getMainLooper()).post(task);\n</code></pre>\n<p>task  UI Looper  UI MessageQueue</p>\n</li>\n<li><p> UI </p>\n<pre><code class=\"java\">private void postFromUiThreadToUiThread(){\n    new Handler().post(new Runnable(){...})\n}\n</code></pre>\n</li>\n<li><p>Activity.runOnUiThread</p>\n<pre><code class=\"java\">private void postFromUiThreadToUiThread(){\n    runOnUiThread(new Runnable(){...})\n}\n</code></pre>\n<p> UI  Activity  runOnUIThread  UI  ID </p>\n<pre><code class=\"java\">public class MyApplication extends Application{\n    private long mUiThreadId;\n    private Handler mUiHandler;\n\n    @Override\n    public void onCreate(){\n        super.onCreate();\n        mUiThread = Thread.currentThread().getId();\n        mUiHandler = new Handler();\n    }\n\n    public void customRunOnUiThread(Runnable action){\n        if(Thread.currentThread().getId() != mUiThreadId){\n            mUiHandler.post(action);\n        } else{\n            action.run();\n        }\n    }\n}\n</code></pre>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>Efficient.Android.Threading  </p>\n</blockquote>","more":"<h3 id=\"Android-\"><a href=\"#Android-\" class=\"headerlink\" title=\"Android \"></a>Android </h3><p> Java  Java  Android  UI </p>\n<p>Android  UI Android -UI </p>\n<p>Android  API  <code>android.os</code> </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182551.jpg\" alt=\"Android Message API\"></p>\n<p><code>android.os.Looper</code></p>\n<p></p>\n<p><code>android.os.Handler</code></p>\n<p> Looper  Handler </p>\n<p><code>android.os.MessageQueue</code></p>\n<p> Looper  Looper </p>\n<p> MessageQueue,  LinkedList</p>\n<p><code>android.os.Message</code></p>\n<p></p>\n<p></p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182556.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li> Handler </li>\n<li>Looper </li>\n<li>Handler  Handler Looper  Handler </li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><pre><code class=\"java\">public class LooperActivity extends Activity {\n\n    LooperThread mLooperThread;\n\n    // 1.\n    private static class LooperThread extends Thread {\n\n        public Handler mHandler;\n\n        public void run() {\n            // 2. Looper MessageQueue\n            Looper.prepare();\n            // 3. Handler  Looper \n            //  Looper.prepare()  Looper\n            mHandler = new Handler() {\n                // 4. \n                public void handleMessage(Message msg) {\n                    if(msg.what == 0) {\n                        doLongRunningOperation();\n                    }\n                }\n            };\n            // 5. \n            //  blocking call\n            Looper.loop();\n        }\n\n        private void doLongRunningOperation() {\n            // Add long running operation here.\n        }\n    }\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_looper);\n        // 6. \n        mLooperThread = new LooperThread();\n        mLooperThread.start();\n    }\n\n    public void onClick(View v) {\n        // 7. Handler  Handler \n        if (mLooperThread.mHandler != null) {\n            // 8.  Message what  0\n            Message msg = mLooperThread.mHandler.obtainMessage(0);\n            // 9. \n            mLooperThread.mHandler.sendMessage(msg);\n        }\n    }\n\n    protected void onDestroy() {\n        super.onDestroy();\n        // 10.  loop() \n        mLooperThread.mHandler.getLooper().quit();\n    }\n}\n</code></pre>\n<h4 id=\"-Classes\"><a href=\"#-Classes\" class=\"headerlink\" title=\" Classes\"></a> Classes</h4><h5 id=\"MessageQueue\"><a href=\"#MessageQueue\" class=\"headerlink\" title=\"MessageQueue\"></a>MessageQueue</h5><p> <code>android.os.MessageQueue</code> </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182557.jpg\" alt=\"\"></p>\n<p> t1 &lt; t2 &lt; t3 t1  t3 <code>disptch barrier</code> , </p>\n<p> Looper  <code>dispatch barrier</code>  <code>dispatch barrier</code> </p>\n<h5 id=\"MessageQueue-IdleHandler\"><a href=\"#MessageQueue-IdleHandler\" class=\"headerlink\" title=\"MessageQueue.IdleHandler\"></a>MessageQueue.IdleHandler</h5><p> Looper  <code>android.os.MessageQueue.IdleHandler</code> </p>\n<pre><code class=\"java\">/**\n * \n */\npublic static interface IdleHandler {  \n    boolean queueIdle();\n}\n\n// \n// \nMessageQueue myQueue = Looper.myQueue();\n//  IdleHandler \nMessageQueue.IdleHandler idleHandler = new MessageQueue.IdleHandler() {\n    @Override\n    public boolean queueIdle() {\n        return false;\n    }\n};\n// \nmyQueue.addIdleHandler(idleHandler);\n// \nmyQueue.removeIdleHandler(idleHandler);\n\n</code></pre>\n<p> IdleHandler  <code>queueIdle</code> </p>\n<p> <code>queueIdle</code> </p>\n<ul>\n<li><p>true</p>\n<p> IdleHandler  time slots MessageQueue </p>\n</li>\n<li><p>false</p>\n<p> IdleHandler  MessageQueue.removeIdleHandler()  MessageQueue </p>\n</li>\n</ul>\n<h5 id=\"-IdleHandler-\"><a href=\"#-IdleHandler-\" class=\"headerlink\" title=\" IdleHandler \"></a> IdleHandler </h5><p> IdleHandler </p>\n<p> IdleHandler </p>\n<p> time slots.</p>\n<pre><code class=\"java\">public class ConsumeAndQuitThreadActivity extends Activity {\n\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        final ConsumeAndQuitThread consumeAndQuitThread = new ConsumeAndQuitThread();\n        consumeAndQuitThread.start();\n        for (int i = 0; i &lt; 10; i++) {\n            // \n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for (int i = 0; i &lt; 10; i++) {\n                        SystemClock.sleep(new Random().nextInt(10));\n                        consumeAndQuitThread.enqueueData(i);\n                    }\n                }\n            }).start();\n        }\n    }\n\n    /**\n     *  Looper \n     *  Looper.loop() \n     */\n    private static class ConsumeAndQuitThread extends Thread implements MessageQueue.IdleHandler {\n\n        private static final String THREAD_NAME = &quot;ConsumeAndQuitThread&quot;;\n\n        public Handler mConsumerHandler;\n        private boolean mIsFirstIdle = true;\n\n        public ConsumeAndQuitThread() {\n            super(THREAD_NAME);\n        }\n\n        @Override\n        public void run() {\n            Looper.prepare();\n\n            mConsumerHandler = new Handler() {\n                @Override\n                public void handleMessage(Message msg) {\n                    // Consume data\n                }\n            };\n            // 1.  Looper IdleHandler \n            Looper.myQueue().addIdleHandler(this);\n            Looper.loop();\n        }\n\n\n        @Override\n        public boolean queueIdle() {\n            // 2.  queueIdle() \n            //  true\n            if (mIsFirstIdle) { \n                mIsFirstIdle = false;\n                return true;\n            }\n            // 3. \n            mConsumerHandler.getLooper().quit();\n            return false;\n        }\n\n        public void enqueueData(int i) {\n            mConsumerHandler.sendEmptyMessage(i);\n        }\n    }\n}\n</code></pre>\n<h5 id=\"Message\"><a href=\"#Message\" class=\"headerlink\" title=\"Message\"></a>Message</h5><p>Message  Runnable </p>\n<p>Message  Handler  Handler </p>\n<pre><code class=\"java\">//  obtain()  Handler  Message.target \nMessage m = Message.obtain(handler, runnbale);\nm.sendToTarget();\n\npublic void sendToTarget() {\n    // target  Handler  Handler  sendMessage \n    target.sendMessage(this);\n}\n</code></pre>\n<p>Message </p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182601.jpg\" alt=\"\"></p>\n<p> handleMessage  Runnable  run  handleMessage </p>\n<p>Message </p>\n<ul>\n<li><p>Initialized</p>\n<p> Message </p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">Message m = new Message();\n</code></pre>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain();\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Handler h);\nMessage m = Message.obtain(Handler h, int what);\nMessage m = Message.obtain(Handler h, int what, Object o);\nMessage m = Message.obtain(Handler h, int what, int arg1, int arg2); \nMessage m = Message.obtain(Handler h, int what, int arg1, int arg2, Object o);\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Handler h, Runnable task);\n</code></pre>\n</li>\n<li><p></p>\n<pre><code class=\"java\">Message m = Message.obtain(Message originalMsg);\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Pending</p>\n<p></p>\n</li>\n<li><p>Disptached</p>\n<p>Looper Looper  loop  Message.target  Handler </p>\n</li>\n<li><p>Recycled</p>\n<p>Message Looper  Message </p>\n<blockquote>\n<p> Handler  Message </p>\n</blockquote>\n</li>\n</ul>\n<h5 id=\"Looper\"><a href=\"#Looper\" class=\"headerlink\" title=\"Looper\"></a>Looper</h5><p><code>android.os.Looper</code>  Handler  Looper </p>\n<p> Looper  Looper Looper  MessageQueue UI  Looper  Looper </p>\n<pre><code class=\"java\">new Thread() {\n    @Override\n    public void run() {\n        // prepare() \n        // \n        Looper.prepare();\n\n        // ... ...\n\n        //  blocking call run() \n        //  run() Looper \n        Looper.loop();\n    }\n}.start();\n</code></pre>\n<p> Looper Looper  MessageQueue</p>\n<h5 id=\"Looper-\"><a href=\"#Looper-\" class=\"headerlink\" title=\"Looper \"></a>Looper </h5><ul>\n<li><p>quit()</p>\n<p></p>\n</li>\n<li><p>quitSafely()</p>\n<p>Looper </p>\n</li>\n</ul>\n<p> Looper  loop()  Looper  Looper  Looper  Looper Looper.prepare()  Looper.loop() </p>\n<h5 id=\"UI--Looper\"><a href=\"#UI--Looper\" class=\"headerlink\" title=\"UI  Looper\"></a>UI  Looper</h5><p>UI  Looper </p>\n<ul>\n<li> Looper.getMainLooper()  UI Looper</li>\n<li>UI  Looper </li>\n<li>Java  Looper.prepareMainLooper()  UI  Looper main looper </li>\n</ul>\n<h5 id=\"Handler\"><a href=\"#Handler\" class=\"headerlink\" title=\"Handler\"></a>Handler</h5><p>Android  <code>android.os.Handler</code>  UI </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Handler  Looper  MQ  Handler  Looper </p>\n<ol>\n<li><p> Looper  Handler </p>\n<pre><code class=\"java\">//  Looper \nnew Handler();\nnew Handler(Handler.Callback);\n</code></pre>\n</li>\n<li><p> Looper </p>\n<pre><code class=\"java\">new Handler(Looper);\nnew Handler(Looper, Handler.Callback);\n</code></pre>\n</li>\n</ol>\n<p> Handler  Handler  Message  target  Handler</p>\n<p><img src=\"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321182554.jpg\" alt=\"\"></p>\n<blockquote>\n<p> Handler Message </p>\n</blockquote>\n<h5 id=\"Message-creation\"><a href=\"#Message-creation\" class=\"headerlink\" title=\"Message creation\"></a>Message creation</h5><p>Handler  Message  Handler </p>\n<pre><code class=\"java\">//  Message.obtain()  Handler \nMessage obtainMessage(int what, int arg1, int arg2)\nMessage obtainMessage()\nMessage obtainMessage(int what, int arg1, int arg2, Object obj) \nMessage obtainMessage(int what)\nMessage obtainMessage(int what, Object obj)\n</code></pre>\n<h5 id=\"Message-insertion\"><a href=\"#Message-insertion\" class=\"headerlink\" title=\"Message insertion\"></a>Message insertion</h5><p>Handler </p>\n<pre><code class=\"java\">//  postXxx() \nboolean post(Runnable r)\nboolean postAtFrontOfQueue(Runnable r)\nboolean postAtTime(Runnable r, Object token, long uptimeMillis) \nboolean postAtTime(Runnable r, long uptimeMillis)\nboolean postDelayed(Runnable r, long delayMillis)\n\n//  sendXxx() \n// \nboolean sendMessage(Message msg) \n// \nboolean sendMessageAtFrontOfQueue(Message msg)\n// \nboolean sendMessageAtTime(Message msg, long uptimeMillis) \nboolean sendMessageDelayed(Message msg, long delayMillis)\nboolean sendEmptyMessage(int what)\nboolean sendEmptyMessageAtTime(int what, long uptimeMillis) \nboolean sendEmptyMessageDelayed(int what, long delayMillis)\n</code></pre>\n<p> when </p>\n<p></p>\n<ul>\n<li><p>Message has no Handler</p>\n<p>Message was created from a Message.obtain() method without a specified Handler.</p>\n</li>\n<li><p>Message has already been disptached and is being processed</p>\n<p>The same message instance was inserted twice.</p>\n</li>\n<li><p>Looper has exited</p>\n<p>Message is inserted after Looper.quit() has been called.</p>\n</li>\n</ul>\n<blockquote>\n<p>Looper  Handler  dispatchMessage </p>\n</blockquote>\n<h5 id=\"Message-processing\"><a href=\"#Message-processing\" class=\"headerlink\" title=\"Message processing\"></a>Message processing</h5><p>Message </p>\n<ul>\n<li><p>Task messages</p>\n<p> Runnbale  Runnable  run  <code>Handler.handMessage()</code> </p>\n</li>\n<li><p>Data messages</p>\n<p> <code>Handler.handMessage()</code> </p>\n</li>\n</ul>\n<p> Handler  Handler  loop() </p>\n<pre><code class=\"java\">class ConsumerThread extends Thread{\n    Handler mHandler;\n    @Override\n    public void run(){\n        Looper.prepare();\n        mHandler = new Handler(){\n            public void handleMessage(Message msg){\n                // process data message here\n            }\n        };\n        Looper.loop();\n    }\n}\n</code></pre>\n<p> <code>Handler.Callback</code>  <code>handleMessage</code> </p>\n<pre><code class=\"java\">public interface Callback {\n    // true: \n    // false:  Handler.handleMessage \n    public boolean handleMessage(Message msg);\n}\n\n// \npublic void dispatchMessage(Message msg) {\n    if (msg.callback != null) {\n        handleCallback(msg);\n    } else {\n        if (mCallback != null) {\n            //  true \n            if (mCallback.handleMessage(msg)) {\n                return;\n            }\n        }\n        handleMessage(msg);\n    }    \n}\n</code></pre>\n<p> Handler  Callback  Handler  Handler  handleMessage()</p>\n<pre><code class=\"java\">public class HandlerCallbackActivity extends Activity implements Handler.Callback {\n    Handler mUiHandler;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState){\n        super.onCreate(savedInstanceState);\n        mUiHandler = new Handler(this); // \n    }\n\n    @Override\n    public boolean handleMessage(Message msg){\n        // process msg\n        return true;\n    }\n}\n</code></pre>\n<h4 id=\"-UI-\"><a href=\"#-UI-\" class=\"headerlink\" title=\" UI \"></a> UI </h4><p>UI  Looper  UI  UI </p>\n<p> UI </p>\n<ol>\n<li><p> Handler  UI  Looper</p>\n<pre><code class=\"java\">Runnable task = new Runnable(){...};\nnew Handler(Looper.getMainLooper()).post(task);\n</code></pre>\n<p>task  UI Looper  UI MessageQueue</p>\n</li>\n<li><p> UI </p>\n<pre><code class=\"java\">private void postFromUiThreadToUiThread(){\n    new Handler().post(new Runnable(){...})\n}\n</code></pre>\n</li>\n<li><p>Activity.runOnUiThread</p>\n<pre><code class=\"java\">private void postFromUiThreadToUiThread(){\n    runOnUiThread(new Runnable(){...})\n}\n</code></pre>\n<p> UI  Activity  runOnUIThread  UI  ID </p>\n<pre><code class=\"java\">public class MyApplication extends Application{\n    private long mUiThreadId;\n    private Handler mUiHandler;\n\n    @Override\n    public void onCreate(){\n        super.onCreate();\n        mUiThread = Thread.currentThread().getId();\n        mUiHandler = new Handler();\n    }\n\n    public void customRunOnUiThread(Runnable action){\n        if(Thread.currentThread().getId() != mUiThreadId){\n            mUiHandler.post(action);\n        } else{\n            action.run();\n        }\n    }\n}\n</code></pre>\n</li>\n</ol>"},{"thumbnail":"https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321185255.png","title":"ViewDragHelper ","date":"2019-05-12T16:00:00.000Z","_content":"\n[](https://www.cnblogs.com/lqstayreal/p/4500219.html)\n\n<!-- more -->\n\n\n\nViewGroupViewViewDragHelperViewNavigation DrawerQQ5.x\n\nViewDragHelperViewDragHelper\n\n### \n\n1. ViewGroupViewDragHelpercreate()ViewDragHelper\n\n2. ViewDragHelper.Callback\n\n   tryCaptureView()clampViewPositionVertical()clampViewPositionHorizontal()getViewHorizontalDragRange()getViewVerticalDragRange()\n\n   - tryCaptureView()ViewViewtruefalse\n   - clampViewPositionVertical()ViewViewViewtopViewtop\n   - clampViewPositionHorizontal()clampViewPositionVertical()Viewleft\n   - getViewVerticalDragRange()0View\n   - getViewHorizontalDragRange()getViewVerticalDragRange()\n\n3. onInterceptTouchEvent()ViewDragHelpershouldInterceptTouchEvent()\n\n4. onTouchEvent()ViewDragHelper()processTouchEvent()ACTION_DOWNViewonTouchEvent()true\n\n5. ViewflingViewGroupcomputeScroll()\n\n   ```\n    @Override\n    public void computeScroll() {\n        if (mDragHelper.continueSettling(true)) {\n            postInvalidate();\n        }\n    }\n   ```\n\n   ViewDragHelper.CallbackonViewReleased()settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()\n\n6. ViewDragHelpersetEdgeTrackingEnabled()ViewDragHelper.CallbackonEdgeDragStarted()captureChildView()View\n\nDemo\n\n### \n\nViewDragHelper[GitHub](https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/ViewDragHelper.java)[GrepCode](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.0.2_r1/android/support/v4/widget/ViewDragHelper.java#ViewDragHelper)\n\n#### \n\n1. View[Android ViewgetLeft, getRight, getTop, getBottom](http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html)\n2. MotionEvent[android,MotionEvent()](http://my.oschina.net/banxi/blog/56421)\n3. Scroller[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)\n4. Touch[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)\n\n#### ViewDragHelper\n\nViewDragHelpercreate()create()\n\n```\n/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, Callback cb) {\n    return new ViewDragHelper(forParent.getContext(), forParent, cb);\n}\n```\n\ncreate()ViewGroupViewcreate()ViewDragHelper\n\n```\n/**\n * Apps should use ViewDragHelper.create() to get a new instance.\n * This will allow VDH to use internal compatibility implementations for different\n * platform versions.\n *\n * @param context Context to initialize config-dependent params from\n * @param forParent Parent view to monitor\n */\nprivate ViewDragHelper(Context context, ViewGroup forParent, Callback cb) {\n    if (forParent == null) {\n        throw new IllegalArgumentException(\"Parent view may not be null\");\n    }\n    if (cb == null) {\n        throw new IllegalArgumentException(\"Callback may not be null\");\n    }\n\n    mParentView = forParent;\n    mCallback = cb;\n\n    final ViewConfiguration vc = ViewConfiguration.get(context);\n    final float density = context.getResources().getDisplayMetrics().density;\n    mEdgeSize = (int) (EDGE_SIZE * density + 0.5f);\n\n    mTouchSlop = vc.getScaledTouchSlop();\n    mMaxVelocity = vc.getScaledMaximumFlingVelocity();\n    mMinVelocity = vc.getScaledMinimumFlingVelocity();\n    mScroller = ScrollerCompat.create(context, sInterpolator);\n}\n```\n\ncreate()ViewDragHelperViewGroup\n\n- mParentViewmCallback\n- ViewConfigurationView\n- mEdgeSizemEdgeSize20dpxmParentView.getLeft() + mEdgeSize20dpViewDragHelpergetEdgesTouched()\n- mTouchSlopmTouchSlop\n- mMaxVelocitymMinVelocityfling\n- mScrollerView\n  - [Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)\n  - [AndroidScroller](http://www.cnblogs.com/supersugar/archive/2012/08/13/2636691.html)\n\ncreate()\n\n```\n/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param sensitivity Multiplier for how sensitive the helper should be about detecting\n *                    the start of a drag. Larger values are more sensitive. 1.0f is normal.\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, float sensitivity, Callback cb) {\n    final ViewDragHelper helper = create(forParent, cb);\n    helper.mTouchSlop = (int) (helper.mTouchSlop * (1 / sensitivity));\n    return helper;\n}\n```\n\nsensitivitymTouchSlopsensitivitymTouchSlopsensitivity120dpsensitivity210dp\n\n#### Touch\n\nmParentViewViewGroupmParentViewonInterceptTouchEvent(MotionEvent ev)shouldInterceptTouchEvent(MotionEvent ev) ACTION_DOWN\n\n```\n/**\n * Check if this event as provided to the parent view's onInterceptTouchEvent should\n * cause the parent to intercept the touch event stream.\n *\n * @param ev MotionEvent provided to onInterceptTouchEvent\n * @return true if the parent view should return true from onInterceptTouchEvent\n */\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn't get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            saveInitialMotion(x, y, pointerId);\n\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView && mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched & mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched & mTrackingEdges, pointerId);\n            }\n            break;\n        }\n\n        // case\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\n9~21MotionEventactionIndexACTION_POINTER_DOWN [android,MotionEvent()](http://my.oschina.net/banxi/blog/56421)\n\nmVelocityTrackerACTION_DOWNcancel()cancel()mVelocityTrackermVelocityTracker ACTION_DOWNACTION_UPACTION_DOWN\n\n24~42case MotionEvent.ACTION_DOWNsaveInitialMotion(x, y, pointerId)ACTION_DOWNxypointerIdmParentViewfindTopChildUnder((int) x, (int) y);ViewfindTopChildUnder \n\n```\n/**\n * Find the topmost child under the given point within the parent view's coordinate system.\n * The child order is determined using {@link Callback#getOrderedChildIndex(int)}.\n *\n * @param x X position to test in the parent's coordinate system\n * @param y Y position to test in the parent's coordinate system\n * @return The topmost child view under (x, y) or null if none found.\n */\npublic View findTopChildUnder(int x, int y) {\n    final int childCount = mParentView.getChildCount();\n    for (int i = childCount - 1; i >= 0; i--) {\n        final View child = mParentView.getChildAt(mCallback.getOrderedChildIndex(i));\n        if (x >= child.getLeft() && x < child.getRight() &&\n                y >= child.getTop() && y < child.getBottom()) {\n            return child;\n        }\n    }\n    return null;\n}\n```\n\nViewViewCallbackgetOrderedChildIndex(int index)ViewtopViewViewindex4bottomViewViewindex3getOrderedChildIndex()indextopViewbottomView\n\n```\npublic int getOrderedChildIndex(int index) {\n    int indexTop = mParentView.indexOfChild(topView);\n    int indexBottom = mParentView.indexOfChild(bottomView);\n    if (index == indexTop) {\n        return indexBottom;\n    }\n    return index;\n}\n```\n\n32~35mDragState\n\n1. STATE_IDLEView\n2. STATE_DRAGGINGView\n3. STATE_SETTLINGView\n   mCapturedViewnullmDragStateSTATE_SETTLINGtryCaptureViewForDrag()\n\n37~40Callback.onEdgeTouchedmParentViewmInitialEdgesTouchedsaveInitialMotion\n\nACTION_DOWN switchreturn mDragState == STATE_DRAGGING;ACTION_DOWNmDragStateSTATE_IDLEfalse\n\nfalse[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)mParentViewViewTouchViewViewdispatchTouchEvent()dispatchTouchEventonTouchEvent()\n\n- ViewViewdispatchTouchEvent()falsemParentViewsuper.dispatchTouchEvent(ev)ViewdispatchTouchEvent(ev)mParentViewonTouchEvent()ViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UPACTION_DOWNtruefalseprocessTouchEvent()ACTION_MOVEtruemParentViewonInterceptTouchEvent()ACTION_MOVEACTION_UP\n- ViewACTION_DOWNmParentViewonTouchEvent()ACTION_DOWNViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNViewrequestDisallowInterceptTouchEvent(true)mParentViewonInterceptTouchEvent()ACTION_MOVEtrueACTION_MOVEprocessTouchEvent()ACTION_MOVEonInterceptTouchEvent()ACTION_MOVE\n\n\n\nViewprocessTouchEvent(MotionEvent ev)ACTION_DOWN\n\n```\n/**\n * Process a touch event received by the parent view. This method will dispatch callback events\n * as needed before returning. The parent view's onTouchEvent implementation should call this.\n *\n * @param ev The touch event received by the parent view\n */\npublic void processTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn't get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            saveInitialMotion(x, y, pointerId);\n\n            // Since the parent is already directly processing this touch event,\n            // there is no reason to delay for a slop before dragging.\n            // Start immediately if possible.\n            tryCaptureViewForDrag(toCapture, pointerId);\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched & mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched & mTrackingEdges, pointerId);\n            }\n            break;\n        }\n        // case\n    }\n}\n```\n\nshouldInterceptTouchEvent()ACTION_DOWNtryCaptureViewForDrag()\n\n```\n/**\n * Attempt to capture the view with the given pointer ID. The callback will be involved.\n * This will put us into the \"dragging\" state. If we've already captured this view with\n * this pointer this method will immediately return true without consulting the callback.\n *\n * @param toCapture View to capture\n * @param pointerId Pointer to capture with\n * @return true if capture was successful\n */\nboolean tryCaptureViewForDrag(View toCapture, int pointerId) {\n    if (toCapture == mCapturedView && mActivePointerId == pointerId) {\n        // Already done!\n        return true;\n    }\n    if (toCapture != null && mCallback.tryCaptureView(toCapture, pointerId)) {\n        mActivePointerId = pointerId;\n        captureChildView(toCapture, pointerId);\n        return true;\n    }\n    return false;\n}\n```\n\nCallbacktryCaptureView(View child, int pointerId)ViewtryCaptureView()ViewViewtryCaptureView()trueViewDragHelperViewcaptureChildView(toCapture, pointerId)\n\n```\n/**\n * Capture a specific child view for dragging within the parent. The callback will be notified\n * but {@link Callback#tryCaptureView(android.view.View, int)} will not be asked permission to\n * capture this view.\n *\n * @param childView Child view to capture\n * @param activePointerId ID of the pointer that is dragging the captured child view\n */\npublic void captureChildView(View childView, int activePointerId) {\n    if (childView.getParent() != mParentView) {\n        throw new IllegalArgumentException(\"captureChildView: parameter must be a descendant \" +\n                \"of the ViewDragHelper's tracked parent view (\" + mParentView + \")\");\n    }\n\n    mCapturedView = childView;\n    mActivePointerId = activePointerId;\n    mCallback.onViewCaptured(childView, activePointerId);\n    setDragState(STATE_DRAGGING);\n}\n```\n\ncaptureChildView(toCapture, pointerId)ViewCallbackonViewCaptured(childView, activePointerId)ViewsetDragState()STATE_DRAGGINGsetDragState()\n\n```\nvoid setDragState(int state) {\n    if (mDragState != state) {\n        mDragState = state;\n        mCallback.onViewDragStateChanged(state);\n        if (mDragState == STATE_IDLE) {\n            mCapturedView = null;\n        }\n    }\n}\n```\n\nCallbackonViewDragStateChanged()\n\nACTION_DOWNmParentViewonTouchEvent()trueACTION_MOVE\n\n```\npublic void processTouchEvent(MotionEvent ev) {\n\n    switch (action) {\n        // case...\n        \n        case MotionEvent.ACTION_MOVE: {\n            if (mDragState == STATE_DRAGGING) {\n                final int index = MotionEventCompat.findPointerIndex(ev, mActivePointerId);\n                final float x = MotionEventCompat.getX(ev, index);\n                final float y = MotionEventCompat.getY(ev, index);\n                final int idx = (int) (x - mLastMotionX[mActivePointerId]);\n                final int idy = (int) (y - mLastMotionY[mActivePointerId]);\n\n                dragTo(mCapturedView.getLeft() + idx, mCapturedView.getTop() + idy, idx, idy);\n\n                saveLastMotion(ev);\n            } else {\n                // Check to see if any pointer is now over a draggable view.\n                final int pointerCount = MotionEventCompat.getPointerCount(ev);\n                for (int i = 0; i < pointerCount; i++) {\n                    final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                    final float x = MotionEventCompat.getX(ev, i);\n                    final float y = MotionEventCompat.getY(ev, i);\n                    final float dx = x - mInitialMotionX[pointerId];\n                    final float dy = y - mInitialMotionY[pointerId];\n\n                    reportNewEdgeDrags(dx, dy, pointerId);\n                    if (mDragState == STATE_DRAGGING) {\n                        // Callback might have started an edge drag.\n                        break;\n                    }\n\n                    final View toCapture = findTopChildUnder((int) x, (int) y);\n                    if (checkTouchSlop(toCapture, dx, dy) &&\n                            tryCaptureViewForDrag(toCapture, pointerId)) {\n                        break;\n                    }\n                }\n                saveLastMotion(ev);\n            }\n            break;\n        }\n\n        // case...\n    }\n}\n```\n\nmDragStateSTATE_DRAGGINGsetDragState(STATE_DRAGGING)tryCaptureViewForDrag()ACTION_DOWNtryCaptureViewForDrag()\nACTION_DOWNViewifmDragStateSTATE_IDLEelseViewmDragStateSTATE_DRAGGINGifCallbackreportNewEdgeDrags()checkTouchSlop()reportNewEdgeDrags()\n\n```\nprivate void reportNewEdgeDrags(float dx, float dy, int pointerId) {\n    int dragsStarted = 0;\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)) {\n        dragsStarted |= EDGE_LEFT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_TOP)) {\n        dragsStarted |= EDGE_TOP;\n    }\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_RIGHT)) {\n        dragsStarted |= EDGE_RIGHT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_BOTTOM)) {\n        dragsStarted |= EDGE_BOTTOM;\n    }\n\n    if (dragsStarted != 0) {\n        mEdgeDragsInProgress[pointerId] |= dragsStarted;\n        mCallback.onEdgeDragStarted(dragsStarted, pointerId);\n    }\n}\n```\n\nmEdgeDragsInProgressCallbackonEdgeDragStarted(int edgeFlags, int pointerId)reportNewEdgeDrags()processTouchEvent()ACTION_MOVEmCallback.onEdgeDragStarted(dragsStarted, pointerId)checkNewEdgeDrag()\n\n```\nprivate boolean checkNewEdgeDrag(float delta, float odelta, int pointerId, int edge) {\n    final float absDelta = Math.abs(delta);\n    final float absODelta = Math.abs(odelta);\n\n    if ((mInitialEdgesTouched[pointerId] & edge) != edge  || (mTrackingEdges & edge) == 0 ||\n            (mEdgeDragsLocked[pointerId] & edge) == edge ||\n            (mEdgeDragsInProgress[pointerId] & edge) == edge ||\n            (absDelta <= mTouchSlop && absODelta <= mTouchSlop)) {\n        return false;\n    }\n    if (absDelta < absODelta * 0.5f && mCallback.onEdgeLock(edge)) {\n        mEdgeDragsLocked[pointerId] |= edge;\n        return false;\n    }\n    return (mEdgeDragsInProgress[pointerId] & edge) == 0 && absDelta > mTouchSlop;\n}\n```\n\n- checkNewEdgeDrag()trueedge\n- deltaodeltaodeltaooppositereportNewEdgeDrags()checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)xdeltadxodeltadydeltaodelta\n- mInitialEdgesTouchedACTION_DOWNsaveInitialMotion()ACTION_DOWNmInitialEdgesTouchedACTION_DOWNedgefalse\n- mTrackingEdgessetEdgeTrackingEnabled(int edgeFlags)setEdgeTrackingEnabled(int edgeFlags)false\n- mEdgeDragsLockedViewDragHelper1206mEdgeDragsLocked[pointerId] & edge) == edgefalse1114absDelta < absODelta * 0.5fCallbackonEdgeLock(edge)mEdgeDragsInProgressCallbackonEdgeDragStarted()mEdgeDragsLocked66edgefalse\n- 7(mEdgeDragsInProgress[pointerId] & edge) == edgemEdgeDragsInProgressedgefalse\n- 8(absDelta <= mTouchSlop && absODelta <= mTouchSlop)\n- edgereportNewEdgeDragsmCallback.onEdgeDragStarted(dragsStarted, pointerId)\n\ncheckTouchSlop()\n\n```\n/**\n * Check if we've crossed a reasonable touch slop for the given child view.\n * If the child cannot be dragged along the horizontal or vertical axis, motion\n * along that axis will not count toward the slop check.\n *\n * @param child Child to check\n * @param dx Motion since initial position along X axis\n * @param dy Motion since initial position along Y axis\n * @return true if the touch slop has been crossed\n */\nprivate boolean checkTouchSlop(View child, float dx, float dy) {\n    if (child == null) {\n        return false;\n    }\n    final boolean checkHorizontal = mCallback.getViewHorizontalDragRange(child) > 0;\n    final boolean checkVertical = mCallback.getViewVerticalDragRange(child) > 0;\n\n    if (checkHorizontal && checkVertical) {\n        return dx * dx + dy * dy > mTouchSlop * mTouchSlop;\n    } else if (checkHorizontal) {\n        return Math.abs(dx) > mTouchSlop;\n    } else if (checkVertical) {\n        return Math.abs(dy) > mTouchSlop;\n    }\n    return false;\n}\n```\n\nmTouchSlopdxdyACTION_DOWNCallbackgetViewHorizontalDragRange(child)getViewVerticalDragRange(child)0View0processTouchEvent()ACTION_MOVEtryCaptureViewForDrag()View\n\nprocessTouchEvent()ACTION_MOVEViewCallbacktryCaptureViewForDrag()ViewACTION_MOVEifdragTo()mCaptureViewdragTo()\n\n```\nprivate void dragTo(int left, int top, int dx, int dy) {\n    int clampedX = left;\n    int clampedY = top;\n    final int oldLeft = mCapturedView.getLeft();\n    final int oldTop = mCapturedView.getTop();\n    if (dx != 0) {\n        clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx);\n        mCapturedView.offsetLeftAndRight(clampedX - oldLeft);\n    }\n    if (dy != 0) {\n        clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy);\n        mCapturedView.offsetTopAndBottom(clampedY - oldTop);\n    }\n\n    if (dx != 0 || dy != 0) {\n        final int clampedDx = clampedX - oldLeft;\n        final int clampedDy = clampedY - oldTop;\n        mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY,\n                clampedDx, clampedDy);\n    }\n}\n```\n\ndxdyACTION_MOVElefttopmCapturedView.getLeft() + dx, mCapturedView.getTop() + dyViewgetLeft()[Android ViewgetLeft, getRight, getTop, getBottom](http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html)\n\noffsetLeftAndRight()offsetTopAndBottom()mCapturedViewViewViewmLeftmRightmTopmBottomViewViewmCapturedViewlayout(int l, int t, int r, int b)View\n\nCallbackclampViewPositionHorizontal()clampViewPositionVertical()clampViewPositionHorizontal(View child, int left, int dx)child.getLeft()clampedX - oldLeft0mCapturedView.offsetLeftAndRight(clampedX - oldLeft)\n\nCallbackonViewPositionChanged(mCapturedView, clampedX, clampedY,clampedDx, clampedDy)ViewclampedXclampedYclampedDx clampedDy\n\nACTION_MOVEACTION_UPACTION_MOVEmParentViewViewACTION_CANCEL\n\n```\npublic void processTouchEvent(MotionEvent ev) {\n    // \n\n    switch (action) {\n        // case\n\n        case MotionEvent.ACTION_UP: {\n            if (mDragState == STATE_DRAGGING) {\n                releaseViewForPointerUp();\n            }\n            cancel();\n            break;\n        }\n\n        case MotionEvent.ACTION_CANCEL: {\n            if (mDragState == STATE_DRAGGING) {\n                dispatchViewReleased(0, 0);\n            }\n            cancel();\n            break;\n        }\n    }\n}\n```\n\nViewreleaseViewForPointerUp()dispatchViewReleased()\n\n```\nprivate void releaseViewForPointerUp() {\n    mVelocityTracker.computeCurrentVelocity(1000, mMaxVelocity);\n    final float xvel = clampMag(\n            VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    final float yvel = clampMag(\n            VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    dispatchViewReleased(xvel, yvel);\n}\n```\n\nreleaseViewForPointerUp()dispatchViewReleased()processTouchEvent()mVelocityTrackerdispatchViewReleased()\n\n```\n/**\n * Like all callback events this must happen on the UI thread, but release\n * involves some extra semantics. During a release (mReleaseInProgress)\n * is the only time it is valid to call {@link #settleCapturedViewAt(int, int)}\n * or {@link #flingCapturedView(int, int, int, int)}.\n */\nprivate void dispatchViewReleased(float xvel, float yvel) {\n    mReleaseInProgress = true;\n    mCallback.onViewReleased(mCapturedView, xvel, yvel);\n    mReleaseInProgress = false;\n\n    if (mDragState == STATE_DRAGGING) {\n        // onViewReleased didn't call a method that would have changed this. Go idle.\n        setDragState(STATE_IDLE);\n    }\n}\n```\n\nCallbackonViewReleased(mCapturedView, xvel, yvel)ViewonViewReleased()mReleaseInProgressViewDragHelpersettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()\n\nfling\nflingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)ViewflingflingViewflingflingCapturedViewint minLeft, int minTop, int maxLeft, int maxTopViewsettleCapturedViewAt(int finalLeft, int finalTop)\n\nsettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()\n\n```\n/**\n * Settle the captured view at the given (left, top) position.\n * The appropriate velocity from prior motion will be taken into account.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * @param finalLeft Settled left edge position for the captured view\n * @param finalTop Settled top edge position for the captured view\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean settleCapturedViewAt(int finalLeft, int finalTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(\"Cannot settleCapturedViewAt outside of a call to \" +\n                \"Callback#onViewReleased\");\n    }\n\n    return forceSettleCapturedViewAt(finalLeft, finalTop,\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId));\n}\n\n/**\n * Settle the captured view based on standard free-moving fling behavior.\n * The caller should invoke {@link #continueSettling(boolean)} on each subsequent frame\n * to continue the motion until it returns false.\n *\n * @param minLeft Minimum X position for the view's left edge\n * @param minTop Minimum Y position for the view's top edge\n * @param maxLeft Maximum X position for the view's left edge\n * @param maxTop Maximum Y position for the view's top edge\n */\npublic void flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(\"Cannot flingCapturedView outside of a call to \" +\n                \"Callback#onViewReleased\");\n    }\n\n    mScroller.fling(mCapturedView.getLeft(), mCapturedView.getTop(),\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            minLeft, maxLeft, minTop, maxTop);\n\n    setDragState(STATE_SETTLING);\n}\n```\n\nmReleaseInProgressfalsefalseIllegalStateExceptionmReleaseInProgresstruedispatchViewReleased()onViewReleased()\n\nScroller[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207) Scroller\n\nViewDragHelperViewsmoothSlideViewTo(View child, int finalLeft, int finalTop)\n\n```\n/**\n * Animate the view <code>child</code> to the given (left, top) position.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * <p>This operation does not count as a capture event, though {@link #getCapturedView()}\n * will still report the sliding view while the slide is in progress.</p>\n *\n * @param child Child view to capture and animate\n * @param finalLeft Final left position of child\n * @param finalTop Final top position of child\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean smoothSlideViewTo(View child, int finalLeft, int finalTop) {\n    mCapturedView = child;\n    mActivePointerId = INVALID_POINTER;\n\n    boolean continueSliding = forceSettleCapturedViewAt(finalLeft, finalTop, 0, 0);\n    if (!continueSliding && mDragState == STATE_IDLE && mCapturedView != null) {\n        // If we're in an IDLE state to begin with and aren't moving anywhere, we\n        // end up having a non-null capturedView with an IDLE dragState\n        mCapturedView = null;\n    }\n\n    return continueSliding;\n}\n```\n\nmReleaseInProgresssettleCapturedViewAt()forceSettleCapturedViewAt()settleCapturedViewAt()ViewsmoothSlideViewTo()0forceSettleCapturedViewAt()Callback\n\n```\n/**\n * Settle the captured view at the given (left, top) position.\n *\n * @param finalLeft Target left position for the captured view\n * @param finalTop Target top position for the captured view\n * @param xvel Horizontal velocity\n * @param yvel Vertical velocity\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\nprivate boolean forceSettleCapturedViewAt(int finalLeft, int finalTop, int xvel, int yvel) {\n    final int startLeft = mCapturedView.getLeft();\n    final int startTop = mCapturedView.getTop();\n    final int dx = finalLeft - startLeft;\n    final int dy = finalTop - startTop;\n\n    if (dx == 0 && dy == 0) {\n        // Nothing to do. Send callbacks, be done.\n        mScroller.abortAnimation();\n        setDragState(STATE_IDLE);\n        return false;\n    }\n\n    final int duration = computeSettleDuration(mCapturedView, dx, dy, xvel, yvel);\n    mScroller.startScroll(startLeft, startTop, dx, dy, duration);\n\n    setDragState(STATE_SETTLING);\n    return true;\n}\n```\n\nScrollmScroller.startScroll()computeSettleDuration()\n\n```\nprivate int computeSettleDuration(View child, int dx, int dy, int xvel, int yvel) {\n    xvel = clampMag(xvel, (int) mMinVelocity, (int) mMaxVelocity);\n    yvel = clampMag(yvel, (int) mMinVelocity, (int) mMaxVelocity);\n    final int absDx = Math.abs(dx);\n    final int absDy = Math.abs(dy);\n    final int absXVel = Math.abs(xvel);\n    final int absYVel = Math.abs(yvel);\n    final int addedVel = absXVel + absYVel;\n    final int addedDistance = absDx + absDy;\n\n    final float xweight = xvel != 0 ? (float) absXVel / addedVel :\n            (float) absDx / addedDistance;\n    final float yweight = yvel != 0 ? (float) absYVel / addedVel :\n            (float) absDy / addedDistance;\n\n    int xduration = computeAxisDuration(dx, xvel, mCallback.getViewHorizontalDragRange(child));\n    int yduration = computeAxisDuration(dy, yvel, mCallback.getViewVerticalDragRange(child));\n\n    return (int) (xduration * xweight + yduration * yweight);\n}\n```\n\nclampMag()computeAxisDuration()dxxvelmCallback.getViewHorizontalDragRange()computeAxisDuration()\n\n```\nprivate int computeAxisDuration(int delta, int velocity, int motionRange) {\n    if (delta == 0) {\n        return 0;\n    }\n\n    final int width = mParentView.getWidth();\n    final int halfWidth = width / 2;\n    final float distanceRatio = Math.min(1f, (float) Math.abs(delta) / width);\n    final float distance = halfWidth + halfWidth *\n            distanceInfluenceForSnapDuration(distanceRatio);\n\n    int duration;\n    velocity = Math.abs(velocity);\n    if (velocity > 0) {\n        duration = 4 * Math.round(1000 * Math.abs(distance / velocity));\n    } else {\n        final float range = (float) Math.abs(delta) / motionRange;\n        duration = (int) ((range + 1) * BASE_SETTLE_DURATION);\n    }\n    return Math.min(duration, MAX_SETTLE_DURATION);\n}\n```\n\n6~1014~19velocity0velocity0deltamotionRangeCallbackgetViewHorizontalDragRange()getViewVerticalDragRange()MAX_SETTLE_DURATION600CallbackgetViewHorizontalDragRange()getViewVerticalDragRange()\n\nsettleCapturedViewAt()flingCapturedView()smoothSlideViewTo()mParentViewcomputeScroll()\n\n```\n@Override\npublic void computeScroll() {\n    if (mDragHelper.continueSettling(true)) {\n        ViewCompat.postInvalidateOnAnimation(this);\n    }\n}\n```\n\nScroll[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)  computeScroll(\n\nViewDragHelpershouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWN\n\nshouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWNmParentViewonInterceptTouchEvent()ACTION_MOVE[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)ViewDragHelpershouldInterceptTouchEvent()ACTION_MOVE\n\n```\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n    \n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            // First to cross a touch slop over a draggable view wins. Also report edge drags.\n            final int pointerCount = MotionEventCompat.getPointerCount(ev);\n            for (int i = 0; i < pointerCount; i++) {\n                final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                final float x = MotionEventCompat.getX(ev, i);\n                final float y = MotionEventCompat.getY(ev, i);\n                final float dx = x - mInitialMotionX[pointerId];\n                final float dy = y - mInitialMotionY[pointerId];\n\n                final View toCapture = findTopChildUnder((int) x, (int) y);\n                final boolean pastSlop = toCapture != null && checkTouchSlop(toCapture, dx, dy);\n                if (pastSlop) {\n                    // check the callback's\n                    // getView[Horizontal|Vertical]DragRange methods to know\n                    // if you can move at all along an axis, then see if it\n                    // would clamp to the same value. If you can't move at\n                    // all in every dimension with a nonzero range, bail.\n                    final int oldLeft = toCapture.getLeft();\n                    final int targetLeft = oldLeft + (int) dx;\n                    final int newLeft = mCallback.clampViewPositionHorizontal(toCapture,\n                            targetLeft, (int) dx);\n                    final int oldTop = toCapture.getTop();\n                    final int targetTop = oldTop + (int) dy;\n                    final int newTop = mCallback.clampViewPositionVertical(toCapture, targetTop,\n                            (int) dy);\n                    final int horizontalDragRange = mCallback.getViewHorizontalDragRange(\n                            toCapture);\n                    final int verticalDragRange = mCallback.getViewVerticalDragRange(toCapture);\n                    if ((horizontalDragRange == 0 || horizontalDragRange > 0\n                            && newLeft == oldLeft) && (verticalDragRange == 0\n                            || verticalDragRange > 0 && newTop == oldTop)) {\n                        break;\n                    }\n                }\n                reportNewEdgeDrags(dx, dy, pointerId);\n                if (mDragState == STATE_DRAGGING) {\n                    // Callback might have started an edge drag\n                    break;\n                }\n\n                if (pastSlop && tryCaptureViewForDrag(toCapture, pointerId)) {\n                    break;\n                }\n            }\n            saveLastMotion(ev);\n            break;\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\nViewfindTopChildUnder(int x, int y)ViewcheckTouchSlop(View child, float dx, float dy)ACTION_DOWNmTouchSlopView\n19~41if (pastSlop){...}getView[Horizontal|Vertical]DragRangeclampViewPosition[Horizontal|Vertical]getView[Horizontal|Vertical]DragRange0clampViewPosition[Horizontal|Vertical]View39breaktryCaptureViewForDrag()View\ntryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()mParentViewprocessTouchEvent()ACTION_MOVE\n\nshouldInterceptTouchEvent()ACTION_DOWN\n\n```\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n    \n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_DOWN: {\n            // ...\n            \n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView && mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n            \n            // ...\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\nViewtryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()processTouchEvent()ACTION_DOWNACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UP\n\nViewDragHelpershouldInterceptTouchEvent()processTouchEvent()ACTION_POINTER_DOWNACTION_POINTER_UP\n\n### \n\n\n\n- [](http://www.processon.com/view/link/5550a7bae4b09739f465ec64)\n- [](http://www.processon.com/view/link/5550d3dce4b09739f46789bd)\n\n~\n\n\n\n- settleCapturedViewAt(int finalLeft, int finalTop)\n  ViewCallbackonViewReleased()\n- flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)\n  ViewflingCallbackonViewReleased()\n- smoothSlideViewTo(View child, int finalLeft, int finalTop)\n  View0\n\nCallback\n\n- void onViewDragStateChanged(int state)\n\n  stateSTATE_IDLESTATE_DRAGGINGSTATE_SETTLING\n\n  setDragState()setDragState()\n\n  - tryCaptureViewForDrag()View\n    - shouldInterceptTouchEvent()ACTION_DOWN\n    - shouldInterceptTouchEvent()ACTION_MOVE\n    - processTouchEvent()ACTION_MOVE\n  - settleCapturedViewAt()smoothSlideViewTo()flingCapturedView()\n  - ViewprocessTouchEvent()ACTION_UPACTION_CANCEL\n  - continueSettling()\n  - abort()\n\n- void onViewPositionChanged(View changedView, int left, int top, int dx, int dy)\n\n  ViewView\n\n  - dragTo()\n  - continueSettling()\n  - abort()\n\n- void onViewCaptured(View capturedChild, int activePointerId)\n\n  tryCaptureViewForDrag()View\n\n  - shouldInterceptTouchEvent()ACTION_DOWN\n  - shouldInterceptTouchEvent()ACTION_MOVE\n  - processTouchEvent()ACTION_MOVE\n  - captureChildView()\n\n- void onViewReleased(View releasedChild, float xvel, float yvel)\n  ViewprocessTouchEvent()ACTION_UPViewprocessTouchEvent()ACTION_CANCEL\n\n- void onEdgeTouched(int edgeFlags, int pointerId)\n  ACTION_DOWNACTION_POINTER_DOWNedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM\n\n- boolean onEdgeLock(int edgeFlags)\n  trueedgeFlagsonEdgeDragStarted()falseedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM\n\n- void onEdgeDragStarted(int edgeFlags, int pointerId)\n  ACTION_MOVEedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOMcaptureChildView()View\n\n- int getOrderedChildIndex(int index)\n  ViewViewtryCaptureViewForDrag()ViewViewView\n\n- int getViewHorizontalDragRange(View child)int getViewVerticalDragRange(View child)\n\n  child0ACTION_DOWNchild0\n\n  \n\n  - checkTouchSlop()0mTouchSlopACTION_MOVEtryCaptureViewForDrag()checkTouchSlop()checkTouchSlop()View\n  - ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVErange00View\n  - smoothSlideViewTo()getView[Horizontal|Vertical]DragRange0\n\n- boolean tryCaptureView(View child, int pointerId)\n\n  tryCaptureViewForDrag()truechildtryCaptureViewForDrag()\n\n  - shouldInterceptTouchEvent()ACTION_DOWN\n  - shouldInterceptTouchEvent()ACTION_MOVE\n  - processTouchEvent()ACTION_MOVE\n\n- int clampViewPositionHorizontal(View child, int left, int dx)int clampViewPositionVertical(View child, int top, int dy)\n\n  childchildclampViewPositionHorizontal()childleftclampViewPositionVertical()childtop\n\n  \n\n  - dragTo()dragTo()processTouchEvent()ACTION_MOVEView\n  - ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVElefttopView\n\n### \n\nViewDragHelper\n\n1. [YoutubeLayout](https://github.com/flavienlaurent/flavienlaurent.com)Demo\n2. [QQ5.x](https://github.com/BlueMor/DragLayout)[ResideLayout](https://github.com/kyze8439690/ResideLayout)\n3. [SwipeBackLayout](https://github.com/ikew0ng/SwipeBackLayout)[SwipeBack](https://github.com/liuguangqiang/SwipeBack)\n4. [SlidingUpPanel](https://github.com/umano/AndroidSlidingUpPanel)\n5. [DrawerLayout](https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/DrawerLayout.java)\n\n### ViewDragHelper\n\n- [Each Navigation Drawer Hides a ViewDragHelper](http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper)[YoutubeLayout](https://github.com/flavienlaurent/flavienlaurent.com)\n- [ViewDragHelper](http://blog.csdn.net/pi9nc/article/details/39583377)","source":"_posts/ViewDragHelper-source-code.md","raw":"---\nthumbnail: https://raw.githubusercontent.com/Joeljt/BlogImage/master/20190321185255.png\ntitle: ViewDragHelper \ntags: [Android, ]\ndate: 2019-05-13\n---\n\n[](https://www.cnblogs.com/lqstayreal/p/4500219.html)\n\n<!-- more -->\n\n\n\nViewGroupViewViewDragHelperViewNavigation DrawerQQ5.x\n\nViewDragHelperViewDragHelper\n\n### \n\n1. ViewGroupViewDragHelpercreate()ViewDragHelper\n\n2. ViewDragHelper.Callback\n\n   tryCaptureView()clampViewPositionVertical()clampViewPositionHorizontal()getViewHorizontalDragRange()getViewVerticalDragRange()\n\n   - tryCaptureView()ViewViewtruefalse\n   - clampViewPositionVertical()ViewViewViewtopViewtop\n   - clampViewPositionHorizontal()clampViewPositionVertical()Viewleft\n   - getViewVerticalDragRange()0View\n   - getViewHorizontalDragRange()getViewVerticalDragRange()\n\n3. onInterceptTouchEvent()ViewDragHelpershouldInterceptTouchEvent()\n\n4. onTouchEvent()ViewDragHelper()processTouchEvent()ACTION_DOWNViewonTouchEvent()true\n\n5. ViewflingViewGroupcomputeScroll()\n\n   ```\n    @Override\n    public void computeScroll() {\n        if (mDragHelper.continueSettling(true)) {\n            postInvalidate();\n        }\n    }\n   ```\n\n   ViewDragHelper.CallbackonViewReleased()settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()\n\n6. ViewDragHelpersetEdgeTrackingEnabled()ViewDragHelper.CallbackonEdgeDragStarted()captureChildView()View\n\nDemo\n\n### \n\nViewDragHelper[GitHub](https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/ViewDragHelper.java)[GrepCode](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.0.2_r1/android/support/v4/widget/ViewDragHelper.java#ViewDragHelper)\n\n#### \n\n1. View[Android ViewgetLeft, getRight, getTop, getBottom](http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html)\n2. MotionEvent[android,MotionEvent()](http://my.oschina.net/banxi/blog/56421)\n3. Scroller[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)\n4. Touch[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)\n\n#### ViewDragHelper\n\nViewDragHelpercreate()create()\n\n```\n/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, Callback cb) {\n    return new ViewDragHelper(forParent.getContext(), forParent, cb);\n}\n```\n\ncreate()ViewGroupViewcreate()ViewDragHelper\n\n```\n/**\n * Apps should use ViewDragHelper.create() to get a new instance.\n * This will allow VDH to use internal compatibility implementations for different\n * platform versions.\n *\n * @param context Context to initialize config-dependent params from\n * @param forParent Parent view to monitor\n */\nprivate ViewDragHelper(Context context, ViewGroup forParent, Callback cb) {\n    if (forParent == null) {\n        throw new IllegalArgumentException(\"Parent view may not be null\");\n    }\n    if (cb == null) {\n        throw new IllegalArgumentException(\"Callback may not be null\");\n    }\n\n    mParentView = forParent;\n    mCallback = cb;\n\n    final ViewConfiguration vc = ViewConfiguration.get(context);\n    final float density = context.getResources().getDisplayMetrics().density;\n    mEdgeSize = (int) (EDGE_SIZE * density + 0.5f);\n\n    mTouchSlop = vc.getScaledTouchSlop();\n    mMaxVelocity = vc.getScaledMaximumFlingVelocity();\n    mMinVelocity = vc.getScaledMinimumFlingVelocity();\n    mScroller = ScrollerCompat.create(context, sInterpolator);\n}\n```\n\ncreate()ViewDragHelperViewGroup\n\n- mParentViewmCallback\n- ViewConfigurationView\n- mEdgeSizemEdgeSize20dpxmParentView.getLeft() + mEdgeSize20dpViewDragHelpergetEdgesTouched()\n- mTouchSlopmTouchSlop\n- mMaxVelocitymMinVelocityfling\n- mScrollerView\n  - [Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)\n  - [AndroidScroller](http://www.cnblogs.com/supersugar/archive/2012/08/13/2636691.html)\n\ncreate()\n\n```\n/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param sensitivity Multiplier for how sensitive the helper should be about detecting\n *                    the start of a drag. Larger values are more sensitive. 1.0f is normal.\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, float sensitivity, Callback cb) {\n    final ViewDragHelper helper = create(forParent, cb);\n    helper.mTouchSlop = (int) (helper.mTouchSlop * (1 / sensitivity));\n    return helper;\n}\n```\n\nsensitivitymTouchSlopsensitivitymTouchSlopsensitivity120dpsensitivity210dp\n\n#### Touch\n\nmParentViewViewGroupmParentViewonInterceptTouchEvent(MotionEvent ev)shouldInterceptTouchEvent(MotionEvent ev) ACTION_DOWN\n\n```\n/**\n * Check if this event as provided to the parent view's onInterceptTouchEvent should\n * cause the parent to intercept the touch event stream.\n *\n * @param ev MotionEvent provided to onInterceptTouchEvent\n * @return true if the parent view should return true from onInterceptTouchEvent\n */\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn't get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            saveInitialMotion(x, y, pointerId);\n\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView && mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched & mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched & mTrackingEdges, pointerId);\n            }\n            break;\n        }\n\n        // case\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\n9~21MotionEventactionIndexACTION_POINTER_DOWN [android,MotionEvent()](http://my.oschina.net/banxi/blog/56421)\n\nmVelocityTrackerACTION_DOWNcancel()cancel()mVelocityTrackermVelocityTracker ACTION_DOWNACTION_UPACTION_DOWN\n\n24~42case MotionEvent.ACTION_DOWNsaveInitialMotion(x, y, pointerId)ACTION_DOWNxypointerIdmParentViewfindTopChildUnder((int) x, (int) y);ViewfindTopChildUnder \n\n```\n/**\n * Find the topmost child under the given point within the parent view's coordinate system.\n * The child order is determined using {@link Callback#getOrderedChildIndex(int)}.\n *\n * @param x X position to test in the parent's coordinate system\n * @param y Y position to test in the parent's coordinate system\n * @return The topmost child view under (x, y) or null if none found.\n */\npublic View findTopChildUnder(int x, int y) {\n    final int childCount = mParentView.getChildCount();\n    for (int i = childCount - 1; i >= 0; i--) {\n        final View child = mParentView.getChildAt(mCallback.getOrderedChildIndex(i));\n        if (x >= child.getLeft() && x < child.getRight() &&\n                y >= child.getTop() && y < child.getBottom()) {\n            return child;\n        }\n    }\n    return null;\n}\n```\n\nViewViewCallbackgetOrderedChildIndex(int index)ViewtopViewViewindex4bottomViewViewindex3getOrderedChildIndex()indextopViewbottomView\n\n```\npublic int getOrderedChildIndex(int index) {\n    int indexTop = mParentView.indexOfChild(topView);\n    int indexBottom = mParentView.indexOfChild(bottomView);\n    if (index == indexTop) {\n        return indexBottom;\n    }\n    return index;\n}\n```\n\n32~35mDragState\n\n1. STATE_IDLEView\n2. STATE_DRAGGINGView\n3. STATE_SETTLINGView\n   mCapturedViewnullmDragStateSTATE_SETTLINGtryCaptureViewForDrag()\n\n37~40Callback.onEdgeTouchedmParentViewmInitialEdgesTouchedsaveInitialMotion\n\nACTION_DOWN switchreturn mDragState == STATE_DRAGGING;ACTION_DOWNmDragStateSTATE_IDLEfalse\n\nfalse[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)mParentViewViewTouchViewViewdispatchTouchEvent()dispatchTouchEventonTouchEvent()\n\n- ViewViewdispatchTouchEvent()falsemParentViewsuper.dispatchTouchEvent(ev)ViewdispatchTouchEvent(ev)mParentViewonTouchEvent()ViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UPACTION_DOWNtruefalseprocessTouchEvent()ACTION_MOVEtruemParentViewonInterceptTouchEvent()ACTION_MOVEACTION_UP\n- ViewACTION_DOWNmParentViewonTouchEvent()ACTION_DOWNViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNViewrequestDisallowInterceptTouchEvent(true)mParentViewonInterceptTouchEvent()ACTION_MOVEtrueACTION_MOVEprocessTouchEvent()ACTION_MOVEonInterceptTouchEvent()ACTION_MOVE\n\n\n\nViewprocessTouchEvent(MotionEvent ev)ACTION_DOWN\n\n```\n/**\n * Process a touch event received by the parent view. This method will dispatch callback events\n * as needed before returning. The parent view's onTouchEvent implementation should call this.\n *\n * @param ev The touch event received by the parent view\n */\npublic void processTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn't get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            saveInitialMotion(x, y, pointerId);\n\n            // Since the parent is already directly processing this touch event,\n            // there is no reason to delay for a slop before dragging.\n            // Start immediately if possible.\n            tryCaptureViewForDrag(toCapture, pointerId);\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched & mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched & mTrackingEdges, pointerId);\n            }\n            break;\n        }\n        // case\n    }\n}\n```\n\nshouldInterceptTouchEvent()ACTION_DOWNtryCaptureViewForDrag()\n\n```\n/**\n * Attempt to capture the view with the given pointer ID. The callback will be involved.\n * This will put us into the \"dragging\" state. If we've already captured this view with\n * this pointer this method will immediately return true without consulting the callback.\n *\n * @param toCapture View to capture\n * @param pointerId Pointer to capture with\n * @return true if capture was successful\n */\nboolean tryCaptureViewForDrag(View toCapture, int pointerId) {\n    if (toCapture == mCapturedView && mActivePointerId == pointerId) {\n        // Already done!\n        return true;\n    }\n    if (toCapture != null && mCallback.tryCaptureView(toCapture, pointerId)) {\n        mActivePointerId = pointerId;\n        captureChildView(toCapture, pointerId);\n        return true;\n    }\n    return false;\n}\n```\n\nCallbacktryCaptureView(View child, int pointerId)ViewtryCaptureView()ViewViewtryCaptureView()trueViewDragHelperViewcaptureChildView(toCapture, pointerId)\n\n```\n/**\n * Capture a specific child view for dragging within the parent. The callback will be notified\n * but {@link Callback#tryCaptureView(android.view.View, int)} will not be asked permission to\n * capture this view.\n *\n * @param childView Child view to capture\n * @param activePointerId ID of the pointer that is dragging the captured child view\n */\npublic void captureChildView(View childView, int activePointerId) {\n    if (childView.getParent() != mParentView) {\n        throw new IllegalArgumentException(\"captureChildView: parameter must be a descendant \" +\n                \"of the ViewDragHelper's tracked parent view (\" + mParentView + \")\");\n    }\n\n    mCapturedView = childView;\n    mActivePointerId = activePointerId;\n    mCallback.onViewCaptured(childView, activePointerId);\n    setDragState(STATE_DRAGGING);\n}\n```\n\ncaptureChildView(toCapture, pointerId)ViewCallbackonViewCaptured(childView, activePointerId)ViewsetDragState()STATE_DRAGGINGsetDragState()\n\n```\nvoid setDragState(int state) {\n    if (mDragState != state) {\n        mDragState = state;\n        mCallback.onViewDragStateChanged(state);\n        if (mDragState == STATE_IDLE) {\n            mCapturedView = null;\n        }\n    }\n}\n```\n\nCallbackonViewDragStateChanged()\n\nACTION_DOWNmParentViewonTouchEvent()trueACTION_MOVE\n\n```\npublic void processTouchEvent(MotionEvent ev) {\n\n    switch (action) {\n        // case...\n        \n        case MotionEvent.ACTION_MOVE: {\n            if (mDragState == STATE_DRAGGING) {\n                final int index = MotionEventCompat.findPointerIndex(ev, mActivePointerId);\n                final float x = MotionEventCompat.getX(ev, index);\n                final float y = MotionEventCompat.getY(ev, index);\n                final int idx = (int) (x - mLastMotionX[mActivePointerId]);\n                final int idy = (int) (y - mLastMotionY[mActivePointerId]);\n\n                dragTo(mCapturedView.getLeft() + idx, mCapturedView.getTop() + idy, idx, idy);\n\n                saveLastMotion(ev);\n            } else {\n                // Check to see if any pointer is now over a draggable view.\n                final int pointerCount = MotionEventCompat.getPointerCount(ev);\n                for (int i = 0; i < pointerCount; i++) {\n                    final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                    final float x = MotionEventCompat.getX(ev, i);\n                    final float y = MotionEventCompat.getY(ev, i);\n                    final float dx = x - mInitialMotionX[pointerId];\n                    final float dy = y - mInitialMotionY[pointerId];\n\n                    reportNewEdgeDrags(dx, dy, pointerId);\n                    if (mDragState == STATE_DRAGGING) {\n                        // Callback might have started an edge drag.\n                        break;\n                    }\n\n                    final View toCapture = findTopChildUnder((int) x, (int) y);\n                    if (checkTouchSlop(toCapture, dx, dy) &&\n                            tryCaptureViewForDrag(toCapture, pointerId)) {\n                        break;\n                    }\n                }\n                saveLastMotion(ev);\n            }\n            break;\n        }\n\n        // case...\n    }\n}\n```\n\nmDragStateSTATE_DRAGGINGsetDragState(STATE_DRAGGING)tryCaptureViewForDrag()ACTION_DOWNtryCaptureViewForDrag()\nACTION_DOWNViewifmDragStateSTATE_IDLEelseViewmDragStateSTATE_DRAGGINGifCallbackreportNewEdgeDrags()checkTouchSlop()reportNewEdgeDrags()\n\n```\nprivate void reportNewEdgeDrags(float dx, float dy, int pointerId) {\n    int dragsStarted = 0;\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)) {\n        dragsStarted |= EDGE_LEFT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_TOP)) {\n        dragsStarted |= EDGE_TOP;\n    }\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_RIGHT)) {\n        dragsStarted |= EDGE_RIGHT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_BOTTOM)) {\n        dragsStarted |= EDGE_BOTTOM;\n    }\n\n    if (dragsStarted != 0) {\n        mEdgeDragsInProgress[pointerId] |= dragsStarted;\n        mCallback.onEdgeDragStarted(dragsStarted, pointerId);\n    }\n}\n```\n\nmEdgeDragsInProgressCallbackonEdgeDragStarted(int edgeFlags, int pointerId)reportNewEdgeDrags()processTouchEvent()ACTION_MOVEmCallback.onEdgeDragStarted(dragsStarted, pointerId)checkNewEdgeDrag()\n\n```\nprivate boolean checkNewEdgeDrag(float delta, float odelta, int pointerId, int edge) {\n    final float absDelta = Math.abs(delta);\n    final float absODelta = Math.abs(odelta);\n\n    if ((mInitialEdgesTouched[pointerId] & edge) != edge  || (mTrackingEdges & edge) == 0 ||\n            (mEdgeDragsLocked[pointerId] & edge) == edge ||\n            (mEdgeDragsInProgress[pointerId] & edge) == edge ||\n            (absDelta <= mTouchSlop && absODelta <= mTouchSlop)) {\n        return false;\n    }\n    if (absDelta < absODelta * 0.5f && mCallback.onEdgeLock(edge)) {\n        mEdgeDragsLocked[pointerId] |= edge;\n        return false;\n    }\n    return (mEdgeDragsInProgress[pointerId] & edge) == 0 && absDelta > mTouchSlop;\n}\n```\n\n- checkNewEdgeDrag()trueedge\n- deltaodeltaodeltaooppositereportNewEdgeDrags()checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)xdeltadxodeltadydeltaodelta\n- mInitialEdgesTouchedACTION_DOWNsaveInitialMotion()ACTION_DOWNmInitialEdgesTouchedACTION_DOWNedgefalse\n- mTrackingEdgessetEdgeTrackingEnabled(int edgeFlags)setEdgeTrackingEnabled(int edgeFlags)false\n- mEdgeDragsLockedViewDragHelper1206mEdgeDragsLocked[pointerId] & edge) == edgefalse1114absDelta < absODelta * 0.5fCallbackonEdgeLock(edge)mEdgeDragsInProgressCallbackonEdgeDragStarted()mEdgeDragsLocked66edgefalse\n- 7(mEdgeDragsInProgress[pointerId] & edge) == edgemEdgeDragsInProgressedgefalse\n- 8(absDelta <= mTouchSlop && absODelta <= mTouchSlop)\n- edgereportNewEdgeDragsmCallback.onEdgeDragStarted(dragsStarted, pointerId)\n\ncheckTouchSlop()\n\n```\n/**\n * Check if we've crossed a reasonable touch slop for the given child view.\n * If the child cannot be dragged along the horizontal or vertical axis, motion\n * along that axis will not count toward the slop check.\n *\n * @param child Child to check\n * @param dx Motion since initial position along X axis\n * @param dy Motion since initial position along Y axis\n * @return true if the touch slop has been crossed\n */\nprivate boolean checkTouchSlop(View child, float dx, float dy) {\n    if (child == null) {\n        return false;\n    }\n    final boolean checkHorizontal = mCallback.getViewHorizontalDragRange(child) > 0;\n    final boolean checkVertical = mCallback.getViewVerticalDragRange(child) > 0;\n\n    if (checkHorizontal && checkVertical) {\n        return dx * dx + dy * dy > mTouchSlop * mTouchSlop;\n    } else if (checkHorizontal) {\n        return Math.abs(dx) > mTouchSlop;\n    } else if (checkVertical) {\n        return Math.abs(dy) > mTouchSlop;\n    }\n    return false;\n}\n```\n\nmTouchSlopdxdyACTION_DOWNCallbackgetViewHorizontalDragRange(child)getViewVerticalDragRange(child)0View0processTouchEvent()ACTION_MOVEtryCaptureViewForDrag()View\n\nprocessTouchEvent()ACTION_MOVEViewCallbacktryCaptureViewForDrag()ViewACTION_MOVEifdragTo()mCaptureViewdragTo()\n\n```\nprivate void dragTo(int left, int top, int dx, int dy) {\n    int clampedX = left;\n    int clampedY = top;\n    final int oldLeft = mCapturedView.getLeft();\n    final int oldTop = mCapturedView.getTop();\n    if (dx != 0) {\n        clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx);\n        mCapturedView.offsetLeftAndRight(clampedX - oldLeft);\n    }\n    if (dy != 0) {\n        clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy);\n        mCapturedView.offsetTopAndBottom(clampedY - oldTop);\n    }\n\n    if (dx != 0 || dy != 0) {\n        final int clampedDx = clampedX - oldLeft;\n        final int clampedDy = clampedY - oldTop;\n        mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY,\n                clampedDx, clampedDy);\n    }\n}\n```\n\ndxdyACTION_MOVElefttopmCapturedView.getLeft() + dx, mCapturedView.getTop() + dyViewgetLeft()[Android ViewgetLeft, getRight, getTop, getBottom](http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html)\n\noffsetLeftAndRight()offsetTopAndBottom()mCapturedViewViewViewmLeftmRightmTopmBottomViewViewmCapturedViewlayout(int l, int t, int r, int b)View\n\nCallbackclampViewPositionHorizontal()clampViewPositionVertical()clampViewPositionHorizontal(View child, int left, int dx)child.getLeft()clampedX - oldLeft0mCapturedView.offsetLeftAndRight(clampedX - oldLeft)\n\nCallbackonViewPositionChanged(mCapturedView, clampedX, clampedY,clampedDx, clampedDy)ViewclampedXclampedYclampedDx clampedDy\n\nACTION_MOVEACTION_UPACTION_MOVEmParentViewViewACTION_CANCEL\n\n```\npublic void processTouchEvent(MotionEvent ev) {\n    // \n\n    switch (action) {\n        // case\n\n        case MotionEvent.ACTION_UP: {\n            if (mDragState == STATE_DRAGGING) {\n                releaseViewForPointerUp();\n            }\n            cancel();\n            break;\n        }\n\n        case MotionEvent.ACTION_CANCEL: {\n            if (mDragState == STATE_DRAGGING) {\n                dispatchViewReleased(0, 0);\n            }\n            cancel();\n            break;\n        }\n    }\n}\n```\n\nViewreleaseViewForPointerUp()dispatchViewReleased()\n\n```\nprivate void releaseViewForPointerUp() {\n    mVelocityTracker.computeCurrentVelocity(1000, mMaxVelocity);\n    final float xvel = clampMag(\n            VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    final float yvel = clampMag(\n            VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    dispatchViewReleased(xvel, yvel);\n}\n```\n\nreleaseViewForPointerUp()dispatchViewReleased()processTouchEvent()mVelocityTrackerdispatchViewReleased()\n\n```\n/**\n * Like all callback events this must happen on the UI thread, but release\n * involves some extra semantics. During a release (mReleaseInProgress)\n * is the only time it is valid to call {@link #settleCapturedViewAt(int, int)}\n * or {@link #flingCapturedView(int, int, int, int)}.\n */\nprivate void dispatchViewReleased(float xvel, float yvel) {\n    mReleaseInProgress = true;\n    mCallback.onViewReleased(mCapturedView, xvel, yvel);\n    mReleaseInProgress = false;\n\n    if (mDragState == STATE_DRAGGING) {\n        // onViewReleased didn't call a method that would have changed this. Go idle.\n        setDragState(STATE_IDLE);\n    }\n}\n```\n\nCallbackonViewReleased(mCapturedView, xvel, yvel)ViewonViewReleased()mReleaseInProgressViewDragHelpersettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()\n\nfling\nflingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)ViewflingflingViewflingflingCapturedViewint minLeft, int minTop, int maxLeft, int maxTopViewsettleCapturedViewAt(int finalLeft, int finalTop)\n\nsettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()\n\n```\n/**\n * Settle the captured view at the given (left, top) position.\n * The appropriate velocity from prior motion will be taken into account.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * @param finalLeft Settled left edge position for the captured view\n * @param finalTop Settled top edge position for the captured view\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean settleCapturedViewAt(int finalLeft, int finalTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(\"Cannot settleCapturedViewAt outside of a call to \" +\n                \"Callback#onViewReleased\");\n    }\n\n    return forceSettleCapturedViewAt(finalLeft, finalTop,\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId));\n}\n\n/**\n * Settle the captured view based on standard free-moving fling behavior.\n * The caller should invoke {@link #continueSettling(boolean)} on each subsequent frame\n * to continue the motion until it returns false.\n *\n * @param minLeft Minimum X position for the view's left edge\n * @param minTop Minimum Y position for the view's top edge\n * @param maxLeft Maximum X position for the view's left edge\n * @param maxTop Maximum Y position for the view's top edge\n */\npublic void flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(\"Cannot flingCapturedView outside of a call to \" +\n                \"Callback#onViewReleased\");\n    }\n\n    mScroller.fling(mCapturedView.getLeft(), mCapturedView.getTop(),\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            minLeft, maxLeft, minTop, maxTop);\n\n    setDragState(STATE_SETTLING);\n}\n```\n\nmReleaseInProgressfalsefalseIllegalStateExceptionmReleaseInProgresstruedispatchViewReleased()onViewReleased()\n\nScroller[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207) Scroller\n\nViewDragHelperViewsmoothSlideViewTo(View child, int finalLeft, int finalTop)\n\n```\n/**\n * Animate the view <code>child</code> to the given (left, top) position.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * <p>This operation does not count as a capture event, though {@link #getCapturedView()}\n * will still report the sliding view while the slide is in progress.</p>\n *\n * @param child Child view to capture and animate\n * @param finalLeft Final left position of child\n * @param finalTop Final top position of child\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean smoothSlideViewTo(View child, int finalLeft, int finalTop) {\n    mCapturedView = child;\n    mActivePointerId = INVALID_POINTER;\n\n    boolean continueSliding = forceSettleCapturedViewAt(finalLeft, finalTop, 0, 0);\n    if (!continueSliding && mDragState == STATE_IDLE && mCapturedView != null) {\n        // If we're in an IDLE state to begin with and aren't moving anywhere, we\n        // end up having a non-null capturedView with an IDLE dragState\n        mCapturedView = null;\n    }\n\n    return continueSliding;\n}\n```\n\nmReleaseInProgresssettleCapturedViewAt()forceSettleCapturedViewAt()settleCapturedViewAt()ViewsmoothSlideViewTo()0forceSettleCapturedViewAt()Callback\n\n```\n/**\n * Settle the captured view at the given (left, top) position.\n *\n * @param finalLeft Target left position for the captured view\n * @param finalTop Target top position for the captured view\n * @param xvel Horizontal velocity\n * @param yvel Vertical velocity\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\nprivate boolean forceSettleCapturedViewAt(int finalLeft, int finalTop, int xvel, int yvel) {\n    final int startLeft = mCapturedView.getLeft();\n    final int startTop = mCapturedView.getTop();\n    final int dx = finalLeft - startLeft;\n    final int dy = finalTop - startTop;\n\n    if (dx == 0 && dy == 0) {\n        // Nothing to do. Send callbacks, be done.\n        mScroller.abortAnimation();\n        setDragState(STATE_IDLE);\n        return false;\n    }\n\n    final int duration = computeSettleDuration(mCapturedView, dx, dy, xvel, yvel);\n    mScroller.startScroll(startLeft, startTop, dx, dy, duration);\n\n    setDragState(STATE_SETTLING);\n    return true;\n}\n```\n\nScrollmScroller.startScroll()computeSettleDuration()\n\n```\nprivate int computeSettleDuration(View child, int dx, int dy, int xvel, int yvel) {\n    xvel = clampMag(xvel, (int) mMinVelocity, (int) mMaxVelocity);\n    yvel = clampMag(yvel, (int) mMinVelocity, (int) mMaxVelocity);\n    final int absDx = Math.abs(dx);\n    final int absDy = Math.abs(dy);\n    final int absXVel = Math.abs(xvel);\n    final int absYVel = Math.abs(yvel);\n    final int addedVel = absXVel + absYVel;\n    final int addedDistance = absDx + absDy;\n\n    final float xweight = xvel != 0 ? (float) absXVel / addedVel :\n            (float) absDx / addedDistance;\n    final float yweight = yvel != 0 ? (float) absYVel / addedVel :\n            (float) absDy / addedDistance;\n\n    int xduration = computeAxisDuration(dx, xvel, mCallback.getViewHorizontalDragRange(child));\n    int yduration = computeAxisDuration(dy, yvel, mCallback.getViewVerticalDragRange(child));\n\n    return (int) (xduration * xweight + yduration * yweight);\n}\n```\n\nclampMag()computeAxisDuration()dxxvelmCallback.getViewHorizontalDragRange()computeAxisDuration()\n\n```\nprivate int computeAxisDuration(int delta, int velocity, int motionRange) {\n    if (delta == 0) {\n        return 0;\n    }\n\n    final int width = mParentView.getWidth();\n    final int halfWidth = width / 2;\n    final float distanceRatio = Math.min(1f, (float) Math.abs(delta) / width);\n    final float distance = halfWidth + halfWidth *\n            distanceInfluenceForSnapDuration(distanceRatio);\n\n    int duration;\n    velocity = Math.abs(velocity);\n    if (velocity > 0) {\n        duration = 4 * Math.round(1000 * Math.abs(distance / velocity));\n    } else {\n        final float range = (float) Math.abs(delta) / motionRange;\n        duration = (int) ((range + 1) * BASE_SETTLE_DURATION);\n    }\n    return Math.min(duration, MAX_SETTLE_DURATION);\n}\n```\n\n6~1014~19velocity0velocity0deltamotionRangeCallbackgetViewHorizontalDragRange()getViewVerticalDragRange()MAX_SETTLE_DURATION600CallbackgetViewHorizontalDragRange()getViewVerticalDragRange()\n\nsettleCapturedViewAt()flingCapturedView()smoothSlideViewTo()mParentViewcomputeScroll()\n\n```\n@Override\npublic void computeScroll() {\n    if (mDragHelper.continueSettling(true)) {\n        ViewCompat.postInvalidateOnAnimation(this);\n    }\n}\n```\n\nScroll[Android----Scroller](http://blog.csdn.net/qinjuning/article/details/7419207)  computeScroll(\n\nViewDragHelpershouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWN\n\nshouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWNmParentViewonInterceptTouchEvent()ACTION_MOVE[Andriod View,ViewGroupTouch](http://blog.csdn.net/xiaanming/article/details/21696315)ViewDragHelpershouldInterceptTouchEvent()ACTION_MOVE\n\n```\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n    \n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            // First to cross a touch slop over a draggable view wins. Also report edge drags.\n            final int pointerCount = MotionEventCompat.getPointerCount(ev);\n            for (int i = 0; i < pointerCount; i++) {\n                final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                final float x = MotionEventCompat.getX(ev, i);\n                final float y = MotionEventCompat.getY(ev, i);\n                final float dx = x - mInitialMotionX[pointerId];\n                final float dy = y - mInitialMotionY[pointerId];\n\n                final View toCapture = findTopChildUnder((int) x, (int) y);\n                final boolean pastSlop = toCapture != null && checkTouchSlop(toCapture, dx, dy);\n                if (pastSlop) {\n                    // check the callback's\n                    // getView[Horizontal|Vertical]DragRange methods to know\n                    // if you can move at all along an axis, then see if it\n                    // would clamp to the same value. If you can't move at\n                    // all in every dimension with a nonzero range, bail.\n                    final int oldLeft = toCapture.getLeft();\n                    final int targetLeft = oldLeft + (int) dx;\n                    final int newLeft = mCallback.clampViewPositionHorizontal(toCapture,\n                            targetLeft, (int) dx);\n                    final int oldTop = toCapture.getTop();\n                    final int targetTop = oldTop + (int) dy;\n                    final int newTop = mCallback.clampViewPositionVertical(toCapture, targetTop,\n                            (int) dy);\n                    final int horizontalDragRange = mCallback.getViewHorizontalDragRange(\n                            toCapture);\n                    final int verticalDragRange = mCallback.getViewVerticalDragRange(toCapture);\n                    if ((horizontalDragRange == 0 || horizontalDragRange > 0\n                            && newLeft == oldLeft) && (verticalDragRange == 0\n                            || verticalDragRange > 0 && newTop == oldTop)) {\n                        break;\n                    }\n                }\n                reportNewEdgeDrags(dx, dy, pointerId);\n                if (mDragState == STATE_DRAGGING) {\n                    // Callback might have started an edge drag\n                    break;\n                }\n\n                if (pastSlop && tryCaptureViewForDrag(toCapture, pointerId)) {\n                    break;\n                }\n            }\n            saveLastMotion(ev);\n            break;\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\nViewfindTopChildUnder(int x, int y)ViewcheckTouchSlop(View child, float dx, float dy)ACTION_DOWNmTouchSlopView\n19~41if (pastSlop){...}getView[Horizontal|Vertical]DragRangeclampViewPosition[Horizontal|Vertical]getView[Horizontal|Vertical]DragRange0clampViewPosition[Horizontal|Vertical]View39breaktryCaptureViewForDrag()View\ntryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()mParentViewprocessTouchEvent()ACTION_MOVE\n\nshouldInterceptTouchEvent()ACTION_DOWN\n\n```\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n    \n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_DOWN: {\n            // ...\n            \n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView && mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n            \n            // ...\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n```\n\nViewtryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()processTouchEvent()ACTION_DOWNACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UP\n\nViewDragHelpershouldInterceptTouchEvent()processTouchEvent()ACTION_POINTER_DOWNACTION_POINTER_UP\n\n### \n\n\n\n- [](http://www.processon.com/view/link/5550a7bae4b09739f465ec64)\n- [](http://www.processon.com/view/link/5550d3dce4b09739f46789bd)\n\n~\n\n\n\n- settleCapturedViewAt(int finalLeft, int finalTop)\n  ViewCallbackonViewReleased()\n- flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)\n  ViewflingCallbackonViewReleased()\n- smoothSlideViewTo(View child, int finalLeft, int finalTop)\n  View0\n\nCallback\n\n- void onViewDragStateChanged(int state)\n\n  stateSTATE_IDLESTATE_DRAGGINGSTATE_SETTLING\n\n  setDragState()setDragState()\n\n  - tryCaptureViewForDrag()View\n    - shouldInterceptTouchEvent()ACTION_DOWN\n    - shouldInterceptTouchEvent()ACTION_MOVE\n    - processTouchEvent()ACTION_MOVE\n  - settleCapturedViewAt()smoothSlideViewTo()flingCapturedView()\n  - ViewprocessTouchEvent()ACTION_UPACTION_CANCEL\n  - continueSettling()\n  - abort()\n\n- void onViewPositionChanged(View changedView, int left, int top, int dx, int dy)\n\n  ViewView\n\n  - dragTo()\n  - continueSettling()\n  - abort()\n\n- void onViewCaptured(View capturedChild, int activePointerId)\n\n  tryCaptureViewForDrag()View\n\n  - shouldInterceptTouchEvent()ACTION_DOWN\n  - shouldInterceptTouchEvent()ACTION_MOVE\n  - processTouchEvent()ACTION_MOVE\n  - captureChildView()\n\n- void onViewReleased(View releasedChild, float xvel, float yvel)\n  ViewprocessTouchEvent()ACTION_UPViewprocessTouchEvent()ACTION_CANCEL\n\n- void onEdgeTouched(int edgeFlags, int pointerId)\n  ACTION_DOWNACTION_POINTER_DOWNedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM\n\n- boolean onEdgeLock(int edgeFlags)\n  trueedgeFlagsonEdgeDragStarted()falseedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM\n\n- void onEdgeDragStarted(int edgeFlags, int pointerId)\n  ACTION_MOVEedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOMcaptureChildView()View\n\n- int getOrderedChildIndex(int index)\n  ViewViewtryCaptureViewForDrag()ViewViewView\n\n- int getViewHorizontalDragRange(View child)int getViewVerticalDragRange(View child)\n\n  child0ACTION_DOWNchild0\n\n  \n\n  - checkTouchSlop()0mTouchSlopACTION_MOVEtryCaptureViewForDrag()checkTouchSlop()checkTouchSlop()View\n  - ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVErange00View\n  - smoothSlideViewTo()getView[Horizontal|Vertical]DragRange0\n\n- boolean tryCaptureView(View child, int pointerId)\n\n  tryCaptureViewForDrag()truechildtryCaptureViewForDrag()\n\n  - shouldInterceptTouchEvent()ACTION_DOWN\n  - shouldInterceptTouchEvent()ACTION_MOVE\n  - processTouchEvent()ACTION_MOVE\n\n- int clampViewPositionHorizontal(View child, int left, int dx)int clampViewPositionVertical(View child, int top, int dy)\n\n  childchildclampViewPositionHorizontal()childleftclampViewPositionVertical()childtop\n\n  \n\n  - dragTo()dragTo()processTouchEvent()ACTION_MOVEView\n  - ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVElefttopView\n\n### \n\nViewDragHelper\n\n1. [YoutubeLayout](https://github.com/flavienlaurent/flavienlaurent.com)Demo\n2. [QQ5.x](https://github.com/BlueMor/DragLayout)[ResideLayout](https://github.com/kyze8439690/ResideLayout)\n3. [SwipeBackLayout](https://github.com/ikew0ng/SwipeBackLayout)[SwipeBack](https://github.com/liuguangqiang/SwipeBack)\n4. [SlidingUpPanel](https://github.com/umano/AndroidSlidingUpPanel)\n5. [DrawerLayout](https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/DrawerLayout.java)\n\n### ViewDragHelper\n\n- [Each Navigation Drawer Hides a ViewDragHelper](http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper)[YoutubeLayout](https://github.com/flavienlaurent/flavienlaurent.com)\n- [ViewDragHelper](http://blog.csdn.net/pi9nc/article/details/39583377)","slug":"ViewDragHelper-source-code","published":1,"updated":"2019-05-13T12:43:31.980Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2yl86fi0022lh1p3v9rraqn","content":"<p><a href=\"https://www.cnblogs.com/lqstayreal/p/4500219.html\" target=\"_blank\" rel=\"noopener\"></a></p>\n<a id=\"more\"></a>\n<p>ViewGroupViewViewDragHelperViewNavigation DrawerQQ5.x</p>\n<p>ViewDragHelperViewDragHelper</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><p>ViewGroupViewDragHelpercreate()ViewDragHelper</p>\n</li>\n<li><p>ViewDragHelper.Callback</p>\n<p>tryCaptureView()clampViewPositionVertical()clampViewPositionHorizontal()getViewHorizontalDragRange()getViewVerticalDragRange()</p>\n<ul>\n<li>tryCaptureView()ViewViewtruefalse</li>\n<li>clampViewPositionVertical()ViewViewViewtopViewtop</li>\n<li>clampViewPositionHorizontal()clampViewPositionVertical()Viewleft</li>\n<li>getViewVerticalDragRange()0View</li>\n<li>getViewHorizontalDragRange()getViewVerticalDragRange()</li>\n</ul>\n</li>\n<li><p>onInterceptTouchEvent()ViewDragHelpershouldInterceptTouchEvent()</p>\n</li>\n<li><p>onTouchEvent()ViewDragHelper()processTouchEvent()ACTION_DOWNViewonTouchEvent()true</p>\n</li>\n<li><p>ViewflingViewGroupcomputeScroll()</p>\n<pre><code> @Override\n public void computeScroll() {\n     if (mDragHelper.continueSettling(true)) {\n         postInvalidate();\n     }\n }\n</code></pre><p>ViewDragHelper.CallbackonViewReleased()settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()</p>\n</li>\n<li><p>ViewDragHelpersetEdgeTrackingEnabled()ViewDragHelper.CallbackonEdgeDragStarted()captureChildView()View</p>\n</li>\n</ol>\n<p>Demo</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ViewDragHelper<a href=\"https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/ViewDragHelper.java\" target=\"_blank\" rel=\"noopener\">GitHub</a><a href=\"http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.0.2_r1/android/support/v4/widget/ViewDragHelper.java#ViewDragHelper\" target=\"_blank\" rel=\"noopener\">GrepCode</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ol>\n<li>View<a href=\"http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html\" target=\"_blank\" rel=\"noopener\">Android ViewgetLeft, getRight, getTop, getBottom</a></li>\n<li>MotionEvent<a href=\"http://my.oschina.net/banxi/blog/56421\" target=\"_blank\" rel=\"noopener\">android,MotionEvent()</a></li>\n<li>Scroller<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a></li>\n<li>Touch<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a></li>\n</ol>\n<h4 id=\"ViewDragHelper\"><a href=\"#ViewDragHelper\" class=\"headerlink\" title=\"ViewDragHelper\"></a>ViewDragHelper</h4><p>ViewDragHelpercreate()create()</p>\n<pre><code>/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, Callback cb) {\n    return new ViewDragHelper(forParent.getContext(), forParent, cb);\n}\n</code></pre><p>create()ViewGroupViewcreate()ViewDragHelper</p>\n<pre><code>/**\n * Apps should use ViewDragHelper.create() to get a new instance.\n * This will allow VDH to use internal compatibility implementations for different\n * platform versions.\n *\n * @param context Context to initialize config-dependent params from\n * @param forParent Parent view to monitor\n */\nprivate ViewDragHelper(Context context, ViewGroup forParent, Callback cb) {\n    if (forParent == null) {\n        throw new IllegalArgumentException(&quot;Parent view may not be null&quot;);\n    }\n    if (cb == null) {\n        throw new IllegalArgumentException(&quot;Callback may not be null&quot;);\n    }\n\n    mParentView = forParent;\n    mCallback = cb;\n\n    final ViewConfiguration vc = ViewConfiguration.get(context);\n    final float density = context.getResources().getDisplayMetrics().density;\n    mEdgeSize = (int) (EDGE_SIZE * density + 0.5f);\n\n    mTouchSlop = vc.getScaledTouchSlop();\n    mMaxVelocity = vc.getScaledMaximumFlingVelocity();\n    mMinVelocity = vc.getScaledMinimumFlingVelocity();\n    mScroller = ScrollerCompat.create(context, sInterpolator);\n}\n</code></pre><p>create()ViewDragHelperViewGroup</p>\n<ul>\n<li>mParentViewmCallback</li>\n<li>ViewConfigurationView</li>\n<li>mEdgeSizemEdgeSize20dpxmParentView.getLeft() + mEdgeSize20dpViewDragHelpergetEdgesTouched()</li>\n<li>mTouchSlopmTouchSlop</li>\n<li>mMaxVelocitymMinVelocityfling</li>\n<li>mScrollerView<ul>\n<li><a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a></li>\n<li><a href=\"http://www.cnblogs.com/supersugar/archive/2012/08/13/2636691.html\" target=\"_blank\" rel=\"noopener\">AndroidScroller</a></li>\n</ul>\n</li>\n</ul>\n<p>create()</p>\n<pre><code>/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param sensitivity Multiplier for how sensitive the helper should be about detecting\n *                    the start of a drag. Larger values are more sensitive. 1.0f is normal.\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, float sensitivity, Callback cb) {\n    final ViewDragHelper helper = create(forParent, cb);\n    helper.mTouchSlop = (int) (helper.mTouchSlop * (1 / sensitivity));\n    return helper;\n}\n</code></pre><p>sensitivitymTouchSlopsensitivitymTouchSlopsensitivity120dpsensitivity210dp</p>\n<h4 id=\"Touch\"><a href=\"#Touch\" class=\"headerlink\" title=\"Touch\"></a>Touch</h4><p>mParentViewViewGroupmParentViewonInterceptTouchEvent(MotionEvent ev)shouldInterceptTouchEvent(MotionEvent ev) ACTION_DOWN</p>\n<pre><code>/**\n * Check if this event as provided to the parent view&#39;s onInterceptTouchEvent should\n * cause the parent to intercept the touch event stream.\n *\n * @param ev MotionEvent provided to onInterceptTouchEvent\n * @return true if the parent view should return true from onInterceptTouchEvent\n */\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn&#39;t get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            saveInitialMotion(x, y, pointerId);\n\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView &amp;&amp; mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched &amp; mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId);\n            }\n            break;\n        }\n\n        // case\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>9~21MotionEventactionIndexACTION_POINTER_DOWN <a href=\"http://my.oschina.net/banxi/blog/56421\" target=\"_blank\" rel=\"noopener\">android,MotionEvent()</a></p>\n<p>mVelocityTrackerACTION_DOWNcancel()cancel()mVelocityTrackermVelocityTracker ACTION_DOWNACTION_UPACTION_DOWN</p>\n<p>24~42case MotionEvent.ACTION_DOWNsaveInitialMotion(x, y, pointerId)ACTION_DOWNxypointerIdmParentViewfindTopChildUnder((int) x, (int) y);ViewfindTopChildUnder </p>\n<pre><code>/**\n * Find the topmost child under the given point within the parent view&#39;s coordinate system.\n * The child order is determined using {@link Callback#getOrderedChildIndex(int)}.\n *\n * @param x X position to test in the parent&#39;s coordinate system\n * @param y Y position to test in the parent&#39;s coordinate system\n * @return The topmost child view under (x, y) or null if none found.\n */\npublic View findTopChildUnder(int x, int y) {\n    final int childCount = mParentView.getChildCount();\n    for (int i = childCount - 1; i &gt;= 0; i--) {\n        final View child = mParentView.getChildAt(mCallback.getOrderedChildIndex(i));\n        if (x &gt;= child.getLeft() &amp;&amp; x &lt; child.getRight() &amp;&amp;\n                y &gt;= child.getTop() &amp;&amp; y &lt; child.getBottom()) {\n            return child;\n        }\n    }\n    return null;\n}\n</code></pre><p>ViewViewCallbackgetOrderedChildIndex(int index)ViewtopViewViewindex4bottomViewViewindex3getOrderedChildIndex()indextopViewbottomView</p>\n<pre><code>public int getOrderedChildIndex(int index) {\n    int indexTop = mParentView.indexOfChild(topView);\n    int indexBottom = mParentView.indexOfChild(bottomView);\n    if (index == indexTop) {\n        return indexBottom;\n    }\n    return index;\n}\n</code></pre><p>32~35mDragState</p>\n<ol>\n<li>STATE_IDLEView</li>\n<li>STATE_DRAGGINGView</li>\n<li>STATE_SETTLINGView<br>mCapturedViewnullmDragStateSTATE_SETTLINGtryCaptureViewForDrag()</li>\n</ol>\n<p>37~40Callback.onEdgeTouchedmParentViewmInitialEdgesTouchedsaveInitialMotion</p>\n<p>ACTION_DOWN switchreturn mDragState == STATE_DRAGGING;ACTION_DOWNmDragStateSTATE_IDLEfalse</p>\n<p>false<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a>mParentViewViewTouchViewViewdispatchTouchEvent()dispatchTouchEventonTouchEvent()</p>\n<ul>\n<li>ViewViewdispatchTouchEvent()falsemParentViewsuper.dispatchTouchEvent(ev)ViewdispatchTouchEvent(ev)mParentViewonTouchEvent()ViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UPACTION_DOWNtruefalseprocessTouchEvent()ACTION_MOVEtruemParentViewonInterceptTouchEvent()ACTION_MOVEACTION_UP</li>\n<li>ViewACTION_DOWNmParentViewonTouchEvent()ACTION_DOWNViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNViewrequestDisallowInterceptTouchEvent(true)mParentViewonInterceptTouchEvent()ACTION_MOVEtrueACTION_MOVEprocessTouchEvent()ACTION_MOVEonInterceptTouchEvent()ACTION_MOVE</li>\n</ul>\n<p></p>\n<p>ViewprocessTouchEvent(MotionEvent ev)ACTION_DOWN</p>\n<pre><code>/**\n * Process a touch event received by the parent view. This method will dispatch callback events\n * as needed before returning. The parent view&#39;s onTouchEvent implementation should call this.\n *\n * @param ev The touch event received by the parent view\n */\npublic void processTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn&#39;t get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            saveInitialMotion(x, y, pointerId);\n\n            // Since the parent is already directly processing this touch event,\n            // there is no reason to delay for a slop before dragging.\n            // Start immediately if possible.\n            tryCaptureViewForDrag(toCapture, pointerId);\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched &amp; mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId);\n            }\n            break;\n        }\n        // case\n    }\n}\n</code></pre><p>shouldInterceptTouchEvent()ACTION_DOWNtryCaptureViewForDrag()</p>\n<pre><code>/**\n * Attempt to capture the view with the given pointer ID. The callback will be involved.\n * This will put us into the &quot;dragging&quot; state. If we&#39;ve already captured this view with\n * this pointer this method will immediately return true without consulting the callback.\n *\n * @param toCapture View to capture\n * @param pointerId Pointer to capture with\n * @return true if capture was successful\n */\nboolean tryCaptureViewForDrag(View toCapture, int pointerId) {\n    if (toCapture == mCapturedView &amp;&amp; mActivePointerId == pointerId) {\n        // Already done!\n        return true;\n    }\n    if (toCapture != null &amp;&amp; mCallback.tryCaptureView(toCapture, pointerId)) {\n        mActivePointerId = pointerId;\n        captureChildView(toCapture, pointerId);\n        return true;\n    }\n    return false;\n}\n</code></pre><p>CallbacktryCaptureView(View child, int pointerId)ViewtryCaptureView()ViewViewtryCaptureView()trueViewDragHelperViewcaptureChildView(toCapture, pointerId)</p>\n<pre><code>/**\n * Capture a specific child view for dragging within the parent. The callback will be notified\n * but {@link Callback#tryCaptureView(android.view.View, int)} will not be asked permission to\n * capture this view.\n *\n * @param childView Child view to capture\n * @param activePointerId ID of the pointer that is dragging the captured child view\n */\npublic void captureChildView(View childView, int activePointerId) {\n    if (childView.getParent() != mParentView) {\n        throw new IllegalArgumentException(&quot;captureChildView: parameter must be a descendant &quot; +\n                &quot;of the ViewDragHelper&#39;s tracked parent view (&quot; + mParentView + &quot;)&quot;);\n    }\n\n    mCapturedView = childView;\n    mActivePointerId = activePointerId;\n    mCallback.onViewCaptured(childView, activePointerId);\n    setDragState(STATE_DRAGGING);\n}\n</code></pre><p>captureChildView(toCapture, pointerId)ViewCallbackonViewCaptured(childView, activePointerId)ViewsetDragState()STATE_DRAGGINGsetDragState()</p>\n<pre><code>void setDragState(int state) {\n    if (mDragState != state) {\n        mDragState = state;\n        mCallback.onViewDragStateChanged(state);\n        if (mDragState == STATE_IDLE) {\n            mCapturedView = null;\n        }\n    }\n}\n</code></pre><p>CallbackonViewDragStateChanged()</p>\n<p>ACTION_DOWNmParentViewonTouchEvent()trueACTION_MOVE</p>\n<pre><code>public void processTouchEvent(MotionEvent ev) {\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            if (mDragState == STATE_DRAGGING) {\n                final int index = MotionEventCompat.findPointerIndex(ev, mActivePointerId);\n                final float x = MotionEventCompat.getX(ev, index);\n                final float y = MotionEventCompat.getY(ev, index);\n                final int idx = (int) (x - mLastMotionX[mActivePointerId]);\n                final int idy = (int) (y - mLastMotionY[mActivePointerId]);\n\n                dragTo(mCapturedView.getLeft() + idx, mCapturedView.getTop() + idy, idx, idy);\n\n                saveLastMotion(ev);\n            } else {\n                // Check to see if any pointer is now over a draggable view.\n                final int pointerCount = MotionEventCompat.getPointerCount(ev);\n                for (int i = 0; i &lt; pointerCount; i++) {\n                    final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                    final float x = MotionEventCompat.getX(ev, i);\n                    final float y = MotionEventCompat.getY(ev, i);\n                    final float dx = x - mInitialMotionX[pointerId];\n                    final float dy = y - mInitialMotionY[pointerId];\n\n                    reportNewEdgeDrags(dx, dy, pointerId);\n                    if (mDragState == STATE_DRAGGING) {\n                        // Callback might have started an edge drag.\n                        break;\n                    }\n\n                    final View toCapture = findTopChildUnder((int) x, (int) y);\n                    if (checkTouchSlop(toCapture, dx, dy) &amp;&amp;\n                            tryCaptureViewForDrag(toCapture, pointerId)) {\n                        break;\n                    }\n                }\n                saveLastMotion(ev);\n            }\n            break;\n        }\n\n        // case...\n    }\n}\n</code></pre><p>mDragStateSTATE_DRAGGINGsetDragState(STATE_DRAGGING)tryCaptureViewForDrag()ACTION_DOWNtryCaptureViewForDrag()<br>ACTION_DOWNViewifmDragStateSTATE_IDLEelseViewmDragStateSTATE_DRAGGINGifCallbackreportNewEdgeDrags()checkTouchSlop()reportNewEdgeDrags()</p>\n<pre><code>private void reportNewEdgeDrags(float dx, float dy, int pointerId) {\n    int dragsStarted = 0;\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)) {\n        dragsStarted |= EDGE_LEFT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_TOP)) {\n        dragsStarted |= EDGE_TOP;\n    }\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_RIGHT)) {\n        dragsStarted |= EDGE_RIGHT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_BOTTOM)) {\n        dragsStarted |= EDGE_BOTTOM;\n    }\n\n    if (dragsStarted != 0) {\n        mEdgeDragsInProgress[pointerId] |= dragsStarted;\n        mCallback.onEdgeDragStarted(dragsStarted, pointerId);\n    }\n}\n</code></pre><p>mEdgeDragsInProgressCallbackonEdgeDragStarted(int edgeFlags, int pointerId)reportNewEdgeDrags()processTouchEvent()ACTION_MOVEmCallback.onEdgeDragStarted(dragsStarted, pointerId)checkNewEdgeDrag()</p>\n<pre><code>private boolean checkNewEdgeDrag(float delta, float odelta, int pointerId, int edge) {\n    final float absDelta = Math.abs(delta);\n    final float absODelta = Math.abs(odelta);\n\n    if ((mInitialEdgesTouched[pointerId] &amp; edge) != edge  || (mTrackingEdges &amp; edge) == 0 ||\n            (mEdgeDragsLocked[pointerId] &amp; edge) == edge ||\n            (mEdgeDragsInProgress[pointerId] &amp; edge) == edge ||\n            (absDelta &lt;= mTouchSlop &amp;&amp; absODelta &lt;= mTouchSlop)) {\n        return false;\n    }\n    if (absDelta &lt; absODelta * 0.5f &amp;&amp; mCallback.onEdgeLock(edge)) {\n        mEdgeDragsLocked[pointerId] |= edge;\n        return false;\n    }\n    return (mEdgeDragsInProgress[pointerId] &amp; edge) == 0 &amp;&amp; absDelta &gt; mTouchSlop;\n}\n</code></pre><ul>\n<li>checkNewEdgeDrag()trueedge</li>\n<li>deltaodeltaodeltaooppositereportNewEdgeDrags()checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)xdeltadxodeltadydeltaodelta</li>\n<li>mInitialEdgesTouchedACTION_DOWNsaveInitialMotion()ACTION_DOWNmInitialEdgesTouchedACTION_DOWNedgefalse</li>\n<li>mTrackingEdgessetEdgeTrackingEnabled(int edgeFlags)setEdgeTrackingEnabled(int edgeFlags)false</li>\n<li>mEdgeDragsLockedViewDragHelper1206mEdgeDragsLocked[pointerId] &amp; edge) == edgefalse1114absDelta &lt; absODelta * 0.5fCallbackonEdgeLock(edge)mEdgeDragsInProgressCallbackonEdgeDragStarted()mEdgeDragsLocked66edgefalse</li>\n<li>7(mEdgeDragsInProgress[pointerId] &amp; edge) == edgemEdgeDragsInProgressedgefalse</li>\n<li>8(absDelta &lt;= mTouchSlop &amp;&amp; absODelta &lt;= mTouchSlop)</li>\n<li>edgereportNewEdgeDragsmCallback.onEdgeDragStarted(dragsStarted, pointerId)</li>\n</ul>\n<p>checkTouchSlop()</p>\n<pre><code>/**\n * Check if we&#39;ve crossed a reasonable touch slop for the given child view.\n * If the child cannot be dragged along the horizontal or vertical axis, motion\n * along that axis will not count toward the slop check.\n *\n * @param child Child to check\n * @param dx Motion since initial position along X axis\n * @param dy Motion since initial position along Y axis\n * @return true if the touch slop has been crossed\n */\nprivate boolean checkTouchSlop(View child, float dx, float dy) {\n    if (child == null) {\n        return false;\n    }\n    final boolean checkHorizontal = mCallback.getViewHorizontalDragRange(child) &gt; 0;\n    final boolean checkVertical = mCallback.getViewVerticalDragRange(child) &gt; 0;\n\n    if (checkHorizontal &amp;&amp; checkVertical) {\n        return dx * dx + dy * dy &gt; mTouchSlop * mTouchSlop;\n    } else if (checkHorizontal) {\n        return Math.abs(dx) &gt; mTouchSlop;\n    } else if (checkVertical) {\n        return Math.abs(dy) &gt; mTouchSlop;\n    }\n    return false;\n}\n</code></pre><p>mTouchSlopdxdyACTION_DOWNCallbackgetViewHorizontalDragRange(child)getViewVerticalDragRange(child)0View0processTouchEvent()ACTION_MOVEtryCaptureViewForDrag()View</p>\n<p>processTouchEvent()ACTION_MOVEViewCallbacktryCaptureViewForDrag()ViewACTION_MOVEifdragTo()mCaptureViewdragTo()</p>\n<pre><code>private void dragTo(int left, int top, int dx, int dy) {\n    int clampedX = left;\n    int clampedY = top;\n    final int oldLeft = mCapturedView.getLeft();\n    final int oldTop = mCapturedView.getTop();\n    if (dx != 0) {\n        clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx);\n        mCapturedView.offsetLeftAndRight(clampedX - oldLeft);\n    }\n    if (dy != 0) {\n        clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy);\n        mCapturedView.offsetTopAndBottom(clampedY - oldTop);\n    }\n\n    if (dx != 0 || dy != 0) {\n        final int clampedDx = clampedX - oldLeft;\n        final int clampedDy = clampedY - oldTop;\n        mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY,\n                clampedDx, clampedDy);\n    }\n}\n</code></pre><p>dxdyACTION_MOVElefttopmCapturedView.getLeft() + dx, mCapturedView.getTop() + dyViewgetLeft()<a href=\"http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html\" target=\"_blank\" rel=\"noopener\">Android ViewgetLeft, getRight, getTop, getBottom</a></p>\n<p>offsetLeftAndRight()offsetTopAndBottom()mCapturedViewViewViewmLeftmRightmTopmBottomViewViewmCapturedViewlayout(int l, int t, int r, int b)View</p>\n<p>CallbackclampViewPositionHorizontal()clampViewPositionVertical()clampViewPositionHorizontal(View child, int left, int dx)child.getLeft()clampedX - oldLeft0mCapturedView.offsetLeftAndRight(clampedX - oldLeft)</p>\n<p>CallbackonViewPositionChanged(mCapturedView, clampedX, clampedY,clampedDx, clampedDy)ViewclampedXclampedYclampedDx clampedDy</p>\n<p>ACTION_MOVEACTION_UPACTION_MOVEmParentViewViewACTION_CANCEL</p>\n<pre><code>public void processTouchEvent(MotionEvent ev) {\n    // \n\n    switch (action) {\n        // case\n\n        case MotionEvent.ACTION_UP: {\n            if (mDragState == STATE_DRAGGING) {\n                releaseViewForPointerUp();\n            }\n            cancel();\n            break;\n        }\n\n        case MotionEvent.ACTION_CANCEL: {\n            if (mDragState == STATE_DRAGGING) {\n                dispatchViewReleased(0, 0);\n            }\n            cancel();\n            break;\n        }\n    }\n}\n</code></pre><p>ViewreleaseViewForPointerUp()dispatchViewReleased()</p>\n<pre><code>private void releaseViewForPointerUp() {\n    mVelocityTracker.computeCurrentVelocity(1000, mMaxVelocity);\n    final float xvel = clampMag(\n            VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    final float yvel = clampMag(\n            VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    dispatchViewReleased(xvel, yvel);\n}\n</code></pre><p>releaseViewForPointerUp()dispatchViewReleased()processTouchEvent()mVelocityTrackerdispatchViewReleased()</p>\n<pre><code>/**\n * Like all callback events this must happen on the UI thread, but release\n * involves some extra semantics. During a release (mReleaseInProgress)\n * is the only time it is valid to call {@link #settleCapturedViewAt(int, int)}\n * or {@link #flingCapturedView(int, int, int, int)}.\n */\nprivate void dispatchViewReleased(float xvel, float yvel) {\n    mReleaseInProgress = true;\n    mCallback.onViewReleased(mCapturedView, xvel, yvel);\n    mReleaseInProgress = false;\n\n    if (mDragState == STATE_DRAGGING) {\n        // onViewReleased didn&#39;t call a method that would have changed this. Go idle.\n        setDragState(STATE_IDLE);\n    }\n}\n</code></pre><p>CallbackonViewReleased(mCapturedView, xvel, yvel)ViewonViewReleased()mReleaseInProgressViewDragHelpersettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()</p>\n<p>fling<br>flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)ViewflingflingViewflingflingCapturedViewint minLeft, int minTop, int maxLeft, int maxTopViewsettleCapturedViewAt(int finalLeft, int finalTop)</p>\n<p>settleCapturedViewAt()flingCapturedView()CallbackonViewReleased()</p>\n<pre><code>/**\n * Settle the captured view at the given (left, top) position.\n * The appropriate velocity from prior motion will be taken into account.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * @param finalLeft Settled left edge position for the captured view\n * @param finalTop Settled top edge position for the captured view\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean settleCapturedViewAt(int finalLeft, int finalTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(&quot;Cannot settleCapturedViewAt outside of a call to &quot; +\n                &quot;Callback#onViewReleased&quot;);\n    }\n\n    return forceSettleCapturedViewAt(finalLeft, finalTop,\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId));\n}\n\n/**\n * Settle the captured view based on standard free-moving fling behavior.\n * The caller should invoke {@link #continueSettling(boolean)} on each subsequent frame\n * to continue the motion until it returns false.\n *\n * @param minLeft Minimum X position for the view&#39;s left edge\n * @param minTop Minimum Y position for the view&#39;s top edge\n * @param maxLeft Maximum X position for the view&#39;s left edge\n * @param maxTop Maximum Y position for the view&#39;s top edge\n */\npublic void flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(&quot;Cannot flingCapturedView outside of a call to &quot; +\n                &quot;Callback#onViewReleased&quot;);\n    }\n\n    mScroller.fling(mCapturedView.getLeft(), mCapturedView.getTop(),\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            minLeft, maxLeft, minTop, maxTop);\n\n    setDragState(STATE_SETTLING);\n}\n</code></pre><p>mReleaseInProgressfalsefalseIllegalStateExceptionmReleaseInProgresstruedispatchViewReleased()onViewReleased()</p>\n<p>Scroller<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a> Scroller</p>\n<p>ViewDragHelperViewsmoothSlideViewTo(View child, int finalLeft, int finalTop)</p>\n<pre><code>/**\n * Animate the view &lt;code&gt;child&lt;/code&gt; to the given (left, top) position.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * &lt;p&gt;This operation does not count as a capture event, though {@link #getCapturedView()}\n * will still report the sliding view while the slide is in progress.&lt;/p&gt;\n *\n * @param child Child view to capture and animate\n * @param finalLeft Final left position of child\n * @param finalTop Final top position of child\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean smoothSlideViewTo(View child, int finalLeft, int finalTop) {\n    mCapturedView = child;\n    mActivePointerId = INVALID_POINTER;\n\n    boolean continueSliding = forceSettleCapturedViewAt(finalLeft, finalTop, 0, 0);\n    if (!continueSliding &amp;&amp; mDragState == STATE_IDLE &amp;&amp; mCapturedView != null) {\n        // If we&#39;re in an IDLE state to begin with and aren&#39;t moving anywhere, we\n        // end up having a non-null capturedView with an IDLE dragState\n        mCapturedView = null;\n    }\n\n    return continueSliding;\n}\n</code></pre><p>mReleaseInProgresssettleCapturedViewAt()forceSettleCapturedViewAt()settleCapturedViewAt()ViewsmoothSlideViewTo()0forceSettleCapturedViewAt()Callback</p>\n<pre><code>/**\n * Settle the captured view at the given (left, top) position.\n *\n * @param finalLeft Target left position for the captured view\n * @param finalTop Target top position for the captured view\n * @param xvel Horizontal velocity\n * @param yvel Vertical velocity\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\nprivate boolean forceSettleCapturedViewAt(int finalLeft, int finalTop, int xvel, int yvel) {\n    final int startLeft = mCapturedView.getLeft();\n    final int startTop = mCapturedView.getTop();\n    final int dx = finalLeft - startLeft;\n    final int dy = finalTop - startTop;\n\n    if (dx == 0 &amp;&amp; dy == 0) {\n        // Nothing to do. Send callbacks, be done.\n        mScroller.abortAnimation();\n        setDragState(STATE_IDLE);\n        return false;\n    }\n\n    final int duration = computeSettleDuration(mCapturedView, dx, dy, xvel, yvel);\n    mScroller.startScroll(startLeft, startTop, dx, dy, duration);\n\n    setDragState(STATE_SETTLING);\n    return true;\n}\n</code></pre><p>ScrollmScroller.startScroll()computeSettleDuration()</p>\n<pre><code>private int computeSettleDuration(View child, int dx, int dy, int xvel, int yvel) {\n    xvel = clampMag(xvel, (int) mMinVelocity, (int) mMaxVelocity);\n    yvel = clampMag(yvel, (int) mMinVelocity, (int) mMaxVelocity);\n    final int absDx = Math.abs(dx);\n    final int absDy = Math.abs(dy);\n    final int absXVel = Math.abs(xvel);\n    final int absYVel = Math.abs(yvel);\n    final int addedVel = absXVel + absYVel;\n    final int addedDistance = absDx + absDy;\n\n    final float xweight = xvel != 0 ? (float) absXVel / addedVel :\n            (float) absDx / addedDistance;\n    final float yweight = yvel != 0 ? (float) absYVel / addedVel :\n            (float) absDy / addedDistance;\n\n    int xduration = computeAxisDuration(dx, xvel, mCallback.getViewHorizontalDragRange(child));\n    int yduration = computeAxisDuration(dy, yvel, mCallback.getViewVerticalDragRange(child));\n\n    return (int) (xduration * xweight + yduration * yweight);\n}\n</code></pre><p>clampMag()computeAxisDuration()dxxvelmCallback.getViewHorizontalDragRange()computeAxisDuration()</p>\n<pre><code>private int computeAxisDuration(int delta, int velocity, int motionRange) {\n    if (delta == 0) {\n        return 0;\n    }\n\n    final int width = mParentView.getWidth();\n    final int halfWidth = width / 2;\n    final float distanceRatio = Math.min(1f, (float) Math.abs(delta) / width);\n    final float distance = halfWidth + halfWidth *\n            distanceInfluenceForSnapDuration(distanceRatio);\n\n    int duration;\n    velocity = Math.abs(velocity);\n    if (velocity &gt; 0) {\n        duration = 4 * Math.round(1000 * Math.abs(distance / velocity));\n    } else {\n        final float range = (float) Math.abs(delta) / motionRange;\n        duration = (int) ((range + 1) * BASE_SETTLE_DURATION);\n    }\n    return Math.min(duration, MAX_SETTLE_DURATION);\n}\n</code></pre><p>6~1014~19velocity0velocity0deltamotionRangeCallbackgetViewHorizontalDragRange()getViewVerticalDragRange()MAX_SETTLE_DURATION600CallbackgetViewHorizontalDragRange()getViewVerticalDragRange()</p>\n<p>settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()mParentViewcomputeScroll()</p>\n<pre><code>@Override\npublic void computeScroll() {\n    if (mDragHelper.continueSettling(true)) {\n        ViewCompat.postInvalidateOnAnimation(this);\n    }\n}\n</code></pre><p>Scroll<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a>  computeScroll(</p>\n<p>ViewDragHelpershouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWN</p>\n<p>shouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWNmParentViewonInterceptTouchEvent()ACTION_MOVE<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a>ViewDragHelpershouldInterceptTouchEvent()ACTION_MOVE</p>\n<pre><code>public boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            // First to cross a touch slop over a draggable view wins. Also report edge drags.\n            final int pointerCount = MotionEventCompat.getPointerCount(ev);\n            for (int i = 0; i &lt; pointerCount; i++) {\n                final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                final float x = MotionEventCompat.getX(ev, i);\n                final float y = MotionEventCompat.getY(ev, i);\n                final float dx = x - mInitialMotionX[pointerId];\n                final float dy = y - mInitialMotionY[pointerId];\n\n                final View toCapture = findTopChildUnder((int) x, (int) y);\n                final boolean pastSlop = toCapture != null &amp;&amp; checkTouchSlop(toCapture, dx, dy);\n                if (pastSlop) {\n                    // check the callback&#39;s\n                    // getView[Horizontal|Vertical]DragRange methods to know\n                    // if you can move at all along an axis, then see if it\n                    // would clamp to the same value. If you can&#39;t move at\n                    // all in every dimension with a nonzero range, bail.\n                    final int oldLeft = toCapture.getLeft();\n                    final int targetLeft = oldLeft + (int) dx;\n                    final int newLeft = mCallback.clampViewPositionHorizontal(toCapture,\n                            targetLeft, (int) dx);\n                    final int oldTop = toCapture.getTop();\n                    final int targetTop = oldTop + (int) dy;\n                    final int newTop = mCallback.clampViewPositionVertical(toCapture, targetTop,\n                            (int) dy);\n                    final int horizontalDragRange = mCallback.getViewHorizontalDragRange(\n                            toCapture);\n                    final int verticalDragRange = mCallback.getViewVerticalDragRange(toCapture);\n                    if ((horizontalDragRange == 0 || horizontalDragRange &gt; 0\n                            &amp;&amp; newLeft == oldLeft) &amp;&amp; (verticalDragRange == 0\n                            || verticalDragRange &gt; 0 &amp;&amp; newTop == oldTop)) {\n                        break;\n                    }\n                }\n                reportNewEdgeDrags(dx, dy, pointerId);\n                if (mDragState == STATE_DRAGGING) {\n                    // Callback might have started an edge drag\n                    break;\n                }\n\n                if (pastSlop &amp;&amp; tryCaptureViewForDrag(toCapture, pointerId)) {\n                    break;\n                }\n            }\n            saveLastMotion(ev);\n            break;\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>ViewfindTopChildUnder(int x, int y)ViewcheckTouchSlop(View child, float dx, float dy)ACTION_DOWNmTouchSlopView<br>19~41if (pastSlop){}getView[Horizontal|Vertical]DragRangeclampViewPosition[Horizontal|Vertical]getView[Horizontal|Vertical]DragRange0clampViewPosition[Horizontal|Vertical]View39breaktryCaptureViewForDrag()View<br>tryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()mParentViewprocessTouchEvent()ACTION_MOVE</p>\n<p>shouldInterceptTouchEvent()ACTION_DOWN</p>\n<pre><code>public boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_DOWN: {\n            // ...\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView &amp;&amp; mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            // ...\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>ViewtryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()processTouchEvent()ACTION_DOWNACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UP</p>\n<p>ViewDragHelpershouldInterceptTouchEvent()processTouchEvent()ACTION_POINTER_DOWNACTION_POINTER_UP</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ul>\n<li><a href=\"http://www.processon.com/view/link/5550a7bae4b09739f465ec64\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://www.processon.com/view/link/5550d3dce4b09739f46789bd\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<p>~</p>\n<p></p>\n<ul>\n<li>settleCapturedViewAt(int finalLeft, int finalTop)<br>ViewCallbackonViewReleased()</li>\n<li>flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)<br>ViewflingCallbackonViewReleased()</li>\n<li>smoothSlideViewTo(View child, int finalLeft, int finalTop)<br>View0</li>\n</ul>\n<p>Callback</p>\n<ul>\n<li><p>void onViewDragStateChanged(int state)</p>\n<p>stateSTATE_IDLESTATE_DRAGGINGSTATE_SETTLING</p>\n<p>setDragState()setDragState()</p>\n<ul>\n<li>tryCaptureViewForDrag()View<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n</ul>\n</li>\n<li>settleCapturedViewAt()smoothSlideViewTo()flingCapturedView()</li>\n<li>ViewprocessTouchEvent()ACTION_UPACTION_CANCEL</li>\n<li>continueSettling()</li>\n<li>abort()</li>\n</ul>\n</li>\n<li><p>void onViewPositionChanged(View changedView, int left, int top, int dx, int dy)</p>\n<p>ViewView</p>\n<ul>\n<li>dragTo()</li>\n<li>continueSettling()</li>\n<li>abort()</li>\n</ul>\n</li>\n<li><p>void onViewCaptured(View capturedChild, int activePointerId)</p>\n<p>tryCaptureViewForDrag()View</p>\n<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n<li>captureChildView()</li>\n</ul>\n</li>\n<li><p>void onViewReleased(View releasedChild, float xvel, float yvel)<br>ViewprocessTouchEvent()ACTION_UPViewprocessTouchEvent()ACTION_CANCEL</p>\n</li>\n<li><p>void onEdgeTouched(int edgeFlags, int pointerId)<br>ACTION_DOWNACTION_POINTER_DOWNedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM</p>\n</li>\n<li><p>boolean onEdgeLock(int edgeFlags)<br>trueedgeFlagsonEdgeDragStarted()falseedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM</p>\n</li>\n<li><p>void onEdgeDragStarted(int edgeFlags, int pointerId)<br>ACTION_MOVEedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOMcaptureChildView()View</p>\n</li>\n<li><p>int getOrderedChildIndex(int index)<br>ViewViewtryCaptureViewForDrag()ViewViewView</p>\n</li>\n<li><p>int getViewHorizontalDragRange(View child)int getViewVerticalDragRange(View child)</p>\n<p>child0ACTION_DOWNchild0</p>\n<p></p>\n<ul>\n<li>checkTouchSlop()0mTouchSlopACTION_MOVEtryCaptureViewForDrag()checkTouchSlop()checkTouchSlop()View</li>\n<li>ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVErange00View</li>\n<li>smoothSlideViewTo()getView[Horizontal|Vertical]DragRange0</li>\n</ul>\n</li>\n<li><p>boolean tryCaptureView(View child, int pointerId)</p>\n<p>tryCaptureViewForDrag()truechildtryCaptureViewForDrag()</p>\n<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n</ul>\n</li>\n<li><p>int clampViewPositionHorizontal(View child, int left, int dx)int clampViewPositionVertical(View child, int top, int dy)</p>\n<p>childchildclampViewPositionHorizontal()childleftclampViewPositionVertical()childtop</p>\n<p></p>\n<ul>\n<li>dragTo()dragTo()processTouchEvent()ACTION_MOVEView</li>\n<li>ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVElefttopView</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ViewDragHelper</p>\n<ol>\n<li><a href=\"https://github.com/flavienlaurent/flavienlaurent.com\" target=\"_blank\" rel=\"noopener\">YoutubeLayout</a>Demo</li>\n<li><a href=\"https://github.com/BlueMor/DragLayout\" target=\"_blank\" rel=\"noopener\">QQ5.x</a><a href=\"https://github.com/kyze8439690/ResideLayout\" target=\"_blank\" rel=\"noopener\">ResideLayout</a></li>\n<li><a href=\"https://github.com/ikew0ng/SwipeBackLayout\" target=\"_blank\" rel=\"noopener\">SwipeBackLayout</a><a href=\"https://github.com/liuguangqiang/SwipeBack\" target=\"_blank\" rel=\"noopener\">SwipeBack</a></li>\n<li><a href=\"https://github.com/umano/AndroidSlidingUpPanel\" target=\"_blank\" rel=\"noopener\">SlidingUpPanel</a></li>\n<li><a href=\"https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/DrawerLayout.java\" target=\"_blank\" rel=\"noopener\">DrawerLayout</a></li>\n</ol>\n<h3 id=\"ViewDragHelper\"><a href=\"#ViewDragHelper\" class=\"headerlink\" title=\"ViewDragHelper\"></a>ViewDragHelper</h3><ul>\n<li><a href=\"http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper\" target=\"_blank\" rel=\"noopener\">Each Navigation Drawer Hides a ViewDragHelper</a><a href=\"https://github.com/flavienlaurent/flavienlaurent.com\" target=\"_blank\" rel=\"noopener\">YoutubeLayout</a></li>\n<li><a href=\"http://blog.csdn.net/pi9nc/article/details/39583377\" target=\"_blank\" rel=\"noopener\">ViewDragHelper</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.cnblogs.com/lqstayreal/p/4500219.html\" target=\"_blank\" rel=\"noopener\"></a></p>","more":"<p>ViewGroupViewViewDragHelperViewNavigation DrawerQQ5.x</p>\n<p>ViewDragHelperViewDragHelper</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><p>ViewGroupViewDragHelpercreate()ViewDragHelper</p>\n</li>\n<li><p>ViewDragHelper.Callback</p>\n<p>tryCaptureView()clampViewPositionVertical()clampViewPositionHorizontal()getViewHorizontalDragRange()getViewVerticalDragRange()</p>\n<ul>\n<li>tryCaptureView()ViewViewtruefalse</li>\n<li>clampViewPositionVertical()ViewViewViewtopViewtop</li>\n<li>clampViewPositionHorizontal()clampViewPositionVertical()Viewleft</li>\n<li>getViewVerticalDragRange()0View</li>\n<li>getViewHorizontalDragRange()getViewVerticalDragRange()</li>\n</ul>\n</li>\n<li><p>onInterceptTouchEvent()ViewDragHelpershouldInterceptTouchEvent()</p>\n</li>\n<li><p>onTouchEvent()ViewDragHelper()processTouchEvent()ACTION_DOWNViewonTouchEvent()true</p>\n</li>\n<li><p>ViewflingViewGroupcomputeScroll()</p>\n<pre><code> @Override\n public void computeScroll() {\n     if (mDragHelper.continueSettling(true)) {\n         postInvalidate();\n     }\n }\n</code></pre><p>ViewDragHelper.CallbackonViewReleased()settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()</p>\n</li>\n<li><p>ViewDragHelpersetEdgeTrackingEnabled()ViewDragHelper.CallbackonEdgeDragStarted()captureChildView()View</p>\n</li>\n</ol>\n<p>Demo</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ViewDragHelper<a href=\"https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/ViewDragHelper.java\" target=\"_blank\" rel=\"noopener\">GitHub</a><a href=\"http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.0.2_r1/android/support/v4/widget/ViewDragHelper.java#ViewDragHelper\" target=\"_blank\" rel=\"noopener\">GrepCode</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ol>\n<li>View<a href=\"http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html\" target=\"_blank\" rel=\"noopener\">Android ViewgetLeft, getRight, getTop, getBottom</a></li>\n<li>MotionEvent<a href=\"http://my.oschina.net/banxi/blog/56421\" target=\"_blank\" rel=\"noopener\">android,MotionEvent()</a></li>\n<li>Scroller<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a></li>\n<li>Touch<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a></li>\n</ol>\n<h4 id=\"ViewDragHelper\"><a href=\"#ViewDragHelper\" class=\"headerlink\" title=\"ViewDragHelper\"></a>ViewDragHelper</h4><p>ViewDragHelpercreate()create()</p>\n<pre><code>/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, Callback cb) {\n    return new ViewDragHelper(forParent.getContext(), forParent, cb);\n}\n</code></pre><p>create()ViewGroupViewcreate()ViewDragHelper</p>\n<pre><code>/**\n * Apps should use ViewDragHelper.create() to get a new instance.\n * This will allow VDH to use internal compatibility implementations for different\n * platform versions.\n *\n * @param context Context to initialize config-dependent params from\n * @param forParent Parent view to monitor\n */\nprivate ViewDragHelper(Context context, ViewGroup forParent, Callback cb) {\n    if (forParent == null) {\n        throw new IllegalArgumentException(&quot;Parent view may not be null&quot;);\n    }\n    if (cb == null) {\n        throw new IllegalArgumentException(&quot;Callback may not be null&quot;);\n    }\n\n    mParentView = forParent;\n    mCallback = cb;\n\n    final ViewConfiguration vc = ViewConfiguration.get(context);\n    final float density = context.getResources().getDisplayMetrics().density;\n    mEdgeSize = (int) (EDGE_SIZE * density + 0.5f);\n\n    mTouchSlop = vc.getScaledTouchSlop();\n    mMaxVelocity = vc.getScaledMaximumFlingVelocity();\n    mMinVelocity = vc.getScaledMinimumFlingVelocity();\n    mScroller = ScrollerCompat.create(context, sInterpolator);\n}\n</code></pre><p>create()ViewDragHelperViewGroup</p>\n<ul>\n<li>mParentViewmCallback</li>\n<li>ViewConfigurationView</li>\n<li>mEdgeSizemEdgeSize20dpxmParentView.getLeft() + mEdgeSize20dpViewDragHelpergetEdgesTouched()</li>\n<li>mTouchSlopmTouchSlop</li>\n<li>mMaxVelocitymMinVelocityfling</li>\n<li>mScrollerView<ul>\n<li><a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a></li>\n<li><a href=\"http://www.cnblogs.com/supersugar/archive/2012/08/13/2636691.html\" target=\"_blank\" rel=\"noopener\">AndroidScroller</a></li>\n</ul>\n</li>\n</ul>\n<p>create()</p>\n<pre><code>/**\n * Factory method to create a new ViewDragHelper.\n *\n * @param forParent Parent view to monitor\n * @param sensitivity Multiplier for how sensitive the helper should be about detecting\n *                    the start of a drag. Larger values are more sensitive. 1.0f is normal.\n * @param cb Callback to provide information and receive events\n * @return a new ViewDragHelper instance\n */\npublic static ViewDragHelper create(ViewGroup forParent, float sensitivity, Callback cb) {\n    final ViewDragHelper helper = create(forParent, cb);\n    helper.mTouchSlop = (int) (helper.mTouchSlop * (1 / sensitivity));\n    return helper;\n}\n</code></pre><p>sensitivitymTouchSlopsensitivitymTouchSlopsensitivity120dpsensitivity210dp</p>\n<h4 id=\"Touch\"><a href=\"#Touch\" class=\"headerlink\" title=\"Touch\"></a>Touch</h4><p>mParentViewViewGroupmParentViewonInterceptTouchEvent(MotionEvent ev)shouldInterceptTouchEvent(MotionEvent ev) ACTION_DOWN</p>\n<pre><code>/**\n * Check if this event as provided to the parent view&#39;s onInterceptTouchEvent should\n * cause the parent to intercept the touch event stream.\n *\n * @param ev MotionEvent provided to onInterceptTouchEvent\n * @return true if the parent view should return true from onInterceptTouchEvent\n */\npublic boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn&#39;t get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            saveInitialMotion(x, y, pointerId);\n\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView &amp;&amp; mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched &amp; mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId);\n            }\n            break;\n        }\n\n        // case\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>9~21MotionEventactionIndexACTION_POINTER_DOWN <a href=\"http://my.oschina.net/banxi/blog/56421\" target=\"_blank\" rel=\"noopener\">android,MotionEvent()</a></p>\n<p>mVelocityTrackerACTION_DOWNcancel()cancel()mVelocityTrackermVelocityTracker ACTION_DOWNACTION_UPACTION_DOWN</p>\n<p>24~42case MotionEvent.ACTION_DOWNsaveInitialMotion(x, y, pointerId)ACTION_DOWNxypointerIdmParentViewfindTopChildUnder((int) x, (int) y);ViewfindTopChildUnder </p>\n<pre><code>/**\n * Find the topmost child under the given point within the parent view&#39;s coordinate system.\n * The child order is determined using {@link Callback#getOrderedChildIndex(int)}.\n *\n * @param x X position to test in the parent&#39;s coordinate system\n * @param y Y position to test in the parent&#39;s coordinate system\n * @return The topmost child view under (x, y) or null if none found.\n */\npublic View findTopChildUnder(int x, int y) {\n    final int childCount = mParentView.getChildCount();\n    for (int i = childCount - 1; i &gt;= 0; i--) {\n        final View child = mParentView.getChildAt(mCallback.getOrderedChildIndex(i));\n        if (x &gt;= child.getLeft() &amp;&amp; x &lt; child.getRight() &amp;&amp;\n                y &gt;= child.getTop() &amp;&amp; y &lt; child.getBottom()) {\n            return child;\n        }\n    }\n    return null;\n}\n</code></pre><p>ViewViewCallbackgetOrderedChildIndex(int index)ViewtopViewViewindex4bottomViewViewindex3getOrderedChildIndex()indextopViewbottomView</p>\n<pre><code>public int getOrderedChildIndex(int index) {\n    int indexTop = mParentView.indexOfChild(topView);\n    int indexBottom = mParentView.indexOfChild(bottomView);\n    if (index == indexTop) {\n        return indexBottom;\n    }\n    return index;\n}\n</code></pre><p>32~35mDragState</p>\n<ol>\n<li>STATE_IDLEView</li>\n<li>STATE_DRAGGINGView</li>\n<li>STATE_SETTLINGView<br>mCapturedViewnullmDragStateSTATE_SETTLINGtryCaptureViewForDrag()</li>\n</ol>\n<p>37~40Callback.onEdgeTouchedmParentViewmInitialEdgesTouchedsaveInitialMotion</p>\n<p>ACTION_DOWN switchreturn mDragState == STATE_DRAGGING;ACTION_DOWNmDragStateSTATE_IDLEfalse</p>\n<p>false<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a>mParentViewViewTouchViewViewdispatchTouchEvent()dispatchTouchEventonTouchEvent()</p>\n<ul>\n<li>ViewViewdispatchTouchEvent()falsemParentViewsuper.dispatchTouchEvent(ev)ViewdispatchTouchEvent(ev)mParentViewonTouchEvent()ViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UPACTION_DOWNtruefalseprocessTouchEvent()ACTION_MOVEtruemParentViewonInterceptTouchEvent()ACTION_MOVEACTION_UP</li>\n<li>ViewACTION_DOWNmParentViewonTouchEvent()ACTION_DOWNViewDragHelperprocessTouchEvent(MotionEvent ev)ACTION_DOWNViewrequestDisallowInterceptTouchEvent(true)mParentViewonInterceptTouchEvent()ACTION_MOVEtrueACTION_MOVEprocessTouchEvent()ACTION_MOVEonInterceptTouchEvent()ACTION_MOVE</li>\n</ul>\n<p></p>\n<p>ViewprocessTouchEvent(MotionEvent ev)ACTION_DOWN</p>\n<pre><code>/**\n * Process a touch event received by the parent view. This method will dispatch callback events\n * as needed before returning. The parent view&#39;s onTouchEvent implementation should call this.\n *\n * @param ev The touch event received by the parent view\n */\npublic void processTouchEvent(MotionEvent ev) {\n    final int action = MotionEventCompat.getActionMasked(ev);\n    final int actionIndex = MotionEventCompat.getActionIndex(ev);\n\n    if (action == MotionEvent.ACTION_DOWN) {\n        // Reset things for a new event stream, just in case we didn&#39;t get\n        // the whole previous stream.\n        cancel();\n    }\n\n    if (mVelocityTracker == null) {\n        mVelocityTracker = VelocityTracker.obtain();\n    }\n    mVelocityTracker.addMovement(ev);\n\n    switch (action) {\n        case MotionEvent.ACTION_DOWN: {\n            final float x = ev.getX();\n            final float y = ev.getY();\n            final int pointerId = MotionEventCompat.getPointerId(ev, 0);\n            final View toCapture = findTopChildUnder((int) x, (int) y);\n\n            saveInitialMotion(x, y, pointerId);\n\n            // Since the parent is already directly processing this touch event,\n            // there is no reason to delay for a slop before dragging.\n            // Start immediately if possible.\n            tryCaptureViewForDrag(toCapture, pointerId);\n\n            final int edgesTouched = mInitialEdgesTouched[pointerId];\n            if ((edgesTouched &amp; mTrackingEdges) != 0) {\n                mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId);\n            }\n            break;\n        }\n        // case\n    }\n}\n</code></pre><p>shouldInterceptTouchEvent()ACTION_DOWNtryCaptureViewForDrag()</p>\n<pre><code>/**\n * Attempt to capture the view with the given pointer ID. The callback will be involved.\n * This will put us into the &quot;dragging&quot; state. If we&#39;ve already captured this view with\n * this pointer this method will immediately return true without consulting the callback.\n *\n * @param toCapture View to capture\n * @param pointerId Pointer to capture with\n * @return true if capture was successful\n */\nboolean tryCaptureViewForDrag(View toCapture, int pointerId) {\n    if (toCapture == mCapturedView &amp;&amp; mActivePointerId == pointerId) {\n        // Already done!\n        return true;\n    }\n    if (toCapture != null &amp;&amp; mCallback.tryCaptureView(toCapture, pointerId)) {\n        mActivePointerId = pointerId;\n        captureChildView(toCapture, pointerId);\n        return true;\n    }\n    return false;\n}\n</code></pre><p>CallbacktryCaptureView(View child, int pointerId)ViewtryCaptureView()ViewViewtryCaptureView()trueViewDragHelperViewcaptureChildView(toCapture, pointerId)</p>\n<pre><code>/**\n * Capture a specific child view for dragging within the parent. The callback will be notified\n * but {@link Callback#tryCaptureView(android.view.View, int)} will not be asked permission to\n * capture this view.\n *\n * @param childView Child view to capture\n * @param activePointerId ID of the pointer that is dragging the captured child view\n */\npublic void captureChildView(View childView, int activePointerId) {\n    if (childView.getParent() != mParentView) {\n        throw new IllegalArgumentException(&quot;captureChildView: parameter must be a descendant &quot; +\n                &quot;of the ViewDragHelper&#39;s tracked parent view (&quot; + mParentView + &quot;)&quot;);\n    }\n\n    mCapturedView = childView;\n    mActivePointerId = activePointerId;\n    mCallback.onViewCaptured(childView, activePointerId);\n    setDragState(STATE_DRAGGING);\n}\n</code></pre><p>captureChildView(toCapture, pointerId)ViewCallbackonViewCaptured(childView, activePointerId)ViewsetDragState()STATE_DRAGGINGsetDragState()</p>\n<pre><code>void setDragState(int state) {\n    if (mDragState != state) {\n        mDragState = state;\n        mCallback.onViewDragStateChanged(state);\n        if (mDragState == STATE_IDLE) {\n            mCapturedView = null;\n        }\n    }\n}\n</code></pre><p>CallbackonViewDragStateChanged()</p>\n<p>ACTION_DOWNmParentViewonTouchEvent()trueACTION_MOVE</p>\n<pre><code>public void processTouchEvent(MotionEvent ev) {\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            if (mDragState == STATE_DRAGGING) {\n                final int index = MotionEventCompat.findPointerIndex(ev, mActivePointerId);\n                final float x = MotionEventCompat.getX(ev, index);\n                final float y = MotionEventCompat.getY(ev, index);\n                final int idx = (int) (x - mLastMotionX[mActivePointerId]);\n                final int idy = (int) (y - mLastMotionY[mActivePointerId]);\n\n                dragTo(mCapturedView.getLeft() + idx, mCapturedView.getTop() + idy, idx, idy);\n\n                saveLastMotion(ev);\n            } else {\n                // Check to see if any pointer is now over a draggable view.\n                final int pointerCount = MotionEventCompat.getPointerCount(ev);\n                for (int i = 0; i &lt; pointerCount; i++) {\n                    final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                    final float x = MotionEventCompat.getX(ev, i);\n                    final float y = MotionEventCompat.getY(ev, i);\n                    final float dx = x - mInitialMotionX[pointerId];\n                    final float dy = y - mInitialMotionY[pointerId];\n\n                    reportNewEdgeDrags(dx, dy, pointerId);\n                    if (mDragState == STATE_DRAGGING) {\n                        // Callback might have started an edge drag.\n                        break;\n                    }\n\n                    final View toCapture = findTopChildUnder((int) x, (int) y);\n                    if (checkTouchSlop(toCapture, dx, dy) &amp;&amp;\n                            tryCaptureViewForDrag(toCapture, pointerId)) {\n                        break;\n                    }\n                }\n                saveLastMotion(ev);\n            }\n            break;\n        }\n\n        // case...\n    }\n}\n</code></pre><p>mDragStateSTATE_DRAGGINGsetDragState(STATE_DRAGGING)tryCaptureViewForDrag()ACTION_DOWNtryCaptureViewForDrag()<br>ACTION_DOWNViewifmDragStateSTATE_IDLEelseViewmDragStateSTATE_DRAGGINGifCallbackreportNewEdgeDrags()checkTouchSlop()reportNewEdgeDrags()</p>\n<pre><code>private void reportNewEdgeDrags(float dx, float dy, int pointerId) {\n    int dragsStarted = 0;\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)) {\n        dragsStarted |= EDGE_LEFT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_TOP)) {\n        dragsStarted |= EDGE_TOP;\n    }\n    if (checkNewEdgeDrag(dx, dy, pointerId, EDGE_RIGHT)) {\n        dragsStarted |= EDGE_RIGHT;\n    }\n    if (checkNewEdgeDrag(dy, dx, pointerId, EDGE_BOTTOM)) {\n        dragsStarted |= EDGE_BOTTOM;\n    }\n\n    if (dragsStarted != 0) {\n        mEdgeDragsInProgress[pointerId] |= dragsStarted;\n        mCallback.onEdgeDragStarted(dragsStarted, pointerId);\n    }\n}\n</code></pre><p>mEdgeDragsInProgressCallbackonEdgeDragStarted(int edgeFlags, int pointerId)reportNewEdgeDrags()processTouchEvent()ACTION_MOVEmCallback.onEdgeDragStarted(dragsStarted, pointerId)checkNewEdgeDrag()</p>\n<pre><code>private boolean checkNewEdgeDrag(float delta, float odelta, int pointerId, int edge) {\n    final float absDelta = Math.abs(delta);\n    final float absODelta = Math.abs(odelta);\n\n    if ((mInitialEdgesTouched[pointerId] &amp; edge) != edge  || (mTrackingEdges &amp; edge) == 0 ||\n            (mEdgeDragsLocked[pointerId] &amp; edge) == edge ||\n            (mEdgeDragsInProgress[pointerId] &amp; edge) == edge ||\n            (absDelta &lt;= mTouchSlop &amp;&amp; absODelta &lt;= mTouchSlop)) {\n        return false;\n    }\n    if (absDelta &lt; absODelta * 0.5f &amp;&amp; mCallback.onEdgeLock(edge)) {\n        mEdgeDragsLocked[pointerId] |= edge;\n        return false;\n    }\n    return (mEdgeDragsInProgress[pointerId] &amp; edge) == 0 &amp;&amp; absDelta &gt; mTouchSlop;\n}\n</code></pre><ul>\n<li>checkNewEdgeDrag()trueedge</li>\n<li>deltaodeltaodeltaooppositereportNewEdgeDrags()checkNewEdgeDrag(dx, dy, pointerId, EDGE_LEFT)xdeltadxodeltadydeltaodelta</li>\n<li>mInitialEdgesTouchedACTION_DOWNsaveInitialMotion()ACTION_DOWNmInitialEdgesTouchedACTION_DOWNedgefalse</li>\n<li>mTrackingEdgessetEdgeTrackingEnabled(int edgeFlags)setEdgeTrackingEnabled(int edgeFlags)false</li>\n<li>mEdgeDragsLockedViewDragHelper1206mEdgeDragsLocked[pointerId] &amp; edge) == edgefalse1114absDelta &lt; absODelta * 0.5fCallbackonEdgeLock(edge)mEdgeDragsInProgressCallbackonEdgeDragStarted()mEdgeDragsLocked66edgefalse</li>\n<li>7(mEdgeDragsInProgress[pointerId] &amp; edge) == edgemEdgeDragsInProgressedgefalse</li>\n<li>8(absDelta &lt;= mTouchSlop &amp;&amp; absODelta &lt;= mTouchSlop)</li>\n<li>edgereportNewEdgeDragsmCallback.onEdgeDragStarted(dragsStarted, pointerId)</li>\n</ul>\n<p>checkTouchSlop()</p>\n<pre><code>/**\n * Check if we&#39;ve crossed a reasonable touch slop for the given child view.\n * If the child cannot be dragged along the horizontal or vertical axis, motion\n * along that axis will not count toward the slop check.\n *\n * @param child Child to check\n * @param dx Motion since initial position along X axis\n * @param dy Motion since initial position along Y axis\n * @return true if the touch slop has been crossed\n */\nprivate boolean checkTouchSlop(View child, float dx, float dy) {\n    if (child == null) {\n        return false;\n    }\n    final boolean checkHorizontal = mCallback.getViewHorizontalDragRange(child) &gt; 0;\n    final boolean checkVertical = mCallback.getViewVerticalDragRange(child) &gt; 0;\n\n    if (checkHorizontal &amp;&amp; checkVertical) {\n        return dx * dx + dy * dy &gt; mTouchSlop * mTouchSlop;\n    } else if (checkHorizontal) {\n        return Math.abs(dx) &gt; mTouchSlop;\n    } else if (checkVertical) {\n        return Math.abs(dy) &gt; mTouchSlop;\n    }\n    return false;\n}\n</code></pre><p>mTouchSlopdxdyACTION_DOWNCallbackgetViewHorizontalDragRange(child)getViewVerticalDragRange(child)0View0processTouchEvent()ACTION_MOVEtryCaptureViewForDrag()View</p>\n<p>processTouchEvent()ACTION_MOVEViewCallbacktryCaptureViewForDrag()ViewACTION_MOVEifdragTo()mCaptureViewdragTo()</p>\n<pre><code>private void dragTo(int left, int top, int dx, int dy) {\n    int clampedX = left;\n    int clampedY = top;\n    final int oldLeft = mCapturedView.getLeft();\n    final int oldTop = mCapturedView.getTop();\n    if (dx != 0) {\n        clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx);\n        mCapturedView.offsetLeftAndRight(clampedX - oldLeft);\n    }\n    if (dy != 0) {\n        clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy);\n        mCapturedView.offsetTopAndBottom(clampedY - oldTop);\n    }\n\n    if (dx != 0 || dy != 0) {\n        final int clampedDx = clampedX - oldLeft;\n        final int clampedDy = clampedY - oldTop;\n        mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY,\n                clampedDx, clampedDy);\n    }\n}\n</code></pre><p>dxdyACTION_MOVElefttopmCapturedView.getLeft() + dx, mCapturedView.getTop() + dyViewgetLeft()<a href=\"http://www.cnblogs.com/zhengbeibei/archive/2013/05/07/3065999.html\" target=\"_blank\" rel=\"noopener\">Android ViewgetLeft, getRight, getTop, getBottom</a></p>\n<p>offsetLeftAndRight()offsetTopAndBottom()mCapturedViewViewViewmLeftmRightmTopmBottomViewViewmCapturedViewlayout(int l, int t, int r, int b)View</p>\n<p>CallbackclampViewPositionHorizontal()clampViewPositionVertical()clampViewPositionHorizontal(View child, int left, int dx)child.getLeft()clampedX - oldLeft0mCapturedView.offsetLeftAndRight(clampedX - oldLeft)</p>\n<p>CallbackonViewPositionChanged(mCapturedView, clampedX, clampedY,clampedDx, clampedDy)ViewclampedXclampedYclampedDx clampedDy</p>\n<p>ACTION_MOVEACTION_UPACTION_MOVEmParentViewViewACTION_CANCEL</p>\n<pre><code>public void processTouchEvent(MotionEvent ev) {\n    // \n\n    switch (action) {\n        // case\n\n        case MotionEvent.ACTION_UP: {\n            if (mDragState == STATE_DRAGGING) {\n                releaseViewForPointerUp();\n            }\n            cancel();\n            break;\n        }\n\n        case MotionEvent.ACTION_CANCEL: {\n            if (mDragState == STATE_DRAGGING) {\n                dispatchViewReleased(0, 0);\n            }\n            cancel();\n            break;\n        }\n    }\n}\n</code></pre><p>ViewreleaseViewForPointerUp()dispatchViewReleased()</p>\n<pre><code>private void releaseViewForPointerUp() {\n    mVelocityTracker.computeCurrentVelocity(1000, mMaxVelocity);\n    final float xvel = clampMag(\n            VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    final float yvel = clampMag(\n            VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            mMinVelocity, mMaxVelocity);\n    dispatchViewReleased(xvel, yvel);\n}\n</code></pre><p>releaseViewForPointerUp()dispatchViewReleased()processTouchEvent()mVelocityTrackerdispatchViewReleased()</p>\n<pre><code>/**\n * Like all callback events this must happen on the UI thread, but release\n * involves some extra semantics. During a release (mReleaseInProgress)\n * is the only time it is valid to call {@link #settleCapturedViewAt(int, int)}\n * or {@link #flingCapturedView(int, int, int, int)}.\n */\nprivate void dispatchViewReleased(float xvel, float yvel) {\n    mReleaseInProgress = true;\n    mCallback.onViewReleased(mCapturedView, xvel, yvel);\n    mReleaseInProgress = false;\n\n    if (mDragState == STATE_DRAGGING) {\n        // onViewReleased didn&#39;t call a method that would have changed this. Go idle.\n        setDragState(STATE_IDLE);\n    }\n}\n</code></pre><p>CallbackonViewReleased(mCapturedView, xvel, yvel)ViewonViewReleased()mReleaseInProgressViewDragHelpersettleCapturedViewAt()flingCapturedView()CallbackonViewReleased()</p>\n<p>fling<br>flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)ViewflingflingViewflingflingCapturedViewint minLeft, int minTop, int maxLeft, int maxTopViewsettleCapturedViewAt(int finalLeft, int finalTop)</p>\n<p>settleCapturedViewAt()flingCapturedView()CallbackonViewReleased()</p>\n<pre><code>/**\n * Settle the captured view at the given (left, top) position.\n * The appropriate velocity from prior motion will be taken into account.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * @param finalLeft Settled left edge position for the captured view\n * @param finalTop Settled top edge position for the captured view\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean settleCapturedViewAt(int finalLeft, int finalTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(&quot;Cannot settleCapturedViewAt outside of a call to &quot; +\n                &quot;Callback#onViewReleased&quot;);\n    }\n\n    return forceSettleCapturedViewAt(finalLeft, finalTop,\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId));\n}\n\n/**\n * Settle the captured view based on standard free-moving fling behavior.\n * The caller should invoke {@link #continueSettling(boolean)} on each subsequent frame\n * to continue the motion until it returns false.\n *\n * @param minLeft Minimum X position for the view&#39;s left edge\n * @param minTop Minimum Y position for the view&#39;s top edge\n * @param maxLeft Maximum X position for the view&#39;s left edge\n * @param maxTop Maximum Y position for the view&#39;s top edge\n */\npublic void flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop) {\n    if (!mReleaseInProgress) {\n        throw new IllegalStateException(&quot;Cannot flingCapturedView outside of a call to &quot; +\n                &quot;Callback#onViewReleased&quot;);\n    }\n\n    mScroller.fling(mCapturedView.getLeft(), mCapturedView.getTop(),\n            (int) VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId),\n            (int) VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId),\n            minLeft, maxLeft, minTop, maxTop);\n\n    setDragState(STATE_SETTLING);\n}\n</code></pre><p>mReleaseInProgressfalsefalseIllegalStateExceptionmReleaseInProgresstruedispatchViewReleased()onViewReleased()</p>\n<p>Scroller<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a> Scroller</p>\n<p>ViewDragHelperViewsmoothSlideViewTo(View child, int finalLeft, int finalTop)</p>\n<pre><code>/**\n * Animate the view &lt;code&gt;child&lt;/code&gt; to the given (left, top) position.\n * If this method returns true, the caller should invoke {@link #continueSettling(boolean)}\n * on each subsequent frame to continue the motion until it returns false. If this method\n * returns false there is no further work to do to complete the movement.\n *\n * &lt;p&gt;This operation does not count as a capture event, though {@link #getCapturedView()}\n * will still report the sliding view while the slide is in progress.&lt;/p&gt;\n *\n * @param child Child view to capture and animate\n * @param finalLeft Final left position of child\n * @param finalTop Final top position of child\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\npublic boolean smoothSlideViewTo(View child, int finalLeft, int finalTop) {\n    mCapturedView = child;\n    mActivePointerId = INVALID_POINTER;\n\n    boolean continueSliding = forceSettleCapturedViewAt(finalLeft, finalTop, 0, 0);\n    if (!continueSliding &amp;&amp; mDragState == STATE_IDLE &amp;&amp; mCapturedView != null) {\n        // If we&#39;re in an IDLE state to begin with and aren&#39;t moving anywhere, we\n        // end up having a non-null capturedView with an IDLE dragState\n        mCapturedView = null;\n    }\n\n    return continueSliding;\n}\n</code></pre><p>mReleaseInProgresssettleCapturedViewAt()forceSettleCapturedViewAt()settleCapturedViewAt()ViewsmoothSlideViewTo()0forceSettleCapturedViewAt()Callback</p>\n<pre><code>/**\n * Settle the captured view at the given (left, top) position.\n *\n * @param finalLeft Target left position for the captured view\n * @param finalTop Target top position for the captured view\n * @param xvel Horizontal velocity\n * @param yvel Vertical velocity\n * @return true if animation should continue through {@link #continueSettling(boolean)} calls\n */\nprivate boolean forceSettleCapturedViewAt(int finalLeft, int finalTop, int xvel, int yvel) {\n    final int startLeft = mCapturedView.getLeft();\n    final int startTop = mCapturedView.getTop();\n    final int dx = finalLeft - startLeft;\n    final int dy = finalTop - startTop;\n\n    if (dx == 0 &amp;&amp; dy == 0) {\n        // Nothing to do. Send callbacks, be done.\n        mScroller.abortAnimation();\n        setDragState(STATE_IDLE);\n        return false;\n    }\n\n    final int duration = computeSettleDuration(mCapturedView, dx, dy, xvel, yvel);\n    mScroller.startScroll(startLeft, startTop, dx, dy, duration);\n\n    setDragState(STATE_SETTLING);\n    return true;\n}\n</code></pre><p>ScrollmScroller.startScroll()computeSettleDuration()</p>\n<pre><code>private int computeSettleDuration(View child, int dx, int dy, int xvel, int yvel) {\n    xvel = clampMag(xvel, (int) mMinVelocity, (int) mMaxVelocity);\n    yvel = clampMag(yvel, (int) mMinVelocity, (int) mMaxVelocity);\n    final int absDx = Math.abs(dx);\n    final int absDy = Math.abs(dy);\n    final int absXVel = Math.abs(xvel);\n    final int absYVel = Math.abs(yvel);\n    final int addedVel = absXVel + absYVel;\n    final int addedDistance = absDx + absDy;\n\n    final float xweight = xvel != 0 ? (float) absXVel / addedVel :\n            (float) absDx / addedDistance;\n    final float yweight = yvel != 0 ? (float) absYVel / addedVel :\n            (float) absDy / addedDistance;\n\n    int xduration = computeAxisDuration(dx, xvel, mCallback.getViewHorizontalDragRange(child));\n    int yduration = computeAxisDuration(dy, yvel, mCallback.getViewVerticalDragRange(child));\n\n    return (int) (xduration * xweight + yduration * yweight);\n}\n</code></pre><p>clampMag()computeAxisDuration()dxxvelmCallback.getViewHorizontalDragRange()computeAxisDuration()</p>\n<pre><code>private int computeAxisDuration(int delta, int velocity, int motionRange) {\n    if (delta == 0) {\n        return 0;\n    }\n\n    final int width = mParentView.getWidth();\n    final int halfWidth = width / 2;\n    final float distanceRatio = Math.min(1f, (float) Math.abs(delta) / width);\n    final float distance = halfWidth + halfWidth *\n            distanceInfluenceForSnapDuration(distanceRatio);\n\n    int duration;\n    velocity = Math.abs(velocity);\n    if (velocity &gt; 0) {\n        duration = 4 * Math.round(1000 * Math.abs(distance / velocity));\n    } else {\n        final float range = (float) Math.abs(delta) / motionRange;\n        duration = (int) ((range + 1) * BASE_SETTLE_DURATION);\n    }\n    return Math.min(duration, MAX_SETTLE_DURATION);\n}\n</code></pre><p>6~1014~19velocity0velocity0deltamotionRangeCallbackgetViewHorizontalDragRange()getViewVerticalDragRange()MAX_SETTLE_DURATION600CallbackgetViewHorizontalDragRange()getViewVerticalDragRange()</p>\n<p>settleCapturedViewAt()flingCapturedView()smoothSlideViewTo()mParentViewcomputeScroll()</p>\n<pre><code>@Override\npublic void computeScroll() {\n    if (mDragHelper.continueSettling(true)) {\n        ViewCompat.postInvalidateOnAnimation(this);\n    }\n}\n</code></pre><p>Scroll<a href=\"http://blog.csdn.net/qinjuning/article/details/7419207\" target=\"_blank\" rel=\"noopener\">Android-Scroller</a>  computeScroll(</p>\n<p>ViewDragHelpershouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWN</p>\n<p>shouldInterceptTouchEvent()ACTION_DOWNViewACTION_DOWNmParentViewonInterceptTouchEvent()ACTION_MOVE<a href=\"http://blog.csdn.net/xiaanming/article/details/21696315\" target=\"_blank\" rel=\"noopener\">Andriod View,ViewGroupTouch</a>ViewDragHelpershouldInterceptTouchEvent()ACTION_MOVE</p>\n<pre><code>public boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_MOVE: {\n            // First to cross a touch slop over a draggable view wins. Also report edge drags.\n            final int pointerCount = MotionEventCompat.getPointerCount(ev);\n            for (int i = 0; i &lt; pointerCount; i++) {\n                final int pointerId = MotionEventCompat.getPointerId(ev, i);\n                final float x = MotionEventCompat.getX(ev, i);\n                final float y = MotionEventCompat.getY(ev, i);\n                final float dx = x - mInitialMotionX[pointerId];\n                final float dy = y - mInitialMotionY[pointerId];\n\n                final View toCapture = findTopChildUnder((int) x, (int) y);\n                final boolean pastSlop = toCapture != null &amp;&amp; checkTouchSlop(toCapture, dx, dy);\n                if (pastSlop) {\n                    // check the callback&#39;s\n                    // getView[Horizontal|Vertical]DragRange methods to know\n                    // if you can move at all along an axis, then see if it\n                    // would clamp to the same value. If you can&#39;t move at\n                    // all in every dimension with a nonzero range, bail.\n                    final int oldLeft = toCapture.getLeft();\n                    final int targetLeft = oldLeft + (int) dx;\n                    final int newLeft = mCallback.clampViewPositionHorizontal(toCapture,\n                            targetLeft, (int) dx);\n                    final int oldTop = toCapture.getTop();\n                    final int targetTop = oldTop + (int) dy;\n                    final int newTop = mCallback.clampViewPositionVertical(toCapture, targetTop,\n                            (int) dy);\n                    final int horizontalDragRange = mCallback.getViewHorizontalDragRange(\n                            toCapture);\n                    final int verticalDragRange = mCallback.getViewVerticalDragRange(toCapture);\n                    if ((horizontalDragRange == 0 || horizontalDragRange &gt; 0\n                            &amp;&amp; newLeft == oldLeft) &amp;&amp; (verticalDragRange == 0\n                            || verticalDragRange &gt; 0 &amp;&amp; newTop == oldTop)) {\n                        break;\n                    }\n                }\n                reportNewEdgeDrags(dx, dy, pointerId);\n                if (mDragState == STATE_DRAGGING) {\n                    // Callback might have started an edge drag\n                    break;\n                }\n\n                if (pastSlop &amp;&amp; tryCaptureViewForDrag(toCapture, pointerId)) {\n                    break;\n                }\n            }\n            saveLastMotion(ev);\n            break;\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>ViewfindTopChildUnder(int x, int y)ViewcheckTouchSlop(View child, float dx, float dy)ACTION_DOWNmTouchSlopView<br>19~41if (pastSlop){}getView[Horizontal|Vertical]DragRangeclampViewPosition[Horizontal|Vertical]getView[Horizontal|Vertical]DragRange0clampViewPosition[Horizontal|Vertical]View39breaktryCaptureViewForDrag()View<br>tryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()mParentViewprocessTouchEvent()ACTION_MOVE</p>\n<p>shouldInterceptTouchEvent()ACTION_DOWN</p>\n<pre><code>public boolean shouldInterceptTouchEvent(MotionEvent ev) {\n    // ...\n\n    switch (action) {\n        // case...\n\n        case MotionEvent.ACTION_DOWN: {\n            // ...\n\n            // Catch a settling view if possible.\n            if (toCapture == mCapturedView &amp;&amp; mDragState == STATE_SETTLING) {\n                tryCaptureViewForDrag(toCapture, pointerId);\n            }\n\n            // ...\n        }\n\n        // case...\n    }\n\n    return mDragState == STATE_DRAGGING;\n}\n</code></pre><p>ViewtryCaptureViewForDrag()ViewmDragStateSTATE_DRAGGINGshouldInterceptTouchEvent()truemParentViewonInterceptTouchEvent()truemParentViewonTouchEvent()processTouchEvent()ACTION_DOWNACTION_DOWNmParentViewonTouchEvent()trueonTouchEvent()ACTION_MOVEACTION_UP</p>\n<p>ViewDragHelpershouldInterceptTouchEvent()processTouchEvent()ACTION_POINTER_DOWNACTION_POINTER_UP</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ul>\n<li><a href=\"http://www.processon.com/view/link/5550a7bae4b09739f465ec64\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://www.processon.com/view/link/5550d3dce4b09739f46789bd\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<p>~</p>\n<p></p>\n<ul>\n<li>settleCapturedViewAt(int finalLeft, int finalTop)<br>ViewCallbackonViewReleased()</li>\n<li>flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)<br>ViewflingCallbackonViewReleased()</li>\n<li>smoothSlideViewTo(View child, int finalLeft, int finalTop)<br>View0</li>\n</ul>\n<p>Callback</p>\n<ul>\n<li><p>void onViewDragStateChanged(int state)</p>\n<p>stateSTATE_IDLESTATE_DRAGGINGSTATE_SETTLING</p>\n<p>setDragState()setDragState()</p>\n<ul>\n<li>tryCaptureViewForDrag()View<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n</ul>\n</li>\n<li>settleCapturedViewAt()smoothSlideViewTo()flingCapturedView()</li>\n<li>ViewprocessTouchEvent()ACTION_UPACTION_CANCEL</li>\n<li>continueSettling()</li>\n<li>abort()</li>\n</ul>\n</li>\n<li><p>void onViewPositionChanged(View changedView, int left, int top, int dx, int dy)</p>\n<p>ViewView</p>\n<ul>\n<li>dragTo()</li>\n<li>continueSettling()</li>\n<li>abort()</li>\n</ul>\n</li>\n<li><p>void onViewCaptured(View capturedChild, int activePointerId)</p>\n<p>tryCaptureViewForDrag()View</p>\n<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n<li>captureChildView()</li>\n</ul>\n</li>\n<li><p>void onViewReleased(View releasedChild, float xvel, float yvel)<br>ViewprocessTouchEvent()ACTION_UPViewprocessTouchEvent()ACTION_CANCEL</p>\n</li>\n<li><p>void onEdgeTouched(int edgeFlags, int pointerId)<br>ACTION_DOWNACTION_POINTER_DOWNedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM</p>\n</li>\n<li><p>boolean onEdgeLock(int edgeFlags)<br>trueedgeFlagsonEdgeDragStarted()falseedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOM</p>\n</li>\n<li><p>void onEdgeDragStarted(int edgeFlags, int pointerId)<br>ACTION_MOVEedgeFlagsEDGE_LEFTEDGE_TOPEDGE_RIGHTEDGE_BOTTOMcaptureChildView()View</p>\n</li>\n<li><p>int getOrderedChildIndex(int index)<br>ViewViewtryCaptureViewForDrag()ViewViewView</p>\n</li>\n<li><p>int getViewHorizontalDragRange(View child)int getViewVerticalDragRange(View child)</p>\n<p>child0ACTION_DOWNchild0</p>\n<p></p>\n<ul>\n<li>checkTouchSlop()0mTouchSlopACTION_MOVEtryCaptureViewForDrag()checkTouchSlop()checkTouchSlop()View</li>\n<li>ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVErange00View</li>\n<li>smoothSlideViewTo()getView[Horizontal|Vertical]DragRange0</li>\n</ul>\n</li>\n<li><p>boolean tryCaptureView(View child, int pointerId)</p>\n<p>tryCaptureViewForDrag()truechildtryCaptureViewForDrag()</p>\n<ul>\n<li>shouldInterceptTouchEvent()ACTION_DOWN</li>\n<li>shouldInterceptTouchEvent()ACTION_MOVE</li>\n<li>processTouchEvent()ACTION_MOVE</li>\n</ul>\n</li>\n<li><p>int clampViewPositionHorizontal(View child, int left, int dx)int clampViewPositionVertical(View child, int top, int dy)</p>\n<p>childchildclampViewPositionHorizontal()childleftclampViewPositionVertical()childtop</p>\n<p></p>\n<ul>\n<li>dragTo()dragTo()processTouchEvent()ACTION_MOVEView</li>\n<li>ACTION_DOWNViewshouldInterceptTouchEvent()ACTION_MOVElefttopView</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ViewDragHelper</p>\n<ol>\n<li><a href=\"https://github.com/flavienlaurent/flavienlaurent.com\" target=\"_blank\" rel=\"noopener\">YoutubeLayout</a>Demo</li>\n<li><a href=\"https://github.com/BlueMor/DragLayout\" target=\"_blank\" rel=\"noopener\">QQ5.x</a><a href=\"https://github.com/kyze8439690/ResideLayout\" target=\"_blank\" rel=\"noopener\">ResideLayout</a></li>\n<li><a href=\"https://github.com/ikew0ng/SwipeBackLayout\" target=\"_blank\" rel=\"noopener\">SwipeBackLayout</a><a href=\"https://github.com/liuguangqiang/SwipeBack\" target=\"_blank\" rel=\"noopener\">SwipeBack</a></li>\n<li><a href=\"https://github.com/umano/AndroidSlidingUpPanel\" target=\"_blank\" rel=\"noopener\">SlidingUpPanel</a></li>\n<li><a href=\"https://github.com/android/platform_frameworks_support/blob/master/v4/java/android/support/v4/widget/DrawerLayout.java\" target=\"_blank\" rel=\"noopener\">DrawerLayout</a></li>\n</ol>\n<h3 id=\"ViewDragHelper\"><a href=\"#ViewDragHelper\" class=\"headerlink\" title=\"ViewDragHelper\"></a>ViewDragHelper</h3><ul>\n<li><a href=\"http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper\" target=\"_blank\" rel=\"noopener\">Each Navigation Drawer Hides a ViewDragHelper</a><a href=\"https://github.com/flavienlaurent/flavienlaurent.com\" target=\"_blank\" rel=\"noopener\">YoutubeLayout</a></li>\n<li><a href=\"http://blog.csdn.net/pi9nc/article/details/39583377\" target=\"_blank\" rel=\"noopener\">ViewDragHelper</a></li>\n</ul>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ck2yl86ay0001lh1pmzb7qwil","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86b30003lh1pfc6viuay"},{"post_id":"ck2yl86bv0004lh1pcdyds597","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86c10008lh1pw5p07kco"},{"post_id":"ck2yl86c5000blh1px246pmbu","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86c9000elh1ph8ix12cx"},{"post_id":"ck2yl86c3000alh1pygir4rq5","tag_id":"ck2yl86c7000clh1pq6g9vvah","_id":"ck2yl86cd000ilh1pk6hhsksh"},{"post_id":"ck2yl86cd000jlh1px5hwn8uk","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86ci000mlh1pumixqm7h"},{"post_id":"ck2yl86c7000dlh1pma10bvvf","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86ck000olh1phhahcuzm"},{"post_id":"ck2yl86cf000klh1plklptp9a","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86cm000rlh1pz0jpr5an"},{"post_id":"ck2yl86ci000nlh1ps1e2mcj7","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86co000tlh1p1a4093ps"},{"post_id":"ck2yl86ca000flh1pdt4qtfci","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86cp000wlh1p3s6zzocz"},{"post_id":"ck2yl86cm000slh1poacbevkx","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86cq000xlh1p3tb1q0im"},{"post_id":"ck2yl86cc000glh1p0w5h4dho","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86cr000zlh1pc6itltbs"},{"post_id":"ck2yl86ck000plh1pwfojm0kt","tag_id":"ck2yl86cp000vlh1poxbpjnwv","_id":"ck2yl86cr0010lh1pefeice9v"},{"post_id":"ck2yl86co000ulh1p4nyxiwdg","tag_id":"ck2yl86cp000vlh1poxbpjnwv","_id":"ck2yl86cs0011lh1pwdl4amm3"},{"post_id":"ck2yl86df0012lh1pdh6pyici","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86di0014lh1pby1w7o1g"},{"post_id":"ck2yl86dl0018lh1pucv074ej","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86dp001blh1p2uzj1kbr"},{"post_id":"ck2yl86dn0019lh1pqqq8oa2h","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86dq001dlh1p8ego5023"},{"post_id":"ck2yl86dp001clh1pmwrxyvss","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86ds001glh1p6ld0w93t"},{"post_id":"ck2yl86dh0013lh1pkq0tk3hu","tag_id":"ck2yl86dk0016lh1pcd7dgvhb","_id":"ck2yl86dt001ilh1pa3yhc1wu"},{"post_id":"ck2yl86dh0013lh1pkq0tk3hu","tag_id":"ck2yl86do001alh1pc0tnbex5","_id":"ck2yl86du001klh1pwk2q8ro5"},{"post_id":"ck2yl86dr001elh1p2e8klfdt","tag_id":"ck2yl86cd000hlh1pfuo0e1jd","_id":"ck2yl86dv001llh1phcoruyco"},{"post_id":"ck2yl86dt001hlh1p7ddmr0qu","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86dv001nlh1pi16zl9qs"},{"post_id":"ck2yl86di0015lh1pu5edl6e8","tag_id":"ck2yl86dk0016lh1pcd7dgvhb","_id":"ck2yl86dw001olh1pnsrw5yu3"},{"post_id":"ck2yl86di0015lh1pu5edl6e8","tag_id":"ck2yl86do001alh1pc0tnbex5","_id":"ck2yl86dw001qlh1pvgcpaynn"},{"post_id":"ck2yl86dk0017lh1p03r88n5a","tag_id":"ck2yl86dk0016lh1pcd7dgvhb","_id":"ck2yl86dx001rlh1pheq8y2ki"},{"post_id":"ck2yl86dk0017lh1p03r88n5a","tag_id":"ck2yl86do001alh1pc0tnbex5","_id":"ck2yl86dx001slh1pj0kp1vsn"},{"post_id":"ck2yl86ep001tlh1pxdspgpfw","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86eq001vlh1p9ox35dbq"},{"post_id":"ck2yl86ep001ulh1p5atkwl16","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86es001xlh1pamwm3hlz"},{"post_id":"ck2yl86eq001wlh1pzl6ybvq9","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86es001ylh1p0mwqswkr"},{"post_id":"ck2yl86f6001zlh1pji1bujb1","tag_id":"ck2yl86dk0016lh1pcd7dgvhb","_id":"ck2yl86f70020lh1pmdnajz8r"},{"post_id":"ck2yl86f6001zlh1pji1bujb1","tag_id":"ck2yl86do001alh1pc0tnbex5","_id":"ck2yl86f70021lh1p75wejlmz"},{"post_id":"ck2yl86fi0022lh1p3v9rraqn","tag_id":"ck2yl86b10002lh1ppxijhwmw","_id":"ck2yl86fj0024lh1pwwz4yl95"},{"post_id":"ck2yl86fi0022lh1p3v9rraqn","tag_id":"ck2yl86fj0023lh1p2vuepgpd","_id":"ck2yl86fj0025lh1pj3122w1v"}],"Tag":[{"name":"Android","_id":"ck2yl86b10002lh1ppxijhwmw"},{"name":"android","_id":"ck2yl86c7000clh1pq6g9vvah"},{"name":"design-pattern","_id":"ck2yl86cd000hlh1pfuo0e1jd"},{"name":"java","_id":"ck2yl86cp000vlh1poxbpjnwv"},{"name":"","_id":"ck2yl86dk0016lh1pcd7dgvhb"},{"name":"Efficient.Android.Threading","_id":"ck2yl86do001alh1pc0tnbex5"},{"name":"","_id":"ck2yl86fj0023lh1p2vuepgpd"}]}}